'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[17],{1253:function(t,F,a){t=a(0);var c=a(963),b=a(4);class e{}Object(t.a)(e,"LokiTokenResult",null,[]);class f{constructor(r){this.PVb=r}nhd(){const r=this.iYh();return r?f.Crd?new Promise((A,x)=>{this.PVb.continueWith(()=>{this.PVb.kh||this.PVb.Hf?x(Error.create("Error downloading auth library")):this.PVb.result.wO("Loki",r).then(n=>{n=b.AFrameworkApplication.fa.pa("ForceLokiFallbackToACLPTokenIsEnabled")?this.lYh():
n.IsSuccess&&n.Token?Object.assign(new e,{isSuccess:!0,token:n.Token,errorMessage:null}):Object.assign(new e,{isSuccess:!1,token:null,errorMessage:JSON.stringify(n)});A(n);return n})})}):Promise.resolve(Object.assign(new e,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):Promise.resolve(Object.assign(new e,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",c.a.r0e())}))}lYh(){const r=
b.AFrameworkApplication.fa.Wa("LokiUserDataSignature")||"";return Object.assign(new e,{isSuccess:!0,token:r,errorMessage:null})}iYh(){let r=null;const A=c.a.nbc();2===A?r=b.AFrameworkApplication.fa.Wa("LokiAADAppId"):1===A&&(r=b.AFrameworkApplication.fa.Wa("LokiMSAAppId"));return r}static get Crd(){return b.AFrameworkApplication.fa.pa("IsO365CommercialHost")||b.AFrameworkApplication.fa.pa("IsO365ConsumerHost")}}Object(t.a)(f,"LokiTokenManager",null,[715]);var d=a(252),h=a(83),m=a(518);class l{get name(){return"Common.App.LivePersonaUtils"}init(){h.a.instance.resolve("Common.ILokiTokenManager")}dispose(){}Ah(r){r.register(f,
"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").qc().yc(()=>new f(m.a.Pq(r.Tb("Common.App.OAuth.IOAuthManager"))))}static main(){d.a.instance.gi(new l)}}Object(t.a)(l,"LivePersonaUtilsPackage",null,[4,5]);a.d(F,"a",function(){return v});const v=()=>{Type.registerNamespace("Common.App.LivePersonaUtils");l.main()}},1276:function(t,F,a){var c=a(9);t=a(0);var b=a(83),e=a(226),f=a(7),d=a(15),h=a(854);class m{constructor(A){this.oAuthManager=A}wO(A,x){return this.oAuthManager?
this.oAuthManager.wO(A,x).then(n=>{n.IsSuccess||d.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+n.ErrorMessage+" Error code: "+n.ErrorCode+" App name: "+A);return Object(f.a)(new h.a,{IsSuccess:n.IsSuccess,Token:n.Token,ErrorCode:n.ErrorCode,ErrorMessage:n.ErrorMessage})}):(d.ULS.sendTraceTag(537154971,0,10,"Oauth manager is null"),Promise.resolve(Object(f.a)(new h.a,{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",ErrorMessage:"Failed to resolve IOAuthManager from the container."})))}o6a(){return this.oAuthManager?
this.oAuthManager.o6a():null}}Object(t.a)(m,"OAuthManagerWrapper",null,[430]);var l=a(712);class v extends e.a{constructor(A){super();this.$=A;this.Db()}create(){this.nb(Object(l.a)(this.$.da,349,()=>new m(b.a.instance.resolve("Common.App.OAuth.IOAuthManager"))))}static ka(A){A.da.Ha(350,new v(A))}}Object(t.a)(v,"OAuthManagerFactory",e.a,[]);a.d(F,"a",function(){return r});const r=()=>{c.a.Fa(A=>{v.ka(A)})}},1301:function(t,F,a){t=a(0);var c=a(15),b=a(861),e=a(940),f=a(4),d=a(99),h=a(555),m=a(252),
l=a(39),v=a(40),r=a(27),A=a(111),x=a(83),n=a(193);class u{get name(){return"Common.App.OAuth.OAuthPackage"}Ah(w){w.register(410,"Common.App.OAuth.IOAuthManager").qc().yc(()=>new b.OAuthManager)}init(){const w=x.a.instance.resolve("Common.App.OAuth.IOAuthManager");this.NWj(w)}NWj(w){const C=f.AFrameworkApplication.fa.Wa("FileSource");if(f.AFrameworkApplication.fa.pa("IsO365ConsumerHost")||f.AFrameworkApplication.fa.pa("IsO365CommercialHost")||"WopiTest"===C){var y=h.OAuthManagerSettings.S4c;if(y&&
y.IsEnabled){var B=y.Application,H=h.OAuthManagerSettings.authority;if(void 0!==B&&null!==B&&B.length&&void 0!==H&&null!==H&&H.length){var I=e.a[w.oS],R=r.a.psa,S=w.mv();try{var G=new Map;void 0!==G&&null!==G?(G.set("SupportStatus",I),G.set("Browser",R),G.set("AuthStrategy",S)):G=null}catch(E){G=null}d.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT","WacOAuthFC",G);var D=v.a.Ud();w.wO("Core",B).then(E=>{const M=Math.floor(v.a.Ud()-D);I=e.a[w.oS];R=r.a.psa;S=w.mv();c.ULS.sendTraceTag(562943369,
3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',M,E.IsSuccess,I,E.ErrorCode,C,R,S);G&&(G.set("SupportStatus",I),G.set("Browser",R),G.set("AuthStrategy",S));var L=Object.assign(new n.a,{durationMs:M,extendedProperties:G});if(E.IsSuccess){if(d.Health.instance.recordKpiSuccess("WacCorePFT",L),E="Bearer "+E.Token,f.AFrameworkApplication.Bd.i2d=E,L=y.Endpoint){var N=v.a.Ud();
f.AFrameworkApplication.Bd.Xnb(L,1,null,{["Authorization"]:E},"OAuthManagerValidateAccess",void 0,void 0,void 0,2E4).continueWith(Y=>{var U=Math.floor(v.a.Ud()-N),P=null;Y.kh?Y="Canceled":Y.Hf?Y="Faulted":(P=Y.result,Y=P.succeeded?"Completed":"Failed");U={["TaskResult"]:Y,["BrowserTokenDurationMS"]:M,["BrowserValidationDurationMS"]:U};P&&(U.HttpStatus=P.Cg.data.httpStatus,P.succeeded&&(P=l.a(P.Cg.data.de),U.ServerValidationDurationMS=P.ElapsedMilliseconds,U.ServerValidationResult=P.ValidatedToken,
U.KMSI=P.KMSI,U.Scopes=P.Scopes,U.TokenExpirationS=Math.floor(parseInt(P.Expiration)-(new Date).getTime()/1E3)));c.ULS.sendTraceTag(520632322,3E3,"Completed"===Y?50:15,A.a.toJSON(U))})}}else d.Health.instance.recordKpiFailure("WacCorePFT",E.ErrorCode,!1,!1,L)}).catch(E=>{var M=Math.floor(v.a.Ud()-D);M=Object.assign(new n.a,{durationMs:M,extendedProperties:G});d.Health.instance.recordKpiFailure("WacCorePFT","UNEXPECTED CATCH: "+E.toString(),!1,!1,M)})}}}}dispose(){}static main(){m.a.instance.gi(new u)}static Vfj(){m.a.instance.gi(new u,
0,!0)}}Object(t.a)(u,"OAuthPackage",null,[4,5]);a.d(F,"a",function(){return z});const z=w=>{Type.registerNamespace("Common.App.OAuth");w?u.Vfj():u.main()}},1492:function(t,F,a){a.r(F);t=a(1301);F=a(1253);a=a(1276);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");Object(t.a)();Object(F.a)();Object(a.a)()},861:function(t,F,a){a.r(F);t=a(0);var c=a(15),b=a(1426),e=a(940),f;(function(da){da[da.external=0]="external";da[da.msa=1]="msa";da[da.aad=2]="aad"})(f||(f=
{}));Object(t.b)("AuthorityType",f);class d{}Object(t.a)(d,"OAuthResult",null,[]);class h{constructor(da){this.rAg=da}initialize(){return Promise.resolve(0)}xlc(){return Promise.resolve(0)}wO(){c.ULS.sendTraceTag(574239257,3E3,50,"Automation flag set.  Returning Mock Token.");return Promise.resolve(Object.assign(new d,{IsSuccess:!0,Token:this.rAg}))}SCc(){return Promise.resolve(Object.assign(new d,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}lBc(){return!1}Oxb(){return"MockAuthTokenStrategy"}}
Object(t.a)(h,"MockAuthTokenStrategy",null,[452]);var m=a(963);class l{static get(da,qa,O){if(!O)return da;let ca=0;return Promise.race([da,new Promise(wa=>{ca=window.setTimeout(()=>{wa(qa)},O)})]).then(wa=>{window.clearTimeout(ca);return Promise.resolve(wa)}).catch(()=>{window.clearTimeout(ca);return Promise.resolve(qa)})}}Object(t.a)(l,"PromiseWithTimeout",null,[]);var v=a(4),r=a(555);class A{constructor(da,qa,O,ca,wa){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=
null;this.resource=da;this.scope=qa;this.silentLogin=O;this.options=ca;this.correlationId=wa}}Object(t.a)(A,"TokenRequestParameters",null,[461]);var x=a(27),n=a(83);class u{constructor(){this.Gme=null;let da=v.AFrameworkApplication.fa.Wa(v.AFrameworkApplication.C7),qa=v.AFrameworkApplication.fa.Wa(v.AFrameworkApplication.shg);this.TXa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",da&&""!==da?da:"Unspecified",qa&&""!==qa?qa:"Unspecified")}initialize(){return new Promise(da=>
{n.a.instance.Tb("Common.App.WopiIdentity.IWopiIdentity").execute(qa=>{this.Gme=qa;da(0)})})}ni(da){const qa=["HTTPS:","API:"];let O=!1;const ca=da.toLocaleUpperCase();for(const wa of qa)if(ca.startsWith(wa)){O=!0;break}return O||this.upi(da)?da+"/.default":da}upi(da){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(da)}xlc(){return Promise.resolve(0)}wO(da,qa,O,ca,wa,ia,Ha){if(x.a.hxa){wa=r.OAuthManagerSettings.x5j;if(!wa)return qa=Object.assign(new d,
{IsSuccess:!1,ErrorCode:"TeamsNoAllowListFound",ErrorMessage:"No app list was found."}),Promise.resolve(qa);if(!Array.contains(wa,da))return qa=Object.assign(new d,{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+da}),Promise.resolve(qa)}da=this.ni(O);O=new A(O,da,!ca,null,v.AFrameworkApplication.userSessionId);return this.Gme.getAccessToken(O,qa,Ha).then(Sa=>Object.assign(new d,{IsSuccess:!0,Token:Sa.accessToken}),Sa=>Object.assign(new d,{IsSuccess:!1,ErrorCode:Sa}))}SCc(){return Promise.resolve(Object.assign(new d,
{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}lBc(){return!1}Oxb(){return this.TXa}}Object(t.a)(u,"ParentFrameTokenStrategy",null,[452]);var z=a(85),w=a(869),C=a(191);class y{constructor(){this.reject=this.resolve=null;this.startTime=0;this.FPf=this.Qwe=null}}Object(t.a)(y,"PromiseWrapper",null,[]);class B{constructor(da=0){this.MB=0;this.tlb=!1;this.Hm=new C.a;this._timeout=da}enqueue(da){return new Promise((qa,
O)=>{this.Hm.add(Object.assign(new y,{FPf:da,resolve:qa,reject:O}));this.process()})}process(){if(this.tlb||this.MB===this.Hm.count)return!1;const da=this.Hm.ma(this.MB++);try{this.tlb=!0,da.FPf().then(qa=>{this.tlb=!1;this.Q3c(da,qa,null,!0)}).catch(qa=>{this.tlb=!1;this.Q3c(da,null,qa,!1)})}catch(qa){this.tlb=!1,this.Q3c(da,null,qa,!1)}return!0}Q3c(da,qa,O,ca){if(ca){const wa=()=>{da.resolve(qa);this.process()};0<this._timeout?window.setTimeout(()=>{wa()},this._timeout):wa()}else{const wa=()=>{da.reject(O);
this.process()};0<this._timeout?window.setTimeout(()=>{wa()},this._timeout):wa()}}}Object(t.a)(B,"PromiseQueue",null,[]);class H{constructor(){this.correlationId=this.resolve=null}}Object(t.a)(H,"ResolveWithCorrelation",null,[]);var I=a(84),R=a(150),S=a(838),G=a(167);class D extends R.a{constructor(da,qa,O,ca,wa,ia){super(!1,!1,!0);this.b8d=this.d1=null;this.OX=da;this.VBg=O;this.Kv=ca;this.IFg=wa;this.YDa=ia;this.Is=document.createElement("iframe");this.Is.id="SharedAuthInteractiveFrame";this.Is.setAttribute("name",
"SharedAuthInteractiveFrame");this.Is.setAttribute("title","SharedAuthInteractiveFrame");this.Is.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.Is.style.border="0";this.Is.style.height="48px";this.Is.style.width="190px";$addHandler(this.Is,"error",Object(z.a)(this,this.FZi,"onSharedAuthFrameError"));da=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}",this.OX,qa,"?replyUrl=",window.location.protocol,"//",window.location.host,"&interactive=1","&WacUserType=",v.AFrameworkApplication.userType);
this.Is.src=da;this.xvg=new Promise(Ha=>{this.b8d=Ha});this.c8d=!1}zzc(){this.d1={["id"]:"SharedAuthConsentDialog",["bodyControls"]:{["promptMessage"]:this.VBg,["errorText"]:CommonUIStrings.l_InternalError,["rtl"]:v.AFrameworkApplication.isRtl,["frameLoaded"]:!1,["createFrame"]:Object(z.a)(this,this.hdh,"createFrame"),["resolveDialogStyles"]:this.b8d}};this.Ob=5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(z.a)(this,this.qDj,"sharedAuthConsentDialogHandler"),this.d1)}jEc(da=!1,qa=!1,O=5){this.d1&&
this.d1.bodyControls&&(da!==Object(I.a)(Object,this.d1.bodyControls).frameLoaded&&(Object(I.a)(Object,this.d1.bodyControls).frameLoaded=da),qa!==Object(I.a)(Object,this.d1.bodyControls).frameLoadSuccess&&(Object(I.a)(Object,this.d1.bodyControls).frameLoadSuccess=qa),O!==this.d1.dialogButtonsOption&&(this.d1.dialogButtonsOption=null,this.Ob=O),this.update(this.d1))}OJj(da,qa){const O=new S.a(G.a.uDj);O.Values={["signInLabel"]:CommonUIStrings.l_SignIn,["cancelLabel"]:CommonUIStrings.l_DialogCancel,
["rtl"]:v.AFrameworkApplication.isRtl,["messageCorrelationId"]:da,["dialogStyles"]:qa};this.Kv.HRa(O,this.Is.contentWindow,this.OX)}pZe(){this.jEc(!0,!1,6)}get j7f(){return this.Is}get xmh(){return this.xvg.then(da=>{this.c8d=!0;return da})}get ymh(){return this.c8d}FZi(){this.pZe()}hdh(){return this.Is}qDj(da){0===da&&(this.IFg.reject(Object.assign(new d,{ErrorCode:"UserCancelled",ErrorMessage:"The interactive flow was cancelled by the user"})),this.YDa(null))}}Object(t.a)(D,"SharedAuthConsentDialog",
R.a,[460]);var E=a(1263),M=a(99),L=a(138),N=a(40),Y=a(174),U=a(193);class P{constructor(){this.Is=null;this.eUb=0;this.Ekb=this.hYa=this.pHc=this.YDa=this.GL=this.Fle=null;this.Kv=new E.a(null,null);this.TXa="SharedAuthTokenStrategy Unloaded";this.OX=r.OAuthManagerSettings.sDj;this.Gje=r.OAuthManagerSettings.rDj;this.N8d=r.OAuthManagerSettings.enableConsoleLogging;this.Pvg=v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",!1);this.eEg=v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",
!1);this.Yqa={};this.oyg=new B(1500)}Oxb(){return this.TXa}initialize(){var {OAuthManager:da}=a(861);if("loadFrame"in this.Yqa)return this.Yqa.loadFrame.Qwe;if(!this.OX)return M.Health.instance.recordKpiFailure(da.kpiName,"SharedAuthFrameOriginNotSet",!1,!1,null),c.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),Promise.reject(1);da=this.RAc("loadFrame");this.eUb=N.a.Ud();var qa=this.OX+this.Gje+"?replyUrl="+window.location.protocol+"//"+window.location.host+
"&usid="+v.AFrameworkApplication.userSessionId+"&WacUserType="+v.AFrameworkApplication.userType;this.Is=document.createElement("iframe");this.Jgi(this.Is);this.Is.style.cssText="height:0;width:0;display:none;";this.Is.id="SharedAuthFrame";this.Is.setAttribute("name","SharedAuthFrame");this.Is.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.Is.setAttribute("title","SharedAuthFrame");this.Is.src=qa;document.body.appendChild(this.Is);qa=N.a.Ud()-this.eUb;c.ULS.sendTraceTag(573112899,
3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",qa,this.Is.src);return da}xlc(da){this.pHc=da;const qa=new S.a(G.a.m7f);qa.Values=this.qwe(da);da=this.RAc("initFrame");this.Kv.HRa(qa,this.Is.contentWindow,this.OX);c.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");return da}wO(da,qa,O,ca,wa,ia){const Ha=new S.a(G.a.vDj),Sa=this.C6e();Ha.Values=this.Ngg(da,qa,O,ca,wa,ia,Sa);da=this.RAc(Sa);ca&&v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",
!1)?this.oyg.enqueue(()=>new Promise(Da=>{this.dWj(ia,Ha,Da,Sa)})):(this.Kv.HRa(Ha,this.Is.contentWindow,this.OX),c.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",qa));return da}dWj(da,qa,O,ca){const wa=this.Yqa[ca];wa&&(this.hYa=qa,this.YDa=Object.assign(new H,{resolve:O,correlationId:ca}),this.GL=new D(this.OX,this.Gje,da,this.Kv,wa,O),this.GL.zzc())}C6e(){return Y.a.create().toString()}Ngg(da,qa,O,ca,wa,ia,Ha){const Sa={};Sa.appName=da;Sa.appId=
qa;Sa.target=O;Sa.withPopup=ca;Sa.claims=wa;Sa.promptMessage=ia;Sa.messageCorrelationId=Ha;return Sa}Jgi(da){$addHandler(da,"load",Object(z.a)(this,this.BUi,"onIFrameLoaded"));$addHandler(da,"error",Object(z.a)(this,this.lpc,"onIFrameError"));this.Kv.PFa(this.OX);this.Kv.Yn(G.a.p7f);this.Kv.Dl(G.a.p7f,Object(z.a)(this,this.WYi,"onScriptLoaded"));this.Kv.Yn(G.a.o7f);this.Kv.Dl(G.a.o7f,Object(z.a)(this,this.VYi,"onScriptInitialized"));this.Kv.Yn(G.a.k7f);this.Kv.Dl(G.a.k7f,Object(z.a)(this,this.cUi,
"onGetTokenResponse"));this.Kv.Yn(G.a.q7f);this.Kv.Dl(G.a.q7f,Object(z.a)(this,this.VVi,"onLoginResponse"));this.Kv.Yn(G.a.n7f);this.Kv.Dl(G.a.n7f,Object(z.a)(this,this.YUi,"onInteractiveFlowReady"));this.Kv.Yn(G.a.l7f);this.Kv.Dl(G.a.l7f,Object(z.a)(this,this.uUi,"onHideDialog"));this.Kv.Yn(G.a.i7f);this.Kv.Dl(G.a.i7f,Object(z.a)(this,this.pPi,"onCloseDialog"))}RAc(da){const qa=new y;qa.startTime=N.a.Ud();const O=new Promise((ca,wa)=>{qa.resolve=ca;qa.reject=wa});qa.Qwe=O;this.Yqa[da]=qa;return O}BUi(){const da=
N.a.Ud()-this.eUb;c.ULS.sendTraceTag(572346566,3E3,50,"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",da)}lpc(da){const {OAuthManager:qa}=a(861),O=N.a.Ud()-this.eUb,ca=Object.assign(new U.a,{durationMs:O});M.Health.instance.recordKpiFailure(qa.kpiName,"SharedAuthWACOAuthAspxFrameError",!1,!0,ca);c.ULS.sendTraceTag(572346567,3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",O,this.N8d?JSON.stringify(da):"")}WYi(da){const {OAuthManager:qa}=a(861),O=this.Yqa.loadFrame;var ca=N.a.Ud()-
O.startTime,wa=da.Values.AuthLibrary.toString();da=da.Values.Success.toString();c.ULS.sendTraceTag(573112902,3E3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",da,wa,ca);wa&&(this.TXa="SharedAuthTokenStrategy "+wa);wa=Boolean.parse(da);wa||(da=L.a.Pr(),void 0!==da&&null!==da&&(da.set("AuthLibrary",this.Oxb()),ca=Object.assign(new U.a,{durationMs:ca,extendedProperties:da}),M.Health.instance.recordKpiFailure(qa.kpiName,"SharedAuthStrategyInitFailed",!1,!0,ca)));
O.resolve(wa?0:1)}VYi(da){if(da.Values.interactive&&this.hYa&&this.hYa.Values.messageCorrelationId){const O=this.hYa.Values.messageCorrelationId.toString();if(da.Values.interactive&&this.GL){this.GL.xmh.then(ca=>{this.Kv.HRa(this.hYa,this.GL.j7f.contentWindow,this.OX);this.GL.OJj(O,ca);this.GL.jEc(!0,!0);this.hYa=null});return}}da=this.Yqa.initFrame;const qa=N.a.Ud()-da.startTime;c.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",qa);da.resolve(0)}cUi(da){if(da.Values.messageCorrelationId&&
da.Values.messageCorrelationId.toString()){var qa=da.Values.messageCorrelationId.toString(),O=this.Yqa[qa];if(O){var ca=N.a.Ud()-O.startTime;c.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",ca);da.Values.isSuccess&&da.Values.isSuccess?O.resolve(da.Values.response):O.reject(da.Values.response);this.bhg(qa)}else c.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else c.ULS.sendTraceTag(573112904,
3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")}YUi(){if(this.GL.ymh)this.GL.pZe();else if(this.pHc&&this.GL){const da=new S.a(G.a.m7f);da.Values=this.qwe(this.pHc,!0);this.Kv.HRa(da,this.GL.j7f.contentWindow,this.OX)}}uUi(){this.GL&&this.GL.Wyb()}pPi(da){da.Values.cancelled&&da.Values.cancelled&&da.Values.messageCorrelationId&&this.bhg(da.Values.messageCorrelationId.toString());this.GL&&this.GL.hide()}qwe(da,qa=!1){const O={};O.appIds=this.DOh();O.upn=
da.loginHint;O.authority=da.authority;O.authorityType=Object(b.a)(f,da.authorityType);O.tenantId=da.tenantId;O.correlationId=v.AFrameworkApplication.userSessionId;O.enableConsoleLogging=this.N8d;O.enablePopupFlash=this.Pvg;O.skipUpnCheck=this.eEg;O.interactive=qa;return O}DOh(){const da=[],qa=r.OAuthManagerSettings.DYc;for(let O in qa)Array.add(da,qa[O]);return da}SCc(da,qa,O,ca,wa,ia){const Ha=new S.a(G.a.tDj),Sa=this.C6e();Ha.Values=this.Ngg(da,qa,O,ca,wa,ia,Sa);this.Fle=Ha;da=this.RAc(Sa);c.ULS.sendTraceTag(555049437,
3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",qa);this.yHj();return da}lBc(){return!0}yHj(){this.Ekb||(this.Ekb=new w.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,null),this.Ekb.id=16,this.Ekb.wrd=!1,this.Ekb.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,()=>{c.ULS.sendTraceTag(527827290,3E3,50,"SharedAuthTokenStrategy TryLogin: User Clicked Login");this.Kv.HRa(this.Fle,this.Is.contentWindow,this.OX)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,
!0),c.ULS.sendTraceTag(555049438,3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))}VVi(da){if(da.Values.messageCorrelationId&&da.Values.messageCorrelationId.toString()){var qa=this.Yqa[da.Values.messageCorrelationId.toString()];if(qa){var O=N.a.Ud()-qa.startTime;c.ULS.sendTraceTag(555049441,3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",O);da.Values.isSuccess&&da.Values.isSuccess?qa.resolve(da.Values.response):qa.reject(da.Values.response)}else c.ULS.sendTraceTag(555049440,
3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else c.ULS.sendTraceTag(555049439,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")}bhg(da){this.YDa&&this.YDa.correlationId===da&&(this.YDa.resolve(null),this.YDa=null)}}Object(t.a)(P,"SharedAuthTokenStrategy",null,[452]);class aa{constructor(da){this.zRc=da;this.TXa="UnsupportedAuthTokenStrategy Reason="+e.a[this.zRc]}initialize(){return Promise.resolve(0)}xlc(){return Promise.resolve(0)}wO(){return Promise.resolve(Object.assign(new d,
{IsSuccess:!1,ErrorCode:e.a[this.zRc],ErrorMessage:"Unable to get a token. Reason: ["+e.a[this.zRc]+"]"}))}SCc(){return Promise.resolve(Object.assign(new d,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}lBc(){return!1}Oxb(){return this.TXa}}Object(t.a)(aa,"UnsupportedAuthTokenStrategy",null,[452]);var X=a(730);a.d(F,"OAuthManager",function(){return Z});class Z{constructor(da=null){this.oS=
0;this.JO=null;this.BCg=0;const qa=N.a.Ud();this.dyg=this.Olh(da).then(O=>O?this.Wei():(c.ULS.sendTraceTag(527827277,3E3,15,"DetermineAuthLibrary failed leaving {0} in {1} ms, all future TryGetToken requests will fail.",this.mv(),Math.floor(N.a.Ud()-qa)),O=L.a.Pr(),void 0!==O&&null!==O&&(O.set("AuthLibrary",this.mv()),O=Object.assign(new U.a,{durationMs:Math.floor(N.a.Ud()-qa),extendedProperties:O}),M.Health.instance.recordKpiFailure(Z.kpiName,"StrategyPickFailed",!1,!0,O)),Promise.resolve(1))).then(O=>
0!==O?Promise.resolve(O):this.Xzi())}Plh(){var da=r.OAuthManagerSettings.zIi;da&&0<da.length?(this.oS=1,this.JO=new h(da)):v.AFrameworkApplication.fa.pa("IsO365ConsumerHost")||v.AFrameworkApplication.fa.pa("IsO365CommercialHost")?v.AFrameworkApplication.fa.pa("IsAnonymousUser")?(this.oS=2,this.JO=new aa(this.oS)):(da=m.a.getAuthContext().loginHint)&&da.length?r.OAuthManagerSettings.$yb?(this.oS=1,this.JO=new u):(this.oS=1,this.JO=new P):(this.oS=3,this.JO=new aa(this.oS)):(this.oS=4,this.JO=new aa(this.oS))}mv(){return this.JO?
this.JO.Oxb()||"Unknown":"None"}Olh(da=null){c.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");const qa=N.a.Ud();return v.AFrameworkApplication.fa.Fgd().then(O=>{O?(this.Plh(),da&&(this.JO=da),c.ULS.sendTraceTag(42084323,3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",r.OAuthManagerSettings.clientVersion,r.OAuthManagerSettings.appVersion,r.OAuthManagerSettings.Hoh,this.mv(),Math.floor(N.a.Ud()-qa))):c.ULS.sendTraceTag(562128579,
3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(N.a.Ud()-qa));return Promise.resolve(O)},()=>{c.ULS.sendTraceTag(562128580,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(N.a.Ud()-qa));return Promise.resolve(!1)})}Wei(){c.ULS.sendTraceTag(573390991,3E3,50,"Initializing {0}",this.mv());const da=N.a.Ud();return l.get(this.JO.initialize(),
2,r.OAuthManagerSettings.uId).then(qa=>{if(0===qa)c.ULS.sendTraceTag(42084353,3E3,50,"Initialization succeeded for {0} in {1} ms.",this.mv(),Math.floor(N.a.Ud()-da));else if(1===qa){c.ULS.sendTraceTag(527827291,3E3,15,"Initialization failed for {0} in {1} ms, all future TryGetToken requests will fail.",this.mv(),Math.floor(N.a.Ud()-da));var O=L.a.Pr();void 0!==O&&null!==O&&(O.set("AuthLibrary",this.mv()),O=Object.assign(new U.a,{durationMs:Math.floor(N.a.Ud()-da),extendedProperties:O}),M.Health.instance.recordKpiFailure(Z.kpiName,
"StrategyInitFailed",!1,!0,O))}else 2===qa&&(c.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",this.mv(),Math.floor(N.a.Ud()-da)),O=L.a.Pr(),void 0!==O&&null!==O&&(O.set("AuthLibrary",this.mv()),O=Object.assign(new U.a,{durationMs:Math.floor(N.a.Ud()-da),extendedProperties:O}),M.Health.instance.recordKpiFailure(Z.kpiName,"StrategyInitTimedOut",!1,!0,O)));return Promise.resolve(qa)},()=>{c.ULS.sendTraceTag(574239256,3E3,15,
"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.mv(),Math.floor(N.a.Ud()-da));return Promise.resolve(1)})}Xzi(){c.ULS.sendTraceTag(562128581,3E3,50,"Loading {0}",this.mv());const da=N.a.Ud();return l.get(this.JO.xlc(m.a.getAuthContext()),2,r.OAuthManagerSettings.uId).then(qa=>{if(0===qa)c.ULS.sendTraceTag(562128582,3E3,50,"Load succeeded for {0} in {1} ms.",this.mv(),Math.floor(N.a.Ud()-da));else if(1===qa){c.ULS.sendTraceTag(562128583,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",
this.mv(),Math.floor(N.a.Ud()-da));var O=L.a.Pr();void 0!==O&&null!==O&&(O.set("AuthLibrary",this.mv()),O=Object.assign(new U.a,{durationMs:Math.floor(N.a.Ud()-da),extendedProperties:O}),M.Health.instance.recordKpiFailure(Z.kpiName,"StrategyLoadFailed",!1,!0,O))}else 2===qa&&(c.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",this.mv(),Math.floor(N.a.Ud()-da)),O=L.a.Pr(),void 0!==O&&null!==O&&(O.set("AuthLibrary",this.mv()),O=Object.assign(new U.a,
{durationMs:Math.floor(N.a.Ud()-da),extendedProperties:O}),M.Health.instance.recordKpiFailure(Z.kpiName,"StrategyLoadTimedOut",!1,!0,O)));return Promise.resolve(qa)},()=>{c.ULS.sendTraceTag(562128584,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.mv(),Math.floor(N.a.Ud()-da));return Promise.resolve(1)})}wO(da,qa,O=null){return this.QCc(da,qa,!1,null,"",O)}Ogg(da,qa,O,ca,wa=null){return this.QCc(da,qa,!0,O,ca,wa)}QCc(da,qa,O,ca,wa,ia,Ha=0){Ha+=1;c.ULS.sendTraceTag(42084352,
3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",da,this.pRa(da,qa),this.mv(),Ha);var Sa=L.a.Pr();void 0!==Sa&&null!==Sa&&(Sa.set("AuthLibrary",this.mv()),Sa.set("AppName",da),Sa.set("Target",this.pRa(da,qa)),M.Health.instance.recordKpiUsage(Z.kpiName,0,"WacOAuthFC",Sa));if(!r.OAuthManagerSettings.isEnabled){var Da;return this.Bwd((Da=new d,Da.IsSuccess=!1,Da.Token=null,Da.ErrorCode="NotEnabled",Da.ErrorMessage="OAuthManager is disabled.",Da),da)}const ea=
r.OAuthManagerSettings.DYc[da];if(void 0===ea||null===ea){c.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",da);var sa;return this.Bwd((sa=new d,sa.IsSuccess=!1,sa.Token=null,sa.ErrorCode="DisallowedApp",sa.ErrorMessage="Disallowed appName: "+da,sa),da)}const Ea=N.a.Ud(),ba=this;Sa=this.dyg.then(yb=>ba.Jki(da,ea,qa,O,ca,wa,ia,yb));Da=O?0:r.OAuthManagerSettings.uId;let ka;sa=(ka=new d,ka.IsSuccess=!1,ka.Token=
null,ka.ErrorCode="authTokenStrategy_timeout",ka.ErrorMessage="Auth Strategy timed out after ["+Da+"] ms when fetching token",ka);let Ca=this,db=this;return l.get(Sa,sa,Da).then(yb=>Ha<=Z.iHi&&(yb.ErrorCode===Z.Peg||yb.ErrorCode===Z.wOj)?(c.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",Ha,Math.floor(N.a.Ud()-Ea)),Ca.QCc(da,qa,O,ca,wa,ia,Ha)):yb.ErrorCode===Z.Rnf&&!O&&(c.ULS.sendTraceTag(561517645,3E3,50,"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",
Ha,Z.oPe),Z.Krh&&Ca.JO.lBc()&&Ca.JO.SCc(da,ea,qa,O,ca,wa).then(kb=>Promise.resolve(Ca.Rlc(kb,da,qa,ea,Ea))).catch(()=>{let kb;const mb=(kb=new d,kb.IsSuccess=!1,kb.Token=null,kb.ErrorCode="authTokenStrategy_failure",kb.ErrorMessage="LoginPopup failed, GetToken could not be called",kb);return Promise.resolve(Ca.Rlc(mb,da,qa,ea,Ea))}),Z.oPe)?Ca.QCc(da,qa,!0,ca,wa,ia,Ha):Promise.resolve(Ca.Rlc(yb,da,qa,ea,Ea))).catch(()=>{let yb;const kb=(yb=new d,yb.IsSuccess=!1,yb.Token=null,yb.ErrorCode="authTokenStrategy_failure",
yb.ErrorMessage="Auth Strategy failed with an unknown error",yb);return Promise.resolve(db.Rlc(kb,da,qa,ea,Ea))})}Jki(da,qa,O,ca,wa,ia,Ha,Sa){return 1===Sa||2===Sa?this.Bwd(Object.assign(new d,{IsSuccess:!1,Token:null,ErrorCode:1===Sa?"InitFailed":"InitTimedOut",ErrorMessage:"Auth Strategy Failed to Init or Load"}),da):this.JO.wO(da,qa,O,ca,wa,ia,Ha).then(Da=>Promise.resolve(this.Gxf(Da,!0,da))).catch(Da=>Promise.resolve(this.Gxf(Da,!1,da)))}Rlc(da,qa,O,ca,wa){const ia={};wa=N.a.Ud()-wa;ia.IsSuccess=
da.IsSuccess;ia.ErrorCode=da.IsSuccess?"Success":da.ErrorCode||"";ia.ErrorMessage=da.IsSuccess?"Success":this.pRa(qa,da.ErrorMessage||"");ia.Target=this.pRa(qa,O||"");ia.TimeInMS=Math.floor(wa);ia.AuthLibrary=this.mv();ia.AppName=qa;ia.AuthorityType=Object(b.a)(f,m.a.nbc());ia.UserType=this.a6h(m.a.getAuthContext());ia.IsAuthSupportedInSession=e.a[this.oS];ia.RequestCount=++this.BCg;ia.AppId=ca;c.ULS.sendTraceTag(593863640,3E3,50,JSON.stringify(ia));da.IsSuccess||(O=L.a.Pr(),void 0!==O&&null!==O&&
(O.set("AppName",qa),O.set("AuthLibrary",this.mv()),O.set("ErrorCode",da.ErrorCode),O.set("ErrorMessage",this.pRa(qa,da.ErrorMessage)),qa=Object.assign(new U.a,{durationMs:wa,extendedProperties:O}),M.Health.instance.recordKpiFailure(Z.kpiName,"TryGetTokenFailure",!1,!0,qa)));return da}Bwd(da,qa){c.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",qa,this.pRa(qa,da.ErrorMessage));const O=L.a.Pr();void 0!==O&&null!==O&&(O.set("AppName",
qa),O.set("AuthLibrary",this.mv()),O.set("ErrorCode",da.ErrorCode),O.set("ErrorMessage",this.pRa(qa,da.ErrorMessage)),qa=Object.assign(new U.a,{extendedProperties:O}),M.Health.instance.recordKpiFailure(Z.kpiName,"FailureBeforeGetToken",!1,!0,qa));return Promise.resolve(da)}Lif(da){return da===X.a.bCc}pRa(da,qa){return this.Lif(da)&&qa?"REDACTED":qa}a6h(da){return v.AFrameworkApplication.fa.pa("IsAnonymousUser")?"anonymous":!da.loginHint||1>da.loginHint.length?"empty":-1<da.loginHint.indexOf("guest#")?
"guest":-1<da.loginHint.indexOf("ext#")?"external":0>da.upn.indexOf("@")?"no-at":"supported"}o6a(){return 1===this.oS}Gxf(da,qa,O){let ca=null,wa=null,ia=null,Ha=null;da?da.ErrorCode||da.ErrorMessage?(wa=da.ErrorCode?da.ErrorCode:Z.MVe,ia=da.ErrorMessage?da.ErrorMessage:"No message"):da.Token?qa?ca=da.Token:(wa=Z.Ngj,ia="A rejected promise returned a token."):(wa=Z.MVe,ia=JSON.stringify(da)):(wa=Z.SKi,ia="No result came from Auth Token Strategy");da&&da.Telemetry&&!this.Lif(O)&&(Ha=da.Telemetry,c.ULS.sendTraceTag(579166408,
3E3,50,JSON.stringify(Ha)));if(wa===Z.JIi||wa===Z.iTj)wa=Z.Peg,ia="Auth Library Timed Out";wa===Z.xUg&&-1<ia.indexOf(Z.CGg)&&(wa=Z.Rnf);if(wa||ia)ca=null;return Object.assign(new d,{IsSuccess:!!ca,Token:ca,ErrorCode:wa,ErrorMessage:ia,Telemetry:Ha})}static get oPe(){return v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",!1)}static get Krh(){return v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",
!1)}}Z.iTj="token_renewal_error";Z.MVe="Exception";Z.SKi="NoResult";Z.Ngj="RejectToken";Z.JIi="monitor_window_timeout";Z.Peg="Timeout";Z.wOj="authTokenStrategy_timeout";Z.xUg="login_required";Z.CGg="AADSTS50058";Z.Rnf="Cookies Disabled";Z.kpiName="OAuthManager";Z.iHi=2;Object(t.a)(Z,"OAuthManager",null,[410])},940:function(t,F,a){a.d(F,"a",function(){return c});t=a(0);var c;(function(b){b[b.unknown=0]="unknown";b[b.supported=1]="supported";b[b.userUnsupportedAnonymous=2]="userUnsupportedAnonymous";
b[b.userUnsupportedNoLoginHint=3]="userUnsupportedNoLoginHint";b[b.hostUnsupported=4]="hostUnsupported"})(c||(c={}));Object(t.b)("SupportStatus",c)}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.oauth.js.map/5b0ae21a7ac1131fba4b2c7d2178f83e/EwaDSEsNext.oauth.js.map