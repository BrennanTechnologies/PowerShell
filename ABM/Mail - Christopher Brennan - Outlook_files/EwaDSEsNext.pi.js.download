'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[19],{1134:function(t,F,a){a.d(F,"a",function(){return c});const c=()=>{Type.registerNamespace("Common.App.InsertFile")}},1135:function(t,F,a){a.d(F,"a",function(){return c});const c=()=>{Type.registerNamespace("Common.App.InsertPicture")}},1137:function(t,F,a){a.d(F,"a",function(){return b});var c=a(511);const b=()=>{c.a.Ai(".insert-media-dialog-old{width:870px;float:left;margin-top:7px}.insert-media-dialog{width:870px;width:clamp(400px,870px,80vw);float:left;margin-top:7px}.app-rtl .insert-media-dialog{float:right}.insert-media-frame{width:100%;height:100%;visibility:visible}.insert-media-panel-old{height:550px}.insert-media-panel{height:550px;height:clamp(300px,550px,90vh)}.keep-focus-start{position:absolute;width:-1000px;top:-1000px}.keep-focus{position:absolute;width:-1000px;top:1000px}.display-none{display:none}.padding-zero{padding:0}")}},
1138:function(t,F,a){a.d(F,"a",function(){return c});t=a(0);class c{}c.PFc="b-ring_Apc_Trans";c.xog="cdn_static_resource_ewa_image";Object(t.a)(c,"ResourceHosts",null,[])},1139:function(t,F,a){a.d(F,"a",function(){return e});t=a(0);var c=a(59),b=a(1319);class e{static ved(f,d,h,m=null){e.Bnc||(e.Bnc=Array.isArray(c.a.Wh(h.ya.NetworkMeasurementUrlList))?c.a.Wh(h.ya.NetworkMeasurementUrlList):null);const l=[];for(let v=0;v<e.Bnc.length;v++){const r=e.Bnc[v];let A=r.key;A||(A=r.Key);if(m&&!m.includes(A))continue;
let x=r.value;x||(x=r.Value);A&&x&&l.push(new b.a(h,A,x,f,d))}return l}}e.Bnc=null;Object(t.a)(e,"NetworkConnectionHelpers",null,[])},1162:function(t,F,a){var c=a(0),b=a(7),e=a(15),f=a(226),d=a(30),h=a(27),m=a(353),l=a(174),v=a(268),r=a(356),A=a(4),x=a(24),n=a(1),u=a(38),z=a(8),w=a(285),C=a(13);class y extends w.a{constructor(Za){super(Za);this.C5g=()=>{e.ULS.sendTraceTag(537167827,0,50,"ClipboardReadPermissionAskDialog OK button pressed")};e.ULS.sendTraceTag(537167828,0,50,"ClipboardReadPermissionAskDialog.ClipboardReadPermissionAskDialog");
this.Ob=0;this.tc(1,C.a.instance.ga(2257));Za=C.a.instance.ga(2255);const Xb=this.EM();this.initializeAndShow(Za,this.C5g,Xb)}get kc(){return"ClipboardReadPermissionAskDialog"}EM(){const Za={};Za.id=this.kc;const Xb=C.a.instance.ga(2256);Za.DialogMessage=Xb;return Za}}Object(c.a)(y,"ClipboardReadPermissionAskDialog",w.a,[]);var B=a(52);const H=(Za,Xb,jb,Sb,lc)=>{const oc=Za.Stopwatch,Qc={};Qc.a=lc;Qc.e=oc.id;Qc.c="RearrangeRowColumn";Qc.b="mouse";Qc.d=Za.OperationId.toString();Qc.f=jb.toString();
Qc.g=Sb.toString();Qc.h=Xb.toString();Qc.i=Za.DragDropIsShiftKeyDown;Qc.j=!0;Qc.o=oc.Bc;Qc.q=!1;Qc.r=Za.CopyPasteTargetType.toString();Qc.s=Za.EncounteredDeploymentErrors;return Qc};class I{constructor(Za,Xb){this.wLh=()=>{const jb={};jb.SourceItem=this.toString();return jb};this.sessionStateId=Za;this.sessionId=Xb;this.toJSON=this.wLh}dif(Za){return Za?this.sessionStateId===Za.sessionStateId&&this.sessionId===Za.sessionId:!1}isFromCurrentSession(Za){return this.sessionId===Za.ya.UserSessionId}}Object(c.a)(I,
"SourceItem",null,[]);class R extends I{constructor(Za,Xb,jb,Sb,lc){super(jb,Sb);this.activeFloatingObjectControlId=Za;this.sheetName=Xb;this.type=lc}isEqual(Za){return Za&&Object.getType(Za)===R?this.dif(Za)&&this.activeFloatingObjectControlId===Za.activeFloatingObjectControlId&&this.sheetName===Za.sheetName:!1}toString(){return this.type.toString()}}Object(c.a)(R,"ArtSourceItem",I,[]);var S;(function(Za){Za[Za.valid=0]="valid";Za[Za.notPairwiseDisjoint=1]="notPairwiseDisjoint";Za[Za.cutNotSupportedInDiscontinuousSelection=
2]="cutNotSupportedInDiscontinuousSelection";Za[Za.notValidForm=3]="notValidForm";Za[Za.temporarilyBlockedCopy=4]="temporarilyBlockedCopy"})(S||(S={}));Object(c.b)("CopySourceValidationOptions",S);var G=a(41);class D extends I{constructor(Za,Xb,jb,Sb,lc){super(Sb,lc);e.ULS.shipAssertTag(537167645,0,!!Xb&&0<Xb.length,"RangeSourceItem.ctor: ranges should not be null or empty");this.$=Za;this.ranges=Xb;this.sheetName=jb}isEqual(Za){return Za&&Object.getType(Za)===D?this.dif(Za)&&G.Q(this.ranges,Za.ranges)&&
this.sheetName===Za.sheetName:!1}toString(){return G.i(this.ranges,",",this.$,!1)}}Object(c.a)(D,"RangeSourceItem",I,[]);const E=Za=>!!Za&&Object.getType(Za)===D;class M{}M.O2j="PasteError_FailedToReadFromClipboard_UserHashMismatchError";Object(c.a)(M,"ExpectedErrorNames",null,[]);class L{}L.plainText="text/plain";L.html="text/html";L.png="image/png";L.shadowWorkbook="data/shadow-workbook";L.sqi="metadata/is-last-copy-was-external";L.Hmi="metadata/is-last-copy-was-external-XLO-source";L.e4g="metadata/chrome-extension-id";
L.csb="copyId";L.DPg="metadata/additional-signature-data-attributes";Object(c.a)(L,"ClipboardDataFormat",null,[]);const N=Za=>Za.clipboardItems&&(Za=Za.clipboardItems.getItem(L.sqi))&&"1"===Za?!0:!1,Y=Za=>N(Za)&&!(void 0===Za.clipboardItems||null===Za.clipboardItems)&&!!Za.clipboardItems.getItem(L.png)&&!Za.clipboardItems.getItem(L.plainText),U=Za=>Za.clipboardItems&&(Za=Za.clipboardItems.getItem(L.Hmi))&&"1"===Za?!0:!1,P=Za=>Za&&(Za=Za.getCachedMetadata(),null===Za||void 0===Za?0:Za.lastCopy)?Za.lastCopy:
null;var aa=a(49),X=a(21),Z=a(34);class da{constructor(Za,Xb,jb,Sb){this.$=Za;this.originalDestinations=Xb;this.h$b=jb;this.nsg=Sb;this.lCg=this.originalDestinations;this.ewg=this.h$b;this.Hzg="PasteRecoveryUI"}get CPg(){return this.nsg}get Yyi(){return this.Hzg}get bej(){return this.lCg}get uWe(){return this.ewg}pKa(){return da.l4i}xTh(){return this.h$b&&1===this.h$b.length?this.yTh(this.h$b[0]):null}yTh(Za){var Xb=X.h(this.$);const jb=Xb.ib.yi(Za);var Sb=Xb.xg(Za,jb);Xb=Xb.rtl;if(!Sb)return null;
Za=X.h(this.$).Rf(jb);const lc=Za.yn;if(!lc.zd(Sb))return null;Sb=lc.De(Sb);const oc=Sb.topLeft.y;var Qc=Sb.bottomRight.y;const Kb=Xb?Sb.bottomRight.x:Sb.topLeft.x;Sb=Xb?Sb.topLeft.x:Sb.bottomRight.x;var hc=new aa.a(Sb+(Xb?-81:81),Qc+38+6);if(lc.Oha(hc))return this.J4a(Za,lc,jb,Sb,Qc,Xb?12:-3,66);hc=new aa.a(Sb+(Xb?-81:81),Qc);if(lc.Oha(hc))return this.J4a(Za,lc,jb,Sb,Qc,Xb?20:3,22);hc=new aa.a(Sb,Qc+38+6);if(lc.Oha(hc))return this.J4a(Za,lc,jb,Sb,Qc,-81+(Xb?18:0),66);Sb=new aa.a(Kb+(Xb?81:-81),Qc);
if(lc.Oha(Sb))return this.J4a(Za,lc,jb,Kb,Qc,-81+(Xb?12:-6),22);Qc=new aa.a(Kb,oc-38-6);return lc.Oha(Qc)?this.J4a(Za,lc,jb,Kb,oc,Xb?15:0,16):this.J4a(Za,lc,jb,Xb?lc.topLeft.x:lc.bottomRight.x,lc.bottomRight.y,-81+(Xb?15:-6),22)}J4a(Za,Xb,jb,Sb,lc,oc,Qc){var Kb=X.h(this.$);const hc=Kb.rtl;Za=Sys.UI.DomElement.getLocation(Za.domElement);Sb=new Sys.UI.Point(Sb+(hc?0:Za.x)-Xb.topLeft.x,lc+Za.y-Xb.topLeft.y);hc&&(Kb=Kb.view.visibleArea,Sb.x=Kb.bottomRight.x-Kb.topLeft.x-Sb.x,2===jb||4===jb)&&(Sb.x+=Xb.bottomRight.x);
Sb=Z.a(this.$).Ija(Sb);return new Sys.UI.Point(Sb.x+oc,Sb.y+Qc)}}da.l4i=["PasteRecoveryUI"];Object(c.a)(da,"PasteRecoveryUI",null,[458]);var qa=a(68),O=a(379);class ca{}ca.uHg="ActiveSelection";ca.shadowWorkbook="ShadowWorkbook";ca.Ipg="GVML";ca.plainText="PlainText";ca.html="Html";ca.PVg="Bitmap";Object(c.a)(ca,"PayloadType",null,[]);class wa{}wa.UKj="Slice6";Object(c.a)(wa,"SliceName",null,[]);class ia{}ia.fLi="NotCalled";ia.success="Success";ia.failed="Failed";Object(c.a)(ia,"SucceededPopulatingSystemClipboardOptions",
null,[]);var Ha=a(361);const Sa=(Za,Xb)=>Za?Xb&&Xb.ya?Za.sessionId!==Xb.ya.UserSessionId:(e.ULS.shipAssertTag(537166209,0,!1,"ewaControl shouldn't be null"),!1):(e.ULS.shipAssertTag(537166210,0,!1,"copyContext shouldn't be null"),!1),Da=Za=>{switch(Za){case 0:return"None";case 2:return"Art";case 1:return"Range";default:return"Unknown"}},ea=Za=>{if(!Za)return"null";const Xb=[];for(const jb of Za.get())Xb.push(`${jb.clipboardDataFormat}(${jb.data.length})`);Xb.sort();return Xb.join(",")};var sa;(function(Za){Za[Za.valid=
0]="valid";Za[Za.destinationRangesIsEmpty=1]="destinationRangesIsEmpty";Za[Za.discontinuousSelectionNotSupportPasteFromExternal=2]="discontinuousSelectionNotSupportPasteFromExternal";Za[Za.discontinuousSelectionNotSupportPasteCrossSession=3]="discontinuousSelectionNotSupportPasteCrossSession";Za[Za.multipleSourcesAndMultipleDestinationsAreNotSupported=4]="multipleSourcesAndMultipleDestinationsAreNotSupported";Za[Za.multipleDestinationsAreNotMultiplyOfSourceRange=5]="multipleDestinationsAreNotMultiplyOfSourceRange";
Za[Za.sourceAndDestinationAreOverlapping=6]="sourceAndDestinationAreOverlapping";Za[Za.copySourceNotValid=7]="copySourceNotValid";Za[Za.cutNotSupportedInDiscontinuousSelection=8]="cutNotSupportedInDiscontinuousSelection";Za[Za.pasteLinkNotSupportMultipleDestination=9]="pasteLinkNotSupportMultipleDestination";Za[Za.temporarilyBlockedPaste=10]="temporarilyBlockedPaste";Za[Za.unknown=100]="unknown"})(sa||(sa={}));Object(c.b)("PasteValidationOptions",sa);var Ea=a(50),ba=a(140),ka=a(37),Ca=a(157),db=a(347),
yb=a(29),kb=a(319),mb=a(11),W=a(22),Q=a(129),va=a(115),na=a(565),Ba=a(100),Oa=a(55),oa=a(204),Ja=a(65),Wb=a(345);class nc extends Sys.EventArgs{constructor(Za,Xb,jb){super();this.command=Za;this.destinationRange=Xb;this.sourceRange=jb}}Object(c.a)(nc,"PasteCSERenderedEventArgs",Sys.EventArgs,[]);var Yb=a(126),pb;(function(Za){Za[Za.source=0]="source";Za[Za.destination=1]="destination"})(pb||(pb={}));Object(c.b)("RangeType",pb);class Fa extends u.a{constructor(Za,Xb,jb,Sb,lc,oc,Qc,Kb,hc=null){super();
this.pasteShortcutManager=null;this.ehf=n.EwaSettings.vb();this.Pwa=n.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",!1);this.reg=null;this.J7a=!1;this.ttd=n.EwaSettings.isChangeGateEnabled("OfficeVSO:6660890_Tag_aoi75RetryLoggingFix2");this.Hwa=n.EwaSettings.isChangeGateEnabled("OfficeVSO:7205979_DemoteDragDropNonEmptyRangeLogLevel");this.FDd=Cc=>{this.oEj(Cc)&&(this.Fp.Sec(),e.ULS.sendTraceTag(537167777,0,50,"CopyPasteInfrastructure.OnMetadataChanged: found that cut/copy operation was preformed in another session therefore removed the highlight in this session."))};
this.MDi=(Cc,Ka)=>{e.ULS.sendTraceTag(537167768,0,50,`CopyPasteInfrastructure.LogShortcutDialogAndRestoreFocus: Got shortcut dialog, user pressed [${Cc}]. userPressedExtensionLink=${Ka}`);this.gridView.focus()};this.dd=(Cc,Ka)=>{Ka.$M||Ka.Bf||this.cr("OnWorkbookOpened",!1).catch(()=>{})};this.ij=(Cc,Ka)=>{Cc=P(this.lK);const Ib=this.Fp.Exb(Cc);Ib&&(Ka.na&&Ka.na.sheetName===Ib.sheetName&&Ib.isFromCurrentSession(this.$)?this.Fp.rcf(Ib.ranges,Cc.commandParameters.commandType):this.Fp.Sec())};this.rpc=
(Cc,Ka)=>{Cc=P(this.lK);(Cc=this.Fp.Exb(Cc))&&Ka.item&&Ka.item.sheetName===Cc.sheetName&&Cc.isFromCurrentSession(this.$)&&this.cr("OnItemDeleting",!1).catch(()=>{})};this.HGb=(Cc,Ka)=>{this.ehf?this.reg(Cc,Ka):this.ZIf()};this.dR=(Cc,Ka)=>{1===Ka.sr&&Ka.Lf.operation.flags&2&&this.cr("OnQueueItemChanged/ItemRemoved",!1).catch(()=>{})};this.$=Za;this.Lh=jb;this.gridView=X.h(Za);this.Fp=lc;this.Jii=oc;this.lK=Xb;this.g5b=Sb;this.getStringifiedError=hc||copyPasteInfra.getStringifiedError;this.M8f=1===
Kb;this.Rcd=n.EwaSettings.isChangeGateEnabled("OfficeVSO:6713439_FixCloneRangeArray");this.Aj();this.copyPasteShortcutDialogFactory=this.$.da.Aa(85);e.ULS.shipAssertTag(537167825,0,!!this.copyPasteShortcutDialogFactory,"CopyPasteInfrastructure.ctor: this.copyPasteShortcutDialogFactory shouldn't be null.");Qc||(e.ULS.sendTraceTag(537167824,0,50,"CopyPasteInfrastructure.ctor: userId is null, using default userId."),Qc=Fa.okh);this.userHash=d.a.Yu(Qc);this.VHi="CultureTag: "+C.a.instance.d7b+" HASH: ";
this.lK.addMetadataChangeListener(Fa.Ovf,this.FDd);this.IGi=O.a.jEb;this.aya=this.Pwa?n.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",this.$.ya.CopyPasteMaxPayloadLength):z.a.aya;(this.mo=n.EwaSettings.isChangeGateEnabled("OfficeVSO:7568646_PressEnterToPaste"))&&Za.da.gb(478,Cc=>{this.pasteShortcutManager=Cc});this.ehf&&(this.reg=kb.a(()=>{this.ZIf()},1,this.$.la,"CopyPasteInfrastructure.OnStartEditInternal",!0))}jNe(){var Za=P(this.lK);return Za?(Za=Za.sourceItem)&&
!Za.isFromCurrentSession(this.$)?(e.ULS.sendTraceTag(537167778,0,50,"CopyPasteInfrastructure.DoesClipboardHaveCopiedOrCutContent: Last copy/cut operation was from a different session."),!1):!0:!1}get pasteIndicationManager(){return this.$.da.Aa(373)}VNg(Za){this.addHandler(Fa.zEd,Za)}skj(Za){this.removeHandler(Fa.zEd,Za)}copy(Za){Za.stopwatch=this.$.Jb.Gc("UserAction",B.b().Cj(Za.ribbonCommandInfo.command)+"ClientSide");if(this.mo){const oc=Ea.GetServiceTaskFactory.Oa(this.$.da,478,479,0);ka.TaskExtensions.za(oc,
()=>{this.pasteShortcutManager=oc.result},this.la,3)}const Xb=!!P(this.lK);n.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.WA&&(this.J7a=!1);this.cr("Copy/before/"+m.a[Za.ribbonCommandInfo.method],!1,void 0,!0,Za.copyPasteTargetType).catch(()=>{});var jb=-1985798686===Za.ribbonCommandInfo.command;if(1===this.gridView.Oe&&(jb=this.Fp.thf(this.gridView.ha.qa.selectedRanges,jb),0!==jb)){const oc=Fa.i$g(jb);this.iza(oc,S[jb],!1);return Promise.reject(!1)}Za.userHash=
this.userHash;Za.id=l.a.create().toString();let Sb=this,lc=this;return this.g5b.onCopy(Za).then(oc=>{oc.isAsyncCopy||Za.stopwatch.stop();Sb.pasteIndicationManager.FNe();const Qc=Ha.d(Za);e.ULS.sendTraceTag(24150883,0,50,`CopyPasteInfrastructure.OnCopy: Copy operation finished successfully. ${Qc}`);Sb.GBi(oc,Xb);oc=n.EwaSettings.isChangeGateEnabled("OfficeVSO:6591921_CheckTargetTypeForEnterToPaste")?1===Za.copyPasteTargetType:!0;!Za.isFormatPainter&&Sb.mo&&oc&&(Sb.pasteShortcutManager?Sb.pasteShortcutManager.Lrh():
e.ULS.shipAssertTag(537167823,0,!1,"Copy: pasteShortcutManager is null."));return Promise.resolve(!0)},oc=>{let Qc=!1,Kb="none",hc=Fa.itb,Cc=!0,Ka=-1,Ib=Fa.copyErrorName+Fa.hJa,dc=!1,yc=null;if(oc){yc=oc.copyContext;Ka=oc.reason;Ib+=Fa.zKa(oc);oc.message&&(hc=oc.message);var Eb=Fa.h$g(oc);if(Eb)if(3===Eb.copyErrorName)Qc=!0,hc=Kb="Async Copy canceled by the user.",Cc=!1;else if(yb.a.oq(Eb.ewaErrors))if(hc=lc.bcc(Eb.ewaErrors),yb.a.dh(Eb.ewaErrors,Fa.operationSucceededWithAlert))dc=Qc=!0;else if(yb.a.dh(Eb.ewaErrors,
Fa.pasteDataLimitHit)||yb.a.dh(Eb.ewaErrors,Fa.copyThrottlingError))Qc=!0;13===oc.reason?(Qc=!0,Cc=!1):11===oc.reason&&(Cc=!1)}Eb=oc?lc.getStringifiedError(oc):"null";Qc?(Eb=Ha.d(Za),e.ULS.sendTraceTag(36304157,0,15,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an expected error. clearStateNeeded: ${Cc}, Friendly message: ${Kb}, Error Message: ${hc}, CommandParameters: ${Eb}`)):e.ULS.sendTraceTag(24150912,0,10,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an unexpected error. clearStateNeeded: ${Cc}, Error Message: ${Eb}, CommandParameters: ${Ha.d(Za)}`);
Cc&&lc.cr("Copy/fail/"+m.a[Za.ribbonCommandInfo.method],!0,void 0,void 0,Za.copyPasteTargetType).catch(()=>{});lc.FBi(Za,Qc,hc,Ib,Ka,dc,yc);return Promise.reject(oc)})}paste(Za){Za.stopwatch=this.$.Jb.Gc("UserAction",B.b().Cj(Za.ribbonCommandInfo.command)+"ClientSide");n.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.WA&&(e.ULS.sendTraceTag(537167822,0,50,"CopyPasteInfrastructure.OnPaste: Cross-app shadow workbook paste is enabled"),this.J7a=!1,Za.clipboardPicklingApiDataFormatsToRead=
[L.shadowWorkbook]);X.h(this.$).vh&&X.h(this.$).vh.u0(this.Hhd(Za.ribbonCommandInfo.command),Za.stopwatch.id);if(Za.isPasteCommandFromRecoveryUI){var Xb=this.$.da.Aa(406);var jb=this.Rcd?G.d(Xb.Pkc):v.a.clone(Xb.Pkc);Xb=Xb.Jud;Za.pasteRecoveryCachedClipboardItems=Xb?Xb[Fa.bMf]:null}else jb=this.Rcd?G.d(this.gridView.ha.qa.selectedRanges):v.a.clone(this.gridView.ha.qa.selectedRanges);Za.originalDestinations=jb;Za.expandDestinations=this.A0c(Za.originalDestinations,Za.commandType);if(this.L0c(Za.commandType,
Za.expandDestinations)||this.c1g())return Za.userHash=this.userHash,Za.id=l.a.create().toString(),n.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PerfImpactExperimentForAsyncApi",!1)&&!h.a.WA&&(Za.clipboardReadPermissionPromptShown=!1,Za.clipboardAsyncApiDataFormatsToRead=[L.plainText+"Async"],this.g5b.shouldShowClipboardReadPermissionDialog().then(Sb=>{Sb&&(Za.clipboardReadPermissionPromptShown=!0,new y(this.$));return Promise.resolve(!0)},()=>Promise.resolve(!0))),this.g5b.onPaste(Za).then(Sb=>
this.Spc(Sb,Za),Sb=>this.tGb(Za,Sb));this.$.Zc(927125067,qa.a.zb,30,null);jb=G.i(Za.expandDestinations,",",this.$,!1);e.ULS.sendTraceTag(24150913,0,15,`CopyPasteInfrastructure.OnPaste: paste was triggered but the estimated destination range is not editable, do nothing. ExpandDestinations: ${jb}, CommandType: ${Za.commandType}, copyPasteTargetType="${Za.copyPasteTargetType}"`);return Promise.resolve(!0)}Hhd(Za){switch(Za){case 1804571062:return 6;case -185374993:return 7;case 1766348718:return 8;default:return 3}}c1g(){return!!X.h(this.$).ha.Sa.activeFloatingObjectControlId&&
this.$.Us(null,!1,470)}OCb(){const Za=P(this.lK);return Za&&Za.commandParameters?Za.commandParameters.copyPasteTargetType:0}rqi(){return!!P(this.lK)&&Sa(P(this.lK),this.$)}cr(Za,Xb,jb=!1,Sb=!1,lc=0){try{this.mo&&this.pasteShortcutManager&&this.pasteShortcutManager.J7b();let oc=lc;const Qc=this.Sxi();if(!Sb&&2===Qc)return e.ULS.sendTraceTag(537167821,0,50,`CopyPasteInfrastructure.ClearState clipboard won't be cleared as there's art in the clipboard. clearClipboardContent = '${Xb}', isExplicit = '${jb}', isForce = '${Sb}', Current CCP operation copyPasteTargetType = '${lc}', LastCopyPasteTargetType = '${Qc}'`),
Promise.reject(null);0===oc&&(oc=Qc);const Kb=this.$.Jb.Gc("UserAction","ClearCopyState"),hc=Kb.id;e.ULS.sendTraceTag(537167820,0,50,`CopyPasteInfrastructure.ClearState clear clipboard state. clearClipboardContent = '${Xb}', isExplicit = '${jb}', isForce = '${Sb}', Current CCP operation copyPasteTargetType = '${lc}', LastCopyPasteTargetType = '${Qc}'`);this.Fp.Sec();this.pbj();return this.g5b.onCancelCopy(Xb).then(()=>{Xb&&n.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!h.a.WA&&(this.J7a=!1);Kb.stop();this.wrf(Za,hc,!0,jb,Xb,"","",Kb.Bc,oc);return Promise.resolve(!0)},Cc=>{var Ka=Cc?this.getStringifiedError(Cc):"null";e.ULS.sendTraceTag(24150915,0,15,`CopyPasteInfrastructure.ClearState: error during call to copyPasteFlowManager.OnClear(). error: ${Ka}`);Kb.stop();Ka=Fa.s1g+Fa.hJa;let Ib=Fa.itb;Cc&&(Ka+=Fa.zKa(Cc),Cc.message&&(Ib=Cc.message));this.wrf(Za,hc,!1,jb,Xb,Ib,Ka,Kb.Bc,oc);return Promise.reject(Cc)})}catch(oc){return Promise.reject(null)}}A2c(Za,Xb,
jb=!1,Sb=!1,lc=0){return Sb||this.jNe()?this.cr(Za,Xb,jb,Sb,lc):(e.ULS.sendTraceTag(537167819,0,50,"CopyPasteInfrastructure.ClearStateOnlyIfClipboardHasContentFromSameSession clipboard won't be cleared as there is no content in the clipboard from the current session"),Promise.reject(null))}iza(Za,Xb,jb){e.ULS.sendTraceTag(590705172,0,50,`CopyPasteInfrastructure.PopupDiscontinuousSelectionErrorDialog: Blocked CCP due to discontinuous selection, reason: ${Xb}`);const Sb=new Ba.a;Sb.ia("reason",Xb);
na.a(Q.a.discontinuousSelectionBlocking,[jb?va.a.e4i:va.a.dah],!0,!0,!1,!1,Sb);Za=yb.a.ed(1,1,750,Za,0,371863010,"DiscontinuousSelectionBlocking");n.EwaSettings.kz()?new db.a(this.$,Za):(Za=new Ca.ErrorDialog(this.$,Za),Za.initialize(),Za.kg())}Sxi(){const Za=P(this.lK);return Za&&Za.sourceItem?Object.getType(Za.sourceItem)===R?2:1:0}dragDropCells(Za,Xb,jb,Sb,lc=!1){Za.stopwatch=this.$.Jb.Gc("UserAction","DragDropClientSide");Za.isDragDrop=!0;this.cr("DragDrop/before/"+m.a[Za.ribbonCommandInfo.method],
!1,void 0,void 0,Za.copyPasteTargetType).catch(()=>{});const oc=lc?2:1;let Qc=0;Qc=lc?4:Sb?256:128;const Kb={encounteredDeploymentErrors:!1};Kb.commandParameters=Za;Za.userHash=this.userHash;Za.id=l.a.create().toString();return this.ttd?this.Fp.pasteRange(Za.ribbonCommandInfo,G.q(Xb,this.$),G.q(jb,this.$),oc,Qc,[Za.stopwatch],Kb,!1,()=>{e.ULS.sendTraceTag(537167818,0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${Za.copyPasteTargetType}"`);this.S8a(Za,oc,Xb,jb,Kb)},hc=>
{const Cc=hc?this.getStringifiedError(hc):"null";this.Hwa||e.ULS.sendTraceTag(537167817,0,10,`CopyPasteInfrastructure.DragDropCells: ${Cc}, copyPasteTargetType="${Za.copyPasteTargetType}"`);this.m$a(hc,Za,oc,Xb,jb,Kb)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},hc=>Promise.reject(hc)):this.Fp.pasteRange(Za.ribbonCommandInfo,G.q(Xb,this.$),G.q(jb,this.$),oc,Qc,[Za.stopwatch],Kb,!1,null,null).then(()=>{e.ULS.sendTraceTag(521410075,0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${Za.copyPasteTargetType}"`);
this.gridView.ha.selectionType=-1;this.S8a(Za,oc,Xb,jb,Kb);return Promise.resolve(!0)},hc=>{const Cc=hc?this.getStringifiedError(hc):"null";this.Hwa||e.ULS.sendTraceTag(521410074,0,10,`CopyPasteInfrastructure.DragDropCells: ${Cc}, copyPasteTargetType="${Za.copyPasteTargetType}"`);this.m$a(hc,Za,oc,Xb,jb,Kb);return Promise.reject(hc)})}nph(Za,Xb,jb,Sb,lc=!1){Za.stopwatch=this.$.Jb.Gc("UserAction","DragDropReplaceClientSide");Za.isDragDrop=!0;this.A2c("DragDropReplace/before/"+m.a[Za.ribbonCommandInfo.method],
!1,void 0,void 0,Za.copyPasteTargetType).catch(()=>{});const oc=lc?2:1;let Qc=0;Qc=lc?4:Sb?256:128;const Kb={encounteredDeploymentErrors:!1};Kb.commandParameters=Za;n.EwaSettings.getBooleanFeatureGate(O.a.p8b,!1)&&(Za.isDragInsert=!1);Za.userHash=this.userHash;Za.id=l.a.create().toString();return this.ttd?this.Fp.pasteRange(Za.ribbonCommandInfo,G.q(Xb,this.$),G.q(jb,this.$),oc,Qc,[Za.stopwatch],Kb,!1,()=>{e.ULS.sendTraceTag(537167816,0,50,`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${Za.copyPasteTargetType}"`);
this.S8a(Za,oc,Xb,jb,Kb)},hc=>{const Cc=hc?this.getStringifiedError(hc):"null";this.Hwa||e.ULS.sendTraceTag(537167815,0,10,`CopyPasteInfrastructure.DragDropReplaceCells: ${Cc}, copyPasteTargetType="${Za.copyPasteTargetType}"`);return this.m$a(hc,Za,oc,Xb,jb,Kb)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},hc=>Promise.reject(hc)):this.Fp.pasteRange(Za.ribbonCommandInfo,G.q(Xb,this.$),G.q(jb,this.$),oc,Qc,[Za.stopwatch],Kb,!1,null,null).then(()=>{e.ULS.sendTraceTag(521410073,
0,50,`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${Za.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.S8a(Za,oc,Xb,jb,Kb);return Promise.resolve(!0)},hc=>{const Cc=hc?this.getStringifiedError(hc):"null";this.Hwa||e.ULS.sendTraceTag(521410072,0,10,`CopyPasteInfrastructure.DragDropReplaceCells: ${Cc}, copyPasteTargetType="${Za.copyPasteTargetType}"`);this.m$a(hc,Za,oc,Xb,jb,Kb);return Promise.reject(hc)})}mph(Za,Xb,jb,Sb,lc=!1){Za.stopwatch=this.$.Jb.Gc("UserAction",
"DragDropInsertClientSide");this.A2c("DragDropInsert/before/"+m.a[Za.ribbonCommandInfo.method],!1,void 0,void 0,Za.copyPasteTargetType).catch(()=>{});const oc=lc?2:1,Qc=G.K(this.A0c([jb],oc));var Kb=this.$.ea.na.sheetName;const hc=this.$.ea.na.sheetName,Cc=G.v(Xb,this.$);Cc.SheetName=Kb;Kb=G.v(Qc,this.$);Kb.SheetName=hc;Sb=Qc.isRow||Xb.isRow||Sb?1:0;const Ka={encounteredDeploymentErrors:!1};Za.isDragInsert=!0;Ka.commandParameters=Za;Za.userHash=this.userHash;Za.id=l.a.create().toString();if(this.ttd)return lc=
this.Fp.ONe(Ka,Cc,Kb,lc,Sb,Za.ribbonCommandInfo,()=>{e.ULS.sendTraceTag(537167814,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${Za.copyPasteTargetType}"`);this.S8a(Za,oc,Xb,jb,Ka)},dc=>{const yc=dc?this.getStringifiedError(dc):"null";this.Hwa||e.ULS.sendTraceTag(537167813,0,10,`CopyPasteInfrastructure.DragDropInsertCells: ${yc}, copyPasteTargetType="${Za.copyPasteTargetType}"`);this.m$a(dc,Za,oc,Xb,jb,Ka)}),oa.c(lc.then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},
dc=>Promise.reject(dc))).Qo(()=>!0);lc=this.Fp.ONe(Ka,Cc,Kb,lc,Sb,Za.ribbonCommandInfo,null,null);let Ib=this;return oa.c(lc.then(()=>{e.ULS.sendTraceTag(521410071,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${Za.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.S8a(Za,oc,Xb,jb,Ka);return Promise.resolve(!0)},dc=>{const yc=dc?Ib.getStringifiedError(dc):"null";this.Hwa||e.ULS.sendTraceTag(521410070,0,10,`CopyPasteInfrastructure.DragDropInsertCells: ${yc}, copyPasteTargetType="${Za.copyPasteTargetType}"`);
Ib.m$a(dc,Za,oc,Xb,jb,Ka);return Promise.reject(dc)})).Qo(()=>!0)}cff(Za,Xb){var jb=P(this.lK);if(!jb)return e.ULS.sendTraceTag(537167812,0,50,"InsertCopiedCutCells: CopyContext must not be null or undefined"),Oa.Task.Ra(!1);if(!E(jb.sourceItem))return e.ULS.sendTraceTag(537167811,0,50,"InsertCopiedCutCells: CopyContext must be a Range"),Oa.Task.Ra(!1);var Sb=jb.sourceItem;if(!Sb)return e.ULS.shipAssertTag(537167810,0,!!Sb,"InsertCopiedCutCells: rangeSourceItem must not be null or undefined"),Oa.Task.Ra(!1);
if(!Sb.isFromCurrentSession(this.$))return e.ULS.sendTraceTag(537167809,0,50,"InsertCopiedCutCells: rangeSourceItem is from a different session"),Oa.Task.Ra(!1);if(1<Sb.ranges.length)return e.ULS.sendTraceTag(537167808,0,50,"InsertCopiedCutCells: multiple source ranges are not supported"),this.iza(2189,"InsertCopiedCutCells",!0),Oa.Task.Ra(!1);jb=G.K(Sb.ranges);var lc=this.gridView.ha.qa.ld.clone();Za=G.K(this.A0c([lc],Za));const oc=this.hpf();Sb=Sb.sheetName;lc=this.$.ea.na.sheetName;const Qc=G.v(jb,
this.$);Qc.SheetName=Sb;const Kb=G.v(Za,this.$);Kb.SheetName=lc;return(Za.Rg||jb.Rg?Oa.Task.Ra(0):Za.isRow||jb.isRow?Oa.Task.Ra(1):this.Jii.x5b(this.$,X.h(this.$).rtl)).Qo(hc=>this.Fp.executeInsertCopiedCutCellsOperation(Qc,Kb,oc,hc.result,Xb,null,null)).continueWith(()=>{oc?this.Fp.Sec():this.cr("InsertCopiedCutCells/success/"+m.a[Xb.method],!0)})}Zqd(){const Za=P(this.lK),Xb=this.gridView.ha.qa.Tg;return!!Za&&E(Za.sourceItem)&&Xb&&1===Za.sourceItem.ranges.length}hpf(){return this.ipf(-911352779)}Okc(){return this.ipf(-1985798686)}L0c(Za,
Xb){var jb=new ba.a(this.$.va),Sb=36===Za;const lc=jb.Pd(4);Za=2===this.OCb()&&jb.Pd(1);Sb=Sb&&lc;jb=!jb.Nh||!this.Okc()||!ba.a.e8b(Xb,X.h(this.$));return Sb||Za||this.$.Us(Xb,!0)&&jb}Thc(Za,Xb){return this.Fp.Thc(Za,Xb)}dispose(){super.dispose();this.Sj();this.lK.removeMetadataChangeListener(Fa.Ovf)}R8c(Za,Xb,jb,Sb,lc,oc){if(!this.m5g(Za.commandParameters.ribbonCommandInfo.command))return Za.cseStatus=2,!1;if(oc&&Xb.zd(Sb))return Za.cseStatus=4,!1;if(jb!==lc)return Za.cseStatus=6,!1;if(n.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests")&&
(Sb.width%Xb.width||Sb.height%Xb.height))return Za.cseStatus=16,!1;if(n.EwaSettings.getBooleanFeatureGate(O.a.vJe,!1)){if(jb=Xb,Sb=Sb.De(this.gridView.fi),Xb=null===Xb.De(this.gridView.fi),lc=Za.commandParameters.ribbonCommandInfo.command,Xb&&1804571062!==lc&&-185374993!==lc||!Sb)return Za.cseStatus=7,!1}else if(jb=Xb.De(this.gridView.fi),Sb=Sb.De(this.gridView.fi),!jb||!Sb)return Za.cseStatus=7,!1;if(O.a.nxe){Xb=this.mxe(this.gridView,Za.commandParameters.ribbonCommandInfo.command,jb,pb.source);
if(0!==Xb)return Za.cseStatus=Xb,!1;Xb=this.mxe(this.gridView,Za.commandParameters.ribbonCommandInfo.command,Sb,pb.destination);if(0!==Xb)return Za.cseStatus=Xb,!1}Xb=G.v(jb,this.$);Xb=this.Lh.j4i(this.gridView,Xb,G.v(Sb,this.$),Za.commandParameters.ribbonCommandInfo.command,Za.commandParameters.stopwatch);1===Xb&&(oc&&(this.Lh.s2c(jb,!1),this.Lh.s2c(jb,!0)),oc=new nc(Za.commandParameters.ribbonCommandInfo.command,Sb,jb),X.h(this.$).Xaj(oc),this.pasteIndicationManager.Old(Za.commandParameters.id),
this.axc(Za.commandParameters.expandDestinations,Za.commandParameters.isPasteCommandFromRecoveryUI),this.TCe("DoPasteClientEstimation/"+m.a[Za.commandParameters.ribbonCommandInfo.method],Za));Za.cseStatus=Xb;return 1===Xb}mxe(Za,Xb,jb,Sb){const lc=new Yb.a("CopyPasteInfrastructure.blockCseForPaste",Za,jb);try{for(;lc.moveNext();){let oc=lc.get_current().cell;if(oc.XA)return 8;if(237279923===Xb||-185374993===Xb){if(oc.lS&&n.EwaSettings.isChangeGateEnabled("OfficeVSO:7148128_BlockWrapTextCseForPaste"))return 18;
if(oc.JM&&n.EwaSettings.isChangeGateEnabled("OfficeVSO:7327017_BlockCondFormattingForPaste"))return 19}if(Sb===pb.source){if(oc.Eba)return 23;if(oc.ftd)return 24;if(oc.hasIgnorableError)return 25;if((237279923===Xb||1804571062===Xb)&&this.xsi(Za,jb))return 20;if(237279923===Xb){if(oc.Yja)return 22;if(oc.hasHyperlink||oc.Jka)return 21}}}}finally{lc&&lc.dispose()}return 0}nNf(){this.copyPasteShortcutDialogFactory.create(this.$).showDialog(!0,!1,!1,this.MDi)}rDi(Za,Xb,jb,Sb){Za=H(Za,Xb,jb,Sb,this.$.ya.UserSessionId);
Za.k=!0;B.b().Te(45,Za,!0)}UXi(Za,Xb,jb,Sb,lc){var oc=!1,Qc=!1,Kb=Fa.itb,hc=Fa.HNe+Fa.hJa;Za&&(hc+=Fa.zKa(Za),yb.a.oq(Za.ewaErrors)?(Kb=this.bcc(Za.ewaErrors),yb.a.dh(Za.ewaErrors,[-103190598])&&(oc=!0)):Za.message&&(Kb=Za.message));Qc||(Qc=this.rqd(Za));Xb=H(Xb,jb,Sb,lc,this.$.ya.UserSessionId);Xb.k=!1;Xb.l=Qc;Xb.n=Kb;Xb.p=hc;Xb.q=oc;B.b().Te(45,Xb,!0);return Promise.reject(Za)}xsi(Za,Xb){const jb=Za.Wj("CopyPasteInfrastructure.isRangeWithBottomOrRightBorder",new x.Range(Xb.top,Xb.right,Xb.bottom,
Xb.right,!0,!0));for(;jb.$$mn();){let Sb=jb.$$cu();if(Sb&&Sb.Uva())return e.ULS.sendTraceTag(509436432,0,50,"CopyPasteInfrastructure.ShowInstantaneousFormattingFromRange: no instantaneous."),!0}for(Za=Za.Wj("CopyPasteInfrastructure.isRangeWithBottomOrRightBorder",new x.Range(Xb.bottom,Xb.left,Xb.bottom,Xb.right,!0,!0));Za.$$mn();)if((Xb=Za.$$cu())&&Xb.Qva())return e.ULS.sendTraceTag(509436431,0,50,"CopyPasteInfrastructure.ShowInstantaneousFormattingFromRange: no instantaneous."),!0;return!1}m5g(Za){switch(Za){case 237279923:case 808159687:return n.EwaSettings.isChangeGateEnabled("OfficeVSO:7317055_PasteCse");
case -185374993:return!0;case 1804571062:return!0;default:return!1}}ipf(Za){const Xb=P(this.lK);if(!Xb)return!1;const jb=Xb.sourceItem;return jb&&!jb.isFromCurrentSession(this.$)?(e.ULS.sendTraceTag(537167779,0,50,"CopyPasteInfrastructure.LastOperationWasCopyCut: Last copy operation was from a different session."),!1):Xb.commandParameters.ribbonCommandInfo.command===Za}oEj(Za){return Za&&Za.lastCopy?Sa(Za.lastCopy,this.$):!0}l2e(Za,Xb,jb,Sb,lc){const oc={};oc.a=this.$.ya.UserSessionId;oc.e=Za.stopwatch.id;
oc.c=B.b().Cj(Za.ribbonCommandInfo.command);oc.b=m.a[Za.ribbonCommandInfo.method];oc.d=Za.id;oc.f=jb.toString();oc.g=Sb.toString();oc.h=Xb.toString();oc.o=Za.stopwatch.Bc;oc.q=!1;oc.r=Za.copyPasteTargetType.toString();oc.s=lc.encounteredDeploymentErrors;n.EwaSettings.getBooleanFeatureGate(O.a.p8b,!1)&&(oc.i=lc.commandParameters.dragDropIsShiftKeyDown,oc.j=lc.commandParameters.isDragInsert);return oc}S8a(Za,Xb,jb,Sb,lc){Za=this.l2e(Za,Xb,jb,Sb,lc);Za.k=!0;B.b().Te(45,Za,!0)}OBi(Za,Xb,jb,Sb,lc,oc,Qc,
Kb,hc){Za=this.l2e(Za,Xb,jb,Sb,hc);Za.k=!1;Za.l=lc;Za.n=oc;Za.p=Qc;Za.q=Kb;B.b().Te(45,Za,!0)}wrf(Za,Xb,jb,Sb,lc,oc,Qc,Kb,hc){const Cc={};Cc.a=this.$.ya.UserSessionId;Cc.b=Xb;Cc.c=Za;Cc.f=jb;Cc.e=Sb;Cc.d=lc;Cc.g=oc;Cc.h=Qc;Cc.i=Kb;Cc.j=hc.toString();B.b().Te(46,Cc,!0)}GBi(Za,Xb){Za=this.I1e(Za.commandParameters,Za);Za.l=!0;Za.j=Xb;B.b().Te(43,Za,!0)}FBi(Za,Xb,jb,Sb,lc,oc,Qc){Za=this.I1e(Za,Qc);Za.l=!1;Za.m=Xb;Za.o=jb;Za.y=Sb;Za.x=lc;Za.z=oc;B.b().Te(43,Za,!0);e.ULS.sendTraceTag(537167776,0,15,`CopyPasteInfrastructure.LogCopyFailedTelemetry: ErrorName=${Za.y},ErrorReason=${Za.x},IsExpectedError=${Za.m},IsSucceededWithAlert=${Za.z},ErrorMessage=${Za.o}`)}I1e(Za,
Xb){const jb={};jb.a=this.$.ya.UserSessionId;jb.f=Za.stopwatch.id;jb.g=Za.id;jb.c=B.b().Cj(Za.ribbonCommandInfo.command);jb.b=m.a[Za.ribbonCommandInfo.method];jb.q=Za.stopwatch.Bc;jb.bd=Fa.rbc();jb.bg=Za.copyPasteHandlerName;jb.bj=void 0===Za.ribbonCommandInfo.We||null===Za.ribbonCommandInfo.We?null:r.a[Za.ribbonCommandInfo.We];jb.bq=Za.uploadToClipService;jb.br=Za.floatingObjectType;jb.s=Za.copyPasteTargetType.toString();jb.bc=Da(Za.copyPasteTargetType);jb.z=!1;if(Xb){jb.bk=Xb.id;jb.bl=Xb.serverRequestTimeInMs;
Xb.requestTelemetryData&&(jb.bm=Xb.requestTelemetryData.EcsOperationDuration,jb.bn=Xb.requestTelemetryData.EcsRequestDuration,jb.bo=Xb.requestTelemetryData.WfeRequestDuration);jb.d=Xb.sourceItem?Xb.sourceItem.toString():null;jb.e=-1;if(E(Xb.sourceItem)){jb.e=0;Za=Xb.sourceItem.ranges;for(const Sb of Za)jb.e+=Sb.Ny}jb.h=Xb.isAsyncCopy;jb.i=Xb.isFromCache;jb.k=Xb.isSelectionAllowed;jb.r=Xb.plainTextPayloadSize;jb.u=Xb.htmlPayloadSize;jb.v=Xb.htmlSizeExceedsLimit;jb.w=Xb.copyTotalSizeExceedsLimit;jb.t=
Xb.shadowWorkbookPayloadSize;jb.p=Xb.clientSideCopyTime;jb.ba=Xb.encounteredDeploymentErrors;jb.bb=Xb.shadowWorkbookSizeExceedsLimit;jb.be=Xb.syncClipboardItemsKeys;jb.bf=Xb.asyncClipboardItemsKeys;jb.bh=this.rGe(Xb.succeededPopulatingSystemClipboardSync);jb.bi=this.rGe(Xb.succeededPopulatingSystemClipboardAsync)}return jb}axc(Za,Xb=!1){if(!this.gridView.fb&&!this.gridView.Uh){var jb=this.gridView.ha.qa,Sb=!Xb&&1===Za.length&&G.Q(Za,jb.selectedRanges),lc=Sb?jb.activeCell:Za[0].topLeft;Za[0].contains(lc)||
(e.ULS.shipAssertTag(537167775,0,!1,`CopyPasteInfrastructure.SelectPastedRange: SelectedRanges ${jb.selectedRanges}, IndexOfActiveRange ${jb.es}, ActiveCell ${jb.activeCell}, calculatedDestinationRanges ${Za}, keepThePreviousActiveCell ${Sb}, newActiveCell ${lc}, isPasteCommandFromRecoveryUI ${Xb}`),lc=Za[0].topLeft);this.gridView.ha.sy(Za,0,lc,0,void 0,"CopyPasteInfrastructure.SelectPastedRange")}}H5e(Za,Xb){const jb={};jb.a=this.$.ya.UserSessionId;jb.g=Za.stopwatch.id;jb.t=Za.stopwatch.Bc;jb.bz=
!1;Xb&&(jb.bv=Xb.id,jb.bw=Xb.serverRequestTimeInMs,jb.n=Xb.commandParameters.clipboardFormatReadTimes,jb.o=Xb.commandParameters.clipboardFormatReadStatus,jb.p=Xb.commandParameters.clipboardReadPermissionPromptShown,jb.q=Xb.commandParameters.asyncApiReadTimedOut,Xb.requestTelemetryData&&(jb.cb=Xb.requestTelemetryData.EcsOperationDuration,jb.cc=Xb.requestTelemetryData.EcsRequestDuration,jb.cd=Xb.requestTelemetryData.WfeRequestDuration));jb.x=Za.copyPasteTargetType.toString();jb.bl=Da(Za.copyPasteTargetType);
jb.br=Za.copyPasteHandlerName;jb.i=G.i(Za.expandDestinations,",",this.$,!1);jb.h=G.i(Za.originalDestinations,",",this.$,!1);jb.e=Za.id;jb.d=Za.commandType;jb.c=B.b().Cj(Za.ribbonCommandInfo.command);jb.b=m.a[Za.ribbonCommandInfo.method];jb.bf=!1;jb.bg=!1;jb.bp=Fa.rbc();jb.bt=void 0===Za.ribbonCommandInfo.We||null===Za.ribbonCommandInfo.We?null:r.a[Za.ribbonCommandInfo.We];jb.cj=Za.isPasteCommandFromEnterShortcut;if(jb.ca=Za.isPasteCommandFromRecoveryUI)jb.cf=Za.pasteRecoveryUndoStopwatch.id,jb.cg=
Za.pasteRecoveryUndoStopwatch.Bc;if(Xb){if((Za=Xb.copyContextSnapshot)&&!Xb.wasLastCopyExternal){jb.f=Za.commandParameters.id;jb.j=Za.sourceItem.toString();jb.k=-1;if(E(Za.sourceItem)){jb.k=0;const Sb=Za.sourceItem.ranges;for(const lc of Sb)jb.k+=lc.Ny}jb.bg=1===Za.commandParameters.commandType}else Xb.clipboardItems?jb.f=Xb.clipboardItems.getItem(L.csb):e.ULS.sendTraceTag(537167774,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext.ClipboardItems is null");jb.bz=Xb.pasteRecoveryUIDisplayed;
jb.ci=Xb.cseStatus}else e.ULS.sendTraceTag(537167773,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext is null");return jb}YCi(Za,Xb,jb,Sb,lc,oc,Qc,Kb,hc){Za=this.H5e(Za,Kb);Za.l=!1;Za.m=Xb;Za.s=jb;Za.bc=Sb;Za.be=lc;Za.bd=oc;Za.bf=Qc;Kb?(Za.y=N(Kb)||!Kb.copyContextSnapshot,Za.bi=!Za.y&&Sa(Kb.copyContextSnapshot,this.$),Za.bj=Kb.shadowWorkbookSizeExceedsLimit,Za.v=Kb.shadowWorkbookPayloadSize,Za.w=Kb.htmlPayloadSize,Za.bq=ea(Kb.clipboardItems),Za.bb=Kb.activeSelectionType,Za.bs=Kb.isSameSession,
Za.bn=Kb.payloadOrigin,Za.bo=Kb.payloadType,Za.bu=Kb.externalAppSource,Za.bx=Kb.indicationDisplayScheduled,Za.by=Kb.pasteIndicationDisplayStatus,Za.ck=Kb.pasteDestinationHasMergedCells):Za.bi=Sa(hc,this.$);B.b().Te(44,Za,!0);e.ULS.sendTraceTag(537167772,0,15,`CopyPasteInfrastructure.LogPasteFailedTelemetry: ErrorName=${Za.be},ErrorReason=${Za.bd},IsExpectedError=${Za.m},IsSucceededWithAlert=${Za.bf},ErrorMessage=${Za.s}`)}ZCi(Za){const Xb=this.H5e(Za.commandParameters,Za);Xb.y=Za.wasLastCopyExternal;
Xb.l=!0;Xb.u=Za.plainTextPayloadSize;Xb.v=Za.shadowWorkbookPayloadSize;Xb.w=Za.htmlPayloadSize;Xb.z=Za.isClipboardDataContainShadowWorkbook;Xb.ba=Za.isShadowWorkbookParsedSuccessfully;Xb.bb=Za.activeSelectionType;Xb.bc=Za.pasteResult;Xb.bh=Za.encounteredDeploymentErrors;Xb.bj=Za.shadowWorkbookSizeExceedsLimit;Xb.bk=U(Za);Xb.bq=ea(Za.clipboardItems);Xb.bs=Za.isSameSession;Xb.bn=Za.payloadOrigin;Xb.bo=Za.payloadType;Xb.bu=Za.externalAppSource;Xb.bx=Za.indicationDisplayScheduled;Xb.by=Za.pasteIndicationDisplayStatus;
Xb.ck=Za.pasteDestinationHasMergedCells;Xb.bm=Za.clipboardItems?Za.clipboardItems.getItem(L.e4g):null;Xb.bi=!Za.isSameSession&&!Za.wasLastCopyExternal;B.b().Te(44,Xb,!0)}Aj(){this.$.va.Vf(this.ij);this.$.va.cNg(this.rpc);this.$.userOperationManager.Lr(this.dR);this.$.Lk(this.dd);X.h(this.$).Vb.xl(this.HGb)}Sj(){this.$&&this.$.va&&(this.$.va.sg(this.ij),this.$.va.Kjj(this.rpc));this.$&&this.$.userOperationManager&&this.$.userOperationManager.zo(this.dR);this.gridView&&this.gridView.Vb&&this.gridView.Vb.nl(this.HGb)}tGb(Za,
Xb){var jb=null;let Sb=!1;var lc=null;let oc="UnknownFailure",Qc=-1,Kb=Fa.itb,hc=Fa.pasteErrorName+Fa.hJa,Cc=!1;this.pasteIndicationManager.Old(Za.id);this.pasteDestinationHasMergedCells(Za.expandDestinations)&&(Xb.pasteContext.pasteDestinationHasMergedCells=!0);const Ka=P(this.lK);(Za.clearStateOnFinish||Za.clearSystemClipboard)&&this.cr("Paste/fail/"+m.a[Za.ribbonCommandInfo.method],!0,void 0,void 0,Za.copyPasteTargetType).catch(()=>{});if(Xb){Qc=Xb.reason;hc+=Fa.zKa(Xb);Xb.message&&(Kb=Xb.message);
if(jb=Fa.v$g(Xb))if(1===jb.pasteErrorName)Sb=!0,oc="CopyPasteLengthTooLongPopup",Kb=lc="The pasted content is too long. Popup a dialog to the user.",e.ULS.sendTraceTag(25216992,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${lc}, copyPasteTargetType="${Za.copyPasteTargetType}"`),jb=yb.a.ed(1,0,26,689,0,1306609195,"CopyPasteOversizeError"),n.EwaSettings.kz()?new db.a(this.$,jb):(jb=new Ca.ErrorDialog(this.$,jb),jb.initialize(),jb.kg());else if(7===jb.pasteErrorName)Sb=!0,oc="No-Op",Kb=lc="The shadow workbook is not ready yet and an async copy failed to populate the clipboard. Do nothing (by the spec)",
e.ULS.sendTraceTag(33948251,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${lc}, copyPasteTargetType="${Za.copyPasteTargetType}"`);else if(8===jb.pasteErrorName)Sb=!0,oc="UseShortcutsPopup",Kb=lc="Unable to paste content from the system clipboard. Popup dialog to the user.",e.ULS.sendTraceTag(25216994,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${lc}, copyPasteTargetType="${Za.copyPasteTargetType}"`),this.nNf();else if(18===jb.pasteErrorName){Sb=!0;oc="PasteExternalNotSupportMultipleSelectionPopup";
Kb="Paste external not support multiple selection.";lc="Unknown";var Ib=2189;100!==jb.validationFailureReason&&(lc=sa[jb.validationFailureReason],Ib=Fa.jGe(jb.validationFailureReason));this.iza(Ib,lc,!0)}else 20===jb.pasteErrorName||19===jb.pasteErrorName?(Sb=!0,20===jb.pasteErrorName?(oc="PasteAcrossSessionNotSupportMultipleSelectionPopup",Kb="Paste across session does not support multiple selection."):(oc="PasteInSameSessionNotSupportMultipleSelectionPopup",Kb="This kind of multiple selection is not supported for same session paste."),
lc="Unknown",Ib=2189,100!==jb.validationFailureReason&&(lc=sa[jb.validationFailureReason],Ib=Fa.jGe(jb.validationFailureReason)),jb=6===jb.validationFailureReason,this.L0c(Za.commandType,Za.expandDestinations)&&jb&&this.axc(Za.expandDestinations),this.iza(Ib,lc,!0)):6===jb.pasteErrorName?(Sb=!0,oc="No-Op",Kb=lc="Paste Formatting/Transpose is not yet a supported operation on System Clipboard based content",e.ULS.sendTraceTag(36263241,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${lc}, copyPasteTargetType="${Za.copyPasteTargetType}"`)):
17===jb.pasteErrorName?(Sb=!0,oc="No-Op",Kb=lc="Paste text on Art is not yet a supported operation",e.ULS.sendTraceTag(0,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${lc}, copyPasteTargetType="${Za.copyPasteTargetType}"`)):16===jb.pasteErrorName?(Sb=!0,oc="No-Op",Kb=lc="Paste has failed because the previous copy has failed",jb=this.getStringifiedError(jb),e.ULS.sendTraceTag(537167771,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${lc}, copyPasteTargetType="${Za.copyPasteTargetType}", error=${jb}`)):
yb.a.oq(jb.ewaErrors)?(yb.a.O9(jb.ewaErrors)||yb.a.dh(jb.ewaErrors,yb.a.Kdc())?(Sb=!0,oc="CommunicationError",lc=yb.a.nc(jb.ewaErrors),e.ULS.sendTraceTag(36304159,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Kb} copyPasteTargetType="${Za.copyPasteTargetType}"`)):yb.a.dh(jb.ewaErrors,Fa.msj)?(Sb=!0,oc="SavingWorkbookError",lc=yb.a.nc(jb.ewaErrors),e.ULS.sendTraceTag(36304160,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Kb} copyPasteTargetType="${Za.copyPasteTargetType}"`)):yb.a.dh(jb.ewaErrors,
Fa.operationSucceededWithAlert)&&(Cc=Sb=!0,oc="OperationSucceededWithAlert",lc=yb.a.nc(jb.ewaErrors),e.ULS.sendTraceTag(36304161,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Kb} copyPasteTargetType="${Za.copyPasteTargetType}"`)),Sb||(Kb=this.bcc(jb.ewaErrors),Sb=this.rqd(Xb))):11===jb.pasteErrorName&&(Sb=!0,oc="No-Op",Kb="Paste has failed because user try copy cross-session oart object");15===Xb.reason&&(Sb=!0,oc="No-Op",Kb="Rejecting deferred paste there is metadata update without copy context. Usually it means that copy canceled before finished.");
W.a.equals(hc,M.O2j,!1)&&(Sb=!0,oc="No-Op",Kb="User hash of the copy is different then the user hash of the paste during cross-session copy-paste. Do nothing.")}Sb||(jb=Xb?this.getStringifiedError(Xb):"null",e.ULS.sendTraceTag(24150916,0,10,`CopyPasteInfrastructure.OnPasteFailed: ${jb}, copyPasteTargetType="${Za.copyPasteTargetType}"`));this.YCi(Za,Sb,Kb,oc,hc,Qc,Cc,Xb.pasteContext,Ka);return Promise.reject(Xb)}Spc(Za,Xb){var jb,Sb,lc;e.ULS.sendTraceTag(24150917,0,50,`CopyPasteInfrastructure.OnPasteSuccess: paste succeed. copyPasteTargetType="${Xb.copyPasteTargetType}"`);
this.pasteIndicationManager.Old(Xb.id);if(this.o4i(Xb.copyPasteTargetType,Za)){n.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.WA&&Za.wasLastCopyExternal&&Za.payloadType===ca.shadowWorkbook&&(this.J7a=!0);let oc=null;(null===(jb=Za.pastedRange)||void 0===jb?0:jb.Ranges)&&0<Za.pastedRange.Ranges.length?oc=G.g(Za.pastedRange.Ranges):Za.wasLastCopyExternal||(oc=Xb.expandDestinations);this.buj(Za,oc);if(this.tGj(Za,oc)){let Qc;this.Rcd?(jb=G.d(Xb.originalDestinations),
Qc=1028===Xb.commandType?G.d(Xb.expandDestinations):G.d(oc)):(jb=v.a.clone(Xb.originalDestinations),Qc=1028===Xb.commandType?v.a.clone(Xb.expandDestinations):v.a.clone(oc));let Kb=null;Za.wasLastCopyExternal&&(Xb.isKeyboardEvent||Xb.isPasteCommandFromRecoveryUI)&&(Kb={[Fa.bMf]:Za.clipboardItems});this.pasteDestinationHasMergedCells(Xb.expandDestinations)&&(Za.pasteDestinationHasMergedCells=!0);Za.pasteRecoveryUIDisplayed=!0;const hc=new da(this.$,jb,Qc,Kb),Cc=Ea.GetServiceTaskFactory.Oa(this.$.da,
406,405,0);ka.TaskExtensions.za(Cc,()=>{const Ka=Cc.result;Ka.OVg(hc);Ka.EJj(Xb.ribbonCommandInfo.method)},this.la,8)}n.EwaSettings.isChangeGateEnabled("OfficeVSO:7512213_SVNoPasteFormatting")?(jb=[237279923,-875588320,-185374993,-958589048],!Za.pasteRecoveryUIDisplayed&&1===oc.length&&jb.includes(null===(lc=null===(Sb=Za.commandParameters)||void 0===Sb?void 0:Sb.ribbonCommandInfo)||void 0===lc?void 0:lc.command)&&(Sb=G.K(oc),A.AFrameworkApplication.Sp("XLS-SmartView-CutAndPaste-Treatment;XLS-SmartView-CutAndPaste-Control"),
n.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.CutAndPasteEnabled",!1)&&Sb&&(lc=Ja.d(this.$.va.na),Sb=new Wb.a(Sb,lc),this.NCc(Sb,"CutAndPaste")))):Za.pasteRecoveryUIDisplayed||1!==oc.length||(Sb=G.K(oc),A.AFrameworkApplication.Sp("XLS-SmartView-CutAndPaste-Treatment;XLS-SmartView-CutAndPaste-Control"),n.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.CutAndPasteEnabled",!1)&&Sb&&(lc=Ja.d(this.$.va.na),Sb=new Wb.a(Sb,lc),this.NCc(Sb,"CutAndPaste")))}this.TCe("Paste/success/"+
m.a[Xb.ribbonCommandInfo.method],Za);this.ZCi(Za);this.M8f&&(!Xb.isKeyboardEvent||U(Za))&&this.$.ea.wg.get(66)&&(e.ULS.sendTraceTag(537167770,0,15,"CopyPasteInfrastructure.OnPasteSuccess: show localStorage disable notification"),this.M8f=!1,this.bbh());return Promise.resolve(!0)}tGj(Za,Xb){return!Xb||1!==Xb.length||Za.commandParameters.clearSystemClipboard||Za.commandParameters.clearStateOnFinish||Za.commandParameters.skipClipboardAccess?!1:N(Za)&&(Xb=Za.clipboardItems.getItem(L.plainText),Za=Za.clipboardItems.getItem(L.html),
void 0===Xb||null===Xb||Xb.length>this.IGi||void 0===Za||null===Za||Za.length>this.aya)?(e.ULS.sendTraceTag(537167769,0,50,"CopyPasteInfrastructure.ShouldShowPasteRecoveryUI: Not showing PasteRecoveryUI for external copy."),!1):!0}o4i(Za,Xb){return 1===Za||Xb.payloadType===ca.plainText||n.EwaSettings.sa(151)&&Xb.payloadType===ca.html||n.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.WA&&Xb.payloadType===ca.shadowWorkbook}pasteDestinationHasMergedCells(Za){const Xb=
X.h(this.$).Ca.JA();if(!Xb||!Xb.length)return!1;for(const jb of Xb)if(jb.iw(Za[0]))return!0;return!1}TCe(Za,Xb){let jb;({tHa:jb}=this.Emi(Xb)).returnValue&&this.cr(Za,jb,void 0,void 0,Xb.commandParameters.copyPasteTargetType).catch(()=>{})}m$a(Za,Xb,jb,Sb,lc,oc){const Qc=Za?this.getStringifiedError(Za):"null";this.Hwa||e.ULS.sendTraceTag(24150918,0,10,`CopyPasteInfrastructure.OnDragAndDropCellsFailed: ${Qc}`);let Kb=!1,hc=!1,Cc=!1,Ka=Fa.itb,Ib=Fa.HNe+Fa.hJa;Za&&(Ib+=Fa.zKa(Za),yb.a.oq(Za.ewaErrors)?
(Ka=this.bcc(Za.ewaErrors),yb.a.dh(Za.ewaErrors,Fa.operationSucceededWithAlert)&&(Kb=!0),yb.a.dh(Za.ewaErrors,Fa.dragDropNonEmptyRange)&&(hc=Cc=!0)):Za.message&&(Ka=Za.message));Cc||(Cc=this.rqd(Za));hc?this.gridView.ha.selectionType=-1:this.Fp.fej(lc);this.Hwa&&!Cc&&e.ULS.sendTraceTag(24150918,0,10,`CopyPasteInfrastructure.OnDragAndDropCellsFailed: ${Qc}, copyPasteTargetType="${Xb.copyPasteTargetType}`);this.OBi(Xb,jb,Sb,lc,Cc,Ka,Ib,Kb,oc)}A0c(Za,Xb){let jb=Za;const Sb=this.JXh();if(null===Sb||void 0===
Sb?0:Sb.ranges)jb=this.Fp.m0g(Xb,Sb.ranges,Za);return jb}JXh(){const Za=P(this.lK);return Za&&E(Za.sourceItem)?Za.sourceItem:null}pbj(){this.raiseEvent(Fa.zEd,null)}buj(Za,Xb){const jb=Za.commandParameters.originalDestinations;Xb&&(G.Q(this.gridView.ha.qa.selectedRanges,jb)?(this.axc(Xb),Za=mb.HelperMethods.mpb(Xb),e.ULS.sendTraceTag(537167767,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range, range: ${Za}`)):Za.commandParameters.isPasteCommandFromRecoveryUI?(this.axc(Xb,
!0),e.ULS.sendTraceTag(537167766,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range for IsPasteCommandFromRecoveryUI, range: ${Xb}, active cell: ${Xb[0].topLeft}`)):(Za=mb.HelperMethods.mpb(jb),e.ULS.sendTraceTag(537167765,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: user change his selection during paste operation. don't change selection. originalPasteDestinations: ${Za}`)))}Emi(Za){if(Za.isPlainTextPaste||Za.isHtmlPaste||Y(Za)||Za.commandParameters.isPasteCommandFromEnterShortcut)return{returnValue:!0,
tHa:!1};var Xb=Za.copyContextSnapshot;if(Za.commandParameters.clearStateOnFinish)return{returnValue:!0,tHa:!0};if(Xb&&E(Xb.sourceItem)){var jb=Xb.sourceItem;if(!jb.isFromCurrentSession(this.$))return{returnValue:!1,tHa:!0};Xb=-1985798686===Xb.commandParameters.ribbonCommandInfo.command;if(!(1<jb.ranges.length||1<Za.commandParameters.expandDestinations.length)){const Sb=G.K(jb.ranges);Za=G.K(Za.commandParameters.expandDestinations);const lc=this.$.ea.na.sheetName;jb=jb.sheetName;if(jb===lc&&Za.equals(Sb))return{returnValue:!1,
tHa:!0};if(jb===lc&&Za.De(Sb))return{returnValue:!0,tHa:!1}}return{returnValue:Xb,tHa:!0}}return{returnValue:!1,tHa:!0}}ZIf(){var Za=P(this.lK);(Za=this.Fp.Exb(Za))&&Za.isFromCurrentSession(this.$)&&this.cr("OnStartEdit",!1).catch(()=>{})}bcc(Za){Za=yb.a.mUh(Za,Fa.hJa);return this.VHi+d.a.Yu(Za).toString()}rqd(Za){Za=Fa.zKa(Za);return!!Za&&W.a.s2a(Za,Fa.UHi)}bbh(){const Za=yb.a.ed(1,2,326,327,h.a.$o?328:h.a.rH?329:330,530046625,"ActivateLocalStorage"),Xb=Ea.GetServiceTaskFactory.Oa(this.$.da,5,4,
0);ka.TaskExtensions.za(Xb,()=>{Xb.result.ih(43,Za)},this.la,3)}rGe(Za){return void 0===Za||null===Za?ia.fLi:Za?ia.success:ia.failed}static v$g(Za){const Xb=Za.innerError;return Xb&&0!==Xb.pasteErrorName?Za.innerError:null}static h$g(Za){const Xb=Za.innerError;return Xb&&0!==Xb.copyErrorName?Za.innerError:null}static zKa(Za){let Xb="";if(!Za)return Fa.zKe;Za.errorName&&(Xb=Za.errorName,Za.innerError&&(Xb+=Fa.hJa+Fa.zKa(Za.innerError)));Xb||(Xb=Za&&Za.name?Za.name:Fa.zKe);return Xb}static rbc(){Fa.Oq||
(Fa.Oq=wa.UKj);return Fa.Oq}static jGe(Za){switch(Za){case 7:case 1:return 2196;case 5:return 2193;case 6:return 2192;case 8:case 3:case 2:case 4:case 9:case 10:return 2189;default:return e.ULS.shipAssertTag(537167764,0,!1,`CopyPasteInfrastructure.ConvertPasteValidationOptionToJsStringId: no case for validationOptions = ${Za}`),2196}}static i$g(Za){switch(Za){case 3:return 2190;case 1:return 2191;case 2:case 4:return 2189;default:return e.ULS.shipAssertTag(537167763,0,!1,`CopyPasteInfrastructure.ConvertCopySourceValidationOptionToJsStringId: no case for validationOptions = ${Za}`),
2196}}NCc(Za,Xb){ka.TaskExtensions.za(Ea.GetServiceTaskFactory.Oa(this.$.da,426,427,1),jb=>{void jb.result.sea(Za,Xb);e.ULS.sendTraceTag(512615303,0,50,"CopyPasteInfrastructure.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},this.$.la,3)}}Fa.Ovf="EwaJsMetadataChangeListenerId";Fa.zEd="cpiOSC";Fa.okh="cpiDID";Fa.itb="Unknown";Fa.zKe="UnknownError";Fa.hJa="_";Fa.HNe="DragAndDropError";Fa.pasteErrorName="PasteError";Fa.s1g="CancelError";Fa.copyErrorName="CopyError";
Fa.UHi="MergedCellOverlap";Fa.bMf="PasteRecoveryCachedClipboardItems";Fa.msj=[1352631530,1679665408];Fa.operationSucceededWithAlert=[-103190598];Fa.pasteDataLimitHit=[1306609195];Fa.copyThrottlingError=[-386183710];Fa.dragDropNonEmptyRange=[563945982];Fa.Oq=null;Object(c.a)(Fa,"CopyPasteInfrastructure",u.a,[441,442,2]);class ab{constructor(){this.q0a=this.fDe=null}}Object(c.a)(ab,"ClipboardPlatformInitializationResult",null,[]);var Gb=a(191),Ga=a(648),Ma=a(552),Qa=a(123),wb=a(5),Na=a(60);const ya=
(Za,Xb,jb,Sb,lc,oc,Qc,Kb,hc,Cc=null)=>{hc=Za.Na(9,hc);hc.sourceRanges=Xb;hc.destinationRanges=jb;hc.flags=Sb;return Na.g(Za,"PasteRange",hc,lc,oc,Qc,Kb,64,Cc)},nb=(Za,Xb,jb,Sb,lc,oc,Qc,Kb=null)=>{Qc=Za.Na(1,Qc);Qc.pasteHtmlParameters=Xb;return Na.g(Za,"PasteHtmlContent",Qc,jb,Sb,lc,oc,64,Kb)},vb=(Za,Xb,jb,Sb,lc,oc,Qc,Kb,hc=null)=>{Kb=Za.Na(9,Kb);Kb.destinationRange=Xb;Kb.source=jb;return Na.g(Za,"PasteString",Kb,Sb,lc,oc,Qc,64,hc)},gb=(Za,Xb,jb,Sb,lc,oc,Qc=null,Kb=null)=>{Qc=Za.Na(1,Qc);Qc.copyParameters=
Xb;return Na.g(Za,"Copy",Qc,jb,Sb,lc,oc,0,Kb)},cb=(Za,Xb,jb,Sb,lc,oc,Qc=null,Kb=null)=>{Qc=Za.Na(1,Qc);Qc.copyParameters=Xb;return Na.g(Za,"Cut",Qc,jb,Sb,lc,oc,0,Kb)},La=(Za,Xb,jb,Sb,lc,oc,Qc=null,Kb=null)=>{Qc=Za.Na(1,Qc);Qc.pasteParameters=Xb;return Na.g(Za,"Paste",Qc,jb,Sb,lc,oc,64,Kb)};class ja{constructor(Za,Xb,jb){this.destinationRange=this.sourceRange=null;this.pasteFlags=0;this.sourceRange=Za;this.destinationRange=Xb;this.pasteFlags=jb}}Object(c.a)(ja,"MacroRecorderPasteRangePayload",null,
[122]);class Ua{constructor(Za,Xb){this.content=this.destinationRange=null;this.destinationRange=Za;this.content=Xb}getContent(){return this.content}}Object(c.a)(Ua,"MacroRecorderPasteStringPayload",null,[122]);class lb{constructor(Za){this.pasteParameters=null;this.pasteParameters=Za}}Object(c.a)(lb,"MacroRecorderPastePayload",null,[122]);var sb=a(589),V=a(796),za=a(192),Ra=a(33),Xa=a(213),$a=a(113),ma=a(282);const fa=(Za,Xb,jb,Sb,lc,oc,Qc=null)=>{Qc=Za.Na(41,Qc);Qc.insertCopiedCutCellsParameters=
Xb;return Na.g(Za,"InsertCopiedCutCells",Qc,jb,Sb,lc,oc,4)},eb=(Za,Xb,jb,Sb,lc,oc,Qc=null)=>{Qc=Za.Na(41,Qc);Qc.insertCopiedCutCellsParameters=Xb;return Na.g(Za,"InsertCopiedCutCellsV2",Qc,jb,Sb,lc,oc,0)};class ua{constructor(Za){this.parameters=null;this.parameters=Za}getParameters(){return this.parameters}}Object(c.a)(ua,"MacroRecorderRangeCopyCutCellsInsertedPayload",null,[122]);var xa=a(374);class tb{constructor(Za,Xb,jb,Sb,lc,oc,Qc,Kb,hc){this.destinationRange=Za;this.csb=jb;this.h4i=Sb;this.Sd=
lc;this.hQb=oc;this.pasteContext=Qc;this.B3b=Kb;this.Afg=hc}}Object(c.a)(tb,"PasteHtmlRequestParams",null,[]);class Qb{constructor(Za,Xb){this.Akc=this.zNa=null;this.CPa=O.a.CPa;this.NFd=O.a.NFd;this.jEb=O.a.jEb;this.nhc=n.EwaSettings.getBooleanFeatureGate(O.a.e6b,!1);this.Zpi=n.EwaSettings.isChangeGateEnabled("OfficeVSO:7316963_InsertCopiedCutCellsV2Enabled");this.Nod=!1;this.Pwa=n.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",!1);this.wz=(jb,Sb)=>{if(2===
Sb.sr)this.wv.clear(),this.zNa=null;else if(1===Sb.sr&&this.wv&&this.wv.contains(Sb.Lf)){jb=Qa.a(Sb.Lf.operation.operationName);const lc=Sb.Lf.dequeueUtcTime.getTime()-Sb.Lf.enqueueUtcTime.getTime();e.ULS.sendTraceTag(526758673,0,50,`CopyPasteUtils.OnQueueChanged: web method ${jb} returned, it took ${lc} milliseconds to complete.`);this.wv.remove(Sb.Lf);this.zNa=null}};this.$=Za;this.gridView=Xb;this.Nod&&(this.$.userOperationManager.Lr(this.wz),this.wv=new Gb.a)}get aya(){return this.Pwa?n.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",
this.$.ya.CopyPasteMaxPayloadLength):z.a.aya}copy(Za,Xb,jb,Sb=null,lc=null){const oc=this.$.oa.xa.Wb();this.Nod&&this.TX();this.Akc=oc.ClientRequestId;var Qc=new za.a(505,0,(Kb,hc,Cc)=>{const Ka={CopyPasteTargetType:1};Ka.SourceRanges=Za;Ka.CopyOperationId=Xb.id;e.ULS.sendTraceTag(537167756,0,50,`CopyPasteInfrastructure.Copy served from CopyPasteProxy : ${this.Pwa}, CopyOperationId : ${Ka.CopyOperationId}`);return this.zNa=this.Pwa?gb(this.$.oa.Wv,Ka,ma.b(Kb,jb),Sb?ma.a(hc,Sb):hc,Cc,Xb.ribbonCommandInfo,
oc,lc):gb(this.$.oa.xa,Ka,ma.b(Kb,jb),Sb?ma.a(hc,Sb):hc,Cc,Xb.ribbonCommandInfo,oc,lc)},80);Qc=this.$.userOperationManager.Jc(Qc,Xb.ribbonCommandInfo);this.Nod&&this.wv.add(Qc)}aMf(Za,Xb,jb,Sb,lc,oc){return new Promise((Qc,Kb)=>{var hc;const Cc=oc.commandParameters.stopwatch.Bc;let Ka=2;20===oc.commandParameters.commandType&&(Ka=16);36===oc.commandParameters.commandType&&(Ka=32);68===oc.commandParameters.commandType&&(Ka=64);Ra.a.bud(this.$)&&1028===oc.commandParameters.commandType&&(Ka=1024);let Ib=
null;if(null===(hc=oc.copyContextSnapshot)||void 0===hc?0:hc.commandParameters)Ib=oc.copyContextSnapshot.commandParameters.id;Qb.tQd(this.$,Za,Sb,Xb,jb,null,dc=>{Qb.kec(dc,oc,Qc,Kb,Cc,this.$,null,!0,null,null)},dc=>{oc.serverRequestTimeInMs=oc.commandParameters.stopwatch.Bc-Cc;dc=$a.a.Pe(dc.data);Kb(new V.a(5,dc))},lc,Ka,Ib,oc.commandParameters.id)})}pasteRange(Za,Xb,jb,Sb,lc,oc,Qc,Kb,hc,Cc){return new Promise((Ka,Ib)=>{const dc=Qc.commandParameters.stopwatch.Bc;Qb.ivj(this.$,Za,Xb,jb,Sb|-5&lc,yc=>
{Qb.kec(yc,Qc,Ka,Ib,dc,this.$,null,!0,hc,Cc)},yc=>{Qc.serverRequestTimeInMs=Qc.commandParameters.stopwatch.Bc-dc;yc=$a.a.Pe(yc.data);yc=new V.a(5,yc);null===Cc||void 0===Cc?void 0:Cc(yc);Ib(yc)},oc,Kb)})}q9i(Za,Xb,jb,Sb,lc,oc,Qc){return(new Promise((Kb,hc)=>{if(Xb)if(Xb.length>this.aya){var Cc=Qc.clipboardItems.getItem(L.plainText);let Ka=-1;void 0!==Cc&&null!==Cc&&(Ka=Cc.length);O.a.qif&&Xb.length<this.NFd&&Xb.length>this.CPa&&(this.gNf(Xb),this.KV=new tb(Za,Xb,jb,Sb,lc,oc,Qc,0,this.rrc.length),
window.requestIdleCallback&&window.requestIdleCallback(()=>this.dGd()));e.ULS.sendTraceTag(42071712,0,15,`CopyPasteInfrastructure.ProcessPasteHtml copy paste length too long. clipboardHtml.Length: ${Xb.length}, MaxHtmlImportLength: ${this.aya}, PlainTextLength: ${Ka}`);hc(new V.a(1))}else Cc=new za.a(204,0,(Ka,Ib,dc)=>{this.$.my();const yc=Qc.commandParameters.stopwatch.Bc;Ka=ma.b(Ka,Vd=>{Qb.kec(Vd,Qc,Kb,hc,yc,this.$,Xb,!1,null,null)});Ib=ma.a(Ib,Vd=>{Qc.serverRequestTimeInMs=Qc.commandParameters.stopwatch.Bc-
yc;Vd=$a.a.Pe(Vd.data);hc(new V.a(3,Vd))});const Eb=this.$.oa.xa.Wb(),Ac=G.v(Za,this.$),ld={};ld.SourceHtml=Xb;ld.DestinationRanges=Ac?G.s(Ac):null;ld.CopyOperationId=jb;ld.PasteId=Sb;e.ULS.sendTraceTag(537167755,0,50,`CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : ${this.Pwa}. PasteId : ${ld.PasteId}`);return this.Pwa?nb(this.$.oa.Wv,ld,Ka,Ib,dc,null,Eb,oc):nb(this.$.oa.xa,ld,Ka,Ib,dc,null,Eb,oc)},65),this.$.userOperationManager.Jc(Cc,lc);else Kb("")})).then(()=>{O.a.qif&&
Xb.length>this.CPa&&(this.gNf(Xb),this.KV=new tb(Za,Xb,jb,Sb,lc,oc,Qc,0,this.rrc.length),window.requestIdleCallback&&window.requestIdleCallback(()=>this.dGd()))})}gNf(Za){const Xb=this.$.Jb.Gc("Task","pasteHtmlChunkOperation"),jb=Math.floor(Za.length/this.CPa)+1;this.rrc=Array(jb);let Sb=0;for(;Sb<jb;)this.rrc[Sb]=Za.substring(Sb*this.CPa,(Sb+1)*this.CPa),Sb++;e.ULS.sendTraceTag(523257954,0,50,`CopyPasteUtils.populatePasteChunks Time taken for chunking: ${Xb.Bc}`)}dGd(){this.g4i(this.KV.destinationRange,
this.rrc[this.KV.B3b],this.KV.csb,this.KV.h4i,this.KV.Sd,this.KV.hQb,this.KV.pasteContext,this.KV.B3b,this.KV.Afg);this.KV.B3b++;this.KV.B3b<this.KV.Afg&&window.requestIdleCallback(()=>this.dGd())}g4i(Za,Xb,jb,Sb,lc,oc,Qc,Kb,hc){const Cc=new za.a(204,0,(Ka,Ib,dc)=>{const yc=Qc.commandParameters.stopwatch.Bc;Ka=ma.b(Ka,()=>{e.ULS.sendTraceTag(512313415,0,15,`CopyPasteUtils.pasteHtmlServerCall succeeded serverRequestTimeInMs:${Qc.commandParameters.stopwatch.Bc-yc},
             pasteid:${Sb},
             chunkIndex:${Kb},
             totalChunks:${hc}`)});Ib=ma.a(Ib,()=>{Qc.serverRequestTimeInMs=Qc.commandParameters.stopwatch.Bc-yc;e.ULS.sendTraceTag(512313414,0,15,`CopyPasteUtils.pasteHtmlServerCall failed serverRequestTimeInMs:${Qc.serverRequestTimeInMs},
               pasteid:${Sb},
               chunkIndex:${Kb},
               totalChunks:${hc}`)});const Eb=this.$.oa.xa.Wb();var Ac=G.v(Za,this.$);Ac={SourceHtml:Xb,DestinationRanges:Ac?G.s(Ac):null,CopyOperationId:jb,PasteId:`${Sb}_chunk_${Kb}`,ChunkIndex:Kb,TotalChunks:hc};e.ULS.sendTraceTag(523257952,0,50,`CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : ${this.Pwa}. PasteId : ${Ac.PasteId}`);return nb(this.$.oa.Wv,Ac,Ka,Ib,dc,null,Eb,oc)},65);this.$.userOperationManager.Jc(Cc,lc)}r9i(Za,Xb,jb,Sb,lc){return new Promise((oc,Qc)=>{e.ULS.sendTraceTag(537167754,
0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: method start. pasteContext.Id=${lc.id}`);Xb&&(Xb=W.a.trimEnd(Xb,"\n","\r"));e.ULS.sendTraceTag(537167753,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after clipboardText.TrimEnd. pasteContext.Id=${lc.id}`);if(Xb)if(Xb.length>this.jEb)e.ULS.sendTraceTag(24150921,0,15,"CopyPasteInfrastructure.ProcessPasteText copy paste length too long. clipboardText.Length: {0}, MaxCopyPasteLength: {1}",Xb.length,this.jEb),Qc(new V.a(1));
else{let hc,Cc;const Ka=G.v(Za,this.$);e.ULS.sendTraceTag(537167752,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before treatAsLink calculation. pasteContext.Id=${lc.id}`);var Kb=!this.$.ea.isNamedObjectViewMode&&!Xb.includes("\n")&&!Xb.includes("\t");e.ULS.sendTraceTag(537167751,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before isLink check. pasteContext.Id=${lc.id}. treatAsLink=${Kb}`);Kb=Kb&&W.a.Pjf(Xb);e.ULS.sendTraceTag(537167750,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after treatAsLink calculation. pasteContext.Id=${lc.id}. treatAsLink=${Kb}`);
const Ib=this.$.oa.xa.Wb();if(Kb){Cc=526;e.ULS.sendTraceTag(537167749,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before FixUpUrl. pasteContext.Id=${lc.id}`);const dc=Xa.a.Tcd(Xb);e.ULS.sendTraceTag(537167748,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after FixUpUrl. pasteContext.Id=${lc.id}`);const yc=G.s(Ka);Kb=(Eb,Ac,ld)=>{const Vd=lc.commandParameters.stopwatch.Bc;Eb=ma.b(Eb,Od=>{e.ULS.sendTraceTag(537167747,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on ApplyHyperlink successCallback. pasteContext.Id=${lc.id}`);
lc.requestTelemetryData=Od.RequestTelemetryData;lc.serverRequestTimeInMs=lc.commandParameters.stopwatch.Bc-Vd;Od.Errors&&0<Od.Errors.length?Qc(new V.a(2,Od.Errors)):oc(Xb)});Ac=ma.a(Ac,Od=>{lc.serverRequestTimeInMs=lc.commandParameters.stopwatch.Bc-Vd;Od=$a.a.Pe(Od.data);Qc(new V.a(2,Od))});this.$.my();e.ULS.sendTraceTag(537167746,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before ApplyHyperlink. pasteContext.Id=${lc.id}`);return Na.b(this.$.oa.xa,yc,Xb,dc,!1,!1,63,Eb,Ac,ld,Za,
Ib,Sb)};hc=()=>new sb.a(yc,Xb,dc)}else Cc=180,Kb=(dc,yc,Eb)=>{this.$.my();const Ac=lc.commandParameters.stopwatch.Bc;dc=ma.b(dc,ld=>{e.ULS.sendTraceTag(537167745,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on PasteString successCallback. pasteContext.Id=${lc.id}`);Qb.kec(ld,lc,oc,Qc,Ac,this.$,Xb,!1,null,null)});yc=ma.a(yc,ld=>{lc.serverRequestTimeInMs=lc.commandParameters.stopwatch.Bc-Ac;ld=$a.a.Pe(ld.data);Qc(new V.a(4,ld))});e.ULS.sendTraceTag(537167744,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before PasteString. pasteContext.Id=${lc.id}`);
return vb(this.$.oa.xa,Ka,Xb,dc,yc,Eb,null,Ib,Sb)},hc=()=>new Ua(Ka,Xb);e.ULS.sendTraceTag(537167715,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before UserWebMethodOperation. pasteContext.Id=${lc.id}`);Kb=new za.a(Cc,0,Kb,65,hc);e.ULS.sendTraceTag(537167714,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: returning. pasteContext.Id=${lc.id}`);this.$.userOperationManager.Jc(Kb,jb)}else oc("")})}rcf(Za,Xb){Xb=[1===Xb?4:5];this.gridView.Cb.xB(Wb.a.FTa(Ja.d(this.$.na),
Za),Xb,!0);this.gridView.Cb.Nq(Xb);this.gridView.Cb.update(!0)}Sec(){const Za=[4,5];this.gridView.Cb.Nj(Za,!1,!1);this.gridView.Cb.wk(null,Za,!1);1===this.gridView.ha.Oe&&this.gridView.Nq(!1,!1);this.gridView.Cb.update(!1,!1)}m0g(Za,Xb,jb){const Sb=[];for(const lc of jb)Sb.push(this.q0g(Za,Xb,lc));return Sb}TX(){if(this.wv)for(let Za of this.wv)if(this.$&&this.$.userOperationManager){if(Za.operation){const Xb=Qa.a(Za.operation.operationName);e.ULS.sendTraceTag(526758675,0,50,`CopyPasteUtils.AbortOutstandingUserOperation: Trying to abort pending operation ${Xb}.`)}this.q1g();
this.$.userOperationManager.Dta(Za)}}q1g(){if(this.zNa){const Za=this.zNa.Rs;e.ULS.sendTraceTag(526758674,0,15,`Cancelling pending copy request with Id=${Za}`);$a.a.Nt(Za);!n.EwaSettings.isChangeGateEnabled("OfficeVSO:6151555_DisableCancelCopyRequest")&&this.Akc&&Na.h(this.$.oa.xa,this.Akc,null,null,null);this.Akc=this.zNa=null}}q0g(Za,Xb,jb){e.ULS.shipAssertTag(537167713,0,!!Xb,"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray shouldn't be null");e.ULS.shipAssertTag(537167712,0,0<Xb.length,
"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray length shouldn't be zero");let Sb=0,lc=0;var oc=new Set;const Qc=new Set;for(const Kb of Xb){Xb=`${Kb.left}_${Kb.right}`;const hc=`${Kb.top}_${Kb.bottom}`;Qc.has(Xb)||(Qc.add(Xb),lc+=Kb.width);oc.has(hc)||(oc.add(hc),Sb+=Kb.height)}if(36===Za)return jb.isSingle?Qb.rWe(lc,Sb,jb):jb.clone();516===Za&&(Za=Sb,Sb=lc,lc=Za);Za=!(jb.width%lc)&&!(jb.height%Sb);oc=jb.TZ&&!(jb.height%Sb);jb.c5&&!(jb.width%lc)||oc?jb=Qb.rWe(lc,Sb,jb):Za?jb=jb.clone():
(jb=jb.clone(),jb.bottom=Math.min(z.a.Vg,jb.top+Sb-1),jb.right=Math.min(z.a.Ug,jb.left+lc-1));return jb}USg(Za,Xb,jb,Sb,lc,oc,Qc,Kb,hc,Cc,Ka){if(!Sb||!Sb.length)return 1;if(1<Sb.length){if(!this.nhc&&oc)return 3;if(Cc)return 0;if(Kb)return 9;if(hc)return 8;if(Ka)return 2;if(1<Xb.length)return 4;const Ib=Xb[0];if(!Qc&&!v.a.all(Sb,dc=>dc.isSingle||!(dc.width%Ib.width)&&!(dc.height%Ib.height)))return 5;if((!this.nhc||!oc)&&W.a.equals(Za,jb,!0))for(const dc of lc)if(dc.zd(Ib)&&!dc.equals(Ib))return 6}else if(Xb&&
0<Xb.length){if(0!==this.thf(Xb,hc))return 7;if(1<Xb.length){if(!this.nhc&&oc)return 3;if((!this.nhc||!oc)&&W.a.equals(Za,jb,!0))for(const Ib of Xb)if(Za=lc[0],Ib.zd(Za)&&!Ib.equals(Za))return 6}}return 0}thf(Za,Xb){if(!Za||1>=Za.length)return 0;if(Xb)return 2;if(!G.S(Za))return 1;Xb=new Ga.a(Ma.a.Ni());for(const jb of Za)for(const Sb of Za){const lc=jb.top===Sb.top&&jb.bottom===Sb.bottom,oc=jb.left===Sb.left&&jb.right===Sb.right,Qc=Math.max(jb.left,Sb.left)<Math.min(jb.right,Sb.right);if(Math.max(jb.top,
Sb.top)<Math.min(jb.bottom,Sb.bottom)&&!lc||Qc&&!oc)return 3;Xb.add(`${jb.top}-${jb.bottom}-${Sb.left}-${Sb.right}`);Xb.add(`${Sb.top}-${Sb.bottom}-${jb.left}-${jb.right}`)}for(const jb of Za)Xb.remove(`${jb.top}-${jb.bottom}-${jb.left}-${jb.right}`);return 0<Xb.count?3:0}fej(Za){const Xb=this.gridView.ha;Xb.updateSelection(Za,Za.topLeft,0);Xb.selectionType=-1}Exb(Za){if(null===Za||void 0===Za?0:Za.sourceItem){if(!E(Za.sourceItem))return null;if((Za=Za.sourceItem)&&G.bb(Za.ranges,!0))return Za}return null}Thc(Za,
Xb){e.ULS.shipAssertTag(537167711,0,!!Za,"CopyPasteUtils.IsFromKeyboardShortcut: commandInfo shouldn't be null");return Xb&&wb.a.HF in Xb||Za.tabName?!1:1===Za.method}static ivj(Za,Xb,jb,Sb,lc,oc,Qc,Kb,hc){const Cc=Za.oa.xa.Wb(hc?{xla:!0,qka:1}:{xla:!1,qka:0});hc=new za.a(506,0,(Ka,Ib,dc)=>{Za.my();return ya(Za.oa.xa,jb,Sb,lc,ma.b(Ka,oc),ma.a(Ib,Qc),dc,null,Cc,Kb)},65,()=>new ja(jb,Sb,lc));Za.userOperationManager.Jc(hc,Xb)}static kec(Za,Xb,jb,Sb,lc,oc,Qc=null,Kb,hc,Cc){e.ULS.sendTraceTag(537167710,
0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: on HandlePasteResult start. pasteContext.Id=${Xb.id}`);Xb.requestTelemetryData=Za.RequestTelemetryData;Xb.serverRequestTimeInMs=Xb.commandParameters.stopwatch.Bc-lc;yb.a.Wf(Za.Errors)?yb.a.Uga(Za.Errors)?(Xb&&(Xb.encounteredDeploymentErrors=!0),Za=yb.a.nc(Za.Errors),e.ULS.sendTraceTag(537167707,0,15,`CopyPasteUtils.HandlePasteServerResponse: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${Za}`)):
(Za=new V.a(5,Za.Errors),null===Cc||void 0===Cc?void 0:Cc(Za),Sb(Za)):Za.Result?(Sb=!!Za&&!!Za.RequestTelemetryData,X.h(oc).vh.zla(Xb.commandParameters.stopwatch.id,Za.StateId,Sb?Za.RequestTelemetryData.EcsOperationDuration:0,Sb?Za.RequestTelemetryData.EcsRequestDuration:0,Sb?Za.RequestTelemetryData.WfeRequestDuration:0),Xb.pastedRange=Za.Result.SheetMultiRange,e.ULS.sendTraceTag(537167708,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise ewaResult.Result is not null. pasteContext.Id=${Xb.id}`),
null===hc||void 0===hc?void 0:hc(),jb(!0),n.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",!1)&&Kb&&(Xb=Xb.commandParameters.isDragDrop?9:6,(oc=oc.da.Aa(465))&&oc.F0(Xb,Za))):(e.ULS.sendTraceTag(537167709,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise when ewaResult.Result is null. pasteContext.Id=${Xb.id}`),jb(Qc||!0))}static tQd(Za,Xb,jb,Sb,lc,oc,Qc,Kb,hc,Cc,Ka,Ib){const dc=Za.oa.xa.Wb(),yc=Qb.gfh(jb,
Sb,lc,Cc,Ka,Ib);jb=new za.a(503,0,(Eb,Ac,ld)=>{Za.my();return La(Za.oa.xa,yc,ma.b(Eb,Qc),ma.a(Ac,Kb),ld,oc,dc,hc)},65,()=>new lb(yc));Za.userOperationManager.Jc(jb,Xb)}static gfh(Za,Xb,jb,Sb,lc,oc){const Qc={};Qc.ShadowWorkbookBase64=Za.shadowWorkbookBase64;Qc.SourceRanges={};Qc.SourceRanges.Ranges=Array(1);Qc.SourceRanges.Ranges[0]={};Qc.SourceRanges.Ranges[0].FirstRow=Za.rangeRowStart;Qc.SourceRanges.Ranges[0].LastRow=Za.rangeRowEnd;Qc.SourceRanges.Ranges[0].FirstColumn=Za.rangeColumnStart;Qc.SourceRanges.Ranges[0].LastColumn=
Za.rangeColumnEnd;n.EwaSettings.getBooleanFeatureGate(O.a.e6b,!1)?jb?Qc.DestinationRanges=G.u(jb.SheetName,jb.NamedObjectName,G.g(jb.Ranges)):(e.ULS.sendTraceTag(537167706,0,15,"CopyPasteInfrastructure.CreatePasteParameters: multiRangeDestination is null"),Qc.DestinationRanges=null):Qc.DestinationRanges=Xb?G.s(Xb):null;Qc.CopyPasteTargetType=1;Qc.PasteType=Sb;Qc.CopyOperationId=lc;Qc.PasteId=oc;Qc.SourceClientPath=Za.sourceClientPath;Qc.SourceSheetName=Za.sourceSheetName;Qc.SourceWorkbookName=Za.sourceWorkbookName;
if(!Za.originalSourceRangesCountExceedsLimit&&Za.originalSourceRanges&&0<Za.originalSourceRanges.length&&1024===Sb){Qc.OriginalSourceMultiRange={};Xb=Array(Za.originalSourceRanges.length);for(jb=0;jb<Xb.length;++jb)Xb[jb]={},Xb[jb].FirstRow=Za.originalSourceRanges[jb][0],Xb[jb].FirstColumn=Za.originalSourceRanges[jb][1],Xb[jb].LastRow=Za.originalSourceRanges[jb][2],Xb[jb].LastColumn=Za.originalSourceRanges[jb][3];Qc.OriginalSourceMultiRange.Ranges=Xb}return Qc}static rWe(Za,Xb,jb){jb=jb.clone();jb.height<
Xb&&(jb.bottom=Math.min(z.a.Vg,jb.top+Xb-1));jb.width<Za&&(jb.right=Math.min(z.a.Ug,jb.left+Za-1));return jb}executeInsertCopiedCutCellsOperation(Za,Xb,jb,Sb,lc,oc=null,Qc=null){const Kb={};Kb.InsertDirection=Sb;Kb.SourceRange=Za;Kb.DestRange=Xb;Kb.CopyCutOperation=jb?0:1;const hc=this.$.oa.xa,Cc=this.$.oa.xa.Wb(),Ka=()=>new ua(Kb);return xa.a(this.$.userOperationManager,(Ib,dc,yc)=>this.Zpi?eb(hc,Kb,oc?ma.b(Ib,oc):Ib,Qc?ma.a(dc,Qc):dc,yc,Cc):fa(hc,Kb,oc?ma.b(Ib,oc):Ib,Qc?ma.a(dc,Qc):dc,yc,null),
Ib=>new za.a(104,0,Ib,void 0,Ka),lc,n.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MoveTaskCompletionToQueueItemLevelByOptingIn",!1))}ONe(Za,Xb,jb,Sb,lc,oc,Qc,Kb){return new Promise((hc,Cc)=>{this.executeInsertCopiedCutCellsOperation(Xb,jb,Sb,lc,oc,Ka=>{Za.requestTelemetryData=Ka.RequestTelemetryData;if(Ka.Errors&&0<Ka.Errors.length){const Ib=new V.a(21,Ka.Errors);null===Kb||void 0===Kb?void 0:Kb(Ib);Cc(new V.a(21,Ka.Errors))}else null===Qc||void 0===Qc?void 0:Qc(),hc(!0)},Ka=>{Ka=$a.a.Pe(Ka.data);
Ka=new V.a(21,Ka);null===Kb||void 0===Kb?void 0:Kb(Ka);Cc(Ka)})})}}Object(c.a)(Qb,"CopyPasteUtils",null,[440]);var pc=a(494),hb;(function(Za){Za[Za.range=0]="range";Za[Za.art=1]="art"})(hb||(hb={}));Object(c.b)("SourceItemType",hb);var ib=a(94);class Vb{constructor(Za){this.jcg={["SourceItemType.Range"]:0,["SourceItemType.Art"]:1};this.MNb={};this.fcg={["FloatingObjectType.Unknown"]:99,["FloatingObjectType.CardView"]:6,["FloatingObjectType.Chart"]:0,["FloatingObjectType.Group"]:7,["FloatingObjectType.Image"]:1,
["FloatingObjectType.Ink"]:8,["FloatingObjectType.InteractiveReport"]:4,["FloatingObjectType.ModernOfficeExtension"]:3,["FloatingObjectType.Shape"]:5,["FloatingObjectType.Slicer"]:2,["FloatingObjectType.Unsupported"]:100};this.nZc={["99"]:"FloatingObjectType.Unknown",["6"]:"FloatingObjectType.CardView",["0"]:"FloatingObjectType.Chart",["7"]:"FloatingObjectType.Group",["1"]:"FloatingObjectType.Image",["8"]:"FloatingObjectType.Ink",["4"]:"FloatingObjectType.InteractiveReport",["3"]:"FloatingObjectType.ModernOfficeExtension",
["5"]:"FloatingObjectType.Shape",["2"]:"FloatingObjectType.Slicer",["100"]:"FloatingObjectType.Unsupported"};this.icg={["RibbonCommand.Copy"]:-911352779,["RibbonCommand.Cut"]:-1985798686};this.FOd={["-911352779"]:"RibbonCommand.Copy",["-1985798686"]:"RibbonCommand.Cut"};this.hcg={["InputManager.InputMethod.NotDefined"]:-1,["InputManager.InputMethod.Unknown"]:0,["InputManager.InputMethod.Keyboard"]:1,["InputManager.InputMethod.Mouse"]:2,["InputManager.InputMethod.Touch"]:3,["InputManager.InputMethod.CrossSlide"]:9};
this.nka={};this.gcg={["FrameMode.None"]:0,["FrameMode.Reading"]:1,["FrameMode.Edit"]:2};this.A3a={};this.kcg={["UILocation.Unknown"]:0,["UILocation.UpperRibbon"]:1,["UILocation.Ribbon"]:2,["UILocation.QAT"]:3,["UILocation.Jewel"]:4,["UILocation.NavigationPane"]:5,["UILocation.KeyboardShortcut"]:6,["UILocation.StatusBar"]:7,["UILocation.Dialog"]:8,["UILocation.Floatie"]:9,["UILocation.NotificationBar"]:10,["UILocation.StandaloneCuiRoot"]:11,["UILocation.TaskPane"]:12,["UILocation.HeroDock"]:13,["UILocation.SingleLineRibbon"]:14,
["UILocation.MultilineRibbon"]:15,["UILocation.Overflow"]:16,["UILocation.TellMe"]:17,["UILocation.FarPeripheralControls"]:18,["UILocation.ContextMenu"]:19,["UILocation.DialogMenu"]:20,["UILocation.Header"]:21,["UILocation.FileMenu"]:22,["UILocation.Toolbar"]:26,["UILocation.Canvas"]:30};this.Er={};this.$=Za;this.nka.notDefined="InputManager.InputMethod.NotDefined";this.nka.unknown="InputManager.InputMethod.Unknown";this.nka.keyboard="InputManager.InputMethod.Keyboard";this.nka.mouse="InputManager.InputMethod.Mouse";
this.nka.touch="InputManager.InputMethod.Touch";this.nka.crossSlide="InputManager.InputMethod.CrossSlide";this.A3a.none="FrameMode.None";this.A3a.reading="FrameMode.Reading";this.A3a.edit="FrameMode.Edit";this.Er.unknown="UILocation.Unknown";this.Er.upperRibbon="UILocation.UpperRibbon";this.Er.ribbon="UILocation.Ribbon";this.Er.QAT="UILocation.QAT";this.Er.jewel="UILocation.Jewel";this.Er.navigationPane="UILocation.NavigationPane";this.Er.keyboardShortcut="UILocation.KeyboardShortcut";this.Er.statusBar=
"UILocation.StatusBar";this.Er.dialog="UILocation.Dialog";this.Er.floatie="UILocation.Floatie";this.Er.notificationBar="UILocation.NotificationBar";this.Er.standaloneCuiRoot="UILocation.StandaloneCuiRoot";this.Er.taskPane="UILocation.TaskPane";this.Er.heroDock="UILocation.HeroDock";this.Er.singleLineRibbon="UILocation.SingleLineRibbon";this.Er.multilineRibbon="UILocation.MultilineRibbon";this.Er.overflow="UILocation.Overflow";this.Er.tellMe="UILocation.TellMe";this.Er.farPeripheralControls="UILocation.FarPeripheralControls";
this.Er.header="UILocation.Header";this.Er.fileMenu="UILocation.FileMenu";this.Er.contextMenu="UILocation.ContextMenu";this.Er.dialogMenu="UILocation.DialogMenu";this.Er.toolbar="UILocation.Toolbar";this.Er.canvas="UILocation.Canvas";this.MNb.range="SourceItemType.Range";this.MNb.art="SourceItemType.Art"}serializeSourceItem(Za){const Xb={};if(Za&&Object.getType(Za)===D)Xb.sheetName=Za.sheetName,Xb.topArray=v.a.map(Za.ranges,jb=>jb.top),Xb.leftArray=v.a.map(Za.ranges,jb=>jb.left),Xb.bottomArray=v.a.map(Za.ranges,
jb=>jb.bottom),Xb.rightArray=v.a.map(Za.ranges,jb=>jb.right),Xb.sessionStateId=Za.sessionStateId,Xb.sessionId=Za.sessionId,Xb.sourceItemType=this.Z2f(0);else if(Za&&Object.getType(Za)===R)Xb.activeFloatingObjectControlId=Za.activeFloatingObjectControlId,Xb.sheetName=Za.sheetName,Xb.sessionStateId=Za.sessionStateId,Xb.sessionId=Za.sessionId,Xb.floatingObjectType=this.Kvj(Za.type),Xb.sourceItemType=this.Z2f(1);else return e.ULS.shipAssertTag(537167705,0,!1,"EnvironmentSerializationHelper.SerializeSourceItem: sourceItem shouldn't be null."),
null;return JSON.stringify(Xb)}serializeCommandParameters(Za){if(!Za)return e.ULS.shipAssertTag(537167704,0,!1,"EnvironmentSerializationHelper.Serialize: commandParameters shouldn't be null."),null;const Xb={};Xb.id=Za.id;Xb.commandType=Za.commandType;Xb.copyPasteTargetType=Za.copyPasteTargetType;Za.ribbonCommandInfo&&(Xb.ribbonCommandName=this.Tvj(Za.ribbonCommandInfo.command),Xb.inputMethodName=this.Nvj(Za.ribbonCommandInfo.method),Xb.frameModeName=this.Lvj(Za.ribbonCommandInfo.mode),Xb.uiLocationName=
this.Xvj(Za.ribbonCommandInfo.We),Xb.tabName=Za.ribbonCommandInfo.tabName);return JSON.stringify(Xb)}deserializeSourceItem(Za){if(!Za)return null;try{const Xb=JSON.parse(Za);if(!Xb)return e.ULS.shipAssertTag(537167703,0,!1,"EnvironmentSerializationHelper.Deserialize: Json.Parse return null result."),null;let jb=null;switch(this.rlh(Xb.sourceItemType)){case 0:jb=new D(this.$,this.olh(Xb),Xb.sheetName,Xb.sessionStateId,Xb.sessionId);break;case 1:jb=new R(Xb.activeFloatingObjectControlId,Xb.sheetName,
Xb.sessionStateId,Xb.sessionId,this.llh(Xb.floatingObjectType))}return jb}catch(Xb){return e.ULS.sendTraceTag(537167702,0,10,`EnvironmentSerializationHelper.DeserializeSourceItem: got exception while try to JSON.Parse string length: ${Za?Za.length:0}, errror: ${Xb}`),null}}deserializeCommandParameters(Za){if(!Za)return null;try{const Xb=JSON.parse(Za);if(!Xb)return e.ULS.shipAssertTag(537167701,0,!1,"EnvironmentSerializationHelper.DeserializeCommandParameters: Json.Parse return null result."),null;
const jb=Ha.a();jb.id=Xb.id;jb.ribbonCommandInfo=this.qlh(Xb);jb.commandType=Xb.commandType;jb.copyPasteTargetType=Xb.copyPasteTargetType;return jb}catch(Xb){return e.ULS.sendTraceTag(537167700,0,10,`EnvironmentSerializationHelper.DeserializeCommandParameters: got exception while try to JSON.Parse string length: ${Za?Za.length:0}, errror: ${Xb}`),null}}olh(Za){const Xb=[];e.ULS.shipAssertTag(537167699,0,!!Za.topArray&&0<Za.topArray.length,`EnvironmentSerializationHelper.DeserializeRanges: TopArray shouldn't be ${Za.topArray?
"empty":"null"}.`);e.ULS.shipAssertTag(537167698,0,!!Za.leftArray&&0<Za.leftArray.length,`EnvironmentSerializationHelper.DeserializeRanges: LeftArray shouldn't be ${Za.leftArray?"empty":"null"}.`);e.ULS.shipAssertTag(537167697,0,!!Za.bottomArray&&0<Za.bottomArray.length,`EnvironmentSerializationHelper.DeserializeRanges: BottomArray shouldn't be ${Za.bottomArray?"empty":"null"}.`);e.ULS.shipAssertTag(537167696,0,!!Za.rightArray&&0<Za.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: RightArray shouldn't be ${Za.rightArray?
"empty":"null"}.`);if(!(Za.topArray&&Za.leftArray&&Za.bottomArray&&Za.rightArray))return Xb;e.ULS.shipAssertTag(537167695,0,Za.topArray.length===Za.bottomArray.length&&Za.topArray.length===Za.leftArray.length&&Za.topArray.length===Za.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: The length of TopArray(${Za.topArray.length}), BottomArray(${Za.bottomArray.length}), LeftArray(${Za.leftArray.length}), RightArray(${Za.rightArray.length}) should be the same.`);const jb=Math.min(Za.topArray.length,
Za.bottomArray.length,Za.leftArray.length,Za.rightArray.length);for(let Sb=0;Sb<jb;Sb++)Xb.push(new x.Range(Za.topArray[Sb],Za.leftArray[Sb],Za.bottomArray[Sb],Za.rightArray[Sb],!1,!1));return Xb}qlh(Za){return new ib.a(this.plh(Za.ribbonCommandName),this.nlh(Za.inputMethodName),this.mlh(Za.frameModeName),this.tlh(Za.uiLocationName),Za.tabName)}Tvj(Za){return void 0!==Za&&null!==Za&&Za.toString()in this.FOd?this.FOd[Za.toString()]:(e.ULS.shipAssertTag(537167694,0,!1,`EnvironmentSerializationHelper.SerializeRibbonCommand expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${Za}`),
this.FOd["-911352779"])}plh(Za){return Za&&Za in this.icg?this.icg[Za]:(e.ULS.shipAssertTag(537167693,0,!1,`EnvironmentSerializationHelper.DeserializeRibbonCommand: expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${Za}`),-911352779)}Nvj(Za){return void 0!==Za&&null!==Za&&m.a[Za]in this.nka?this.nka[m.a[Za]]:(e.ULS.shipAssertTag(537167692,0,!1,`EnvironmentSerializationHelper.SerializeInputMethod: got unexpected value ${Za}`),this.nka.unknown)}nlh(Za){return Za&&
Za in this.hcg?this.hcg[Za]:(e.ULS.shipAssertTag(537167691,0,!1,`EnvironmentSerializationHelper.DeserializeInputMethod: got unexpected value ${Za}`),0)}Lvj(Za){return void 0!==Za&&null!==Za&&pc.a[Za]in this.A3a?this.A3a[pc.a[Za]]:(e.ULS.shipAssertTag(537167690,0,!1,`EnvironmentSerializationHelper.SerializeFrameMode: got unexpected value ${Za}`),this.A3a.edit)}mlh(Za){return Za&&Za in this.gcg?this.gcg[Za]:(e.ULS.shipAssertTag(537167689,0,!1,`EnvironmentSerializationHelper.DeserializeFrameMode: got unexpected value ${Za}`),
2)}Z2f(Za){return void 0!==Za&&null!==Za&&hb[Za]in this.MNb?this.MNb[hb[Za]]:(e.ULS.shipAssertTag(537167688,0,!1,`EnvironmentSerializationHelper.SerializeSourceItemType: got unexpected value ${Za}`),this.MNb.range)}rlh(Za){return Za&&Za in this.jcg?this.jcg[Za]:(e.ULS.shipAssertTag(537167687,0,!1,`EnvironmentSerializationHelper.DeserializeSourceItemType: got unexpected value ${Za}`),0)}Kvj(Za){return void 0!==Za&&null!==Za&&Za.toString()in this.nZc?this.nZc[Za.toString()]:(e.ULS.shipAssertTag(537167686,
0,!1,`EnvironmentSerializationHelper.SerializeArtSourceItemType: got unexpected value ${Za}`),this.nZc["99"])}llh(Za){return Za&&Za in this.fcg?this.fcg[Za]:(e.ULS.shipAssertTag(537167685,0,!1,`EnvironmentSerializationHelper.DeserializeArtSourceItemType: got unexpected value ${Za}`),99)}Xvj(Za){return void 0!==Za&&null!==Za&&r.a[Za]in this.Er?this.Er[r.a[Za]]:(e.ULS.shipAssertTag(36229129,0,!1,`EnvironmentSerializationHelper.SerializeUILocation: got unexpected value ${Za}`),this.Er.ribbon)}tlh(Za){return Za&&
Za in this.kcg?this.kcg[Za]:(e.ULS.shipAssertTag(537167684,0,!1,`EnvironmentSerializationHelper.DeserializeUILocation: got unexpected value ${Za}`),2)}}Object(c.a)(Vb,"EnvironmentSerializationHelper",null,[]);class wc{}wc.q0f="SameSession";wc.wJe="CrossSession";wc.Xpf="LegacyCrossSession";wc.external="External";Object(c.a)(wc,"PayloadOrigin",null,[]);const Lc=Za=>Za?Za.shadowWorkbookSizeExceedsLimit&&void 0!==Za.shadowWorkbookBlockedSize&&null!==Za.shadowWorkbookBlockedSize?Za.shadowWorkbookBlockedSize:
Za.shadowWorkbookBase64?Za.shadowWorkbookBase64.length:0:0,Fc=Za=>Za.shadowWorkbookSizeExceedsLimit?!0:Lc(Za)>z.a.Hmc;class fd{constructor(Za,Xb){this._name=Xb;this.$=Za;this.cm=C.a.instance;this.Fp=new Qb(Za,X.h(Za))}get name(){return this._name}get qZc(){return this.cm.Ta(5)}shouldWaitForCopyToComplete(){return!1}onDeferredPasteStarted(){}onDeferredPasteCompleted(){}beforePaste(){}sWj(Za){let Xb;Xb=null;try{const jb=Za.getItem(L.shadowWorkbook);if(!jb)return{returnValue:!1,p0:Xb};Xb=JSON.parse(jb);
return{returnValue:this.Zvi(Xb),p0:Xb}}catch(jb){return e.ULS.sendTraceTag(537167835,0,50,"BaseCopyPasteHandler.TryParseRangeShadowWorkbookPayload: Exception caught: "+jb),{returnValue:!1,p0:Xb}}}Zvi(Za){return!!Za&&(!!Za.shadowWorkbookBase64||Za.shadowWorkbookSizeExceedsLimit)&&void 0!==Za.rangeRowStart&&void 0!==Za.rangeRowEnd&&void 0!==Za.rangeColumnStart&&void 0!==Za.rangeColumnEnd}prc(Za){Za.wasLastCopyExternal=!0;if(n.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!h.a.WA&&516!==Za.commandParameters.commandType&&1028!==Za.commandParameters.commandType){var Xb=null;if(({p0:Xb}=this.sWj(Za.clipboardItems)).returnValue)return Za.isShadowWorkbookParsedSuccessfully=!0,this.f4i(Za,Xb)}if(516!==Za.commandParameters.commandType&&36!==Za.commandParameters.commandType){if(n.EwaSettings.sa(151)&&20!==Za.commandParameters.commandType&&(null===this.$.shortcutKeyManager||this.$.shortcutKeyManager.shc)&&(Xb=Za.clipboardItems.getItem(L.html),void 0!==Xb&&null!==Xb&&Xb&&
Xb.trim()!==this.qZc&&(Xb.startsWith("<")||h.a.Cf&&Xb.startsWith("\n<")))){const jb=Za.clipboardItems.getItem(L.csb);return this.d4i(Za,Xb,void 0===jb?null:jb)}return this.XLf(Za)}return Promise.reject(new V.a(6))}f4i(Za,Xb){e.ULS.sendTraceTag(537167834,0,50,"BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: Pasting shadow workbook from system clipboard");Za.pasteResult="SystemClipboardShadowWorkbookPaste";Za.payloadType=ca.shadowWorkbook;Za.payloadOrigin=wc.external;Za.shadowWorkbookPayloadSize=
Lc(Xb);Za.shadowWorkbookSizeExceedsLimit=Fc(Xb);let jb=null,Sb=null;const lc=Za.commandParameters.originalDestinations;n.EwaSettings.getBooleanFeatureGate(O.a.e6b,!1)?jb=G.r(lc,this.$):Sb=G.v(G.K(lc),this.$);Xb.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&(Za.originalSourceRangesCountExceedsLimit=Xb.originalSourceRangesCountExceedsLimit);if(Za.shadowWorkbookSizeExceedsLimit)return e.ULS.sendTraceTag(537167833,0,15,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: shadow workbook length(${Za.shadowWorkbookPayloadSize}) is over the limit(${z.a.Hmc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${Xb.shadowWorkbookSizeExceedsLimit}`),
Promise.reject(new V.a(1));e.ULS.sendTraceTag(537167832,0,50,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: trigger Paste request. PasteOperationId=${Za.commandParameters.id}`);return this.Fp.aMf(Za.commandParameters.ribbonCommandInfo,Sb,jb,Xb,[Za.commandParameters.stopwatch],Za)}XLf(Za){var Xb=Za.clipboardItems.getItem(L.plainText);if(void 0!==Xb&&null!==Xb&&Xb.trim()===this.qZc)return Promise.reject(new V.a(7));void 0!==Xb&&null!==Xb&&(Za.plainTextPayloadSize=Xb.length);Za.isPlainTextPaste=
!0;Za.pasteResult="SystemClipboardPaste";Za.payloadOrigin=U(Za)?wc.Xpf:wc.external;Za.payloadType=ca.plainText;e.ULS.sendTraceTag(537167831,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: trigger ProcessPasteText request. pasteContext.Id=${Za.id}, PasteOperationId=${Za.commandParameters.id}`);Xb=this.Fp.r9i(G.K(Za.commandParameters.originalDestinations),Xb,Za.commandParameters.ribbonCommandInfo,[Za.commandParameters.stopwatch],Za);e.ULS.sendTraceTag(537167830,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: returned from ProcessPasteText. pasteContext.Id=${Za.id}`);
return Xb}d4i(Za,Xb,jb){Za.htmlPayloadSize=Xb.length;Za.isHtmlPaste=!0;Za.pasteResult="SystemClipboardHtmlPaste";Za.payloadType=ca.html;Za.payloadOrigin=U(Za)?wc.Xpf:wc.external;e.ULS.sendTraceTag(42071711,0,50,`BaseRangeCopyPasteHandler.PasteByHtml: trigger ProcessPasteHtml request. PasteOperationId=${Za.commandParameters.id}`);return this.Fp.q9i(G.K(Za.commandParameters.originalDestinations),Xb,jb,Za.commandParameters.id,Za.commandParameters.ribbonCommandInfo,[Za.commandParameters.stopwatch],Za)}UIe(Za){const Xb=
{};Za&&(Xb.shadowWorkbookBase64=Za.ShadowWorkbookBase64,Xb.shadowWorkbookSizeExceedsLimit=Za.ShadowWorkbookSizeExceedsLimit,Xb.originalSourceRangesCountExceedsLimit=Za.OriginalSourceRangesCountExceedsLimit,Xb.originalSourceRangesCount=Za.OriginalSourceRangesCount,Xb.shadowWorkbookBlockedSize=Za.ShadowWorkbookBlockedSize);return Xb}Xlg(Za,Xb){const jb=N(Za),Sb=32===(Za.commandParameters.commandType&32),lc=1024===(Za.commandParameters.commandType&1024);let oc=!1,Qc=null,Kb=null,hc=!1;if(!jb){oc=-1985798686===
Za.commandParameters.ribbonCommandInfo.command;var Cc=Za.copyContextSnapshot;if(Xb)hc=!Cc.sourceItem.isFromCurrentSession(this.$);else if(Cc=this.Fp.Exb(Cc))Qc=Cc.ranges,Kb=Cc.sheetName,hc=!Za.isSameSession}return this.Fp.USg(Kb,Qc,this.$.na.sheetName,Za.commandParameters.originalDestinations,Za.commandParameters.expandDestinations,hc,Sb,lc,oc,Xb,jb)}}Object(c.a)(fd,"BaseCopyPasteHandler",null,[480,481,482]);class Ta{constructor(Za){this.clipboardItems=this.key=null;this.r$=Za}Gva(Za){return this.key&&
this.key.isEqual(Za)?this.createClipboardItems(this.clipboardItems):null}setValue(Za,Xb){this.key=Za;this.clipboardItems=this.createClipboardItems(Xb)}createClipboardItems(Za){const Xb=this.r$.create();var jb=Za.getItem(L.plainText);jb&&Xb.setItem(L.plainText,jb);(jb=Za.getItem(L.shadowWorkbook))&&Xb.setItem(L.shadowWorkbook,jb);(Za=Za.getItem(L.html))&&Xb.setItem(L.html,Za);return Xb}}Object(c.a)(Ta,"CopyCache",null,[]);var Fb=a(66);class ic extends fd{constructor(Za,Xb,jb,Sb,lc=null){super(Za,Sb);
this.hah=Xb;this.r$=jb;this.P4c=lc||new Ta(this.r$);this.gridView=X.h(Za);this.ha=this.gridView.ha;this.clipboardRangeFactory=Za.da.Aa(169)}getSourceItem(){const Za=n.EwaSettings.isChangeGateEnabled("OfficeVSO:6713439_FixCloneRangeArray")?G.d(this.gridView.ha.qa.selectedRanges):v.a.clone(this.gridView.ha.qa.selectedRanges);return new D(this.$,Za,this.$.ea.na.sheetName,this.$.ea.se,this.$.ya.UserSessionId)}beforeSerialize(Za){Za.isSelectionAllowed=!1;Za.isAsyncCopy=!1;Za.isFromCache=!1;Za.encounteredDeploymentErrors=
!1;Za.plainTextPayloadSize=0;Za.shadowWorkbookPayloadSize=0;Za.htmlPayloadSize=0;Za.clientSideCopyTime=0;const Xb=new ba.a(this.$.va),jb=Za.sourceItem;Za.isSelectionAllowed=v.a.all(jb.ranges,Sb=>this.isSelectionAllowed(Xb,Sb));Za.isSelectionAllowed&&this.Fp.rcf(jb.ranges,Za.commandParameters.commandType)}QMa(Za){return this.gridView.Ca.v4()&&X.j(this.gridView,Za)}D4i(Za,Xb,jb,Sb){let lc=!1,oc=1===Xb.commandParameters.commandType,Qc=Sb[0].Ny;1===jb.ranges.length&&1===Sb.length?n.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests1")&&
oc&&1!==Qc&&Qc!==jb.ranges[0].Ny?Za.cseStatus=17:lc=this.hah.R8c(Za,G.K(jb.ranges),jb.sheetName,G.K(Za.commandParameters.expandDestinations),this.$.ea.na.sheetName,oc):Za.cseStatus=5;lc&&X.h(this.$).vh.UR(Za.commandParameters.stopwatch.id,Fb.BasicTelemetryCalculator.zQ);return this.m4i(Za,jb,G.u(this.$.na.sheetName,null,Sb),Xb.commandParameters.commandType,lc)}isSelectionAllowed(Za,Xb){return Za.PBb(Xb,this.gridView)}m4i(Za,Xb,jb,Sb,lc){Xb=G.u(Xb.sheetName,null,Xb.ranges);Za.pasteResult="SameSessionPaste";
Za.payloadOrigin=wc.q0f;Za.payloadType=ca.uHg;e.ULS.sendTraceTag(537167829,0,50,`BaseRangeCopyPasteHandler.PasteSameSession: trigger PasteRange request. PasteOperationId=${Za.commandParameters.id}`);return this.Fp.pasteRange(Za.commandParameters.ribbonCommandInfo,Xb,jb,Sb,Za.commandParameters.commandType,[Za.commandParameters.stopwatch],Za,lc,null,null)}}Object(c.a)(ic,"BaseRangeCopyPasteHandler",fd,[]);var zb=a(35);class Bb{constructor(Za){this.dU=new zb.a(!0);this.$=Za}onDeferredPasteStarted(Za){this.dU.hb(Za.id)||
this.dU.add(Za.id,!0);if(0<this.dU.count){const Xb=Ea.GetServiceTaskFactory.Oa(this.$.da,5,4,0);ka.TaskExtensions.za(Xb,()=>{Xb.result.ih(28,null)},this.$.la,3)}}onDeferredPasteCompleted(Za){const Xb=0<this.dU.count;this.dU.hb(Za.id)&&this.dU.remove(Za.id);if(Xb&&!this.dU.count){const jb=Ea.GetServiceTaskFactory.Oa(this.$.da,5,4,0);ka.TaskExtensions.za(jb,()=>{jb.result.removeEntry(28)},this.$.la,3)}}}Object(c.a)(Bb,"DeferredPasteTracker",null,[]);var ec;(function(Za){Za[Za.none=0]="none";Za[Za.loadClipboardFromServerFailed=
1]="loadClipboardFromServerFailed";Za[Za.loadCopiedDataFromServerFailed=2]="loadCopiedDataFromServerFailed";Za[Za.asyncCopyCanceled=3]="asyncCopyCanceled";Za[Za.loadCopiedArtDataFromServerFailed=4]="loadCopiedArtDataFromServerFailed"})(ec||(ec={}));Object(c.b)("CopyErrorType",ec);var Qd=a(942),fc=a(1136);class cd extends Qd.a{constructor(Za,Xb=null){super(ec[Za]);this.copyErrorName=0;this.ewaErrors=null;this.copyErrorName=Za;this.ewaErrors=Xb;if(null===Xb||void 0===Xb?0:Xb.length)this.innerError=
new fc.a(Xb,null)}}Object(c.a)(cd,"CopyInnerError",Qd.a,[]);class jd extends ic{constructor(Za,Xb,jb,Sb=null){super(Za,Xb,jb,"AcrossSessionRangeCopyPasteHandler",Sb);this.dU=new Bb(Za)}serialize(Za){const Xb=Za.sourceItem,jb={};let Sb=this.P4c.Gva(Xb);if(Sb)jb.synchronousResult=Sb,Za.isFromCache=!0,Za.clientSideCopyTime=Za.commandParameters.stopwatch.Bc;else{let oc=null;var lc=G.F(Xb.ranges);if(!Ra.a.ljf()&&this.QMa(lc)){e.ULS.sendTraceTag(537167936,0,50,"AcrossSessionRangeCopyPasteHandler.Serialize: All data is loaded prepare the data in the client side.");
lc=this.clipboardRangeFactory.create(lc);try{oc=lc.toString(),Sb=this.r$.create(),Sb.setItem(L.plainText,oc),this.P4c.setValue(Xb,Sb),jb.synchronousResult=Sb,Za.clientSideCopyTime=Za.commandParameters.stopwatch.Bc}finally{lc&&lc.dispose()}}else Za.isAsyncCopy=!0,jb.synchronousResult=this.r$.create(),jb.synchronousResult.setItem(L.plainText,this.qZc);jb.asynchronousResult=this.Ffd(Za,Xb,oc)}Za.syncClipboardItemsKeys=ea(jb.synchronousResult);return jb}shouldWaitForCopyToComplete(Za){if(!Za||!Za.copyContextSnapshot)return e.ULS.sendTraceTag(537167907,
0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: pasteContext or pasteContext.CopyContextSnapshot is not define, return false."),!1;e.ULS.shipAssertTag(537167906,0,!!this.$.ya,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: this.EwaControl.BootstrapContext shouldn't be null");if(Za.copyContextSnapshot.sessionId===this.$.ya.UserSessionId)return e.ULS.sendTraceTag(537167905,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: Same session copy scenario, return false."),
!1;e.ULS.sendTraceTag(537167904,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted(Za){this.dU.onDeferredPasteStarted(Za)}onDeferredPasteCompleted(Za){this.dU.onDeferredPasteCompleted(Za)}deserialize(Za){Za.isClipboardDataContainShadowWorkbook=!(void 0===Za.clipboardItems.getItem(L.shadowWorkbook)||null===Za.clipboardItems.getItem(L.shadowWorkbook));if(X.h(this.$).ha.Oe&326)return N(Za)&&(Za.wasLastCopyExternal=!0),Promise.reject(new V.a(17));
var Xb=this.Xlg(Za,!1);if(0!==Xb)return Promise.reject(new V.a(N(Za)?18:Za.isSameSession?19:20,void 0,void 0,void 0,Xb));var jb=Za.copyContextSnapshot,Sb=this.Fp.Exb(jb);if(N(Za))return this.prc(Za);Xb=Za.commandParameters.originalDestinations;if(Sb&&Za.isSameSession)return this.D4i(Za,jb,Sb,Xb);if(516!==Za.commandParameters.commandType){if(({p0:jb}=this.rWj(Za.clipboardItems)).returnValue){Za.isShadowWorkbookParsedSuccessfully=!0;let lc=Sb=null;n.EwaSettings.getBooleanFeatureGate(O.a.e6b,!1)?Sb=
G.r(Xb,this.$):lc=G.v(G.K(Xb),this.$);return this.b4i(Za,lc,Sb,jb)}if(Za.isClipboardInaccessible)return Promise.reject(new V.a(8));if(36!==Za.commandParameters.commandType)return this.XLf(Za)}return Promise.reject(new V.a(6))}beforePaste(Za){this.$.da.Aa(373).Gsj(Za);Za.indicationDisplayScheduled=!0}JVj(Za){let Xb;if(!(Za&&Za.SourceRanges&&Za.SourceRanges.Ranges&&Za.SourceRanges.Ranges.length&&(Za.OriginalSourceRangesCountExceedsLimit||Za.OriginalSourceMultiRange&&Za.OriginalSourceMultiRange.Ranges&&
Za.OriginalSourceMultiRange.Ranges.length)))return{returnValue:!1,p0:null};var jb=Za.SourceRanges.Ranges[0];if(!Za.ShadowWorkbookBase64&&!Za.ShadowWorkbookSizeExceedsLimit)return{returnValue:!1,p0:null};Xb=this.UIe(Za);Xb.rangeRowStart=jb.FirstRow;Xb.rangeRowEnd=jb.LastRow;Xb.rangeColumnStart=jb.FirstColumn;Xb.rangeColumnEnd=jb.LastColumn;Xb.sourceClientPath=Za.SourceClientPath;Xb.sourceSheetName=Za.SourceSheetName;Xb.sourceWorkbookName=Za.SourceWorkbookName;if(!Za.OriginalSourceRangesCountExceedsLimit)for(Za=
Za.OriginalSourceMultiRange.Ranges,Xb.originalSourceRanges=Array(Za.length),jb=0;jb<Za.length;++jb)Xb.originalSourceRanges[jb]=[Za[jb].FirstRow,Za[jb].FirstColumn,Za[jb].LastRow,Za[jb].LastColumn];return{returnValue:!0,p0:Xb}}rWj(Za){let Xb;Xb=null;Za=Za.getItem(L.shadowWorkbook);if(!Za)return{returnValue:!1,p0:Xb};Xb=JSON.parse(Za);return{returnValue:this.Yvi(Xb),p0:Xb}}Yvi(Za){return!!Za&&(!!Za.shadowWorkbookBase64||Za.shadowWorkbookSizeExceedsLimit)&&void 0!==Za.rangeRowStart&&void 0!==Za.rangeRowEnd&&
void 0!==Za.rangeColumnStart&&void 0!==Za.rangeColumnEnd}b4i(Za,Xb,jb,Sb){e.ULS.shipAssertTag(537167903,0,!!Sb,"AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadowWorkbookPayload shouldn't be null");A.AFrameworkApplication.fN("Microsoft.Office.Excel.Server.Flighting.IDenyListNewCopyPasteExperienceAcrossSessions");Za.pasteResult="CrossSessionPaste";Za.payloadOrigin=wc.wJe;Za.payloadType=ca.shadowWorkbook;Za.shadowWorkbookPayloadSize=Lc(Sb);Za.shadowWorkbookSizeExceedsLimit=Fc(Sb);Sb.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&
(Za.originalSourceRangesCountExceedsLimit=Sb.originalSourceRangesCountExceedsLimit);if(Za.shadowWorkbookSizeExceedsLimit)return e.ULS.sendTraceTag(34415003,0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadow workbook length(${Za.shadowWorkbookPayloadSize}) is over the limit(${z.a.Hmc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${Sb.shadowWorkbookSizeExceedsLimit}`),Promise.reject(new V.a(1));if(1028===Za.commandParameters.commandType&&Za.originalSourceRangesCountExceedsLimit)return e.ULS.sendTraceTag(572617859,
0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: Original source ranges count(${Sb.originalSourceRangesCount}) is over the limit(${z.a.JGi}). Reject the paste request. OriginalSourceRangesCountExceedsLimit: ${Sb.originalSourceRangesCountExceedsLimit}`),Promise.reject(new V.a(1));e.ULS.sendTraceTag(537167902,0,50,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: trigger Paste request. PasteOperationId=${Za.commandParameters.id}`);return this.Fp.aMf(Za.commandParameters.ribbonCommandInfo,
Xb,jb,Sb,[Za.commandParameters.stopwatch],Za)}Ffd(Za,Xb,jb){e.ULS.shipAssertTag(537167901,0,!!Za,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: copyContext shouldn't be null");const Sb=Za.commandParameters.stopwatch.Bc;return new Promise((lc,oc)=>{e.ULS.sendTraceTag(26035421,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data for copy Id: ${Za.id}`);const Qc=G.u(Xb.sheetName,null,Xb.ranges);this.Fp.copy(Qc,Za.commandParameters,
Kb=>{Za.requestTelemetryData=Kb.RequestTelemetryData;Za.serverRequestTimeInMs=Za.commandParameters.stopwatch.Bc-Sb;if(yb.a.Wf(Kb.Errors))if(yb.a.Uga(Kb.Errors))Za.encounteredDeploymentErrors=!0,Kb=yb.a.nc(Kb.Errors),e.ULS.sendTraceTag(537167898,0,15,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${Kb}. copy Id: ${Za.id}`);else{var hc=yb.a.nc(Kb.Errors);e.ULS.sendTraceTag(26035419,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${hc}. copy Id: ${Za.id}`);
oc(new cd(2,Kb.Errors))}else if(e.ULS.sendTraceTag(537167900,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeed for copy Id: ${Za.id}`),Za.markForCancellation)oc(new cd(3,Kb.Errors));else{hc=Kb.Result;var Cc=hc.PlainTextResult;void 0!==jb&&null!==jb&&(Cc=jb);void 0!==Cc&&null!==Cc&&(Za.plainTextPayloadSize=Cc.length);var Ka=this.r$.create();if(({p0:Ib}=this.JVj(hc)).returnValue){Za.shadowWorkbookPayloadSize=Lc(Ib);Za.shadowWorkbookSizeExceedsLimit=Fc(Ib);
Za.originalSourceRangesCountExceedsLimit=hc.OriginalSourceRangesCountExceedsLimit;var Ib=JSON.stringify(Ib);Ka.setItem(L.shadowWorkbook,Ib)}Ka.setItem(L.plainText,Cc);Ra.a.ljf()&&(Cc=hc.HtmlResult,Za.htmlSizeExceedsLimit=hc.HtmlSizeExceedsLimit,void 0!==Cc&&null!==Cc&&(Za.htmlPayloadSize=Cc.length),Ka.setItem(L.html,Cc));Za.copyTotalSizeExceedsLimit=hc.CopyTotalSizeExceedsLimit;Ka.setItem(L.csb,Za.commandParameters.id);this.P4c.setValue(Xb,Ka);Za.asyncClipboardItemsKeys=ea(Ka);lc(Ka);n.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",
!1)&&(hc=1===Za.commandParameters.commandType?8:7,(Ka=this.$.da.Aa(465))&&Ka.F0(hc,Kb))}},Kb=>{Za.serverRequestTimeInMs=Za.commandParameters.stopwatch.Bc-Sb;Kb=$a.a.Pe(Kb.data);const hc=yb.a.nc(Kb);e.ULS.sendTraceTag(537167897,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${hc}. copy Id: ${Za.id}`);oc(new cd(2,Kb))},[Za.commandParameters.stopwatch])})}}Object(c.a)(jd,"AcrossSessionRangeCopyPasteHandler",ic,[]);class nd{constructor(Za,Xb,
jb,Sb,lc,oc=null,Qc=null){this.floatingObjectId=Za;this.commandParameters=Xb;this.Kt=jb;this.Dih=Sb;this.taa=oc;this.hQb=Qc;this.Y$g=lc}}Object(c.a)(nd,"CopyArtRequest",null,[]);class vd{constructor(Za,Xb,jb,Sb,lc,oc,Qc,Kb,hc){this.promise=null;this.ribbonCommandInfo=Za;this.destination=Xb;this.sLe=jb;this.hQb=lc;this.p0=oc;this.item=Qc;this.pasteContext=Kb;this.aOa=jb||Xb.FirstRow+"_"+Xb.FirstColumn;this.Fjf=!0;this.bDe=hc}}Object(c.a)(vd,"PasteArtRequest",null,[]);class wd{constructor(Za,Xb){this.pKb=
new Ba.a;this.NZa=Za;this.$=Xb;this.T9i=jb=>Promise.resolve(jb);this.tGb=jb=>Promise.reject(jb)}E$h(Za){if(this.Jri(Za.aOa)){e.ULS.sendTraceTag(537167681,5,50,`PasteArtRequestManager.HandleRequest: Enqueued paste request as a result of rapid paste on same destination: ${Za.aOa}`);const Xb=this.pKb.ma(Za.aOa);this.pKb.ia(Za.aOa,Za);const jb=Xb.promise;Xb.Fjf=!1;return this.ish(Za,jb)}this.pKb.ia(Za.aOa,Za);return this.Ryi(Za)}Jri(Za){return this.pKb.hb(Za)}Ryi(Za){return new Promise((Xb,jb)=>{Za.promise=
this.NZa.WLf(Za).then(Sb=>{Xb(null);return this.Spc(Za,Sb)},Sb=>{jb(null);return this.tGb(Sb)})})}ish(Za,Xb){return new Promise((jb,Sb)=>{Za.promise=Xb.then(lc=>{this.L0j(Za,lc);return this.NZa.WLf(Za).then(oc=>{jb(null);return this.Spc(Za,oc)},oc=>{Sb(null);return this.tGb(oc)})},lc=>this.tGb(lc))})}Spc(Za,Xb){Za.Fjf&&(this.L4g(Za.aOa),this.XPd(Za,Xb));return this.T9i(Xb)}L4g(Za){this.pKb.remove(Za)}XPd(Za,Xb){const jb=this.z2h();Za.aOa===jb&&this.NZa.XPd(Za.destination,Xb,Za.item.type)}z2h(){var Za=
X.h(this.$).ha.Sa.activeFloatingObjectControlId;Za||(Za=G.v(X.h(this.$).ha.qa.activeCell,this.$),Za=Za.FirstRow+"_"+Za.FirstColumn);return Za}L0j(Za,Xb){Za.destination=null;Za.sLe=Xb}}Object(c.a)(wd,"PasteArtRequestManager",null,[]);var Td=a(206),jc=a(124),bd=a(106);class Hd extends fd{constructor(Za,Xb,jb,Sb,lc=null){super(Za,"ArtCopyPasteHandler");this.D5g="XLO";this.E5g="3";this.dU=new Bb(Za);this.r$=Xb;this.NZa=jb;this.ha=X.h(Za).ha;this.O4c=lc||new Ta(this.r$);this.c4i=new wd(jb,Za);this.opb=
Sb}getSourceItem(){e.ULS.shipAssertTag(537167896,0,!!this.ha.Sa.activeFloatingObjectControlId,"Expecting a floating object to be currently selected for copy");e.ULS.sendTraceTag(537167895,0,50,`ArtCopyPasteHandler.GetSourceItem: Creating ArtSourceItem with FloatingObjectId=[${this.ha.Sa.activeFloatingObjectControlId}]`);return new R(this.ha.Sa.activeFloatingObjectControlId,this.$.ea.na.sheetName,this.$.ea.se,this.$.ya.UserSessionId,this.ha.Sa.dc.floatingObject.type)}beforeSerialize(Za){Za&&Za.commandParameters?
(Za?(Za.isAsyncCopy=!1,Za.isSelectionAllowed=!1,Za.isFromCache=!1,Za.plainTextPayloadSize=0,Za.shadowWorkbookPayloadSize=0,Za.htmlPayloadSize=0,Za.htmlSizeExceedsLimit=!1,Za.clientSideCopyTime=0,Za.encounteredDeploymentErrors=!1,Za.shadowWorkbookSizeExceedsLimit=!1,Za.originalSourceRangesCountExceedsLimit=!1,Za.copyTotalSizeExceedsLimit=!1):e.ULS.sendTraceTag(537167826,0,10,"CommonCopyPasteUtils.InitializeCopyContext: copyContext is null."),Za.commandParameters.copyPasteTargetType=2):e.ULS.sendTraceTag(537167894,
0,10,"ArtCopyPasteHandler.BeforeSerialize: copyContext or copyContext.CommandParameters is null.")}serialize(Za){const Xb=Za.sourceItem,jb={};if(!Xb)return e.ULS.sendTraceTag(537167893,0,10,"ArtCopyPasteHandler.Serialize: artSourceItem should not be null"),jb;if(!this.Iui())return e.ULS.sendTraceTag(36824456,0,50,"ArtCopyPasteHandler.Serialize: Unsupported floating object type. This will clear the clipboard"),jb;e.ULS.sendTraceTag(537167892,0,50,`ArtCopyPasteHandler.Serialize: Serializing ArtSourceItem with FloatingObjectId=[${Xb.activeFloatingObjectControlId}]`);
this.aHd();let Sb=this.O4c.Gva(Xb);if(Sb)jb.synchronousResult=Sb,Za.isFromCache=!0,Za.isAsyncCopy=!1,Za.clientSideCopyTime=Za.commandParameters.stopwatch.Bc,1===Za.commandParameters.commandType&&this.$.Zc(2045211913,Za.commandParameters.ribbonCommandInfo.method,Za.commandParameters.ribbonCommandInfo.We,null);else{Za.isFromCache=!1;Za.isAsyncCopy=!0;Sb=this.r$.create();if(Za.commandParameters.uploadToClipService){const lc={};lc["data-clipservice-ccpid"]=Za.commandParameters.id;lc["data-pkey"]=Za.commandParameters.pKey;
lc["data-clipservice-type"]=Za.commandParameters.clipServiceDataType;lc["data-clipservice-count"]=Za.commandParameters.objectCount.toString();lc["data-clipservice-dc"]=Za.commandParameters.clipServiceDataCenter;lc["data-clipservice-client"]=this.D5g;lc["data-TimeStamp"]=(new Date).toUTCString();lc["data-clipservice-version"]=this.E5g;Sb.setItem(L.DPg,JSON.stringify(lc))}jb.synchronousResult=this.dJg(Sb);jb.asynchronousResult=this.Ffd(Za,Xb,Sb)}Za.syncClipboardItemsKeys=ea(jb.synchronousResult);return jb}dJg(Za){e.ULS.shipAssertTag(537167891,
0,!!this.ha.Sa.dc,"Expecting a floating object to be currently selected for copy");Za||(Za=this.r$.create());const Xb=this.ha.Sa.dc.Xvb();Xb&&Za.setItem(L.html,`<img src='${Xb}'>`);return Za}aHd(){const Za=this.ha.Sa.dc;this.opb.aHd(jc.a.qrb(Za.floatingObject),jc.a.G5g(Za.lu))}shouldWaitForCopyToComplete(){e.ULS.sendTraceTag(537167890,0,50,"ArtCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted(Za){this.dU.onDeferredPasteStarted(Za)}onDeferredPasteCompleted(Za){this.dU.onDeferredPasteCompleted(Za)}deserialize(Za){var Xb=
N(Za),jb=null;let Sb=null;var lc=!1;if(!Xb){jb=Za.copyContextSnapshot;Sb=jb.sourceItem;if(!Sb)return Promise.reject(new V.a(10));lc=Sb.isFromCurrentSession(this.$)}var oc=this.Xlg(Za,!0);if(0!==oc)return Promise.reject(new V.a(Xb?18:lc?19:20,void 0,void 0,void 0,oc));if(Xb)return this.prc(Za);if(!lc&&!Hd.jni(Sb))return Za=`User attempted to paste art of type [${Sb.type}] between sessions.`,e.ULS.sendTraceTag(537167889,0,50,Za),Promise.reject(new V.a(11,void 0,void 0,Za));if(jb.isAsyncSerializeFailed)return Promise.reject(new V.a(16,
void 0,void 0,"Last async serialize failed, therefore no current shadow workbook payload to paste"));let Qc;try{const Kb=Za.clipboardItems.getItem(L.shadowWorkbook);Qc=JSON.parse(Kb)}catch(Kb){return Za=copyPasteInfra.getStringifiedError(Kb),e.ULS.sendTraceTag(537167888,0,10,`ArtCopyPasteHandler.Deserialize: Failed to parse shadow workbook JSON with exception: ${Za}`),Promise.reject(new V.a(12,void 0,Kb))}Qc.floatingObjectId!==Sb.activeFloatingObjectControlId?e.ULS.sendTraceTag(537167887,0,10,`ArtCopyPasteHandler.Deserialize: FloatingObjectId mismatch! Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${Sb.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${Qc.floatingObjectId}]`):
e.ULS.sendTraceTag(537167886,0,50,`ArtCopyPasteHandler.Deserialize: Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${Sb.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${Qc.floatingObjectId}]`);if(!Qc||!Qc.shadowWorkbookBase64)return Promise.reject(new V.a(13,void 0,void 0,`shadowWorkbookPayload is null = ${!Qc}`));Za.isShadowWorkbookParsedSuccessfully=!0;Za.shadowWorkbookPayloadSize=Lc(Qc);Za.shadowWorkbookSizeExceedsLimit=Fc(Qc);Za.payloadOrigin=lc?wc.q0f:
wc.wJe;Za.payloadType=ca.Ipg;if(Fc(Qc))return Za=`Shadow workbook size [${Za.shadowWorkbookPayloadSize}] is over the limit [${z.a.Hmc}]. ShadowWorkbookSizeExceedsLimit: ${Qc.shadowWorkbookSizeExceedsLimit}`,e.ULS.sendTraceTag(36304156,0,15,`ArtCopyPasteHandler.Deserialize: ${Za}`),Promise.reject(new V.a(1,void 0,void 0,Za));jb=Xb=null;X.h(this.$).ha.Oe&326?jb=X.h(this.$).ha.Sa.activeFloatingObjectControlId:Xb=this.$.na&&this.$.na.activeCell?G.v(this.$.na.activeCell,this.$):G.v(G.K(Za.commandParameters.originalDestinations),
this.$);lc=null;if(this.opb.n8f(Sb))try{lc=this.opb.R8c()}catch(Kb){oc=copyPasteInfra.getStringifiedError(Kb),e.ULS.sendTraceTag(537167885,0,10,`ArtCopyPasteHandler.Deserialize: Exception encountered while performing client-side estimation. Exception: ${oc}`)}return this.c4i.E$h(new vd(Za.commandParameters.ribbonCommandInfo,Xb,jb,Za.commandParameters.commandType,[Za.commandParameters.stopwatch],Qc,Sb,Za,lc))}prc(Za){Za.wasLastCopyExternal=!0;if(Za.clipboardItems.getItem("image/png")){const Xb=Za.commandParameters.stopwatch.Bc;
Za.payloadType=ca.PVg;return oa.b(this.$.Zc(1403967063,Za.commandParameters.ribbonCommandInfo.method,Za.commandParameters.ribbonCommandInfo.We,{["dataUrl"]:Za.clipboardItems.getItem("image/png")})).then(jb=>{Za.serverRequestTimeInMs=Za.commandParameters.stopwatch.Bc-Xb;return jb?Promise.resolve(null):Promise.reject(new V.a(15))},()=>{Za.serverRequestTimeInMs=Za.commandParameters.stopwatch.Bc-Xb;return Promise.reject(new V.a(15))})}e.ULS.shipAssertTag(537167884,0,!1,"Should not paste external content that is not image via ArtCopyPasteHandler");
return super.prc(Za)}Iui(){const Za=X.h(this.$).ha;return Za.Sa.activeFloatingObjectControlId&&Za.Sa.dc&&Za.Sa.dc.floatingObject?Za.Sa.dc.floatingObject.qXd():!1}Ffd(Za,Xb,jb){return new Promise((Sb,lc)=>{const oc=Za.commandParameters.stopwatch.Bc;e.ULS.sendTraceTag(41562516,0,50,"ArtCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data...");this.NZa.$$g(new nd(Xb.activeFloatingObjectControlId,Za.commandParameters,Qc=>{Za.requestTelemetryData=Qc.RequestTelemetryData;
Za.serverRequestTimeInMs=Za.commandParameters.stopwatch.Bc-oc;if(yb.a.Wf(Qc.Errors))if(yb.a.Uga(Qc.Errors))Za.encounteredDeploymentErrors=!0,Qc=yb.a.nc(Qc.Errors),e.ULS.sendTraceTag(537167879,0,15,`ArtCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${Qc}`);else{var Kb=yb.a.nc(Qc.Errors);e.ULS.sendTraceTag(36229122,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Kb}`);lc(new cd(4,
Qc.Errors))}else if(e.ULS.sendTraceTag(537167883,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeeded for FloatingObjectId=[${Xb.activeFloatingObjectControlId}].`),Za.markForCancellation)lc(new cd(3,Qc.Errors));else{if(yb.a.oq(Qc.Errors)){var hc=yb.a.nc(Qc.Errors);e.ULS.sendTraceTag(537167882,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Server messages present. Errors: ${hc}`)}if(hc=Qc.Result){hc=this.UIe(hc);hc.floatingObjectId=Xb.activeFloatingObjectControlId;
Za.shadowWorkbookPayloadSize=Lc(hc);Za.shadowWorkbookSizeExceedsLimit=Fc(hc);try{Kb=JSON.stringify(hc)}catch(Cc){lc(new V.a(14,void 0,Cc,`Failed to stringify shadow workbook: copyContext.ShadowWorkbookPayloadSize: [${Za.shadowWorkbookPayloadSize}], shadowWorkbookPayload.FloatingObjectId: [${hc.floatingObjectId}]`));return}e.ULS.shipAssertTag(537167881,0,!!jb,"Expecting syncClipboardItems to be defined");jb.setItem(L.shadowWorkbook,Kb);1===Za.commandParameters.commandType&&(this.F7i(Xb.type,Xb.activeFloatingObjectControlId,
Qc.StateId),this.deleteFloatingObject(Xb.activeFloatingObjectControlId,Xb.type));this.O4c.setValue(Xb,jb);Za.asyncClipboardItemsKeys=ea(jb);Sb(jb)}else e.ULS.sendTraceTag(537167880,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Result form server returned null, copied item id: ${Xb.activeFloatingObjectControlId}`),Sb(this.O4c.Gva(Xb))}},Za.commandParameters.commandType,Xb.type,Qc=>{Za.serverRequestTimeInMs=Za.commandParameters.stopwatch.Bc-oc;Qc=$a.a.Pe(Qc.data);1===Za.commandParameters.commandType&&
this.NZa.rXj(Xb.type,Xb.activeFloatingObjectControlId);const Kb=yb.a.nc(Qc);e.ULS.sendTraceTag(537167878,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Kb}`);lc(new cd(4,Qc))},[Za.commandParameters.stopwatch]))})}deleteFloatingObject(Za,Xb){Za=Td.a.Xy(Xb,Za);if(Za=bd.a(this.$).lr(Za))bd.a(this.$).deleteFloatingObject(Za,14,!0),X.h(this.$).ha.Sa.wA=null}F7i(Za,Xb,jb){const Sb=this.$.da.Aa(277);if(Sb){let oc=null;Za=Td.a.Xy(Za,Xb);Za=bd.a(this.$).lr(Za);
if(null===Za||void 0===Za?0:Za.Ki)oc=Za.Ki.block;if(oc){var lc=Za.floatingObject.Fg();Sb.ZZb(()=>!oc.xi.hb(lc),jb,"CutArt")}}}static jni(Za){return 1===Za.type||5===Za.type}}Object(c.a)(Hd,"ArtCopyPasteHandler",fd,[]);var ge=a(59);class Mb extends lb{constructor(Za,Xb,jb,Sb){super(Za);this.isFromCurrentSession=!1;this.left=this.top=0;this.isFromCurrentSession=Xb;this.top=jb;this.left=Sb}}Object(c.a)(Mb,"MacroRecorderPasteArtPayload",lb,[]);class Kc{constructor(Za,Xb){this.$=Za;this.opb=Xb}afi(Za,
Xb,jb,Sb,lc,oc=null,Qc=null){const Kb=this.$.oa.xa.Wb();let hc=null;const Cc={CopyPasteTargetType:2};Cc.FloatingObjectId=Za;Cc.CopyOperationId=jb.id;jb.floatingObjectType=Xb;Cc.UploadToClipService=jb.uploadToClipService;Cc.PKey=jb.pKey;Cc.ClipServiceDataCenter=jb.clipServiceDataCenter;let Ka=0;2===lc?(lc=505,Ka=16,hc=(Ib,dc,yc)=>gb(this.$.oa.xa,Cc,ma.b(Ib,Sb),oc?ma.a(dc,oc):dc,yc,jb.ribbonCommandInfo,Kb,Qc)):(lc=179,hc=(Ib,dc,yc)=>{this.noh(Xb,Za);this.$.my();return cb(this.$.oa.xa,Cc,ma.b(Ib,Sb),
oc?ma.a(dc,oc):dc,yc,jb.ribbonCommandInfo,Kb,Qc)});this.$.userOperationManager.Jc(new za.a(lc,0,hc,Ka|64),jb.ribbonCommandInfo)}noh(Za,Xb){var jb=Td.a.Xy(Za,Xb);(jb=bd.a(this.$).lr(jb))?(X.h(this.$).ha.Sa.OG(jb),jb.isVisible=!1):e.ULS.sendTraceTag(537167876,0,50,`ArtCopyPasteUtils.DoCutClientEstimation: floatingObjectcontrol is null. FloatingObjectType : ${Za}, FloatingObjectId: ${Xb}`)}rXj(Za,Xb){Za=Td.a.Xy(Za,Xb);if(Za=bd.a(this.$).lr(Za))Za.isVisible=!0}$$g(Za){this.afi(Za.floatingObjectId,Za.Y$g,
Za.commandParameters,Za.Kt,Za.Dih,Za.taa,Za.hQb)}Cfi(Za,Xb,jb,Sb,lc,oc,Qc,Kb=null,hc=!0){return new Promise((Cc,Ka)=>{const Ib=oc.commandParameters.stopwatch.Bc;this.tQd(Za,lc,Xb,jb,dc=>{oc.requestTelemetryData=dc.RequestTelemetryData;oc.serverRequestTimeInMs=oc.commandParameters.stopwatch.Bc-Ib;if(yb.a.Uga(dc.Errors))oc&&(oc.encounteredDeploymentErrors=!0),dc=yb.a.nc(dc.Errors),e.ULS.sendTraceTag(537167875,0,15,`ArtCopyPasteUtils.PasteArt: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${dc}`);
else if(yb.a.Wf(dc.Errors)){var yc=yb.a.nc(dc.Errors);e.ULS.sendTraceTag(36459652,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${yc}`);Ka(new V.a(9,dc.Errors))}else dc.Result?(yc=dc.Result,e.ULS.sendTraceTag(537167874,0,50,"ArtCopyPasteUtils.PasteArt: PasteArt succeeded."),this.S7i(Qc,yc.FloatingObjectId,dc.StateId),Cc(Kc.Xmd(yc.FloatingObjectId))):(e.ULS.sendTraceTag(537167873,0,10,"ArtCopyPasteUtils.PasteArt: PasteArt failed, result returned from server is null."),Ka(new V.a(9,dc.Errors)))},
dc=>{oc.serverRequestTimeInMs=oc.commandParameters.stopwatch.Bc-Ib;dc=$a.a.Pe(dc.data);e.ULS.sendTraceTag(537167872,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${yb.a.nc(dc)}`);Ka(new V.a(9,dc))},Sb,Kb,hc)})}S7i(Za,Xb,jb){const Sb=this.$.da.Aa(277);if(Sb){const lc=Td.a.Xy(Za,Kc.Xmd(Xb));Sb.ZZb(()=>!!bd.a(this.$).lr(lc),jb,"PasteArt")}}s_d(Za,Xb){Xb&&this.opb.s_d(Za,Td.a.Xy(Za.type,Xb))}WLf(Za){return this.Cfi(Za.ribbonCommandInfo,Za.destination,Za.sLe,Za.hQb,Za.p0,Za.pasteContext,Za.item.type,
Za.bDe,Za.item.isFromCurrentSession(this.$)).then(Xb=>Xb,Xb=>{this.s_d(Za.item,Za.bDe);return Promise.reject(Xb)})}XPd(Za,Xb,jb){Za||(Za=G.v(X.h(this.$).ha.qa.activeCell,this.$));X.h(this.$).bjc(G.D(Za),1)?bd.a(this.$).nna(jb,Xb,!0):X.h(this.$).ha.Sa.oHa(Za,Xb,jb).continueWith(Sb=>{Sb.result?e.ULS.sendTraceTag(537167843,5,50,`ArtCopyPasteUtils.SelectPastedObject: Selection succeeded in async manner for object ID [${Xb}]`):e.ULS.sendTraceTag(537167842,5,10,`ArtCopyPasteUtils.SelectPastedObject: Selection failed in async manner for object ID [${Xb}]`)})}tQd(Za,
Xb,jb,Sb,lc,oc,Qc,Kb,hc=!0){const Cc=this.$.oa.xa.Wb(),Ka={};Ka.ShadowWorkbookBase64=Xb.shadowWorkbookBase64;Ka.FloatingObjectId=Sb;Ka.DestinationRanges=jb?G.s(jb):null;Ka.CopyPasteTargetType=2;Ka.ClientEstimationFloatingObjectId=Kb;jb=new za.a(503,0,(Ib,dc,yc)=>{Kb||this.$.my();return La(this.$.oa.xa,Ka,ma.b(Ib,lc),ma.a(dc,oc),yc,null,Cc,Qc)},void 0,()=>{if(hc){let Ib;Ib=ge.a.Wh(ge.a.Dc(Ka));Ib.FloatingObjectId=Xb.floatingObjectId;Ka.DestinationRanges||(Ib.DestinationRanges=G.p(this.$.va.na.sheetName,
"",0,0,0,0));return new Mb(Ib,hc,0,0)}return new Mb(Ka,hc,0,0)});jb.flags=65;this.$.userOperationManager.Jc(jb,Za)}static Xmd(Za){return`${Za.length+2}.{${Za.toUpperCase()}}`}}Object(c.a)(Kc,"ArtCopyPasteUtils",null,[464]);var Ob=a(198);class Mc{constructor(Za){this.M4c=this.cta=null;this.pab=15;this.$=Za}aHd(Za,Xb){this.cta=Za;this.M4c=Xb}R8c(){if(!this.cta||!this.M4c)return e.ULS.sendTraceTag(537167841,0,15,"ArtPasteClientEstimation.DoPasteClientEstimation: copiedFloatingObjectControl and/or copiedEffectsExtents is null, aborting client side estimation."),
"";const Za=jc.a.qrb(new Td.a(this.cta));Za.Id=Kc.Xmd(l.a.create().toString());Za.Version=-1;Za.Name="";Za.IsClientEstimation=!0;var Xb=this.Tgi(Za);if(!Xb)return null;const jb=new Td.a(Za);Xb.block.xi.add(jb);jb.tKb();const Sb=bd.a(this.$);Sb.v5b(jb,Xb);Xb=Sb.lr(Td.a.kWh(Za));!Xb||Xb.floatingObject.BMa||Xb.floatingObject.ZMa||Xb.RRa(this.M4c);Sb.nna(Za.Type,Za.Id,!0);return Za.Id}n8f(Za){return n.EwaSettings.sa(205)&&Za.isFromCurrentSession(this.$)&&!X.h(this.$).rtl&&!X.h(this.$).ib.gj}s_d(Za,Xb){this.n8f(Za)&&
(Za=bd.a(this.$).lr(Xb))&&(e.ULS.sendTraceTag(537167840,5,50,`ArtPasteClientEstimation.UndoPasteClientEstimation: undoing client-side estimation. Removing floating object with ID: [${Xb}] of type [${Za.floatingObject.type}]`),bd.a(this.$).deleteFloatingObject(Za,15,!0),Za.Ki&&Za.Xbb(Za.Ki,!1))}Tgi(Za){if(!Za)return e.ULS.sendTraceTag(537167839,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: Called with null FloatingObjectData."),null;if(X.h(this.$).ha.Sa.activeFloatingObjectControlId){var Xb=
X.h(this.$).ha.Sa.wA.floatingObject;Za.OriginDeltaX=Xb.offsetX+this.pab;Za.OriginDeltaY=Xb.offsetY+this.pab;Za.AbsoluteLeft+=this.pab;Za.AbsoluteTop+=this.pab;Za.AbsoluteRight+=this.pab;Za.AbsoluteBottom+=this.pab;Za.ZOrder=Xb.JB+1;return X.h(this.$).ha.Sa.wA.Ki}if(!this.$.na||!this.$.na.activeCell)return e.ULS.sendTraceTag(537167838,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: ActiveItem/ActiveCell is null - cannot perform estimation for grid paste."),null;var jb=this.$.na.activeCell;
Xb=X.h(this.$).R0(jb);if(!Xb)return e.ULS.sendTraceTag(537167837,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: gridViewBlock for range ${jb.toString()} is null.`),null;const Sb=mb.HelperMethods.pxb(Xb.domElement,Xb.aj.domElement);jb=Xb.gridView.xg(jb,2);if(!Sb||!jb)return e.ULS.sendTraceTag(537167836,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: blockPositionRelativeToGridOrigin is null: ${!Sb}. cellPositionRelativeToGridOrigin is null: ${!jb} .`),null;Za.OriginDeltaX=
jb.topLeft.x-Sb.x;Za.OriginDeltaY=jb.topLeft.y-Sb.y;Za.AbsoluteLeft=jb.topLeft.x;Za.AbsoluteTop=jb.topLeft.y;Za.AbsoluteRight=Za.AbsoluteLeft+Math.abs(this.cta.AbsoluteRight-this.cta.AbsoluteLeft);Za.AbsoluteBottom=Za.AbsoluteTop+Math.abs(this.cta.AbsoluteBottom-this.cta.AbsoluteTop);Za.ZOrder=this.cta.ZOrder+100;return new Ob.a(Xb.gridView.Ca.zl(Xb.hashCode),Xb.hashCode)}}Object(c.a)(Mc,"ArtPasteClientEstimation",null,[463]);class Dc{create(){const Za=window.clipboardPlatform;return Za?Za.createClipboardItems():
null}}Object(c.a)(Dc,"ClipboardItemsFactory",null,[462]);class $c{}$c.undefined="Undefined";Object(c.a)($c,"CCPTelemetryConsts",null,[]);class td{}td.cells="Cells";td.floatingObject="FloatingObject";td.unknown="Unknown";Object(c.a)(td,"ActiveSelection",null,[]);class Yd{}Yd.znh="DisplayNotInvoked";Yd.K8c="Displayed";Yd.a8i="PrerequisitesNotReady";Object(c.a)(Yd,"PasteIndicationDisplayStatus",null,[]);var ae=a(114);class je{constructor(Za){this.nHc=this.qRc=null;this.$=Za}get gJd(){if(!this.qRc){const Za=
this.$.da.Aa(254,!0);Za&&(this.qRc=new jd(this.$,Za,new Dc))}return this.qRc}get mZc(){if(!this.nHc&&this.$.da.Aa(254,!0)){const Za=new Mc(this.$);this.nHc=new Hd(this.$,new Dc,new Kc(this.$,Za),Za)}return this.nHc}getCopyFlowHandler(Za){const Xb=this.eSh(X.h(this.$).Oe);Za.commandParameters.copyPasteHandlerName=Xb.name;return Xb}getPasteFlowHandler(Za){var Xb=Za.copyContextSnapshot;Xb=Y(Za)?this.mZc:N(Za)?this.gJd:(null===Xb||void 0===Xb?0:Xb.sourceItem)&&Object.getType(Xb.sourceItem)===R?this.mZc:
this.gJd;Za.commandParameters.copyPasteHandlerName=Xb.name;return Xb}initializePasteContext(Za){if(Za&&(Za.isSameSession=!1,Za.isShadowWorkbookParsedSuccessfully=!1,Za.pasteResult=$c.undefined,Za.payloadOrigin=$c.undefined,Za.payloadType=$c.undefined,Za.encounteredDeploymentErrors=!1,Za.shadowWorkbookSizeExceedsLimit=!1,Za.originalSourceRangesCountExceedsLimit=!1,Za.activeSelectionType=this.LNh(),Za.indicationDisplayScheduled=!1,Za.pasteDestinationHasMergedCells=!1,Za.pasteIndicationDisplayStatus=
Yd.znh,Za.copyContextSnapshot)){var Xb=Za.copyContextSnapshot;const Qc=E(Xb.sourceItem);var jb=Xb.sourceItem;var Sb=!!jb&&Object.getType(jb)===R;jb=0;var lc=!1;Qc?(lc=Xb.sourceItem,Za.isSameSession=lc.isFromCurrentSession(this.$),jb=1,lc=this.Kri(lc,Za)):Sb&&(Za.isSameSession=Xb.sourceItem.isFromCurrentSession(this.$),jb=2);if(Za.copyContextSnapshot.commandParameters){const Kb=-1985798686===Xb.commandParameters.ribbonCommandInfo.command;Sb=Za.commandParameters;var oc=this.$;Xb?oc&&oc.ya?Xb=Xb.sessionId===
oc.ya.UserSessionId:(e.ULS.shipAssertTag(537166211,0,!1,"ewaControl shouldn't be null"),Xb=!1):(e.ULS.shipAssertTag(537166212,0,!1,"copyContext shouldn't be null"),Xb=!1);Sb.clearSystemClipboard=Xb&&Kb&&Qc&&!lc;Za.commandParameters.copyPasteTargetType=jb}}}getSessionId(){return this.$.ya.UserSessionId}Kri(Za,Xb){const jb=ae.b(Za.ranges,Sb=>Sb.Rg)&&ae.b(Xb.commandParameters.originalDestinations,Sb=>1!==Sb.top);return ae.b(Za.ranges,Sb=>Sb.isRow)&&ae.b(Xb.commandParameters.originalDestinations,Sb=>
1!==Sb.left)||jb}eSh(Za){switch(Za){case 1:return this.gJd;case 64:case 4:case 2:case 256:return this.mZc;default:throw Error.invalidOperation("Unsupported selection");}}LNh(){return X.h(this.$).ha.Oe&470?td.floatingObject:1===X.h(this.$).ha.Oe?td.cells:td.unknown}getDialogResponse(){}}Object(c.a)(je,"ExcelCopyPasteApplicationHost",null,[439]);var Ke=a(160);class Fd extends w.a{constructor(Za,Xb){super(Za);this.jt=null;this.Kii=(jb,Sb)=>{1===jb?(jb=Fd.Lmh[Sb[Fd.Kmh]],e.ULS.sendTraceTag(537167683,
0,50,`InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler OK button pressed with valid input, shift direction = ${0===jb?"Horizontal":"Vertical"}`),this.jt.setResult(jb)):(e.ULS.sendTraceTag(537167682,0,50,"InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler cancel button pressed"),this.jt.rs())};this.ig(Xb)}get kc(){return"InsertCopiedCutCellsDialog"}ig(Za){this.jt=new Ke.a;const Xb=C.a.instance.ga(16);Za=this.EM(Za);this.initializeAndShow(Xb,this.Kii,Za)}EM(Za){return{[Fd.it]:this.kc,
[Fd.mti]:Za}}}Fd.Kmh="direction";Fd.mti="isRtl";Fd.Lmh={["Vertical"]:1,["Horizontal"]:0};Object(c.a)(Fd,"InsertCopiedCutCellsDialog",w.a,[]);class fe{x5b(Za,Xb){return(new Fd(Za,Xb)).jt.task}}Object(c.a)(fe,"InsertCopiedCutCellsDialogFactory",null,[437]);var ne=a(89),ce=a(48),te=a(44);class we{constructor(Za){this.v6b="";this.W1=this.Vs=null;this.psc=!1;this.Sbf=(Xb=null,jb=null)=>{this.hide(Xb,jb)};this.gridView=X.h(Za);this.gridView.ha.cC(this.Sbf)}FNe(){this.psc||(e.ULS.sendTraceTag(537167680,
0,50,"PasteIndicationManager.DownloadPrerequisitesIfNeeded: Trying to get appChrome"),this.gridView.$.Sx(Za=>{Za.Gaa(0).then(()=>{this.psc=!0})}))}Gsj(Za){var Xb=Za.commandParameters.id;e.ULS.sendTraceTag(537167651,0,50,`PasteIndicationManager.ScheduleDisplay: pasteCommandId = ${Xb}, cancelCtx is null = ${!this.Vs}, PrerequisitesDownloaded = ${this.psc}`);this.FNe();this.v6b=Xb;Xb=!this.pxf();if(!this.Vs||Xb)this.kAe(),this.Vs=ce.a.instance.create(()=>{this.ynh(Za)},void 0===Za.timeoutToShowSpinnerInMs||
null===Za.timeoutToShowSpinnerInMs?100:Za.timeoutToShowSpinnerInMs,te.a.i4i);this.W1=Za.commandParameters.originalDestinations}ynh(Za){this.psc?(this.display(Za.commandParameters.originalDestinations),Za.pasteIndicationDisplayStatus=Yd.K8c):(e.ULS.sendTraceTag(537167650,0,50,"PasteIndicationManager.DisplayIfPossible: Prerequisites were not ready, skipping display"),this.hide(),Za.pasteIndicationDisplayStatus=Yd.a8i)}display(Za){e.ULS.sendTraceTag(537167649,0,50,"PasteIndicationManager.Display: started");
this.gridView.Cb.xB(Wb.a.FTa(Ja.d(this.gridView.$.na),Za),we.qrc,!0);this.gridView.Cb.Nq(we.qrc)}Old(Za){e.ULS.sendTraceTag(537167648,0,50,`PasteIndicationManager.HideForPasteId: pasteCommandId = ${Za}, currentPasteCommandId = ${this.v6b}`);Za&&W.a.equals(Za,this.v6b,!1)&&this.hide()}hide(Za=null){this.W1&&Za&&this.pxf()&&e.ULS.sendTraceTag(537167647,0,15,"PasteIndicationManager.Hide: Triggered by a SelectionChanged event while indication is (or will be) active but active range did not change");this.v6b=
"";this.kAe();this.W1=null;this.gridView.Cb.Nj(we.qrc);this.gridView.Cb.wk(null,we.qrc)}pxf(){return G.Q(this.gridView.ha.qa.selectedRanges,this.W1)}kAe(){this.Vs&&(ne.a.Ja(this.Vs),this.Vs=null)}dispose(){this.hide();this.gridView.ha.sB(this.Sbf)}}we.qrc=[30];Object(c.a)(we,"PasteIndicationManager",null,[419,2]);var Pe=a(999),qf=a(51),Ve=a(712);class Qe extends f.a{constructor(Za){super();this.$=Za;this.cm=C.a.instance;this.Db()}create(){const Za=qf.a.RQ([74,75],4,this.Xa,void 0,void 0,void 0,Qe.una),
Xb=Ea.GetServiceTaskFactory.create(this.$.da,18,this.$.la,this.Xa);ka.TaskExtensions.za(ka.TaskExtensions.Fd([Xb,Za],this.la),()=>{const jb=new Pe.a;let Sb=null;this.x8g(jb).then(lc=>{Sb=lc.fDe;const oc=copyPasteInfra.createCopyPasteInfra(Sb,new je(this.$),jb,this.$);e.ULS.shipAssertTag(537167762,0,!!this.$.ya,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext should not be null");e.ULS.shipAssertTag(537167761,0,!!this.$.ya&&!!this.$.ya.DocumentHostInfo,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext.DocumentHostInfo should not be null");
const Qc=Sb.getMetadataManager();var Kb=Object(Ve.a)(this.$.da,254,()=>new Fa(this.$,Qc,Xb.result,oc,new Qb(this.$,X.h(this.$)),new fe,this.$.ya.DocumentHostInfo.UserId,Sb.getInitializationError()));this.nb(Kb);if(lc.q0a){Kb=Fa.rbc();const hc=JSON.stringify(lc.q0a.dataClipboardCapabilities),Cc=lc.q0a.clipboardStrategiesToInitialize[0].clipboardStrategyType===lc.q0a.dataClipboardStrategyType,Ka=void 0===window.bsqmXLSPageLoadStartTime||null===window.bsqmXLSPageLoadStartTime?"-1":(Date.now()-window.bsqmXLSPageLoadStartTime.getTime()).toString();
e.ULS.sendTraceTag(41731933,0,50,`CopyPasteInfrastructureFactory.Create: Initialize CCP infra succeed. SliceName=${Kb}, StrategyType=${lc.q0a.dataClipboardStrategyType}, StrategyCapabilities=${hc}, IsBestStrategyTypeInitialized=${Cc}, InfraLoadTimeMS=${Ka}`)}else e.ULS.shipAssertTag(537167760,0,!1,"CopyPasteInfrastructureFactory.Create: initResult.ClipboardPlatformEnvironmentInitializationInfo should not be null")},lc=>{const oc=Fa.rbc();lc=lc?copyPasteInfra.getStringifiedError(lc):"null";e.ULS.shipAssertTag(38847436,
0,!1,`CopyPasteInfrastructureFactory.Create: error during call to clipboardPlatformEnvironment.Init(). Copy Paste operations will not be available in this session. SliceName: ${oc} error: ${lc}`)})},this.la,3)}dispose(){super.dispose()}x8g(Za){let Xb=null;var jb=window.clipboardPlatform;jb&&(Xb=jb.getClipboardPlatformEnvironment());if(!Xb)return e.ULS.shipAssertTag(537167759,0,!1,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: getClipboardPlatformEnvironment should have returned a valid object"),
Promise.reject(null);jb=this.$.ya;const Sb=[jb.OfficeOnlineChromeExtensionId,jb.ChromeClipboardAccessExtensionId],lc=this.cm.Ta(5);var oc=this.$.Xd.get(57);let Qc=!oc&&this.$.Xd.get(5);const Kb=this.$.ea.$b;Kb&&(Kb.inWebPart||Kb.inViewerFromWebPart||Kb.isDivSyndicated)&&(Qc=!1);oc=this.aRh(Qc,!oc);e.ULS.shipAssertTag(537167758,0,!!jb.DocumentHostInfo,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: bootstrapContext.DocumentHostInfo should not be null");return Xb.init(this.$,
Za,Sb,jb.SharedClipboardHostingApp,jb.SharedClipboardHostingApps,jb.SharedClipboardHostingEnvironments,jb.SharedClipboardOverrideOrigin,jb.SharedClipboardSchemaVersion,jb.SharedClipboardExpirationInMinutes,jb.ClipboardPromiseTimeoutInMinutes,lc,jb.MachineCluster,new Vb(this.$),oc,jb.DocumentHostInfo.UserId,jb.ClipboardTtlInMS,n.EwaSettings.sa(273),jb.UserSessionId,jb.BulsEndpointUrl).then(hc=>Object(b.a)(new ab,{fDe:Xb,q0a:hc}),hc=>Promise.reject(hc))}aRh(Za,Xb){const jb=[];Za&&Xb&&jb.push(this.dhh());
Xb&&(jb.push(this.A6c(7)),jb.push(this.A6c(0)));Za&&jb.push(this.aIe());jb.push({clipboardStrategyType:4});const Sb=jb?jb.map(lc=>JSON.stringify(lc)).join(","):"[]";e.ULS.sendTraceTag(39978242,0,50,`CopyPasteInfrastructureFactory.GetClipboardStrategiesInitList: create clipboard stratgy initialization list: isBrowserStorageAllowed=${Za}, isSystemClipboardAllowed=${Xb}, result = ${Sb}`);return jb}aIe(){const Za=this.$.ya,Xb={clipboardStrategyType:5};Xb.sessionId=Za.UserSessionId;Xb.useSharedClipboardIframe=
!0;Xb.sharedClipboardHostingApp=Za.SharedClipboardHostingApp;Xb.sharedClipboardHostingApps=Za.SharedClipboardHostingApps;Xb.sharedClipboardHostingEnvironments=Za.SharedClipboardHostingEnvironments;Xb.sharedClipboardOverrideOrigin=Za.SharedClipboardOverrideOrigin;Xb.sharedClipboardSchemaVersion=Za.SharedClipboardSchemaVersion;Xb.sharedClipboardExpirationInMinutes=Za.SharedClipboardExpirationInMinutes;Xb.wacCluster=Za.MachineCluster;return Xb}dhh(){const Za={clipboardStrategyType:6};Za.localStorageStrategyParameters=
this.aIe();Za.systemClipboardStrategyParameters=this.A6c(0);return Za}A6c(Za){const Xb={};Xb.clipboardStrategyType=Za;Xb.skipFilesIfPlainTextExists=!0;return Xb}static ka(Za){Za.da.Ha(373,new we(Za));Za.da.Ha(Qe.una,new Qe(Za))}}Qe.una=255;Object(c.a)(Qe,"CopyPasteInfrastructureFactory",f.a,[]);var Ze=a(9);a.d(F,"a",function(){return Re});const Re=()=>{Ze.a.Fa(Za=>{Qe.ka(Za)})}},1178:function(t,F,a){t=a(0);var c=a(15),b=a(697),e=a(552),f=a(85),d=a(84),h;(function(ea){ea[ea.applicationFeatureHelperHandler=
0]="applicationFeatureHelperHandler";ea[ea.cloudPolicySettings=1]="cloudPolicySettings";ea[ea.alternateAuthToken=2]="alternateAuthToken"})(h||(h={}));Object(t.b)("ApplicationFeatureHelperRequestType",h);class m{constructor(){this.message=null;this.F5a=0}}Object(t.a)(m,"HttpRequstToPromiseRejectData",null,[]);var l=a(99),v=a(79),r=a(242),A=a(30);class x{constructor(ea,sa){this.mb=ea;this.ph=sa}P5c(ea,sa,Ea,ba=null,ka=null,Ca=null,db=null,yb=null){const kb=h[Ea],mb=kb+"RequestFailure";l.Health.instance.recordKpiUsage(mb,
0,"jpittsdirects",null);return new Promise((W,Q)=>{c.ULS.sendTraceTag(50622688,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Initializing HttpRequest {0}.",kb);const va=null!=db?db:this.mb.vd("ApplicationFeatureHelperRequestQueueTimeout",15E3),na=null!=yb?yb:this.mb.vd("ApplicationFeatureHelperRequestSentTimeout",3E4);this.ph.Gga(ea,1,null,this.vWh(Ea,ba),Ca,!1,1,Ba=>{c.ULS.sendTraceTag(50622689,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: HttpRequest {0} Succeeded.",
kb);try{if(void 0===Ba||null===Ba||void 0===Ba.data||null===Ba.data||void 0===Ba.data.de||null===Ba.data.de){l.Health.instance.recordKpiFailure(mb,"Invalid RequestSucceededEventArgs",!1,!0,null);let oa=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data or args.Data.ResponseData is null or undefined request {0}",kb);Q(this.Hxb(oa,Ba))}else if(Ba.data.httpStatus!==r.a.EO){l.Health.instance.recordKpiFailure(mb,"HttpStatusCode_"+Ba.data.httpStatus.toString(),!1,!0,
null);let oa=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: ApplicationFeatureHelper Service token generation returned unexpected response code {0}, request {1}",Ba.data.httpStatus,kb);Q(this.Hxb(oa,Ba))}else{void 0!==ka&&null!==ka&&void 0!==Ba.data.responseHeaders&&null!==Ba.data.responseHeaders&&ka(Ba.data.responseHeaders);var Oa=sa(Ba.data.de);if(Oa)c.ULS.sendTraceTag(50622690,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Successfully parsed response for request {0}",
kb),W(Oa);else{l.Health.instance.recordKpiFailure(mb,"Parse Failure",!1,!0,null);let oa=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Failed to parse response for request {0}",kb);Q(this.Hxb(oa,Ba))}}}catch(oa){l.Health.instance.recordKpiFailure(mb,"Unexpected Failure",!1,!0,null),Oa=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Exception {0} for request {1}",oa,kb),Q(this.Hxb(Oa,Ba))}},Ba=>{if(Ba.data){l.Health.instance.recordKpiFailure(mb,"HttpStatusCode_"+
Ba.data.httpStatus.toString(),!1,!0,null);var Oa=A.a.Did(Ba.data.de||"No Data");Oa=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Request Failed: HttpStatus - {0}, ResponseData - {1} for Request - {2}",Ba.data.httpStatus,Oa,kb)}else l.Health.instance.recordKpiFailure(mb,"Invalid RequestFailedEventArgs",!1,!0,null),Oa=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data is null or undefined for request {0}",kb);Q(this.Hxb(Oa,Ba))},null,void 0,
void 0,va,na)})}Hxb(ea,sa){const Ea=new m;Ea.message=ea;Ea.F5a=sa&&sa.data?sa.data.httpStatus:-1;return Ea}vWh(ea,sa){const Ea={};Ea["x-UserDataSignature"]=this.mb.Wa("UserDataSignature");Ea["x-LicensingIsEnabled"]=this.mb.pa("LicensingIsEnabled").toString();Ea["x-CacheIsEnabled"]=this.mb.pa("LicensingRedisIsEnabled").toString();Ea["x-OcpsIsEnabled"]=this.mb.pa("OcpsIsEnabled").toString();Ea["x-LicensingAADIdIsEnabled"]=this.mb.pa("LicensingAadIdIsEnabled").toString();0===ea&&(Ea["x-LicenseCheckOnTenantEnabled"]=
"true",Ea["x-SupportUserConsentDependentFeatures"]="true",Ea["x-AFHUserConsentGroupValue"]="0",Ea["x-UseShellServiceForUserConsentGroup"]="true",Ea["x-SMBUserLicensingEnabled"]="true",Ea["x-AFHPIPLComplianceEnabled"]=v.a.Rx(window.location.href,"wd_afhpipl")||"false");if(sa)for(let ba of sa.keys)Ea[ba]=sa.ma(ba);return Ea}}Object(t.a)(x,"HttpRequestToPromiseUtility",null,[]);var n=a(4),u;(function(ea){ea[ea.loki=0]="loki";ea[ea.augloopACLP=1]="augloopACLP"})(u||(u={}));Object(t.b)("AlternateAuthSupportApp",
u);var z=a(555),w=a(39);class C{constructor(){this.Token=null;this.ExpirationTime=0}}Object(t.a)(C,"WacAlternateAuthToken",null,[]);class y{constructor(ea,sa){this.hTj=3E5;if(void 0===ea||null===ea||void 0===sa||null===sa)throw Error.argumentNull("appSettingsManager/clientRequestManager");this.mb=ea;this.zRb=new b.a(e.a.Ni());this.Ejb=new x(ea,sa);void 0!==z.OAuthManagerSettings.pxd&&null!==z.OAuthManagerSettings.pxd&&void 0!==z.OAuthManagerSettings.Zlc&&null!==z.OAuthManagerSettings.Zlc&&0<z.OAuthManagerSettings.Zlc&&
(ea=new C,ea.Token=z.OAuthManagerSettings.pxd,ea.ExpirationTime=z.OAuthManagerSettings.Zlc,this.zRb.ia("loki",ea))}yOh(){let ea=null;this.zRb.hb(u[0])&&(ea=this.zRb.ma(u[0]));return void 0===ea||null===ea||this.Atd(ea)?this.mFh():Promise.resolve(ea.Token)}Atd(ea){return ea.ExpirationTime-Date.now()<this.hTj}mFh(){const ea=new b.a(e.a.Ni());ea.ia("X-AlternateAuthApp",u[0]);return this.Ejb.P5c(this.eva("/afhs/AlternateAuthHelperHandler.ashx"),Object(f.a)(this,this.t3i,"parseAlternateAuthTokenResponse"),
2,ea).then(sa=>{c.ULS.sendTraceTag(545821456,3004,50,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Retrieved WacAlternateAuthToken for {0}",u[0]);this.zRb.ia(u[0],sa);return sa.Token},sa=>{sa=Object(d.a)(m,sa);c.ULS.sendTraceTag(545604827,3004,10,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Error: {0}, status code: {1}",sa.message,sa.F5a);return null})}t3i(ea){let sa=null;({ht:sa}=w.d(ea));c.ULS.sendTraceTag(545821457,3004,sa?50:10,"ParseAlternateAuthTokenResponse: fetched WacAlternateAuthToken from {0}",
ea);return sa}eva(ea){return String.format("{0}{1}?{2}",this.mb.Wa("WebServiceBase"),ea,n.AFrameworkApplication.ti)}}Object(t.a)(y,"AlternateAuthHelper",null,[214]);var B=a(459);class H{constructor(ea,sa,Ea){this.featureName=null;this.isEnabled=!1;this.tierName=0;this.featureName=ea;this.isEnabled=sa;this.tierName=Ea}}Object(t.a)(H,"FeatureStateChangeArgs",null,[]);var I=a(138),R=a(256),S=a(27),G=a(111),D=a(174),E;(function(ea){ea[ea.Enabled=0]="Enabled";ea[ea.Disabled=1]="Disabled"})(E||(E={}));
Object(t.b)("FeatureState",E);var M=a(83),L=a(25),N=a(193);class Y{constructor(ea,sa,Ea=null,ba=null,ka=null){this.uua=this.aXb=this.Zhe=this.yqa=this.bYb=null;this.Ejb=new x(ea,sa);this.mb=ea;this.Mzg=ea.vd("LicensingMaxRetryAttempts",0);this.HUb=ea.pa("IsO365ConsumerHost");this.uNc=ea.pa("IsO365CommercialHost");this.DUb=ea.pa("PremiumUpsellIsEnabled");this.COc=0;this.v6d=Ea;this.lme=ba;this.Ma=ka;this.xqa=ea.pa("LicensingIsEnabled");this.DEa=ea.pa("OcpsIsEnabled")&&this.uNc;this.NUc=ea.pa("ShowPrivacyDialog")&&
!!ba;this.IMc=ea.pa("IsAnonymousUser");this.Obd=new Promise(Ca=>{Ca(!1)});this.IBa=new Promise(Ca=>{Ca(!0)});this.tua=new b.a(e.a.Ni());this.QYb=!0;this.nde=this.WXh();this.Crd()&&!this.IMc?(void 0!==n.AFrameworkApplication.ra&&null!==n.AFrameworkApplication.ra&&(this.bYb=n.AFrameworkApplication.ra.ED,void 0!==this.bYb&&null!==this.bYb&&(this.yqa=this.bYb.zg("WebServiceCall","ApplicationFeatureHelperService"))),this.uua=this.ZZd()):this.uua=new Promise(Ca=>{Ca({})});this.uua.catch(Ca=>{Ca=Object(d.a)(m,
Ca);c.ULS.sendTraceTag(42513088,3004,10,"ApplicationFeatureHelper initialization failed, HttpStatus={0}",Ca?Ca.F5a.toString():"Unknown")});this.QYb&&(this.DUb=!1,this.isFeatureEnabled("FreemiumUpsell",!0).then(Ca=>{this.DUb=this.mb.pa("PremiumUpsellIsEnabled")&&Ca;return null}))}WXh(){const ea=this.mb.Ep("AllLicensedFeatures")?this.mb.hw("AllLicensedFeatures"):[],sa=new B.a;for(let Ea=0;Ea<ea.length;Ea++)sa.add(ea[Ea]);return sa}Crd(){return this.uNc||this.HUb}ZZd(ea=0,sa=!1){c.ULS.sendTraceTag(51185368,
3004,50,"ApplicationFeatureHelper_TryInitializeLicensing: forceRefresh = {0}",sa);const Ea=I.a.Pr();Ea&&(Ea.set("retryAttempt",ea.toString()),Ea.set("forceRefresh",sa.toString()),Ea.set("isO365ConsumerHost",this.HUb.toString()),Ea.set("isO365CommercialHost",this.uNc.toString()),Ea.set("isFreemiumUpsellSettingEnabled",this.DUb.toString()));l.Health.instance.recordKpiUsageForAlertableKpi("AFHSLicensingFailedRequest","waclicensing",Ea);l.Health.instance.recordKpiUsage("AFHSLicensingSuccessfulRequest",
1,"waclicensing",Ea);void 0!==this.yqa&&null!==this.yqa&&this.yqa.start();let ba=null;sa&&(ba=new b.a(e.a.Ni()),ba.ia("x-LicensingForceRefresh","true"));this.Zhe=new Date;return(this.xqa?this.Ejb.P5c(this.eva("/afhs/ApplicationFeatureHelperHandler.ashx"),Object(f.a)(this,this.w3i,"parseApplicationFeatureHelperResponse"),0,ba,Object(f.a)(this,this.T8i,"processApplicationFeatureHelperResponseHeaders"),["Date"]):Promise.resolve({})).then(ka=>{const Ca=Object.assign(new N.a,{durationMs:this.Ibg()});Ca.extendedProperties=
Ea;Ca.extendedProperties&&ka&&(Ca.extendedProperties.set("featureCount",G.a.count(ka).toString()),Ca.extendedProperties.set("licensingTestFeatureEnabled",("LicensingTestFeature"in ka).toString()),Ca.extendedProperties.set("msoPremiumBadgeEnabled",("MsoPremiumBadge"in ka).toString()),"FreemiumUpsell"in ka&&Ca.extendedProperties.set("isFreemiumUpsellEnabled",ka.FreemiumUpsell.toString()),this.aXb&&Ca.extendedProperties.set("fromCache",(this.aXb<this.Zhe).toString()));l.Health.instance.recordKpiSuccess("AFHSLicensingSuccessfulRequest",
Ca);return ka},ka=>{const Ca=Object.assign(new N.a,{durationMs:this.Ibg()}),db=Object(d.a)(m,ka);if(!db)return c.ULS.sendTraceTag(51491471,3004,10,"ApplicationFeatureHelper_TryInitializeLicensing: Invalid cast to HttpRequestToPromiseRejectData"),l.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","InvalidCastToHttpRequestToPromiseRejectData",!1,!0,Ca),new Promise((yb,kb)=>{kb(ka)});Ca.extendedProperties=Ea;Ca.extendedProperties&&Ca.extendedProperties.set("status",db.F5a.toString());l.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest",
"RequestFailed",!1,!0,Ca);return 408===db.F5a&&++ea<=this.Mzg?this.ZZd(ea):new Promise((yb,kb)=>{kb(db)})})}w3i(ea){(ea=w.b(ea))?(c.ULS.sendTraceTag(50436170,3004,50,"ParseApplicationFeatureHelperResponse: Successfully fetched features"),c.ULS.sendTraceTag(50938594,3004,50,"{0}",ea)):c.ULS.sendTraceTag(50436171,3004,10,"ParseApplicationFeatureHelperResponse: ApplicationFeatureHelper Service returned a null feature set");return ea.Features}eva(ea){var sa=String.format("{0}{1}",this.mb.Wa("WebServiceBase"),
ea);this.mb.Ep("ApplicationFeatureHelperHttpCachingEnabled")&&this.mb.pa("ApplicationFeatureHelperHttpCachingEnabled")&&(ea=Y.ycc(this.mb))&&0<ea.length&&(this.QYb&&(ea+="ucbf"),sa=new R.QueryStringBuilder(sa),sa.$i("afhskey",ea),sa=sa.toString());return sa}isFeatureEnabled(ea,sa){if(!this.DEa&&!this.NUc&&!this.xqa)return this.IBa;c.ULS.sendTraceTag(42513091,3004,50,"ApplicationFeatureHelper.IsFeatureEnabled: Call made to check if feature: {0} is enabled.",ea);if("ConnectedServices"===ea){var Ea=
this.DEa?this.v6d.zM("ControllerConnectedServicesEnabled"):this.IBa;const Ca=this.NUc?this.lme.getSettings().then(db=>2!==db.fu,()=>sa):this.IBa;return Ea.then(db=>db?Ca:this.Obd)}Ea=null;Ea=this.DEa?this.v6d.isFeatureEnabled(ea):this.IBa;let ba=null;ba=this.xqa?this.uoi(ea,sa):this.IBa;let ka=null;ka=this.NUc?this.lme.isFeatureEnabled(ea):this.IBa;return Ea.then(Ca=>Ca?ka.then(db=>db?ba:this.Obd):this.Obd).then(Ca=>{this.Frf(ea,Ca,!0);return Ca},()=>{this.Frf(ea,sa,!1);return sa})}Frf(ea,sa,Ea){c.ULS.sendTraceTag(526713106,
3004,50,"FeatureName={0}, IsEnabled={1}, IsSuccess={2}",ea,sa,Ea)}getFeatureTier(ea,sa){if(!this.xqa)return new Promise(Ea=>{Ea(2)});c.ULS.sendTraceTag(42804871,3004,50,"ApplicationFeatureHelper.GetFeatureTier: Call made to get Feature's Tier.",ea);return this.uua.then(Ea=>this.vdc(ea,Ea,sa),()=>sa)}isFreemiumUpsellEnabled(){const ea=this.DUb&&this.HUb&&!this.IMc;if(ea&&2!==this.COc||!ea&&1!==this.COc)c.ULS.sendTraceTag(509728161,3004,20,"ApplicationFeatureHelper_IsFreemiumUpsellEnabled: isO365ConsumerHost={0}, isAnonymousUser={1}, isFreemiumUpsellEnabled={2}",
this.HUb.toString(),this.IMc.toString(),ea.toString()),this.COc=ea?2:1;return ea}launchUpsellExperience(ea,sa=null){c.ULS.sendTraceTag(594564814,3004,50,String.format("ApplicationFeatureHelper_LaunchUpsellExperience: Launching upsell experience for experienceId: {0}",ea));var Ea=I.a.Pr();Ea&&(Ea.set("experienceId",ea),sa&&Ea.set("campaignId",sa));l.Health.instance.recordKpiUsage("AFHCLaunchUpsellSuccess",1,"waclicensing",Ea);if(Ea=M.a.instance.mg("Common.IInProductMessagingUIManager")){const ba=Object(f.a)(this,
this.I8h,"handleDimeTaskComplete");Ea.Kpf(ea,ba,sa)}else c.ULS.sendTraceTag(594367561,3004,15,"InProductMessaging was not initialized"),l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","InProductMessagingNotInitialized",!1,!0,null),this.Ma.Wd(L.a.Kac,2,{["experience"]:ea})}Mza(ea,sa){if(!this.xqa)return null;if(!ea||!sa)return c.ULS.sendTraceTag(594564813,3004,10,"ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: Invalid input."),null;const Ea=D.a.create().toString();this.tua.hb(ea)||
this.tua.ia(ea,new b.a(e.a.Ni()));this.tua.ma(ea).add(Ea,sa);c.ULS.sendTraceTag(594564812,3004,50,String.format("ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: registered callback {0} for feature {1}",Ea,ea));return Ea}iLd(ea,sa){this.xqa&&(ea&&this.tua.hb(ea)?sa&&D.a.isValid(sa)?this.tua.ma(ea).hb(sa)?(c.ULS.sendTraceTag(594564808,3004,50,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: Removing callback {0} for feature {1}",sa,ea)),this.tua.ma(ea).remove(sa)):
c.ULS.sendTraceTag(594564809,3004,15,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: callbackId {0} not registered for feature {1} ",sa,ea)):c.ULS.sendTraceTag(594564810,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid callbackId {0} for feature {1}",sa,ea)):c.ULS.sendTraceTag(594564811,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid or non registered featureName {0}",ea)))}vdc(ea,sa,Ea){return this.QYb?
ea in sa?sa[ea].LicenseTier:Ea:ea in sa?this.T3i(sa[ea],Ea):Ea}T3i(ea,sa){switch(ea.toLowerCase()){case "unknown":return 0;case "basic":return 1;case "premium":return 2;default:return sa}}I8h(){c.ULS.sendTraceTag(594367560,3004,50,"ApplicationFeatureHelper_HandleDimeTaskComplete");this.uua.then(ea=>{this.rTf(ea)}).catch(()=>{this.rTf({})})}rTf(ea){c.ULS.sendTraceTag(594051087,3004,50,"ApplicationFeatureHelper_RefreshLicensingAndNotifyUpdatedFeatures");const sa=this.ZZd(0,!0);sa.then(Ea=>{this.uua=
sa;G.a.count(Ea)>G.a.count(ea)?l.Health.instance.recordKpiSuccess("AFHCLaunchUpsellSuccess",null):l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","FeatureCountNotIncreased",!1,!0,null);for(let ba of this.tua.keys)if(ba in Ea){const ka=this.vdc(ba,Ea,0);ba in ea?this.vdc(ba,ea,0)!==ka&&this.iBd(ba,!0,ka):this.iBd(ba,!0,ka)}else ba in ea&&this.iBd(ba,!1,this.vdc(ba,ea,0))}).catch(Ea=>{l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","LicensingRefreshFailed",!1,!0,null);c.ULS.sendTraceTag(594051086,
3004,10,JSON.stringify(Ea))})}iBd(ea,sa,Ea){c.ULS.sendTraceTag(594051085,3004,50,"ApplicationFeatureHelper_NotifyFeatureStateChanged: Notify feature state changed callbacks for feature {0}, {1}, {2}",ea,sa,Ea);sa=new H(ea,sa,Ea);Ea=this.tua.ma(ea);for(let ba of Ea)try{ba.value(sa)}catch(ka){c.ULS.sendTraceTag(594051084,3004,10,String.format("ApplicationFeatureHelper_NotifyFeatureStateChanged: Exception when calling registered callback: feature: {0} callbackId: {1}, exception {2}",ea,ba.key,ka.message))}}Pd(ea,
sa){if(this.xqa){const Ea=this.nde.contains(ea);let ba=!0,ka="",Ca=!1;return this.uua.then(db=>{ea in db?(db=db[ea],ka=E[db.FeatureState],ba=1!==db.FeatureState):ba=!Ea;this.Orf(ea,Ea,ka,Ca,sa,ba);return ba},()=>{Ca=!0;Ea&&(ba=sa);this.Orf(ea,Ea,ka,Ca,sa,ba);return ba})}return this.IBa}Orf(ea,sa,Ea,ba,ka,Ca){c.ULS.sendTraceTag(557389507,3004,50,"featureName : {0}, isLicenseControlledFeature={1}, encounteredError = {2}, featureData={3}, fallbackValue={4}, isAllowed={5}",ea,sa,ba,Ea,ka,Ca)}uoi(ea,sa){if(this.QYb)return this.Pd(ea,
sa);if(this.xqa){if(this.nde.contains(ea))return this.uua.then(Ea=>ea in Ea,()=>sa);c.ULS.sendTraceTag(590385821,3004,50,"ApplicationFeatureHelper_IsFeatureAllowedByUserLicense: Feature '{0}' requested while not in the licensed features set.",ea)}return this.IBa}T8i(ea){try{ea&&"Date"in ea&&(this.aXb=new Date(ea.Date),c.ULS.sendTraceTag(578863817,3004,50,"ProcessApplicationFeatureHelperResponseHeaders Date {0}",this.aXb.toString()))}catch(sa){c.ULS.sendTraceTag(578863818,3004,10,"ProcessApplicationFeatureHelperResponseHeaders Exception {0}",
sa)}}Ibg(){if(void 0!==this.yqa&&null!==this.yqa){const ea=this.yqa.Bc;this.yqa.stop();return ea}return null}static ycc(ea){try{if(S.a.uPj){const sa=ea.Wa("UserDataSignature").split(".");if(1<sa.length){const Ea=window.self.atob(sa[1]),ba=JSON.parse(Ea).LocalStorageKey;if(void 0!==ba&&null!==ba&&0<ba.length)return ba}}}catch(sa){c.ULS.sendTraceTag(578863816,3004,10,"GetLocalStorageCacheKey exception {0}",sa.toString())}return null}}Object(t.a)(Y,"ApplicationFeatureHelper",null,[215]);var U=a(191);
class P{constructor(ea,sa){this.PolicySettings=null;this.ExpirationTime=0;this.PolicySettings=ea.PolicySettings;ea=new Date;ea.setMinutes(ea.getMinutes()+sa);this.ExpirationTime=ea.getTime()}}Object(t.a)(P,"CloudPolicySettingsCacheData",null,[]);var aa=a(798),X=a(378),Z=a(231);class da{static P$f(){return n.AFrameworkApplication.fa.pa("SideCarIsEnabled")?da.Lwc&&da.Ypd?new Promise(ea=>{ea(!0)}):new Promise((ea,sa)=>{da.Lwc=Z.a.create(n.AFrameworkApplication.fa.Wa("SideCarUrl"));X.a.uia(da.Lwc);da.Lwc.t9((Ea,
ba)=>{(da.Ypd=ba.succeeded)?ea(ba.succeeded):sa(ba.succeeded)})}):new Promise(ea=>{ea(!1)})}}da.Ypd=!1;da.Lwc=null;Object(t.a)(da,"SideCarLoader",null,[]);class qa{constructor(){this.ControllerConnectedServicesFeatureNames=this.PolicySettings=null}}Object(t.a)(qa,"CloudPolicySettingsData",null,[]);class O{constructor(ea,sa){this.pIc=0;this.a4b=null;this.Ejb=new x(ea,sa);this.mb=ea;sa=ea.Wa("HostAuthType");this.DEa=ea.pa("OcpsIsEnabled")&&ea.pa("IsO365CommercialHost")&&!(void 0===sa||null===sa)&&"aad"===
sa.toLowerCase();this.wfe=w.b(ea.Wa("OcpsDefaultSettings")||"{}");this.wkb=this.ycc();sa=this.mb.Ep("ServicesControlsMicrosoftControllerServicesList")?this.mb.hw("ServicesControlsMicrosoftControllerServicesList")||[]:[];this.ASb=new B.a;for(let Ea=0;Ea<sa.length;Ea++)this.ASb.add(sa[Ea]);this.DEa&&!ea.pa("IsAnonymousUser")&&ea.pa("SideCarIsEnabled")?this.a4b=this.iWj():this.a4b=this.Aoa(this.DEa,this.eva("/afhs/CloudPolicySettings.ashx"),Object(f.a)(this,this.x3i,"parseCloudPolicySettingsResponse"));
this.a4b.then(()=>null).catch(Ea=>{Ea=Object(d.a)(m,Ea);c.ULS.sendTraceTag(50622685,3004,10,"CloudPolicySettingsHelper initialization failed, HttpStatus={0}",Ea?Ea.F5a.toString():"Unknown")})}zM(ea,sa=!0){if(!this.DEa){const Ca=this;return new Promise(db=>{db(Ca.oxb(ea))})}let Ea=this,ba=this;const ka=this.a4b.then(Ca=>{try{let db=null;Ca.PolicySettings&&"unknown"in Ca.PolicySettings&&(db=Ca.PolicySettings.unknown);if(db){if(ea in db&&void 0!==db[ea]&&null!==db[ea])return new Promise(kb=>{kb("0"!==
db[ea])});const yb=ea.toLowerCase();if(yb in db&&void 0!==db[yb]&&null!==db[yb])return new Promise(kb=>{kb("0"!==db[yb])});c.ULS.sendTraceTag(51512667,3004,50,"Policy"+ea+" not found, using default");return new Promise(kb=>{kb(Ea.oxb(ea))})}return new Promise(yb=>{yb(Ea.oxb(ea))})}catch(db){return c.ULS.sendTraceTag(50622686,3004,10,"Failed to get "+ea+" policy value. Error Message: {0}",db.message),Ea.handleError(db.toString(),sa,Ea.oxb(ea))}},Ca=>ba.handleError(Ca,sa,ba.oxb(ea)));ka.then(Ca=>{c.ULS.sendTraceTag(50651667,
3004,50,"CloudPolicySettingsHelper.GetBooleanPolicySetting: policy: {0}, value: {1}",ea,Ca);return null});return ka}isFeatureEnabled(ea,sa=!0){if(this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseApplicationFeatureHelperAPIForFeedbackAndSurvey",!1))return this.woi(ea,sa);let Ea=new Promise(ka=>{ka(!0)}),ba="";this.ASb.contains(ea)&&(ba="ControllerConnectedServicesEnabled",Ea=this.zM(ba,sa));Ea.then(ka=>{c.ULS.sendTraceTag(50651668,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabled: Feature: {0}, enabled or not: {1}, by policy: {2}",
ea,ka,ba);return null});return Ea}woi(ea,sa=!0){let Ea=new Promise(ka=>{ka(!0)}),ba="";"mso_sendASmile"===ea?ba="Enabled":"Survey"===ea||"FloodgateSurvey"===ea?ba="SurveyEnabled":this.ASb.contains(ea)&&(ba="ControllerConnectedServicesEnabled");""!==ba&&(Ea=this.zM(ba,sa));Ea.then(ka=>{c.ULS.sendTraceTag(558187080,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabledV2: Feature: {0}, enabled or not: {1}, by policy: {2}",ea,ka,ba);return null});return Ea}handleError(ea,sa,Ea){return sa?new Promise(ba=>
{ba(Ea)}):new Promise((ba,ka)=>{ka(ea)})}Aoa(ea,sa,Ea){if(!ea)return Promise.resolve(new qa);let ba=!1,ka=null;l.Health.instance.recordKpiUsage("GetCloudPolicySettings",1,"jpittsdirects",null);let Ca=this.k5c("GetCloudPolicySettings");return(new Promise((db,yb)=>{if(void 0!==this.wkb&&null!==this.wkb&&0<this.wkb.length){const kb=this.SVj();if(void 0!==kb&&null!==kb){ba=!0;db(kb);return}}this.Ejb.P5c(sa,Ea,1,null,Object(f.a)(this,this.Y8i,"processCloudPolicySettingsResponseHeaders"),["CheckIn-Interval"],
this.mb.vd("CloudPolicySettingsRequestQueueTimeout",15E3),this.mb.vd("CloudPolicySettingsRequestSentTimeout",3E4)).then(kb=>{c.ULS.sendTraceTag(51662933,3004,50,"Retrieved CloudPolicySettingsData from OCPS");this.IWj(kb);db(kb);return kb},kb=>{yb(kb);return null})})).then(db=>{({stopwatch:Ca,returnValue:ka}=this.KAc(Ca));var yb=I.a.Pr();yb&&yb.set("FromCache",ba.toString());yb=Object.assign(new N.a,{durationMs:ka,extendedProperties:yb});l.Health.instance.recordKpiSuccess("GetCloudPolicySettings",
yb);return db})}iWj(){return da.P$f().then(()=>{c.ULS.sendTraceTag(593282845,3004,50,"CloudPolicySettingsHelper - Retrieving CloudPolicySettingsData Promise from Sidecar");return sidecar.cloudPolicy.GetCloudPolicySettingsData()})}eva(ea){return String.format("{0}{1}",this.mb.Wa("WebServiceBase"),ea)}x3i(ea){let sa=null;({ht:sa}=w.d(ea));ea=!!sa;c.ULS.sendTraceTag(50622687,3004,ea?50:10,"ParseCloudPolicySettingsResponse: Success={0}",ea);return sa}Y8i(ea){try{if(void 0!==ea&&null!==ea&&"CheckIn-Interval"in
ea){const sa=parseInt(ea["CheckIn-Interval"]);void 0!==sa&&null!==sa&&0<sa&&(this.pIc=sa)}}catch(sa){c.ULS.sendTraceTag(51662934,3004,10,"ProcessCloudPolicySettingsResponseHeaders Exception {0}",sa)}}oxb(ea){return ea in this.wfe?"0"!==this.wfe[ea]:!0}SVj(){try{const ea=aa.a.instance.getItem(this.wkb);if(void 0===ea||null===ea)return c.ULS.sendTraceTag(51662936,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null"),null;c.ULS.sendTraceTag(51662937,3004,50,"TryGetCloudPolicySettingsDataFromCache retrieved data {0} from LocalStorage",
ea);const sa=JSON.parse(ea);if(void 0===sa||null===sa)return c.ULS.sendTraceTag(51662938,3004,15,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null after parsing"),null;if(void 0===sa.ExpirationTime||null===sa.ExpirationTime)return c.ULS.sendTraceTag(51662939,3004,15,"TryGetCloudPolicySettingsDataFromCache ExpirationTime from LocalStorage is null after parsing"),null;if((new Date(sa.ExpirationTime)).getTime()<Date.now())return c.ULS.sendTraceTag(51662940,3004,50,"TryGetCloudPolicySettingsDataFromCache Cache is expired"),
null;const Ea=new qa;Ea.PolicySettings=sa.PolicySettings;Ea.ControllerConnectedServicesFeatureNames=new U.a;this.mb.Ep("ServicesControlsMicrosoftControllerServicesList")&&this.mb.hw("ServicesControlsMicrosoftControllerServicesList");for(let ba of this.ASb)Ea.ControllerConnectedServicesFeatureNames.add(ba);c.ULS.sendTraceTag(51662941,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage retrieved");return Ea}catch(ea){return c.ULS.sendTraceTag(51662942,3004,10,"TryGetCloudPolicySettingsDataFromCache exception {0}",
ea.toString()),null}}IWj(ea){try{if(void 0===ea||null===ea||void 0===ea.PolicySettings||null===ea.PolicySettings)c.ULS.sendTraceTag(51662944,3004,15,"TrySetCloudPolicySettingsDataIntoCache data/PolicySettings is null");else if(0>=this.pIc)c.ULS.sendTraceTag(51662945,3004,15,"TrySetCloudPolicySettingsDataIntoCache _checkInInterval is Invalid");else{const sa=new P(ea,this.pIc),Ea=JSON.stringify(sa);c.ULS.sendTraceTag(51662946,3004,50,"TrySetCloudPolicySettingsDataIntoCache data to cache {0}",Ea);aa.a.instance.setItem(this.wkb,
Ea);c.ULS.sendTraceTag(51662947,3004,50,"TrySetCloudPolicySettingsDataIntoCache set data to cache")}}catch(sa){c.ULS.sendTraceTag(51662976,3004,10,"TrySetCloudPolicySettingsDataIntoCache exception {0}",sa.toString())}}ycc(){const ea=Y.ycc(this.mb);return ea&&0<ea.length?"OCPS"+ea:null}k5c(ea){const sa=M.a.instance.mg("Microsoft.Office.Telemetry.Usage.IStopwatchBuilder");return void 0!==sa&&null!==sa?sa.Gc("WebServiceCall",ea):null}KAc(ea){if(void 0!==ea&&null!==ea){const sa=ea.Bc;ea.stop();return{returnValue:sa,
stopwatch:null}}return{returnValue:null,stopwatch:ea}}}Object(t.a)(O,"CloudPolicySettingsHelper",null,[212]);class ca{constructor(){this.zNe=this.qlg=this.fu=0;this.ANe=this.rlg=this.THa="";this.zTc=this.Fea=2}clone(){const ea=new ca;ea.fu=this.fu;ea.qlg=this.qlg;ea.zNe=this.zNe;ea.THa=this.THa;ea.rlg=this.rlg;ea.ANe=this.ANe;ea.Fea=this.Fea;ea.zTc=this.src;return ea}get src(){return this.zTc}serialize(ea=null){const sa={};if(!ea||ea.contains(ca.DOa))sa[ca.DOa]=this.fu;if(!ea||ea.contains(ca.sFb))sa[ca.sFb]=
this.THa;if(!ea||ea.contains(ca.tFb))sa[ca.tFb]=this.Fea;return JSON.stringify(sa)}static create(ea,sa=null){const Ea=new ca;Ea.zTc=ea;void 0!==sa&&null!==sa&&(ca.DOa in sa&&(Ea.fu=sa[ca.DOa]),ca.sFb in sa&&(Ea.THa=sa[ca.sFb]),ca.tFb in sa&&(Ea.Fea=sa[ca.tFb]));return Ea}static deserialize(ea,sa){try{const Ea=JSON.parse(ea);if(void 0!==Ea&&null!==Ea)return ca.create(sa,Ea);c.ULS.sendTraceTag(50860946,306,10,"UserPrivacySettings Deserialize: Unable to convert {0} to dict",ea);throw Error.argument("settingsData");
}catch(Ea){throw c.ULS.sendTraceTag(50860947,306,10,"UserPrivacySettings Deserialize Exception = {0}",Ea.toString()),Ea;}}}ca.DOa="CCS";ca.sFb="CCSTime";ca.tFb="OfficePrivacyRoamedNoticeShown";Object(t.a)(ca,"UserPrivacySettings",null,[]);var wa=a(134);class ia{constructor(ea,sa){if(void 0===ea||null===ea||void 0===sa||null===sa)throw Error.argumentNull("appSettingsManager/clientRequestManager");this.mb=ea;this.ph=sa;this.RSc=this.ke=null}eva(ea){var sa=String.format("{0}RoamingServiceHandler.ashx?action=",
this.mb.appSettings.RoamingServiceHandlerWebServiceBase||"");sa=new Sys.StringBuilder(sa);sa.append(ea);sa.append("&");sa.append(n.AFrameworkApplication.ti);return sa.toString()}executeRequest(ea,sa,Ea,ba=null){return this.ph.Xnb(ea,sa,ba,null,Ea,"33",!1,null,6E4)}saveSettings(ea){return new Promise((sa,Ea)=>{try{if(void 0===this.ke||null===this.ke||void 0===ea||null===ea)c.ULS.sendTraceTag(51258443,3004,15,"SaveUserPrivacySettings: Can't determine setting changes to save"),Ea("Can't determine setting changes to save");
else{var ba=this.ke.fu!==ea.fu;if(2===this.ke.src&&ba)this.asj(ea),sa(!0);else{var ka=this.Uvj(ea);if(void 0===ka||null===ka||!ka.length)c.ULS.sendTraceTag(50917389,3004,15,"SaveUserPrivacySettings: returning since nothing changed"),Ea("No changes to save");else if(1===this.ke.src)sa(this.chg(ka));else if(0===this.ke.src){c.ULS.sendTraceTag(51258444,3004,50,"UserPrivacySettingsHelper: SaveSettings to Roaming {0}",ka);const Ca=this.executeRequest(this.eva("saveUserPrivacySettings"),2,"SaveUserPrivacySettingsRequest",
ka);Ca.continueWith(()=>{if(Ca.kh||Ca.Hf)c.ULS.sendTraceTag(50860929,3004,10,"SaveUserPrivacySettings: Roaming Request Cancelled/Failed"),sa(!1);else{var db=Ca.result;void 0!==db.Cg&&null!==db.Cg&&void 0!==db.Cg.data&&null!==db.Cg.data&&db.Cg.data.httpStatus===r.a.EO?(c.ULS.sendTraceTag(51258445,3004,50,"SaveUserPrivacySettings: Roaming Request Succeeded"),sa(!0)):(c.ULS.sendTraceTag(51258446,3004,10,"SaveUserPrivacySettings: Roaming Request Failed"),sa(!1))}})}}}}catch(Ca){c.ULS.sendTraceTag(50860930,
3004,10,"SaveUserPrivacySettings: Exception = {0}",Ca.toString()),sa(!1)}})}Uvj(ea){if(void 0===this.ke||null===this.ke||void 0===ea||null===ea)throw Error.invalidOperation("User Privacy settings have not been initialized");const sa=new U.a;0===ea.src?(this.ke.fu!==ea.fu&&(sa.add(ca.DOa),sa.add(ca.sFb)),this.ke.Fea!==ea.Fea&&sa.add(ca.tFb)):1===ea.src&&this.ke.fu!==ea.fu&&sa.add(ca.DOa);return sa.count?ea.serialize(sa):(c.ULS.sendTraceTag(50860931,3004,50,"SaveUserPrivacySettings: returning since nothing changed"),
null)}getSettings(){if(!this.RSc){const ea=this;this.RSc=new Promise(sa=>{try{ea.ke?sa(ea.ke.clone()):ea.aWj().then(Ea=>{ea.ke=Ea;sa(ea.ke.clone());return null},()=>{ea.ZVj().then(Ea=>{ea.ke=Ea;sa(ea.ke.clone());return null},()=>{ea.$Vj().then(Ea=>{ea.ke=Ea;sa(ea.ke.clone());return null},()=>{c.ULS.sendTraceTag(50967430,3004,10,"UserPrivacySettings TryGetSettingsFromQueryParams returned an error)");ea.ke=new ca;sa(ea.ke.clone());return null});return null});return null})}catch(Ea){c.ULS.sendTraceTag(50860932,
3004,10,"UserPrivacySettings GetSettings: Exception = {0}",Ea.toString()),ea.ke=new ca,sa(ea.ke.clone())}})}return this.RSc}aWj(){return new Promise((ea,sa)=>{try{const ba=-1!==window.location.href.indexOf("&wd_pn=2");if(this.mb.pa("PrivacyDialogShouldCheckRoaming")||ba){var Ea=this.executeRequest(this.eva("getUserPrivacySettings"),1,"GetUserPrivacySettingsRequest");Ea.continueWith(()=>{try{if(Ea.kh||Ea.Hf)c.ULS.sendTraceTag(50860934,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Request failure");
else{const ka=Ea.result;if(ka&&ka.Cg&&ka.Cg.data)if(ka.Cg.data.httpStatus!==r.a.EO)c.ULS.sendTraceTag(50860936,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Received error response {0}",ka.Cg.data.httpStatus);else{if(ka.Cg.data.de){ea(ia.parse(ka.Cg.data.de,0));c.ULS.sendTraceTag(51258447,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Success, Settings {0}",ka.Cg.data.de);return}c.ULS.sendTraceTag(50860937,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: ResponseData is null")}else c.ULS.sendTraceTag(50860935,
3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Data is null");sa("UserPrivacySettings TryGetSettingsFromRoaming Request Faillure")}}catch(ka){c.ULS.sendTraceTag(50860938,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming Exception handling request {0}",ka.toString()),sa("UserPrivacySettings TryGetSettingsFromRoaming Request Exception")}})}else c.ULS.sendTraceTag(50860933,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Roaming should not be used"),sa("Roaming should not be used")}catch(ba){c.ULS.sendTraceTag(50860939,
3004,10,"TryGetSettingsFromRoaming Exception = {0}",ba.toString()),sa("UserPrivacySettings TryGetSettingsFromRoaming Exception")}})}ZVj(){return new Promise((ea,sa)=>{try{const Ea=wa.a.get("WacUPToggleState");let ba=null;void 0!==Ea&&null!==Ea&&0<Ea.length&&(ba=decodeURIComponent(Ea));if(void 0!==ba&&null!==ba&&0<ba.length){const ka=ia.parse(ba,1);c.ULS.sendTraceTag(51258448,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings retrieved from cookie {0}",ka.toString());ea(ka)}else{const ka=ca.create(1),
Ca=new U.a;Ca.add(ca.DOa);const db=ka.serialize(Ca);this.chg(db)?(c.ULS.sendTraceTag(51258449,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings initialized and retrieved from cookie {0}",db),ea(ka)):(c.ULS.sendTraceTag(51258450,3004,15,"TryGetSettingsFromCookie: Failure initializing cookie with settings {0}",db),sa("UserPrivacySettings TryGetSettingsFromCookie Failure in TrySaveSettingsToCookie"))}}catch(Ea){c.ULS.sendTraceTag(50860941,3004,10,"TryGetSettingsFromCookie from Cookie Exception = {0}",
Ea.toString()),sa("UserPrivacySettings TryGetSettingsFromCookie Eception")}})}$Vj(){return new Promise(ea=>{try{var sa=-1!==window.location.href.indexOf("&wdccsoff=1");let Ea=ca.create(2);sa?(Ea.fu=2,n.AFrameworkApplication.eMe(),c.ULS.sendTraceTag(51258451,3004,50,"TryGetSettingsFromQueryParams: Retrieved from query param {0}",Ea.toString())):(Ea.fu=1,c.ULS.sendTraceTag(51258452,3004,50,"TryGetSettingsFromQueryParams: Initialized with query param as data source for {0}",Ea.toString()));ea(Ea)}catch(Ea){c.ULS.sendTraceTag(50967431,
3004,50,"TryGetSettingsFromCookie from Query Params Exception = {0}",Ea.toString()),sa=ca.create(2),sa.fu=1,ea(sa)}})}asj(ea){c.ULS.sendTraceTag(51258453,3004,50,"UserPrivacySettingsHelper: SaveSettingsToQueryParam");2===ea.fu?n.AFrameworkApplication.eMe():n.AFrameworkApplication.Grh();c.ULS.sendTraceTag(51258454,3004,50,"SaveSettingsToQueryParam saved settings = {0}",ea)}chg(ea){try{c.ULS.sendTraceTag(51258455,3004,50,"UserPrivacySettingsHelper: TrySaveSettingsToCookie Saving settings {0}",ea);const sa=
this.mb.Wa("PrivacyCookieDomain")||"";if(!sa||!sa.length)throw Error.invalidOperation("PrivacyCookieDomain is null or empty");c.ULS.sendTraceTag(51258456,3004,50,"SaveUserPrivacySettings to Cookie {0}",ea);return wa.a.xSd("WacUPToggleState",ea,wa.a.h_,"/",sa)}catch(sa){return c.ULS.sendTraceTag(50860942,3004,50,"SaveUserPrivacySettings to Cookie Exception = {0}",sa.toString()),!1}}isFeatureEnabled(ea){return this.getSettings().then(sa=>{const Ea=this.mb.Ep("ServicesControlsMicrosoftControllerServicesList")?
this.mb.hw("ServicesControlsMicrosoftControllerServicesList"):[],ba=new B.a;for(let ka=0;ka<Ea.length;ka++)ba.add(Ea[ka]);return ba.contains(ea)?2!==sa.fu:!0},()=>{c.ULS.sendTraceTag(50860945,3004,10,"Failed to get privacy setting for feature {0}",ea);return!0})}static parse(ea,sa){try{return c.ULS.sendTraceTag(50860943,3004,50,"Parsing user privacy settings {0} from {1}",ea,sa),ca.deserialize(ea,sa)}catch(Ea){throw c.ULS.sendTraceTag(50860944,3004,10,"GetUserPrivacySettings Exception = {0}",Ea.toString()),
Ea;}}}Object(t.a)(ia,"UserPrivacySettingsHelper",null,[213]);var Ha=a(252);class Sa{constructor(){this.$a=null}get name(){return"Common.App.ApplicationFeatureHelper.ApplicationFeatureHelperPackage"}Ah(ea){this.$a=ea;this.$a.register(212,"Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper").qc().yc(()=>new O(n.AFrameworkApplication.fa,n.AFrameworkApplication.Bd));this.$a.register(213,"Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper").qc().yc(()=>new ia(n.AFrameworkApplication.fa,
n.AFrameworkApplication.Bd));this.$a.register(214,"Common.App.ApplicationFeatureHelper.IAlternateAuthHelper").qc().yc(()=>new y(n.AFrameworkApplication.fa,n.AFrameworkApplication.Bd));this.$a.register(215,"Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").qc().yc(()=>new Y(n.AFrameworkApplication.fa,n.AFrameworkApplication.Bd,this.$a.resolve("Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper"),this.$a.resolve("Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper"),
n.AFrameworkApplication.rb))}init(){n.AFrameworkApplication.fa.ru(()=>{const ea=this.$a.resolve("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");n.AFrameworkApplication.fa.pa("LicensingIsEnabled")&&(ea.isFeatureEnabled("LicensingTestFeature",!1).then(sa=>{c.ULS.sendTraceTag(42513092,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned IsFeatureEnabled as {0}. IsAnonymousUser : {1}.",sa,n.AFrameworkApplication.fa.Wa("IsAnonymousUser"));return null}),ea.getFeatureTier("LicensingTestFeature",
0).then(sa=>{c.ULS.sendTraceTag(42804872,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned GetFeatureTier as {0}. IsAnonymousUser : {1}.",sa,n.AFrameworkApplication.fa.Wa("IsAnonymousUser"));return null}));this.$a.resolve("Common.App.ApplicationFeatureHelper.IAlternateAuthHelper");this.SQj()})}dispose(){}SQj(){try{n.AFrameworkApplication.fa.pa("SideCarIsEnabled")&&da.P$f().then(ea=>{c.ULS.sendTraceTag(594057429,3004,50,"Sidecar Loader attempted to load Sidecar.  SideCarIsAvailable:{0}",
ea);return ea})}catch(ea){}}static main(){Ha.a.instance.gi(new Sa)}}Object(t.a)(Sa,"ApplicationFeatureHelperPackage",null,[4,5]);a.d(F,"a",function(){return Da});const Da=()=>{Type.registerNamespace("Common");Type.registerNamespace("Common.App.ApplicationFeatureHelper");Sa.main()}},1181:function(t,F,a){var c=a(9);t=a(0);var b=a(226),e=a(15),f=a(1387),d=a(641),h=a(548),m=a(27),l=a(89),v=a(30),r=a(160),A=a(237),x=a(8),n=a(59),u=a(157),z=a(347),w=a(48),C=a(44),y=a(29),B=a(1),H=a(22),I=a(13),R=a(106),
S=a(84),G=a(85),D=a(150),E=a(4),M=a(14),L=a(97),N=a(46),Y=a(1096);class U extends D.a{constructor(Yb,pb=!0){super(!1,!1,U.Iu);this.oXa=null;this.q9d=!1;this.$m=[];this.Gj=null;this.KYb=Yb;this.rDg=pb;this.Yw=this.Xke=!1;this.pga=null;this.yKc=!1;this.og=this.pmh;this.pe="InsertFileDialog";this.tc(1,this.gZb);U.Iu?(this.oXa={["id"]:this.pe,["bodyControls"]:{["uploadButtonProps"]:{["label"]:CommonUIStrings.l_DialogChooseFile,["onExecute"]:Object(G.a)(this,this.y0i,"onUploadButtonClick")}},["uploadStatusLabel"]:CommonUIStrings.l_DialogNoFileChosen,
["onFrameReady"]:Object(G.a)(this,this.iSi,"onFrameReady")},this.initializeAndShow(this.titleText,Object(G.a)(this,this.jgc,"insertDialogHandler"),this.oXa),this.bTb=!0):(this.showDialog(this.titleText,Object(G.a)(this,this.jgc,"insertDialogHandler")),pb&&this.y6f(),(Yb=this.FJ(1))&&this.$m.push(Yb),(Yb=this.FJ(0))&&this.$m.push(Yb),this.Ojg(),this.bTb=!1)}get p2j(){return this.KYb}validate(){this.Gj.HE||e.ULS.sendTraceTag(25798091,322,10,"UploadFrame.FileInputElement is null");return this.Gj.HE.value?
!0:(U.Kz(CommonUIStrings.l_FileUploadNoFileSpecified),!1)}iSi(Yb){this.rDg&&(this.Gj=this.x6f(Yb,this.KYb))}y0i(){this.Gj&&this.Gj.HE&&(this.q9d||(this.Gj.Qfj(Object(G.a)(this,this.VCd,"onFileChosen")),this.q9d=!0),this.Gj.fXe())}VCd(Yb){this.oXa.uploadStatusLabel=Yb;this.aUa(this.titleText,Object(G.a)(this,this.jgc,"insertDialogHandler"),this.oXa)}jgc(Yb){1===Yb&&this.isEnabled()?U.Iu&&this.Gj.HE&&!this.Gj.HE.value?(this.oXa.uploadStatusLabel=CommonUIStrings.l_FileUploadNoFileSpecified,this.aUa(this.titleText,
Object(G.a)(this,this.jgc,"insertDialogHandler"),this.oXa)):(this.Wyb(),this.KYb.finalizeUpload(this.Gj,Object(G.a)(this,this.dispose,"dispose"))):0===Yb&&this.hide()}y6f(){this.yKc=!1;this.Gj=this.x6f(document.getElementById("uploadFrameContainer"),this.KYb);E.AFrameworkApplication.fa.pa("InsertPictureDialogFocusLoopFixIsEnabled")&&(this.pga=Object(G.a)(this,this.IEd,"onUploadFrameLoad"),N.a.addHandler(this.Gj.iFrame,"load",this.pga));this.Gj.HE||e.ULS.sendTraceTag(25798092,322,15,"UploadFrame.FileInputElement is null");
this.kPf()}IEd(){this.kPf()}kPf(){if(this.Gj&&!this.yKc){var Yb=this.Gj.HE;Yb&&(N.a.addHandler(Yb,M.a.Sb,Object(G.a)(this,this.onKeyDown,"onKeyDown")),Yb=[Yb],this.$m=Yb.concat.apply(Yb,this.$m),this.Ojg(),this.yKc=!0)}}dispose(){if(this.Gj&&!U.Iu){const Yb=this.Gj.HE;Yb&&N.a.removeHandler(Yb,M.a.Sb,Object(G.a)(this,this.onKeyDown,"onKeyDown"));this.pga&&N.a.removeHandler(this.Gj.iFrame,"load",this.pga)}this.Gj=null;super.dispose()}Ojg(){if(0<this.$m.length){const Yb=new Y.a(this.$m),pb=L.FocusManager.instance().gQ();
pb&&(this.$m[0].focus(),pb.ef=Yb,pb.d_=!0)}}onKeyDown(Yb){4!==L.FocusManager.instance().nPf(Yb)&&Yb.preventDefault()}static get Iu(){return E.AFrameworkApplication.ra.Qa.sv&&E.AFrameworkApplication.ra.Qa.olf}static Kz(Yb){const pb=document.getElementById("errorText");pb.innerText=Yb;pb.style.display="inline-block"}}Object(t.a)(U,"InsertFileDialog",D.a,[]);class P{static get og(){return D.a.xq(P.Ll,CommonUIStrings.l_ImageUploadDialogText,CommonUIStrings.l_ImageUploadNoFileSpecified)}}P.Ll="<div class='WACDialogRow' id='block1'> <label id='labelText' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRowNoBreak' id='block2'> <div id='uploadFrameContainer'></div> <div class='WACDialogError' id='errorText' role='alert'>{1}</div> </div>";
Object(t.a)(P,"InsertImageDialogHtml",null,[]);class aa extends U{constructor(Yb,pb=!0){super(Yb,pb)}get gZb(){return CommonUIStrings.l_ImageUploadButtonText}get titleText(){return CommonUIStrings.l_ImageUploadingTitle}get pmh(){return P.og}validate(){this.Gj.HE||e.ULS.sendTraceTag(25798095,322,10,"UploadFrame.FileInputElement is null");const Yb=Object(S.a)(f.a,this.p2j),pb=Yb.Vlg(this.Gj.HE.value);return 0!==pb?(U.Kz(Yb.z2e(pb)),!1):!0}}Object(t.a)(aa,"InsertImageDialog",U,[]);var X=a(553);const Z=
(Yb,pb,Fa)=>{if(Yb){var ab=0;do{try{Yb();break}catch(Gb){if(e.ULS.sendTraceTag(50946190,306,10,"RetryOnException: [Retries: {0}] [Caller: {1}] [Exception: {2}] [Callstack: {3}].",ab,Fa,Gb.message,Gb.stack),ab>=pb)break}ab++}while(1)}};var da=a(109),qa=a(88),O=a(39),ca=a(256),wa=a(175),ia=a(79),Ha=a(464),Sa=a(174);class Da{constructor(Yb,pb,Fa,ab,Gb,Ga,Ma,Qa,wb=!0,Na=null,ya=!1){this.mXe="FileUpload.ashx";this.Vn=null;this._initialized=!1;this.Bg=this.Zib=this.xKc=this.pga=this.ATb=this.Sq=this.Fs=
null;this.Fm=!1;this.OD=this.BTb=this.JUc=null;this._parent=Yb;this.gyg=pb;this.HCg=Fa;this.X9d=Gb;this.OSc=Ma;this.d4d=Qa;this.$5d=Na;this.IUc=!1;this.Eyg=ab.pa("CanaryRenewalForFileUploadIsEnabled");this.glg=!1;(this.Nqa=ya)||this.Vah(Ga);wb&&this.Tef()}get EZf(){return this.HCg}get sessionId(){return this.OSc}get iFrame(){return this.Vn}get HE(){return this.Sq}get E9a(){return E.AFrameworkApplication.fa?E.AFrameworkApplication.fa.pa("NativeFileOpenDialogIsEnabled"):!1}get gXe(){return E.AFrameworkApplication.fa?
E.AFrameworkApplication.fa.pa("FileInputDescriptionAccessibilityIsEnabled"):!1}get vqi(){return this.Nqa?!1:wa.b(this.Vn.contentWindow.location.pathname,this.mXe,0)}get KQg(){return!m.a.Kka&&E.AFrameworkApplication.fa.pa("AllowMultipleImageInsertFromLocalDevice")}Tef(){this.OD=Sa.a.create().toString();this.Nqa?this.n$c():this.NRg()}Vah(Yb){this.Vn=document.createElement("iframe");this.Vn.className=Yb;this.Vn.id=Yb;this.X9d&&(this.Vn.style.visibility="visible",this.Vn.style.height="30px",this.Vn.setAttribute("frameborder",
"0"));this.pga=Object(G.a)(this,this.IEd,"onUploadFrameLoad");N.a.addHandler(this.Vn,"load",this.pga)}c8b(Yb=null){E.AFrameworkApplication.ra.msc();if(!this.Sq)return e.ULS.sendTraceTag(25798093,322,50,"_fileInput is null"),"";N.a.addHandler(this.Sq,"change",()=>{this.FFh(Yb)});Z(Object(G.a)(this,this.fXe,"fileInputClick"),1,"DoFileOpenDialog");return this.Sq.value}FFh(Yb){Yb&&Yb(this.Sq.value)}GFh(){this.ATb&&(this.ATb.innerText=this.U3e())}Qfj(Yb){N.a.addHandler(this.Sq,"change",()=>{Yb(this.U3e())})}U3e(){let Yb=
null;if(this.Sq.value){const pb=this.Sq.value,Fa=pb.lastIndexOf("\\");0<Fa&&(Yb=pb.substring(Fa+1,pb.length))}return Yb?Yb:""}fXe(){try{e.ULS.sendTraceTag(35939520,322,50,"UploadFrame.FileInputClick - Clicking on File input element."),this.Sq.click()}catch(Yb){throw e.ULS.sendTraceTag(36783331,322,10,"UploadFrame.FileInputClick Exception: {0}",Yb.message),Yb;}}IOj(){this.Mti()?this.vcg():(this.R0d(),this.Fs.submit())}Mti(){return(this.Eyg||this.Nqa)&&!(void 0===window.self.FormData||null===window.self.FormData)}Q2f(Yb){if(Yb){const pb=
this.LGe();this.Bg=new XMLHttpRequest;this.Bg.open("POST",pb);this.Bg.setRequestHeader("X-CorrelationId",this.OD);this.cCi(Yb);this.Bg.onreadystatechange=Object(G.a)(this,this.Loa,"uploadResponseReceived");this.Bg.send(Yb)}}cCi(Yb){if(!m.a.Kka&&Yb.get){var pb=Yb.get("ImageId");Yb=window.self.navigator;pb={["CorrelationId"]:this.OD,["Canary"]:E.AFrameworkApplication.canary,["ImageNodeId"]:pb};Yb&&(Yb=Yb.connection?Yb.connection:Yb.mozConnection?Yb.mozConnection:Yb.webkitConnection?Yb.webkitConnection:
null)&&(pb.effectiveType=Yb.effectiveType,pb.downlink=Yb.downlink,pb.type=Yb.type,pb.rtt=Yb.rtt);e.ULS.sendTraceTag(573345858,322,50,"LogFileUploadStatistics: FileUpload {0}",pb)}}vcg(){try{this.R0d();e.ULS.sendTraceTag(594888409,322,50,"SubmitFormWithRequest is preparing to send an upload request");const Yb=new (Type.parse("FormData"))(this.Fs);this.Q2f(Yb)}catch(Yb){e.ULS.sendTraceTag(594888407,322,10,"SubmitFormWithRequest failed to send the request with exception "+Yb.message),this.P$a(null)}}ucg(Yb){try{if(this.R0d(),
e.ULS.sendTraceTag(594888406,322,50,"SubmitFormWithBlob is preparing to send an upload request"),this.i4j(Yb)){this.BTb=Yb;this.Fs.contains(this.Sq)&&this.Fs.removeChild(this.Sq);var pb=new (Type.parse("FormData"))(this.Fs);pb.append("applicationfileInput",Yb.blob,Yb.filename);this.Q2f(pb)}else this.P$a(null)}catch(Fa){e.ULS.sendTraceTag(591267743,322,10,"SubmitFormWithBlob failed to send the request with exception "+Fa.message),this.P$a(null)}}i4j(Yb){return Yb&&void 0!==Yb.blob&&null!==Yb.blob&&
void 0!==Yb.filename&&null!==Yb.filename&&""!==Yb.filename?void 0===window.self.FormData||null===window.self.FormData?(e.ULS.sendTraceTag(578380442,322,10,"FormData isn't supported"),!1):!0:(Yb=Yb?String.format("[isNull: false] [blobIsNullorEmpty: {0}] [filenameIsNullOrEmpty: {1}]",void 0===Yb.blob||null===Yb.blob,void 0===Yb.filename||null===Yb.filename||""===Yb.filename):"[isNull: true] [blobIsNullorEmpty: false] [filenameIsNullOrEmpty: false]",e.ULS.sendTraceTag(578380441,322,10,String.format("Content of the blob is empty {0}",
Yb)),!1)}Loa(){if(4===this.Bg.readyState)if(200===this.Bg.status){e.ULS.sendTraceTag(594888405,322,50,"UploadResponseReceived received a successful response. CorrelationId: {0}",this.OD);const Yb=this.Bg.getResponseHeader("X-NewKey"),pb=this.lmi(this.Bg);let Fa=!1;if(void 0!==Yb&&null!==Yb&&pb&&(Fa=this.X3j(Yb),!this.IUc&&Fa)){e.ULS.sendTraceTag(594888404,322,50,"UploadResponseReceived resubmitting the upload request with a fresh canary. correlationId: {0}",this.OD);this.IUc=!0;void 0!==this.BTb&&
null!==this.BTb?this.ucg(this.BTb):this.vcg();return}e.ULS.sendTraceTag(594888403,322,50,"UploadResponseReceived processing the response [retried: {0}] [canaryInvalid: {1}] [gotNewCanary: {2}] [canaryRenewed: {3}] [CorrelationId: {4}]",this.IUc,pb,!(void 0===Yb||null===Yb),Fa,this.OD);this.P$a(this.Bg.responseText)}else e.ULS.sendTraceTag(42874946,322,15,"Upload request failed with status: {0} [isResponseNull: {1}] [correlationId: {2}]",this.Bg.status,this.Bg.responseText?!1:!0,this.OD),this.P$a(null)}lmi(Yb){try{const pb=
O.a(Yb.responseText).Responses;if(void 0!==pb&&null!==pb&&1===pb.length){const Fa=pb[0];if(void 0!==Fa&&null!==Fa&&2===Fa.length&&28===Fa[1].StatusCode)return!0}}catch(pb){}return!1}X3j(Yb){Ha.a.Oig(Yb);return E.AFrameworkApplication.canary!==Yb?!1:!0}R0d(){this.JUc||(this.JUc=new Date)}dispose(){this.Fm||(this.Nqa?this._parent.removeChild(this.Fs):(this._parent.removeChild(this.Vn),N.a.removeHandler(this.Vn,"load",this.pga),this.pga=null),this.xKc&&(N.a.removeHandler(this.Sq,"change",this.xKc),this.xKc=
null),this.gXe&&(this.Zib&&(N.a.removeHandler(this.Sq,"change",this.Zib),this.Zib=null),this.ATb=null),this.Sq=this.Fs=this._parent=this.Vn=null,this.Fm=!0,this.JUc=null,e.ULS.sendTraceTag(25798094,322,50,"UploadFrame disposed"))}delayedDispose(){this.dispose()}Adh(Yb){if(this.Fs){var pb;(pb=this.Fs.querySelector("input[name=__REQUESTDIGEST]"))?pb.value=Yb:(pb=this.S5c(),pb.type="hidden",pb.id="__REQUESTDIGEST",pb.name="__REQUESTDIGEST",pb.value=Yb,this.Fs.appendChild(pb))}}S5c(){return this.Nqa?
document.createElement("input"):this.Vn.contentWindow.document.createElement("input")}IEd(){try{if(!this.Vn.contentWindow.document.body)return}catch(pb){this.mai();return}if(!(this._initialized||this.E9a&&m.a.gF))this.n$c();else if(!this.E9a||!m.a.gF||this.vqi){let pb;pb=m.a.rv?this.Vn.contentWindow.document.body.innerText:this.glg?this.Vn.contentWindow.document.body.firstChild.innerText:this.Vn.contentWindow.document.body.firstChild.innerHTML;var Yb=this.Vn.contentWindow.document.body.innerText.toLowerCase();
const Fa=0<=Yb.indexOf("responses")||0<=Yb.indexOf("wopisrc");Yb=0<=Yb.indexOf("http error");!Fa&&Yb&&e.ULS.sendTraceTag(42551183,322,15,"Couldn't obtain a valid response but the frame contains: "+this.Vn.contentWindow.document.body.innerText);this.P$a(pb)}}n$c(){if(!this._initialized){var Yb=this.ga("uploadForm");const pb=this.ga("fileInput"),Fa=this.LGe();this.fdh();this.Fs.id=Yb;this.Fs.method="post";this.Fs.encoding="multipart/form-data";this.Fs.action=Fa;this.Sq.type="file";this.d4d&&(this.Sq.accept=
this.d4d,this.$5d&&(this.Sq.capture=this.$5d));this.Sq.id=pb;this.Sq.name=pb;this.KQg&&(this.Sq.multiple=!0);!this.gXe||m.a.rv||m.a.rH||(this.Zib=Object(G.a)(this,this.GFh,"fileInputChangedHandleAccessibility"),N.a.addHandler(this.Sq,"change",this.Zib),this.ATb=qa.a.Ute(this.Fs,this.Sq,"InputFileDescription"));this.X9d&&(this.Nqa||(Yb=this.Vn.contentWindow.document.body,Yb.style.margin="0",Yb.style.overflow="hidden"),Yb=E.AFrameworkApplication.ra,this.Sq.style.fontFamily=Yb.I0,this.Sq.style.fontSize=
Yb.WCc,this.Sq.style.margin="0");(Yb=document.getElementById("__REQUESTDIGEST"))&&this.Adh(Yb.value);this.Fs.appendChild(this.Sq);this._initialized=!0;this.gyg(this)}}fdh(){if(this.Nqa)this.Fs=document.createElement("form"),this._parent.appendChild(this.Fs),this.Sq=document.createElement("input");else{this.Fs=this.Vn.contentWindow.document.createElement("form");const Yb=this.Vn.contentWindow.document;Yb.body.appendChild(this.Fs);this.Sq=Yb.createElement("input")}}NRg(){this._parent.appendChild(this.Vn);
this.E9a&&m.a.gF&&this.n$c()}LGe(){var Yb=new ca.QueryStringBuilder(this.mXe);E.AFrameworkApplication.EYa(Yb);this.Hwj(Yb);Yb=Yb.toString();if(m.a.Cf||m.a.gF||m.a.rH)Yb=ia.a.Ded(Yb);return Yb}xoe(){const Yb=new da.a(2,1,0,Object(G.a)(this,this.delayedDispose,"delayedDispose"),4);E.AFrameworkApplication.hi.fg(Yb)}}Object(t.a)(Da,"UploadFrame",null,[2]);var ea=a(41),sa=a(113),Ea=a(21);class ba extends Da{constructor(Yb,pb,Fa,ab,Gb,Ga,Ma=!1){super(Yb,pb,Fa,ab,Gb,"UploadFrame",Ga.ea.sessionId,"image/*",
!1,null,Ma);this.$=Ga;this.glg=!0;this.Tef()}ga(Yb){return Yb}Hwj(Yb){e.ULS.shipAssertTag(526399105,0,!!this.sessionId,"SessionId shouldn't be null.");sa.a.JYc(Yb,this.$.ya);Yb.p9(x.a.sessionId,this.sessionId);var pb=Ea.h(this.$).ha;pb=ea.o(pb.qa.P3,this.$);Yb.p9(x.a.j$i,this.$.va.na.name);Yb.p9(x.a.i$i,pb.FirstRow.toString());Yb.p9(x.a.h$i,pb.FirstColumn.toString())}mai(){this.EZf("ServerUploadError")}P$a(Yb){this.EZf(Yb)}static soi(Yb){return!Yb||H.a.equals(Yb,"ServerUploadError",!1)}}Object(t.a)(ba,
"UploadFrameWrapper",Da,[]);class ka extends aa{constructor(Yb,pb,Fa,ab){super(Yb,!1);this.RP=null;this.hBa=!1;this.htmlSanitizationHelper=null;this.Poc=()=>{this.b0d("");this.lDc();return!1};this.$=pb;this.wEc=Yb;this.xQ=X.a.instance;this.fa=Fa;this.htmlSanitizationHelper=ab;this.y6f();this.Qnd();this.$.qb.tv=!0}x6f(Yb,pb){return new ba(Yb,Object(G.a)(pb,pb.PGb,"onUploadFrameInitialized"),Object(G.a)(pb,pb.Loa,"uploadResponseReceived"),this.fa,!0,this.$)}dispose(){this.lDc();this.xQ=this.wEc=null;
super.dispose()}hide(){super.hide();this.$.qb.tv=!1}validate(){var Yb=this.wEc.z1d(this.Gj.HE.value,this.wEc.Igg(this.Gj));return 0!==Yb?(Yb=this.wEc.fgd(Yb).Description,this.b0d(Yb),this.eXd(),!1):!0}isEnabled(){return!0}b0d(Yb){B.EwaSettings.isChangeGateEnabled("OfficeVSO:6296544_ReduceInnerHTMLUsage")&&B.EwaSettings.isChangeGateEnabled("OfficeVSO:7073924_CleanUpInnerHtmlInInsertImageDialogWrapper")&&this.htmlSanitizationHelper?this.htmlSanitizationHelper.w4f(this.RP,Yb):this.RP.innerHTML=Yb}Qnd(){this.RP=
document.getElementById("errorText");this.RP.style.display="inline-block";this.hBa=!1;this.b0d("");this.HIa.style.maxWidth=this.HIa.currentStyle.minWidth}eXd(){this.xQ.ta(M.a.click,this.Gj.HE,this.Poc);this.xQ.ta(M.a.Sb,this.Gj.HE,this.Poc);this.hBa=!0}lDc(){this.hBa&&(this.xQ.Ba(M.a.click,this.Gj.HE,this.Poc),this.xQ.Ba(M.a.Sb,this.Gj.HE,this.Poc),this.hBa=!1)}}Object(t.a)(ka,"InsertImageDialogWrapper",aa,[]);var Ca=a(52),db=a(55),yb=a(50),kb=a(37);class mb extends f.a{constructor(Yb,pb,Fa,ab,Gb=
!0){super(null,pb,Fa);this.Hia=this.Kt=null;this.U7a=!1;this.kGd=null;this.Loa=Ga=>{this.s2d.stop();this.l1b.cancel();if(ba.soi(Ga))this.kCc?this.j$e(4):(Ga=new d.a(0,2,null,null,!1,null,null,null),Ga.status=8,this.EZd(new h.a(Ga),null,"InsertPictureWebMethod")),e.ULS.sendTraceTag(526399121,0,50,`Http Error occurred, isTimeoutError: ${this.kCc}`);else{const Ma=mb.o4j(Ga);0!==Ma?(e.ULS.sendTraceTag(526399122,0,50,`Server returned error, response: ${Ga}`),this.j$e(Ma)):this.$$h(Ga)}this.zqc();this.dispose()};
this.BRi=Ga=>{this.cCa(Ga,this.Gj)&&this.finalizeUpload(this.Gj,null)};this.PGb=Ga=>{e.ULS.sendTraceTag(526399120,0,50,"Upload frame initialized");this.Gj=Ga;if(!this.N1a){if(this.Z0d){if(this.Uze()||this.E9a&&m.a.gF){Ga.c8b(this.BRi);return}const Ma=Ga.c8b(null);if(!this.cCa(Ma,Ga))return}this.finalizeUpload(Ga,null)}};this.T_i=()=>{this.kCc=!0};this.jb=Yb;this.s2d=Yb.Jb.zg("WebServiceCall","InsertPictureOperation");this.l1b=w.a.instance.create(this.T_i,1E5,C.a.oVg,!1);this.kCc=!1;this.Dmc=this.$.ya.InsertPictureMaxFileSizeBytes;
ab&&(this.U7a="TestOnly"in ab);Gb&&this.showDialog()}get $(){return this.jb}get yGi(){return this.Dmc/1024/1024}dispose(){l.a.Ja(this.l1b);this.Gj&&this.Gj.xoe();this.Gj=this.l1b=this.jb=null}Ucj(Yb){if(!this.$)return e.ULS.sendTraceTag(526399119,0,50,"ReadPictureAsDataURLTask: EwaControl is null"),db.Task.Ra(!0);if(!this.$.vba)return db.Task.Ra(!0);const pb=new r.a,Fa=new FileReader;Yb=Yb.HE.files[0];const ab=()=>{pb.Tw(!0)};Fa.onload=()=>{this.kGd=Fa.result;pb.Tw(!0)};Fa.onerror=ab;Fa.onabort=ab;
Fa.readAsDataURL(Yb);return pb.task}Igg(Yb){let pb=-1;Yb=Yb.HE;(null===Yb||void 0===Yb?0:Yb.files)&&0<Yb.files.length&&(pb=Yb.files[0].size);return pb}z1d(Yb,pb){let Fa=mb.Q$g(f.a.cCa(Yb));0===Fa?-1!==pb&&(e.ULS.sendTraceTag(526399118,0,50,`Validating picture, pictureSize: ${pb}, maxAllowedSize: ${this.Dmc}, remainingWorkbookSize: ${this.$.ea.npf}`),pb>this.Dmc?Fa=3:pb>this.$.ea.npf&&(Fa=7)):6===Fa&&this.jEi(Yb);e.ULS.sendTraceTag(526399117,0,50,`Validated file on client, validation result: ${Fa}`);
return Fa}cCa(Yb,pb){Yb=this.z1d(Yb,this.Igg(pb));return 0!==Yb?(this.N1a||1===Yb||this.MUd(Yb),!1):!0}agg(Yb){Yb.IOj()}fgd(Yb){let pb=0,Fa=1,ab=-1100324317,Gb="InsertPictureUnknownError",Ga=null;switch(Yb){case 1:pb=1755;Fa=0;ab=940870981;Gb="InsertPictureNoFileSelected";break;case 3:Fa=0;ab=1250467391;Gb="InsertPicturePictureTooBig";Ga=String.format(I.a.instance.ob(181),this.yGi.toLocaleString());break;case 6:pb=1759;Fa=0;ab=1380041209;Gb="InsertPictureUnsupportedFormat";break;case 7:pb=1756;Fa=
0;ab=-903115058;Gb="InsertPictureExceedWorkbookSize";break;case 4:pb=1757;Fa=0;ab=1218352119;Gb="InsertPictureUploadTimeout";break;case 5:pb=1758,Fa=0,ab=1979899005,Gb="InsertPictureServiceNonDeterministicError"}Yb=mb.ed(pb,Fa,ab,Gb);Ga&&(Yb.Description=Ga);return Yb}showDialog(){if(this.Uze())this.N1a=!1,this.Gj=new ba(this.$.domElement,this.PGb,this.Loa,this.fa,!1,this.$,!0);else if(e.ULS.sendTraceTag(526399115,0,50,"Showing Insert Picture dialog"),!this.U7a&&(m.a.qw||m.a.gF&&72>m.a.gCe))this.N1a=
!1,this.Gj=new ba(this.$.domElement,this.PGb,this.Loa,this.fa,!1,this.$);else{this.N1a=!0;const Yb=B.EwaSettings.isChangeGateEnabled("OfficeVSO:6296544_ReduceInnerHTMLUsage")&&B.EwaSettings.isChangeGateEnabled("OfficeVSO:7073924_CleanUpInnerHtmlInInsertImageDialogWrapper")?yb.GetServiceTaskFactory.Oa(this.$.da,498,499,0):A.a.Ra(null);kb.TaskExtensions.za(Yb,()=>{this.Gj=(new ka(this,this.$,this.fa,Yb.result)).Gj},this.$.la,3)}}$$h(Yb){let pb={};try{if(pb=n.a.Wh(Yb),Ca.b().aC(this.s2d.id,pb.ServerCorrelationId,
"actions","ServerActions"),!y.a.Wf(pb.Errors)&&pb.Result){this.$.ea.VW(pb.StateId,"BasePictureUploaderWrapper.UploadResponseReceived");const Fa=pb.Result;R.a(this.$).nna(1,Fa);const ab=this.$.da.Aa(277);ab&&ab.xWc(this.$,1,pb.Result,pb,"InsertPicture");e.ULS.sendTraceTag(526399114,0,50,"Insert picture completed successfully :)")}}catch(Fa){e.ULS.sendTraceTag(526399113,0,50,`BasePictureUploaderWrapper.HandleSuccessCallback: got exception while try to JSON.Parse string length: ${Yb?Yb.length:-1}, errror: ${Fa}`)}this.LCc(pb,
null,"InsertPictureWebMethod")}j$e(Yb){Yb=this.fgd(Yb);const pb={};pb.Errors=[Yb];this.LCc(pb,null,"InsertPictureWebMethod")}LCc(Yb,pb,Fa){this.Kt(Yb,pb,Fa)}EZd(Yb,pb,Fa){this.Hia(Yb,pb,Fa)}MUd(Yb){Yb=this.fgd(Yb);B.EwaSettings.kz()?new z.a(this.$,Yb):(new u.ErrorDialog(this.$,Yb)).kg()}jEi(Yb){const pb=this.$.ya.InsertPicturUnsupportedExtensionsForLogging;Yb=v.a.Yk(Yb);for(let Fa=0;Fa<pb.length;++Fa)if(Yb.endsWith(pb[Fa])){e.ULS.sendTraceTag(526399112,0,50,`Insert picture blocked invalid extension: ${pb[Fa]}`);
break}}static o4j(Yb){return!Yb||H.a.equals(Yb,x.a.insertPictureUnknownError,!0)?2:H.a.equals(Yb,x.a.insertPictureNoFileSelectedError,!0)?1:H.a.equals(Yb,x.a.Uii,!0)?3:H.a.equals(Yb,x.a.Vii,!0)?5:0}static ed(Yb,pb,Fa,ab){return y.a.ed(1,0,0,Yb,pb,Fa,ab)}static Q$g(Yb){switch(Yb){case 1:return 1;case 2:return 6}return 0}Uze(){return this.U7a||void 0===window.self.FormData||null===window.self.FormData?!1:!0}}Object(t.a)(mb,"BasePictureUploaderWrapper",f.a,[2]);class W extends mb{constructor(Yb,pb,Fa,
ab,Gb,Ga=!0){super(Yb,pb,Fa,ab,!1);this.LFh=Gb;this.I$b=Yb.Jb.zg("LoadResource","FileReaderUploaderLoadResource");Ga&&this.showDialog()}iIj(){this.Dmc=28E5;this.MUd(3)}ncd(Yb){e.ULS.sendTraceTag(526399111,0,50,"FileReaderUploaderWrapper.finalizeUploadImpl - Start function.");const pb=new FileReader;Yb=Yb.HE.files;if(0==Yb.length)e.ULS.sendTraceTag(526399110,0,15,"FileReaderUploaderWrapper.finalizeUploadImpl - No image file found.");else{var Fa=Yb[0];pb.onload=()=>{this.I$b.stop();this.LFh.n_i(pb.result,
this);e.ULS.sendTraceTag(526399109,0,50,`FileReaderUploaderWrapper.finalizeUploadImpl - End function. Type:${Fa.type}, Size:${Fa.size.toString()}`)};pb.onerror=()=>{this.I$b.stop();e.ULS.sendTraceTag(526399108,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Can't read image. Type:${Fa.type}, Size:${Fa.size.toString()}`)};pb.onabort=()=>{this.I$b.stop();e.ULS.sendTraceTag(526399107,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Aborted read image. Type:${Fa.type}, Size:${Fa.size.toString()}`)};
this.I$b.start();pb.readAsDataURL(Fa)}}finalizeUpload(Yb,pb){this.ncd(Yb,pb)}}Object(t.a)(W,"FileReaderUploaderWrapper",mb,[421]);var Q=a(374),va=a(192);class na{constructor(Yb,pb){this.dataUri=this.sheetName=null;this.sheetName=Yb;this.dataUri=pb}getSheetName(){return this.sheetName}}Object(t.a)(na,"MacroRecorderPictureInsertedPayload",null,[122]);class Ba extends mb{constructor(Yb,pb,Fa,ab,Gb,Ga=!0){super(Yb,Fa,ab,Gb,!1);this.Sd=pb;Ga&&this.showDialog()}ncd(Yb,pb){super.finalizeUpload(Yb,pb);Q.a(this.$.userOperationManager,
(Fa,ab)=>{this.Kt=Fa;this.Hia=ab;this.s2d.start();this.l1b.Xp();this.kCc=!1;this.agg(Yb);return this.Ucj(Yb)},Fa=>{const ab={};this.$.ak(ab);const Gb=ab.SheetName;Fa=new va.a(510,0,Fa,72,()=>new na(Gb,this.kGd?this.kGd:""));Fa.EAa(()=>!0);Fa.Sd=this.Sd;return Fa},this.Sd)}finalizeUpload(Yb,pb){this.ncd(Yb,pb)}}Object(t.a)(Ba,"PictureUploaderWrapper",mb,[]);class Oa{constructor(Yb,pb){this.filename=Yb;this.blob=pb}}Object(t.a)(Oa,"UploadBlobParameters",null,[]);class oa extends Ba{constructor(Yb,pb,
Fa,ab,Gb,Ga,Ma){super(Yb,pb,Fa,ab,Gb,!1);this.Z0d=!1;this.qI=Ma;this.Dfc=oa.ILh(Ga);Yb=this.z1d(this.Dfc.name,this.Dfc.size);0!==Yb?(this.MUd(Yb),this.qI.setException(Error.create("DataUrlUploaderWrapper: Invlid data url")),this.dispose()):this.Gj=new ba(this.$.domElement,this.PGb,this.Loa,ab,!1,this.$)}EZd(Yb,pb,Fa){super.EZd(Yb,pb,Fa);this.qI.setException(Error.create("DataUrlUploaderWrapper.TriggerFailedCallback: File upload request failed"))}LCc(Yb,pb,Fa){super.LCc(Yb,pb,Fa);y.a.Wf(Yb.Errors)?
this.qI.setException(Error.create(`DataUrlUploaderWrapper.TriggerSuccessCallback: File upload request returned with errors: ${y.a.nc(Yb.Errors)}`)):this.qI.setResult(!0)}agg(Yb){const pb=new Oa(this.Dfc.name,this.Dfc);Yb.ucg(pb)}static ILh(Yb){var pb=Yb.split(",");Yb=pb[0].includes("base64")?window.self.atob(pb[1]):window.self.decodeURI(pb[1]);pb=pb[0].split(":")[1].split(";")[0];const Fa=new Uint8Array(Yb.length);for(let ab=0;ab<Yb.length;ab++)Fa[ab]=Yb.charCodeAt(ab);Yb=new Blob([Fa],{type:pb});
Yb.name="Image.png";return Yb}}Object(t.a)(oa,"DataUrlUploaderWrapper",Ba,[]);class Ja{constructor(){}Fhi(Yb,pb,Fa,ab,Gb){new Ba(Yb,pb,Fa,ab,Gb,!0)}Fgi(Yb,pb,Fa,ab,Gb,Ga){new oa(Yb,null,pb,Fa,ab,Gb,Ga)}Qgi(Yb,pb,Fa,ab,Gb){new W(Yb,pb,Fa,ab,Gb,!0)}}Object(t.a)(Ja,"UploaderCreator",null,[401]);class Wb extends b.a{constructor(Yb){super();this.$=Yb;this.Db()}static ka(Yb){Yb.da.Ha(485,new Wb(Yb))}create(){var Yb;this.nb(null!==(Yb=this.$.da.Aa(484))&&void 0!==Yb?Yb:this.$.da.Ha(484,new Ja))}}Object(t.a)(Wb,
"UploaderCreatorFactory",b.a,[]);a.d(F,"a",function(){return nc});const nc=()=>{c.a.Fa(Yb=>{Wb.ka(Yb)})}},1214:function(t,F,a){var c=a(9);t=a(0);var b=a(709),e=a(160),f=a(104),d=a(4),h=a(188),m=a(15),l=a(1387),v=a(30),r=a(99),A=a(83),x=a(557),n=a(174),u=a(41),z=a(374),w=a(192),C=a(284),y=a(29),B=a(250),H=a(11),I=a(13),R=a(282),S=a(106),G=a(21),D=a(150),E=a(88),M=a(97),L=a(167),N=a(184),Y=a(90),U=a(157),P=a(347),aa=a(1),X=a(1263),Z=a(79);class da extends X.a{constructor(Ca,db){super(Ca,Z.a.Qaa(db))}Ltc(Ca,
db){this.isEnabled()&&this.PFa(this.targetOrigin)&&(this.Yn(Ca),this.Dl(Ca,db))}}Object(t.a)(da,"InsertMediaCrossDocumentMessenger",X.a,[455,123,2]);var qa=a(7);class O{}Object(t.a)(O,"OnlineMediaSearchResult",null,[]);var ca=a(316);class wa extends D.a{constructor(Ca,db,yb,kb,mb,W){super();this.fic=!1;this.Jvd=this.jR=this.lwa=null;this.vOi=()=>{this.sua(this.t_a)};this.Cud=Q=>{Q.keyCode===Sys.UI.Key.tab&&("KeepFocusDiv"!==Q.target.id||Q.shiftKey?"KeepFocusStartDiv"===Q.target.id&&Q.shiftKey&&(Q.preventDefault(),
document.getElementById("KeepFocusDiv").focus()):(Q.preventDefault(),document.getElementById("KeepFocusStartDiv").focus()))};this.FVi=()=>{this.Oob&&(this.Oob.launchUpsellExperience("stockimages"),m.ULS.sendTraceTag(537155807,0,50,"OnLaunchM365Upsell: Launched Dime Upsell flow"))};this.el=W;this.$=Ca;this.gff=db;this.Oob=yb;this.rAa=[];this.uvf=kb;this.qmh=mb;this.Sse=this.$.ya.InsertOnlinePictureMaxCountOfImagesToInsert;this.og=this.Odh()}IIj(Ca){this.fic=!1;this.showDialog(this.el,null);this.lwa=
document.getElementById(this.Dh("InsertMediaFrame"));if(!this.lwa)throw this.sua(this.t_a),Error.invalidOperation("Couldn't get InsertMediaIframe.");var db=document.getElementById(this.Dh("WACDialogPanel"));db&&db.setAttribute(E.a.Cd,E.a.KZa);db=document.createElement("div");db.id="KeepFocusStartDiv";db.tabIndex=0;db.className="keep-focus-start";this.lwa.parentNode.insertBefore(db,this.lwa.parentNode.firstChild);db=document.createElement("div");db.id="KeepFocusDiv";db.tabIndex=0;db.className="keep-focus";
this.lwa.parentNode.appendChild(db);$addHandler(this.HIa,"keydown",this.Cud);this.lwa.src=this.gff;this.lwa.frameBorder="0";db=document.getElementById(this.Dh("WACDialogButtonPanel"));if(!db)throw Error.invalidOperation("Couldn't get WACDialogButtonPanel.");db.className="display-none";db=document.getElementById(this.Dh("WACDialogTitleText"));if(!db)throw Error.invalidOperation("Couldn't get WACDialogTitleText.");db.className="display-none";2===this.uvf&&(document.getElementById(this.Dh("WACDialogTitlePanel")).className=
"display-none",document.getElementById(this.Dh("WACDialogBodyPanel")).className="padding-zero");M.FocusManager.instance().gQ().scope.dN=!0;this.jR=new da(this.lwa.contentWindow,this.gff);this.jR.Ltc(L.a.jJg,yb=>{this.kNi(yb,Ca.Loa)});this.jR.Ltc(L.a.insert,()=>{this.SUi(Ca.Loa)});this.jR.Ltc(L.a.T0c,this.vOi);2===this.uvf&&0===this.qmh&&(this.jR.Ltc(L.a.Hyi,this.FVi),this.Jvd=this.Oob.Mza("MsoPremiumStockImages",yb=>{m.ULS.sendTraceTag(537155811,0,50,"OnCompleteM365Upsell: Upsell completed from stock images");
yb.isEnabled?this.jR.jj(L.a.j2j,{["LicenseTier"]:yb.toString()}):m.ULS.sendTraceTag(537155810,0,10,"OnCompleteM365Upsell: Upsell completed but license tier didn't upgrade.")}))}dispose(){this.rAa=null;this.Oob&&this.Jvd&&this.Oob.iLd("MsoPremiumStockImages",this.Jvd);this.jR&&(this.jR.dispose(),this.jR=null);super.dispose()}hide(){super.hide();Y.a.$xc(this.$)}get R3(){return N.a.y7b+"/InsertMediaDialog"}get nY(){return!1}kNi(Ca,db){Ca=Ca&&Ca.Values?(Ca=Ca.Values)?Object(qa.a)(new O,{Action:Ca.action||
"",Caption:Ca.caption||"",ContentType:Ca.contentType||"",FileExtension:Ca.extension||"",PageUrl:Ca.pageUrl||"",SourceUrl:Ca.sourceUrl||"",ThumbnailUrl:Ca.thumbnailUrl||"",LicenseUrl:Ca.licenseUrl||"",LicenseDisplayName:Ca.licenseDisplayName||"",Height:Ca.height||0,Width:Ca.width||0}):null:null;Ca&&(this.rAa.push(Ca),this.fic&&(m.ULS.sendTraceTag(537155809,0,50,"InsertMediaDialog.OnAddItem: Insert Message handling was pending"),db(this.rAa),this.fic=!1,this.sua(this.t_a)))}SUi(Ca){this.rAa&&0<this.rAa.length?
this.rAa.length<=this.Sse?(Ca(this.rAa),this.sua(this.t_a)):(this.Kz(),m.ULS.sendTraceTag(537155808,0,10,"OnInsert : Tried to insert more than allowed limit of items."),this.rAa.length=0):this.fic=!0}Odh(){const Ca=document.createElement("div");Ca.id="InsertMediaDialog";Ca.className=aa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixHorizonalScroll",!0)?"insert-media-dialog":"insert-media-dialog-old";const db=document.createElement("div");db.id="InsertMediaPanel";
db.className=aa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixCancelButton",!0)?"insert-media-panel":"insert-media-panel-old";const yb=document.createElement("iframe");yb.id="InsertMediaFrame";yb.className="insert-media-frame";Ca.appendChild(db);db.appendChild(yb);return ca.b(Ca)}Kz(){const Ca=y.a.ed(1,0,0,0,0,466721363,"InsertPictureExceededAllowedCount");Ca.Description=String.format(I.a.instance.ob(206),this.Sse.toLocaleString());aa.EwaSettings.kz()?new P.a(this.$,
Ca):(new U.ErrorDialog(this.$,Ca)).kg()}}Object(t.a)(wa,"InsertMediaDialog",D.a,[]);var ia=a(381),Ha=a(290);class Sa extends l.a{constructor(Ca,db,yb,kb,mb,W){super(null,yb,kb);this.Usf=0;this.Loa=Q=>{if(Q){var va=Array(Q.length);for(var na=0;na<Q.length;na++){const oa=Q[na];va[na]={};va[na].SourceUrl=oa.SourceUrl;v.a.Swa(oa.LicenseUrl)&&v.a.Swa(oa.PageUrl)&&(va[na].LicenseUrl=oa.LicenseUrl,va[na].LicenseDisplayName=oa.LicenseDisplayName,va[na].PageUrl=oa.PageUrl);va[na].AltText=-2053056795===this.Sd.command?
oa.Caption:""}var Ba=-2009825598===this.Sd.command?"bing":"M365";na=G.h(this.$);var Oa=u.o(na.ha.qa.activeCell,this.$);z.a(this.$.userOperationManager,(oa,Ja,Wb)=>C.s(this.$.oa.xa,Oa,va,Ba,R.b(oa,this.oXi),R.a(Ja,this.nXi),Wb,null),oa=>new w.a(595,0,oa),this.Sd);H.HelperMethods.OZ?(na=new Map,na.set("MediaProvider",Ba),na.set("ImagesCount",Q.length.toString()),na.set("TimeTakenToOpenDialog",this.Usf.toString()),r.Health.instance.recordKpiUsage(Ha.a.Rii,1,ia.a.Rdg,na)):m.ULS.sendTraceTag(537155805,
0,15,"OnlinePictureUploaderWrapper.UploadResponseReceived: KPI Usage not supported.");this.zqc()}else m.ULS.sendTraceTag(537155806,0,10,"OnlinePictureUploaderWrapper.UploadResponseReceived: Response is null")};this.oXi=Q=>{B.a(Q)?m.ULS.sendTraceTag(537155799,0,10,`OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded with errors. Errors: ${y.a.nc(Q.Errors)}`):(m.ULS.sendTraceTag(537155801,0,50,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded."),Q.Result?
S.a(this.$).nna(1,Q.Result):m.ULS.sendTraceTag(537155800,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess:Result.result is null"))};this.nXi=()=>{m.ULS.sendTraceTag(537155798,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadFailed: Operation failed")};this.$=Ca;this.Sd=db;this.qI=W;this.Bte=A.a.instance.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");this.showDialog()}dispose(){this.$=null}showDialog(){let Ca=null;Ca=this.$.Jb.Gc("UserAction","showOnlineImagesDialogTimeStopwatch");
switch(this.Sd.command){case -2009825598:this.SHj();break;case -2053056795:this.Bte.execute(db=>{db.isFeatureEnabled("MsoPremiumStockImages",!1).catch(yb=>m.ULS.sendTraceTag(557200643,0,10,`OnlinePictureUploaderWrapper::ShowDialog - Failed to load the premium state from application feature helper: ${yb}`)).then(yb=>{this.THj(yb);return null})})}Ca.stop();this.Usf=Ca.Bc}SHj(){let Ca=this.$.ya.BingPictureEndpoint;const db=x.a.IJ(d.AFrameworkApplication.lcid),yb=n.a.create();Ca?(Ca=0<Ca.search(RegExp("insertmedia.bing.office.net",
"gi"))?String.format(Ca,1,1):String.format(Ca,1,d.AFrameworkApplication.lcid,db?db.name:"en-us",d.AFrameworkApplication.buildVersion,yb.toString(),1,this.$.ya.DocumentHostInfo.LoggableUserId),this.x5b(Ca,1,-1,I.a.instance.ga(1761))):(m.ULS.sendTraceTag(537155804,0,10,"OnlinePictureUploaderWrapper::ShowDialogForBingPictures - Can't access the Bing service endpoint"),this.qI.setException(Error.create("Failed to access the Bing service endpoint")))}THj(Ca){var db=this.$.ya.M365PictureEndpoint,yb=n.a.create();
if(db){var kb=this.$.ya.DocumentHostInfo.UserId;kb=kb?v.a.Yu(kb).toString():"0";var mb=this.Bte.instance.isFreemiumUpsellEnabled();Ca=Ca?1:mb?0:-1;yb=yb.toString();mb=x.a.IJ(d.AFrameworkApplication.lcid).name;db=String.format(db,d.AFrameworkApplication.lcid,mb,d.AFrameworkApplication.buildVersion,yb,1,kb,Ca,1);this.x5b(db,2,Ca,I.a.instance.ga(1760))}else m.ULS.sendTraceTag(537155803,0,10,"OnlinePictureUploaderWrapper::ShowDialogForStockImages - Can't access the M365 service endpoint"),this.qI.setException(Error.create("Failed to access the M365 service endpoint"))}x5b(Ca,
db,yb,kb){try{(new wa(this.$,Ca,A.a.instance.mg("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),db,yb,kb)).IIj(this),this.qI.setResult(!0)}catch(mb){m.ULS.sendTraceTag(537155802,0,10,`OnlinePictureUploaderWrapper::CreateAndShowDialog failed [Exception : ${mb}] [MediaProvider : ${db}] [DialogLicenseTier : ${yb}]`),this.qI.setException(mb)}}}Object(t.a)(Sa,"OnlinePictureUploaderWrapper",l.a,[2]);var Da=a(55);class ea{constructor(Ca,db){this.$=Ca;this.uploaderCreator=db}executeCommand(Ca,
db,yb){Ca=db.command;switch(Ca){case 1403967063:if(yb&&"dataUrl"in yb)return db=new e.a,this.uploaderCreator&&this.uploaderCreator.Fgi(this.$,f.a.instance,d.AFrameworkApplication.fa,yb,yb.dataUrl,db),db.task;this.uploaderCreator&&this.uploaderCreator.Fhi(this.$,db,f.a.instance,d.AFrameworkApplication.fa,yb);return Da.Task.Ra(!0);case -2053056795:case -2009825598:return Ca=new e.a,new Sa(this.$,db,f.a.instance,d.AFrameworkApplication.fa,yb,Ca),Ca.task;default:return h.a(Ca)}}wc(Ca,db){if(Ca=this.$.isEditMode)switch(db.command){case 1403967063:Ca=
!0;break;case -2053056795:Ca=!0;break;case -2009825598:Ca=!0;break;default:Ca=!1}return Ca}Mc(){return!1}Hc(){return!1}}Object(t.a)(ea,"PictureCommandHandler",null,[221]);var sa=a(37),Ea=a(50);class ba extends b.a{constructor(Ca){super(Ca)}hd(){sa.TaskExtensions.za(Ea.GetServiceTaskFactory.Oa(this.$.da,484,485,1),Ca=>{this.$c([new ea(this.$,Ca.result)])},this.$.la,3)}static ka(Ca){b.a.Ld(90,new ba(Ca))}}Object(t.a)(ba,"PictureCommandHandlerFactory",b.a,[]);a.d(F,"a",function(){return ka});const ka=
()=>{c.a.Fa(Ca=>{ba.ka(Ca)})}},1240:function(t,F,a){var c=a(9);t=a(0);var b=a(226),e=a(15),f=a(511),d=a(38),h=a(4),m=a(60);class l{}l.ygd="GetFontPreviewData";Object(t.a)(l,"FontWebServiceMethods",null,[]);const v=(H,I,R,S,G=null)=>{const D=l.ygd;G=H.Na(5,G);G.locale=h.AFrameworkApplication.uiCulture;return m.g(H,D,G,I,R,S,null,644)};var r=a(11),A=a(1),x=a(42),n=a(113),u=a(29);const z={xlyellow:"xlyellow"};class w extends d.a{constructor(H,I){super();this.$=H;this.jv=I;this.Gua={};this.jO={};this.eve=
!1;this.styles=null;this.cSi=(R,S,G)=>{e.ULS.sendTraceTag(520710152,1,50,`FontServiceManager.onFontPreviewRequestComplete: Attempt to request FontUrl method: ${G} has succeeded.`);this.H7i(R);this.eve=!0;e.ULS.sendTraceTag(512340116,1,50,"FontServiceManager.onFontPreviewRequestComplete: timeFromAppInteractive to fonts download {0} ms",x.PageLoadTrackingInfo.instance.zva(new Date));this.Aaj()};this.dSi=(R,S,G)=>{R=n.a.Pe(R.data);R=u.a.nc(R);e.ULS.sendTraceTag(520710151,1,10,`FontServiceManager.onFontPreviewRequestFailed: Encountered errors: ${R} for method: ${G}`)};
this.xnj=()=>{this.jl&&this.ygd(this.cSi,this.dSi)};this.jl=A.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FontServiceIntegration",!1);this.xnj()}H7i(H){if(this.Svi(H)){var I=r.HelperMethods.ZQ(()=>{const R=H.Result;this.styles=`@font-face{font-family:"msofpNew";font-style:normal;font-weight:normal;src:url('${R.PreviewUrl}') format('truetype')}`;const S=R.FontFacePropertiesList;let G,D,E;R.FontNameList.forEach((M,L)=>{this.Gua[M]=S[L].Codepoint;let N=`https://fs.microsoft.com/fs/${R.CatalogVersion}/rawguids/${S[L].FontGuid}`;
this.styles=this.Tte(this.styles,M,N,S[L].FontWeight);this.jO[M]=S[L].LocalizedFontName;"Segoe UI Semibold"===M&&(G=S[L].FontFamily,D=N,E=S[L].FontWeight)});G&&(this.styles=this.Tte(this.styles,G,D,E));f.a.Ai(this.styles)});10<I&&e.ULS.sendTraceTag(520710159,1,50,`FontServiceManager.prepareFontCodepointMap: Duration for prepareFontCodepointMap the model, duration=${I}`)}}Svi(H){if(!H.Result)return e.ULS.sendTraceTag(520710158,1,15,"FontServiceManager.isValidFontPreviewData: Result in EwaResult is Null."),
!1;H=H.Result;return H?H.PreviewUrl?H.FontFacePropertiesList?H.FontNameList?0===H.FontFacePropertiesList.length||H.FontFacePropertiesList.length!==H.FontNameList.length?(e.ULS.sendTraceTag(520710153,1,15,"FontServiceManager.isValidFontPreviewData: Mismatch in length of FontFacePropertiesList and FontNameList in fontListPreviewData."),!1):!0:(e.ULS.sendTraceTag(520710154,1,15,"FontServiceManager.isValidFontPreviewData: FontNameList in fontListPreviewData is Null."),!1):(e.ULS.sendTraceTag(520710155,
1,15,"FontServiceManager.isValidFontPreviewData: FontFacePropertiesList in fontListPreviewData is Null."),!1):(e.ULS.sendTraceTag(520710156,1,15,"FontServiceManager.isValidFontPreviewData: PreviewUrl in fontListPreviewData is Null."),!1):(e.ULS.sendTraceTag(520710157,1,15,"FontServiceManager.isValidFontPreviewData: fontListPreviewData is Null."),!1)}Tte(H,I,R,S){return H+`@font-face{font-family:"${I}";src:url('${R}');font-weight:${S};}`}ygd(H,I){return v(this.jv,H,I,null,this.jv.Wb())}Aaj(){this.Nhc&&
this.raiseEvent(w.kZe)}get hBc(){return this.jO}get lJh(){return this.Gua}get Nhc(){return this.eve}isFontSupported(H){return this.jl&&this.jO&&(!!this.jO[H]||!!z[H.replace(/\s/g,"").toLowerCase()])}gre(H){this.addHandler(w.kZe,H)}}w.kZe="fsmFD";Object(t.a)(w,"FontServiceManager",d.a,[233]);var C=a(712);class y extends b.a{constructor(H){super();this.$=H;this.Db()}static ka(H){H.da.Ha(505,new y(H))}create(){this.nb(Object(C.a)(this.$.da,504,()=>new w(this.$,this.$.oa.jv)))}}Object(t.a)(y,"FontServiceManagerFactory",
b.a,[]);a.d(F,"a",function(){return B});const B=()=>{c.a.Fa(H=>{y.ka(H)})}},1277:function(t,F,a){t=a(0);var c=a(110),b=a(226),e=a(15),f=a(14),d=a(38),h=a(94),m=a(1),l=a(21),v=a(5);class r extends d.a{constructor(z,w,C){super();this.statusBarManager=null;this.lMe=()=>{this.J7b()};this.Tmh=()=>{this.J7b()};this.kMe=y=>{10===y&&this.J7b()};this.onKeyDown=y=>13===y.Ea.keyCode?(y=new h.a(237279923,1,2,6,null),this.$.Ia.Hb(y,{[v.a.skipClipboardAccess]:!0,[v.a.nQe]:!0}),!0):!1;this.$=z;this.qo=w;this.Cm=
C;this.A$c=!1;(this.N8f=m.EwaSettings.isChangeGateEnabled("OfficeVSO:7568646_PressEnterToPaste"))&&this.$.da.gb(29,y=>{this.statusBarManager=y;y.XI(this)})}dispose(){this.Sj();this.Cm=this.qo=this.$=null;this.statusBarManager&&(this.statusBarManager.wF(this),this.statusBarManager=null)}tn(){return this.N8f}Tr(z,w){if("QueryPasteShortcutEnabledLabel"!==z&&!r.RNj.includes(z))return!1;const C=this.mo();"QueryPasteShortcutEnabledLabel"===z?(w.Visible=C,e.ULS.sendTraceTag(537167636,0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${C} for commandId ${z}`)):
(w.Visible=!C,e.ULS.sendTraceTag(537167635,0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${!C} for commandId ${z}`));return!0}Lrh(){this.Aj();this.raiseEvent("pasteShortcutStatusChanged")}J7b(){this.Sj();this.raiseEvent("pasteShortcutStatusChanged")}mo(){return this.A$c}nq(z){this.addHandler("pasteShortcutStatusChanged",z)}Iq(z){this.removeHandler("pasteShortcutStatusChanged",z)}Aj(){if(!this.mo()){this.A$c=!0;l.h(this.$).li.xl(this.lMe);this.Cm.ka("blur",this.Tmh);const z=this.$.da.Aa(65);
z&&z.zY&&z.zY.registerForCommentEvents(this.kMe);this.qo.ms(f.a.Sb,this.$.eu,this.onKeyDown,!0)}}Sj(){if(this.mo()){this.A$c=!1;l.h(this.$).li.nl(this.lMe);this.Cm.detach("blur");const z=this.$.da.Aa(65);z&&z.zY&&z.zY.unregisterForCommentEvents(this.kMe);this.qo.ys(f.a.Sb,this.$.eu,this.onKeyDown,!0)}}}r.RNj=["QuerySheetNumberButton","QueryWorkbookStatisticsButton"];Object(t.a)(r,"PasteShortcutManager",d.a,[418,282,203,2]);var A=a(132);class x extends b.a{constructor(z){super();this.$=z;this.Db()}create(){const z=
this.$;this.nb(z.da.Aa(478)||this.$.da.Ha(478,new r(z,c.KeyInputManager.instance,A.a.instance.KG())))}static ka(z){z.da.Ha(479,new x(z))}}Object(t.a)(x,"PasteShortcutManagerFactory",b.a,[]);var n=a(9);a.d(F,"a",function(){return u});const u=()=>{n.a.Fa(z=>{x.ka(z)})}},1278:function(t,F,a){var c=a(9);t=a(0);var b=a(110),e=a(226),f=a(132),d=a(7),h=a(15),m=a(4),l=a(1425),v=a(14),r=a(5),A=a(920),x=a(48),n=a(28),u=a(21),z=a(1),w=a(41),C=a(65),y=a(345),B=a(37),H=a(50),I=a(33);class R{constructor(D,E,M,
L){this.recoveryUI=null;this.bgg=(N="Paste")=>{var Y=C.d(this.$.va.na);Y=new y.a(this.pasteRange,Y);this.NCc(Y,N)};this.fkg=()=>{this.recoveryUI&&(this.e2d=n.a.Ya.ue.m,this.hide(),x.a.instance.create(()=>{this.T0j()},250,"RecoveryUI.UpdatePositionOnVisibleAreaChanged",void 0,!0))};this.yMe=N=>{10===N&&this.Jta()};this.jnh=()=>{if(this.recoveryUI){const N=document.getElementById("PasteRecoveryUI");N&&r.a.Uj===N.getAttribute(r.a.sT)&&N.click();this.documentHidden=!0;this.Jta()}};this.zMe=()=>{this.Jta()};
this.AMe=()=>{this.Jta()};this.onKeyUp=N=>{if(this.recoveryUI){if(this.$Z)return!1;if(17===N.Ea.keyCode&&this.i$b){N=document.getElementById("PasteRecoveryUI");if(!N)return h.ULS.shipAssertTag(537154070,0,!1,"RecoveryUIController.OnKeyUp: recoveryUIElement is null."),!1;const Y=N.getAttribute(r.a.sT)||"";if(r.a.pq===Y)return N.click(),!0}}return!1};this.onKeyDown=N=>{if(this.recoveryUI){this.i$b=!1;this.$Z=N.ctrlKey;N=N.Ea.keyCode;if(27===N)return this.Jta(),z.EwaSettings.isChangeGateEnabled("OfficeVSO:6022397_ClearStateWhileHidingRecoveryUI")&&
(N=this.$.da.Aa(254))&&N.cr("RecoveryUIController.onKeyDown",!0,!0).catch(()=>{}),!0;if(17===N)return this.i$b=!0}return!1};this.aR=(N,Y)=>{this.ECb=N=Y.Sd;if(z.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",!1)){switch(N.command){case -1027730316:case -1059615499:if(Y.properties&&Y.properties.launcherId===this.m4e())return;break;case -847286761:if(Y.properties&&(13===Y.properties.CalloutName||18===Y.properties.CalloutName))return}this.Jta()}else-1027730316!==
N.command&&-1059615499!==N.command?this.Jta():(Y=Y.properties)&&Y.launcherId!==this.m4e()&&this.Jta()};this.$=D;this.htc=E;this.qo=M;this.Cm=L;this.Pkc=this.ECb=this.Jud=null;this.$Z=this.i$b=this.O7b=this.Tec=!1;this.e2d=0;this.documentHidden=!1;this.grid=u.h(this.$);this.pasteRange=null;z.EwaSettings.cl()||this.$.da.Ha(406,this)}dispose(){this.Xhg();this.dig();this.Pkc=this.Jud=this.recoveryUI=this.Cm=this.qo=this.htc=this.$=null;this.e2d=0}OVg(D){this.recoveryUI=D;this.Jud=D.CPg;this.Pkc=D.bej}Jta(){this.recoveryUI&&
(this.pasteRange=w.K(this.recoveryUI.uWe),this.DLj(),this.hide(),this.Xhg(),this.recoveryUI=null)}DLj(){const D=[1868184698,-1985798686,753331043,2137617149,237279923,1804571062,1766348718,42074747,-875588320,-958589048,-185374993,-111689794,-1502853784,-1096627081,1441131127,-1027730316,-847286761];m.AFrameworkApplication.Sp("XLS-SmartView-OnPasteEnabled-Control;XLS-SmartView-OnPasteEnabled-Treatment");z.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.OnPasteEnabled",!1)&&this.pasteRange&&
(h.ULS.sendTraceTag(523622037,0,50,"RecoveryUIController:smartViewOnPaste RecoveryUI is being dismissed."),null!=this.ECb&&D.includes(this.ECb.command)?(h.ULS.sendTraceTag(526758984,306,50,`RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. Last command was ${A.a[this.ECb.command]}`),this.ECb=null):z.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.PasteCoOccurrence",!1)?h.ULS.sendTraceTag(509723927,306,50,"RecoveryUIController:smartViewOnPaste Format as table prompt already triggered with the paste recovery UI."):
this.documentHidden?(h.ULS.sendTraceTag(523833603,306,50,"RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. User clicked outside of document."),this.documentHidden=!1):this.i$a(()=>{this.bgg("Paste")}))}Nwa(){return this.grid.Ca.HQ(4,this.$.na)}i$a(D){if(this.Nwa())D();else{h.ULS.sendTraceTag(520725721,306,50,"RecoveryUIController:smartViewOnPaste Grid is not in consistent state.");const E=()=>{this.Nwa()&&(D(),this.grid.Cuc(E))};this.grid.y_b(E)}}Ksi(){return!!this.recoveryUI&&
this.htc.Goi}EJj(D){m.AFrameworkApplication.Sp("XLS-SmartView-PasteCoOccurrence-Treatment;XLS-SmartView-PasteCoOccurrence-Control");I.a.nui()&&(this.pasteRange=w.K(this.recoveryUI.uWe),this.i$a(()=>{this.bgg("PasteCoOccurrence")}));this.recoveryUI?this.show(D):h.ULS.shipAssertTag(537154072,0,!1,"RecoveryUIController.ShowRecoveryUI: recoveryUI is null.")}m4e(){return this.recoveryUI?this.recoveryUI.Yyi:null}show(D){const E=this.recoveryUI.xTh();E?(this.htc.showFloatie(Object(d.a)(new l.a,{x:E.x,y:E.y}),
this.recoveryUI.pKa(),D),this.Aj()):h.ULS.sendTraceTag(537154071,0,100,"RecoveryUIController.Show: point is null.")}hide(){this.Ksi()&&this.htc.DC();this.dig()}Aj(){if(!this.O7b){var D=u.h(this.$);D.view.Ps(this.fkg);D.li.xl(this.zMe);this.Cm.ka("blur",this.jnh);this.$.Ia.WFa(this.aR);this.$.va.Vf(this.AMe);(D=this.$.da.Aa(65))&&D.zY&&D.zY.registerForCommentEvents(this.yMe);this.O7b=!0}this.Tec||(this.qo.ms(v.a.Sb,this.$.domElement,this.onKeyDown,!0),this.qo.ms(v.a.Kd,this.$.domElement,this.onKeyUp,
!0),this.Tec=!0)}Xhg(){if(this.O7b){var D=u.h(this.$);D.view.Jq(this.fkg);D.li.nl(this.zMe);this.Cm.detach("blur");this.$.Ia.Tza(this.aR);this.$.va.sg(this.AMe);(D=this.$.da.Aa(65))&&D.zY&&D.zY.unregisterForCommentEvents(this.yMe);this.O7b=!1}}dig(){this.Tec&&(this.qo.ys(v.a.Sb,this.$.domElement,this.onKeyDown,!0),this.qo.ys(v.a.Kd,this.$.domElement,this.onKeyUp,!0),this.Tec=this.$Z=this.i$b=!1)}T0j(){this.recoveryUI&&250<=n.a.Ya.ue.m-this.e2d&&this.show(-1)}NCc(D,E){B.TaskExtensions.za(H.GetServiceTaskFactory.Oa(this.$.da,
426,427,1),M=>{void M.result.sea(D,E);h.ULS.sendTraceTag(523622036,0,50,"RecoveryUIController.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},this.$.la,3)}}Object(t.a)(R,"RecoveryUIController",null,[238,2]);class S extends e.a{constructor(D){super();this.$=D;this.Db()}create(){if(z.EwaSettings.cl())this.vKi();else{const D=this.$;D.Sx(E=>{E.Pfc().then(M=>{this.nb(this.$.da.Aa(406)||new R(D,M,b.KeyInputManager.instance,f.a.instance.KG()))})})}}vKi(){const D=this.$;
let E=this.$.da.Aa(406);E?this.nb(E):D.Sx(M=>{M.Pfc().then(L=>{E=new R(D,L,b.KeyInputManager.instance,f.a.instance.KG());this.$.da.Ha(406,E);this.nb(E)})})}static ka(D){D.da.Ha(405,new S(D))}}Object(t.a)(S,"RecoveryUIControllerFactory",e.a,[]);a.d(F,"a",function(){return G});const G=()=>{c.a.Fa(D=>{S.ka(D)})}},1319:function(t,F,a){t=a(0);var c=a(15),b=a(256);class e{constructor(h,m){this.testName=null;this.startTimeMs=0;this.isSuccess=!1;this.caller=this.errorStatusCode=this.errorMessage=null;this.reqTotalDurationMs=
0;this.browserResourceTiming=null;this.testIteration=0;this.testName=h;this.caller=m;this.reset()}reset(){this.isSuccess=!1;this.startTimeMs=-1;this.errorStatusCode=this.errorMessage="";this.reqTotalDurationMs=-1;this.browserResourceTiming=null}}Object(t.a)(e,"NetworkTestResult",null,[]);var f=a(581);a.d(F,"a",function(){return d});class d{constructor(h,m,l,v,r){this.url="";this.V5a=!1;this.w7=-1;this.testIteration=0;this.baseUrl=l;this.bBf=v;this.mmd=m;this.result=new e(m,r)}runTest(){try{if(this.V5a)return c.ULS.sendTraceTag(537155206,
0,50,`NetworkTestReq.RunTest: a test for the host ${this.mmd} is already mid way, not starting a new one.`),!1;this.reset();this.V5a=!0;this.result.startTimeMs=Date.now();const h=new b.QueryStringBuilder(this.baseUrl);h.p9("tid",this.result.startTimeMs.toString());this.url=h.toString();this.Cuj();this.testIteration++;this.result.testIteration=this.testIteration;return!0}catch(h){return this.fvb("Exeption: "+h.message),!1}}reset(){this.url="";this.result.reset();this.V5a=!1;this.w7=-1}clearTimeout(){-1!==
this.w7&&(window.clearTimeout(this.w7),this.w7=-1)}Cuj(){try{const h=new XMLHttpRequest;h.onreadystatechange=()=>{4===h.readyState&&(200===h.status?this.BHh():this.fvb(`Error when downloading resource. status code: ${h.status}, status text: ${h.statusText}`,h.status.toString()))};h.onerror=()=>{this.fvb(`Client error when attempting to download resource. status code: ${h.status}, response: ${h.statusText}`)};this.w7=window.setTimeout(()=>{this.w7=-1;this.fvb("Request timeout")},1E4);h.open("GET",
this.url,!0);h.send(null)}catch(h){this.fvb("Exeption: "+h.message)}}BHh(){this.V5a&&(this.result.reqTotalDurationMs=Date.now()-this.result.startTimeMs,this.clearTimeout(),this.result.browserResourceTiming=f.a(this.url),this.result.isSuccess=!0,this.u4b())}fvb(h,m=null){this.V5a&&(this.clearTimeout(),this.result.errorMessage=h,this.result.isSuccess=!1,this.result.errorStatusCode=m,this.u4b())}u4b(){this.V5a=!1;this.bBf&&this.bBf(this.result,this.mmd)}}Object(t.a)(d,"NetworkTestReq",null,[])},1387:function(t,
F,a){t=a(0);var c=a(15),b=a(85);a(109);var e=a(27);class f{constructor(A,x,n){this.Gj=this.HEd=null;this.ZEa=this.Y8=0;this.CTb=null;this.uS=A;this.he=x;this.mb=n;this.N1a=!1;this.Z0d=!0;this.moj();this.E9a=this.fa.pa("NativeFileOpenDialogIsEnabled")}get context(){return this.uS}get fa(){return this.mb}get retryCount(){return this.Y8}get AOd(){return this.ZEa}PGb(A){this.Gj=A;if(!this.N1a){if(this.Z0d){if(this.E9a&&e.a.gF){this.CTb=A.c8b(Object(b.a)(this,this.VCd,"onFileChosen"));return}this.CTb=
A.c8b(null);if(!this.cCa(this.CTb,A))return}this.finalizeUpload(A,null)}}VCd(A){if(this.cCa(A,this.Gj)){if(e.a.gF||e.a.Cf)this.CTb=A;this.finalizeUpload(this.Gj,null)}}zqc(){this.HEd&&this.HEd()}moj(){this.Y8=0;this.ZEa=this.fa.vd("Box4UploadRetryDelayStart",200);this.Gj&&(this.Gj.dispose(),this.Gj=null)}}Object(t.a)(f,"FileUploader",null,[]);var d=a(4),h=a(321),m=a(794),l=a(136),v=a(30);a.d(F,"a",function(){return r});class r extends f{constructor(A,x,n){super(A,x,n);this.oWb=this.wra=null}get iO(){return d.AFrameworkApplication.ra.ED}z2e(A){switch(A){case 1:return CommonUIStrings.l_ImageUploadNoFileSpecified;
case 2:return CommonUIStrings.l_ImageUploadUnsupportedFileType;default:return""}}Vlg(A){return r.cCa(A,this.e6h())}e6h(){return r.ome}cCa(A,x=null){A=this.Vlg(A);return 0!==A?(x&&x.xoe(),2===A&&this.kj(0,this.z2e(A)),!1):!0}finalizeUpload(A,x){c.ULS.sendTraceTag(36783360,322,50,"PictureUploader.FinalizeUpload");this.HEd=x;this.QIj();h.a.mark(5576);this.oWb=this.iO.Gc("LoadResource","PictureUploadTime")}kj(A,x){const n=new l.StandardDialog;n.Ob=0;n.Kz(A,CommonUIStrings.l_ImageUploadFailedTitle,x,null)}zqc(){c.ULS.sendTraceTag(36783361,
322,50,"PictureUploader.OnUploadComplete");super.zqc();this.oWb&&(this.oWb.stop(),this.oWb=null);this.P5g()}QIj(){this.wra=(new m.a).create();this.wra.message=CommonUIStrings.l_ImageUploadWait;this.wra.Ob=5;this.wra.pt=!1;this.wra.WAa(null,null,null)}P5g(){this.wra&&(this.wra.close(),this.wra=null)}static vbi(A,x){A=v.a.Yk(A);for(let n=0;n<x.length;++n)if(A.endsWith(x[n]))return!0;return!1}static cCa(A,x=null){x||(x=r.ome);return A?r.vbi(A,x)?0:2:1}}r.ome=".jpg .jpeg .png .gif .bmp .tif .tiff".split(" ");
Object(t.a)(r,"PictureUploader",f,[])},1460:function(t,F,a){a.r(F);var c=a(1178),b=a(0),e=a(15),f=a(4),d=a(121),h=a(400);class m extends h.a{constructor(Eb){super(Eb)}get m5b(){return!1}createElement(){const Eb=document.createElement("link");Eb.setAttribute("rel","stylesheet");Eb.setAttribute("type","text/css");Eb.setAttribute("href",this.Ft);return Eb}N5c(){return null}Xtc(){this.element.setAttribute("href","");this.element.setAttribute("href",this.Fz.Ft)}}Object(b.a)(m,"CssResource",h.a,[]);var l=
a(378),v=a(231),r=a(30),A=a(55);class x{constructor(){this.uWb=this.GTb=null}gAi(){this.GTb||(e.ULS.sendTraceTag(21030598,324,50,"InProductMessagingDependenciesLoad usage"),this.GTb=A.Task.WAA(x.lAi(),x.cAi()),this.GTb.continueWith(Eb=>{e.ULS.sendTraceTag(21030599,324,10,"{0}",r.a.ggd(Eb.exception))},5));return this.GTb}iAi(){if(!this.uWb)try{e.ULS.sendTraceTag(39978390,324,50,"InProductMessagingFreemiumDependenciesLoad usage"),this.uWb=A.Task.WAA(x.f$c(v.a.create(f.AFrameworkApplication.fa.Wa("DimeUrl"),
null,null))),this.uWb.continueWith(Eb=>{e.ULS.sendTraceTag(39978391,324,10,"{0}",r.a.ggd(Eb.exception))},5)}catch(Eb){e.ULS.sendTraceTag(594874951,324,10,"{0}",r.a.ggd(Eb))}return this.uWb}static lAi(){var Eb=x.xdc("inproductmessaging.js");Eb=v.a.create(Eb,null,null);return x.f$c(Eb)}static cAi(){var Eb=x.xdc("inproductmessaging.css");Eb=new m(Eb);return x.f$c(Eb)}static xdc(Eb){return d.a.r4b(String.format("ipm/{0}",Eb))}static f$c(Eb){l.a.uia(Eb);return Eb.Q8a}}Object(b.a)(x,"DependencyDownloader",
null,[727]);class n{}n.C2i="inProductMessagingOverlayDiv";n.x5i="PlayButtonImage";n.lmj="ReplayButtonImage";Object(b.a)(n,"Constants",null,[]);class u{constructor(){this.cke=this.Bee=this.c5d=!0;this.mmj=this.y5i=null;this.xJi=!1;this.locale=null;this.thg={}}get Dwe(){return this.c5d}set Dwe(Eb){this.c5d=Eb}get cwf(){return this.Bee}set cwf(Eb){this.Bee=Eb}get R9f(){return this.cke}set R9f(Eb){(this.cke=Eb)&&this.iAj()}iAj(){this.Rpe(n.x5i,this.y5i);this.Rpe(n.lmj,this.mmj)}Rpe(Eb,Ac){Ac&&(this.thg[Eb]=
Ac)}}Object(b.a)(u,"FirstRunExperienceUISettings",null,[726]);class z{constructor(){this.completed=this.Vgj=!1}}Object(b.a)(z,"FirstRunExperienceViewData",null,[725]);var w=a(85),C=a(178),y=a(108),B=a(25);class H{constructor(Eb,Ac,ld){this.Ma=Eb;this.Ze=Ac;this.mUb=ld}Ag(){this.Ma.Ne(B.a.ZHh,y.a.frame,Object(w.a)(this,this.XHh,"firstRunExperienceHandler"),64);this.Ma.Nb(B.a.sYe,y.a.frame,Object(w.a)(this,this.nei,"inProductMessagingTabHandler"));this.Ma.Nb(B.a.rYe,y.a.frame,Object(w.a)(this,this.mei,
"inProductMessagingShiftTabHandler"));this.Ma.Nb(B.a.Gmh,y.a.frame,Object(w.a)(this,this.Hmh,"dimeLaunchHandler"));this.Ma.Nb(B.a.VXf,y.a.frame,C.ActionManager.gg);this.Ma.Nb(B.a.Kmj,y.a.frame,C.ActionManager.gg);this.Ma.Nb(B.a.Lmj,y.a.frame,C.ActionManager.gg);this.Ze&&this.Ze.updateCommandUI()}XHh(Eb,Ac,ld,Vd,Od){2===ld&&this.mUb.Fyi(Od);return 32}Hmh(Eb,Ac,ld,Vd,Od){2===ld&&this.mUb.Cyi(Od);return 32}nei(Eb,Ac,ld){return 2===ld?this.mUb.Izd():32}mei(Eb,Ac,ld){return 2===ld?this.mUb.Gzd():32}}Object(b.a)(H,
"InProductMessagingActor",null,[]);var I=a(84);class R{constructor(){this.rUf=this.wZf=this.Cdg=this.elc=this.instance=null}}Object(b.a)(R,"DimeExperienceUISettings",null,[]);var S=a(146),G=a(466);class D{constructor(Eb,Ac,ld,Vd,Od){this.Jac=!1;this.xtb=null;this.Ma=Eb;this.rFa=Ac;this.YWb=ld;this.X0=Vd;this.fHc=Od}ehi(Eb){S.b("getHeaderApi")?Eb.isFeatureEnabled("MsoPremiumBadge",!0).then(Ac=>{const ld=Eb.isFreemiumUpsellEnabled();ld&&(appChrome.getHeaderApi().then(Vd=>{Vd.updatePremiumStatus(Ac,
ld);return null}),Eb.Mza("MsoPremiumBadge",Vd=>{appChrome.getHeaderApi().then(Od=>{Od.updatePremiumStatus(Vd.isEnabled,ld);return null})}));return null}):e.ULS.sendTraceTag(593859840,324,10,"getHeaderApi not available")}Fyi(Eb){this.YWb.gAi().continueWith(()=>{this.rFa.dKj(Eb)})}Cyi(Eb){let Ac="gopremium",ld=null,Vd=()=>{};Eb?(Eb.experience&&""!==Object(I.a)(String,Eb.experience)&&(Ac=Object(I.a)(String,Eb.experience)),Eb.onTaskComplete&&(Vd=Eb.onTaskComplete),Eb.campaignId&&""!==Object(I.a)(String,
Eb.campaignId)&&(ld=Object(I.a)(String,Eb.campaignId))):e.ULS.sendTraceTag(51675402,324,50,"Experience not given, using default experience");this.Kpf(Ac,Vd,ld)}Kpf(Eb,Ac,ld=null){if(this.Jac&&this.xtb){const Vd={};Vd.experience=Eb||"gopremium";Vd.campaignId=ld||G.b(this.X0,this.fHc,Object(I.a)(String,Vd.experience),!0);this.Ma.processAction(B.a.VXf,2);e.ULS.sendTraceTag(51675403,324,50,"Launching Freemium Upsell dialog: "+Vd.experience);try{const Od=Object.assign(new R,{instance:this.xtb,elc:Vd,Cdg:Ac||
(()=>{}),wZf:he=>{e.ULS.sendTraceTag(51675405,324,50,"Dime launch result: "+he.status)},rUf:()=>{e.ULS.sendTraceTag(51675406,324,10,"Dime launch error");this.Jac=!1;this.xtb=null}});this.rFa.tIj(Od)}catch(Od){e.ULS.sendTraceTag(51675407,324,10,"Dime launch error: "+Od.message),this.Jac=!1,this.xtb=null,this.Ma.Wd(B.a.Kac,2,{["experience"]:Vd.experience})}}else e.ULS.sendTraceTag(39978392,324,10,"FreemiumUpsellDialogDependencies not loaded"),this.Ma.Wd(B.a.Kac,2,{["experience"]:Eb})}Bqf(){this.YWb.iAi().continueWith(()=>
{try{var Eb=r.a.Yk(f.AFrameworkApplication.uiCulture);const Vd=G.c(this.X0);if(Vd){var Ac={};Ac.partnerId=Vd;Ac.language=Eb;Ac.sessionId=f.AFrameworkApplication.userSessionId;Ac.authHint=f.AFrameworkApplication.fa.Wa("UserPrincipalName");var ld=f.AFrameworkApplication.fa.Wa("Puid")||"";""!==ld&&(Eb={},Eb.puid=ld,Ac.userInfo=Eb);this.xtb=new Dime(Ac);this.Jac=!0;e.ULS.sendTraceTag(592721856,324,50,"Dime initialized")}else e.ULS.sendTraceTag(51675409,324,15,"App not supported")}catch(Vd){e.ULS.sendTraceTag(51675410,
324,10,"FreemiumUpsellDialogDependencies failed: "+Vd.message)}},3)}Izd(){return this.rFa.Izd()}Gzd(){return this.rFa.Gzd()}}Object(b.a)(D,"InProductMessagingUIManager",null,[724]);class E{constructor(){this.Ele=0;this.OWa=Array(5);this.OWa[0]=10;this.OWa[1]=15;this.OWa[2]=50;this.OWa[3]=100;this.OWa[4]=200}Init(Eb){this.Ele=Eb}SendTrace(Eb,Ac){e.ULS.sendTraceTag(34182235,this.Ele,this.OWa[Eb],"{0}",Ac)}}Object(b.a)(E,"DefaultNetworkingManager",null,[743]);var M=a(265),L=a(317),N=a(97);class Y{constructor(Eb){this.Zb=
Eb}dKj(Eb){Eb&&(InProductMessaging.Networking.NetworkingMgr=new E,InProductMessaging.Networking.NetworkingMgr.Init(387),InProductMessaging.Init(Eb.R9f,Eb.cwf,Eb.Dwe,Eb.xJi,Eb.locale,Object(w.a)(this,this.IQi,"onDismissFirstRunExperience"),Eb.thg),this.WRa(n.C2i,!0))}tIj(Eb){if(Eb&&Eb.instance&&Eb.elc){let Ac=document.getElementById("wacDimeContainer");Ac||(Ac=document.createElement("div"),Ac.id="wacDimeContainer",document.body.appendChild(Ac));f.AFrameworkApplication.fa.pa("DimeFocusManagerIsEnabled")&&
this.WRa("wacDimeContainer",!1);Eb.elc.parentElementId="wacDimeContainer";Eb.instance.launch(Eb.elc,Eb.Cdg).then(ld=>{this.rJb();document.body.removeChild(Ac);Eb.wZf(ld)}).catch(ld=>{this.rJb();document.body.removeChild(Ac);Eb.rUf(ld)})}else throw Error.argument("DimeExperienceUISettings");}WRa(Eb,Ac){if(this.Zb&&Eb&&(Eb=document.getElementById(Eb),this.Xgi(Eb),Eb=this.Zb.FM("InProductMessagingFocusId"))){const ld=this.Zb.Sh;ld&&"InProductMessagingFocusId"===ld.name||this.Zb.lR("InProductMessagingFocusId",
!1);Ac&&this.uSf(Eb.scope)}}Xgi(Eb){var Ac=this.Zb.ni("InProductMessagingFocusId");Ac.parent=M.AFrame.qT;const ld=new L.DOMFocusListing(()=>Eb);ld.Wbb=!1;ld.Zn(3);ld.Zn(2);ld.Zn(4);Ac=this.Zb.tsa(()=>Eb,Ac,ld);Ac.kJb();Ac.d_=!0;Ac.LHa=!0}uSf(Eb){Eb.yk(N.FocusManager.instance().K1);Eb.yk(N.FocusManager.instance().L1);Eb.bindAction(N.FocusManager.instance().K1,B.a.sYe);Eb.bindAction(N.FocusManager.instance().L1,B.a.rYe)}rJb(){this.Zb&&(this.Zb.Tca("InProductMessagingFocusId"),this.Zb.AQa("InProductMessagingFocusId"))}IQi(Eb,
Ac){this.rJb();Eb=Object.assign(new z,{completed:Eb,Vgj:Ac});f.AFrameworkApplication.rb.Wd(B.a.WHh,2,Eb)}Izd(){const Eb=document.activeElement,Ac=this.Zb.gQ();return Eb&&Ac&&Ac.ef&&Eb===Ac.ef.vw?(Ac.ef.Fl(Eb),Ac.fya()?32:8):4}Gzd(){const Eb=document.activeElement,Ac=this.Zb.gQ();return Eb&&Ac&&Ac.ef&&Eb===Ac.ef.firstElement?(Ac.ef.Fl(Eb),Ac.uOa()?32:8):4}}Object(b.a)(Y,"InProductMessagingUIWrapper",null,[722]);var U=a(137),P=a(252),aa=a(27);class X{constructor(){this.$a=null}get name(){return"Common.App.InProductMessaging"}Ah(Eb){Eb.register(x,
"Common.App.InProductMessaging.DependencyDownloader").as("Common.App.InProductMessaging.IDependencyDownloader").qc().yc(()=>new x);Eb.register(Y,"Common.App.InProductMessaging.InProductMessagingUIWrapper").as("Common.IInProductMessagingUIWrapper").qc().yc(()=>new Y(N.FocusManager.instance()));Eb.register(D,"Common.App.InProductMessaging.InProductMessagingUIManager").as("Common.IInProductMessagingUIManager").qc().yc(()=>new D(f.AFrameworkApplication.rb,Eb.resolve("Common.IInProductMessagingUIWrapper"),
Eb.resolve("Common.App.InProductMessaging.IDependencyDownloader"),f.AFrameworkApplication.ra.Qa.Oj,f.AFrameworkApplication.ra.Qa.pca));Eb.register(H,"Common.App.InProductMessaging.InProductMessagingActor").qc().yc(()=>new H(f.AFrameworkApplication.rb,f.AFrameworkApplication.ra,Eb.resolve("Common.IInProductMessagingUIManager")));Eb.register(u,"Common.App.InProductMessaging.FirstRunExperienceUISettings").as("Common.IFirstRunExperienceUISettings").qc().yc(()=>new u);Eb.register(z,"Common.App.InProductMessaging.FirstRunExperienceViewData").as("Common.IFirstRunExperienceViewData").qc().yc(()=>
new z);this.$a=Eb}init(){this.$a.resolve("Common.App.InProductMessaging.InProductMessagingActor").Ag();f.AFrameworkApplication.fa.ru(()=>{f.AFrameworkApplication.ra.Qa.gs&&U.a.get_instance().Lj(15,()=>{this.$a.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(Eb=>{this.$a.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").ehi(Eb)})});f.AFrameworkApplication.fa.pa("FreemiumUpsellShowDialogIsEnabled")&&G.a()&&!aa.a.Kka&&1!==f.AFrameworkApplication.ra.Qa.Oj&&
this.$a.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(Eb=>{Eb.isFeatureEnabled("MsoPremiumBadge",!0).then(Ac=>{!Ac&&Eb.isFreemiumUpsellEnabled()&&this.$a.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").Bqf();return null})})})}dispose(){}static main(){P.a.instance.gi(new X)}}Object(b.a)(X,"InProductMessagingPackage",null,[4,5]);var Z=a(191),da=a(39);class qa{constructor(Eb,Ac,ld,Vd=null,Od=null){this.Ov=Eb;this.RDa=Ac;this.qjb=ld;this.Yge=Vd;this.Blb=
Od}b$b(Eb){const Ac=new Sys.StringBuilder(this.Ov.OKb);Ac.append("RoamingServiceHandler.ashx?action=");Ac.append("getFirstRunExperienceSettings");Ac.append("&");Ac.append(this.did(Eb));Ac.append("&");Ac.append(f.AFrameworkApplication.ti);f.AFrameworkApplication.Bd.Im(Ac.toString(),1,null,null,!0,2,Object(w.a)(this,this.X3,"getRequestSuccessCallback"),Object(w.a)(this,this.GM,"getRequestFailureCallback"),null)}W2a(Eb){var Ac=new Sys.StringBuilder(this.Ov.OKb);Ac.append("RoamingServiceHandler.ashx?action=");
Ac.append("saveFirstRunExperienceSettings");Ac.append("&");Ac.append(f.AFrameworkApplication.ti);Ac=Ac.toString();Eb=da.c(Eb);f.AFrameworkApplication.Bd.Im(Ac,2,Eb,null,!0,4,Object(w.a)(this,this.a7i,"postRequestSuccessCallback"),Object(w.a)(this,this.EN,"postRequestFailureCallback"),null)}X3(Eb){let Ac=!1,ld=null;try{if(0<Eb.data.de.length){const Vd=Object(I.a)(Object,da.a(Eb.data.de)),Od=Vd?Vd[this.Ov.EYc]:null;Od&&(ld=Object(I.a)(Object,da.a(Od.toString())))}Ac=!0}catch(Vd){this.GM(null)}Ac&&this.RDa&&
this.RDa(Eb.data,ld)}GM(Eb){this.qjb&&this.qjb(Eb?Eb.data:null)}a7i(Eb){this.Yge&&this.Yge(Eb?Eb.data:null)}EN(Eb){this.Blb&&this.Blb(Eb?Eb.data:null)}did(Eb){const Ac=new Sys.StringBuilder("requestedsettings=");for(let ld=0;ld<Eb.count;ld++)Ac.append(Eb.ma(ld)),ld<Eb.count-1&&Ac.append(";");return Ac.toString()}}Object(b.a)(qa,"FirstRunExperienceRequestHandler",null,[]);var O=a(234),ca=a(83);class wa{constructor(){this.gjb=this.HTb=this.Ov=null}GUd(Eb){Eb?(this.Ov=Eb,this.Mqi()&&(e.ULS.sendTraceTag(51675532,
306,50,"Initiating call to get FRE data for current user from Roaming Settings Service"),Eb=new Z.a,Eb.add(this.Ov.EYc),this.HTb=new qa(this.Ov,Object(w.a)(this,this.X3,"getRequestSuccessCallback"),Object(w.a)(this,this.GM,"getRequestFailureCallback"),null,Object(w.a)(this,this.EN,"postRequestFailureCallback")),this.HTb.b$b(Eb)),(this.Ov.U7a||f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUITest",!1))&&this.HUd()):e.ULS.sendTraceTag(51675531,306,
10,"Invalid launcherSettings")}Mqi(){try{if(this.Ov.U7a)return!0;if(!f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceEnabled",!0)||f.AFrameworkApplication.fa.pa("IsAnonymousUser"))return!1;if(this.Ov.wni||this.Ov.X7a||f.AFrameworkApplication.fa.pa("IsO365ConsumerHost"))return!0;const Eb=f.AFrameworkApplication.fa.Wa("FlightId");return-1!==(Eb?Eb.toString().toLowerCase():"").indexOf("firstrunexperienceui")}catch(Eb){e.ULS.sendTraceTag(576582624,306,
10,"Error checking setting {0}",Eb?Eb.toString():null)}return!1}I0f(Eb){const Ac={},ld={};ld.FREDisplayedDate=(new Date).toUTCString();ld.VersionDisplayed=Eb;ld.RemindMeLater=!1;Ac[this.Ov.EYc]=da.c(ld);e.ULS.sendTraceTag(51675533,306,50,"Initiating call to save FRE data for current user from Roaming Settings Service");this.HTb&&this.HTb.W2a(Ac)}X3(Eb,Ac){Eb=Eb?+Eb.R2-+Eb.aF:-1;Eb>this.Ov.v_f?e.ULS.sendTraceTag(51675534,306,50,"Call to Roaming Settings Service took {0}ms. This is more than the {1}ms threshold. A new attempt will be made next time the user starts a new session.",
Eb,this.Ov.v_f):Ac?this.gHj(Ac)?(e.ULS.sendTraceTag(51675536,306,50,"FRE data already exists for current user. FRE UI should be displayed again. User selected 'Remind me later' option more than {0} hours ago.",this.Ov.Wvf),this.HUd()):(this.F8c(!1),e.ULS.sendTraceTag(51675537,306,100,"Current user has already seen this version of the FRE. No further action required.")):(e.ULS.sendTraceTag(51675535,306,50,"No FRE data found for current user. FRE UI should be displayed."),this.HUd())}GM(Eb){this.F8c(!1);
e.ULS.sendTraceTag(51675541,306,10,"First Run Experience failed to GET data from Roaming Settings Service with status: {0}",Eb?Eb.httpStatus:-1)}EN(Eb){e.ULS.sendTraceTag(51675542,306,10,"First Run Experience failed to POST data to Roaming Settings Service with status: {0}",Eb?Eb.httpStatus:-1)}HUd(){this.F8c(!0);var Eb=ca.a.instance.mg("Common.ISystemInitiatedFeedback");Eb?this.F9f(Eb):(e.ULS.sendTraceTag(51675543,306,50,"Error resolving ISystemInitiatedFeedback"),f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUIResolveFuture",
!0)&&((Eb=ca.a.instance.Tb("Common.ISystemInitiatedFeedback"))?Eb.execute(Ac=>{this.F9f(Ac)}):e.ULS.sendTraceTag(539494111,306,50,"Error resolving ISystemInitiatedFeedback Future")))}F9f(Eb){if(Eb){var Ac=this.Ov.kIh;Ac&&(f.AFrameworkApplication.Ixa(Ac),f.AFrameworkApplication.Sp(Ac));e.ULS.sendTraceTag(51675544,306,50,"Attempting to display First Run Experience UI using floodgate.",Ac);Eb.logActivity("ShowFirstRunExperienceUIV2",null);window.addEventListener?(this.gjb=Object(w.a)(this,this.KRi,"onFirstRunExperienceCampaignEvent"),
window.addEventListener("FGWebSurfaceEvent",this.gjb,!0),window.addEventListener("FRELaunchedEvent",this.gjb,!0)):(e.ULS.sendTraceTag(51675545,306,50,"FRE V2 UI triggered. Attempting to save FRE data."),this.I0f(this.Ov.currentVersion))}else e.ULS.sendTraceTag(539494112,306,50,"Invalid ISystemInitiatedFeedback")}KRi(Eb){if(Eb){var Ac=Eb.detail;Eb=Eb.type;var ld=this.Ov&&this.Ov.campaignId?this.Ov.campaignId.split("-")[0]:null;if("FRELaunchedEvent"===Eb||ld&&Ac&&Ac.id&&-1!==Ac.id.indexOf(ld))Ac.success&&
(e.ULS.sendTraceTag(51675546,306,50,"FRE V2 UI has been launched. Attempting to save FRE data."),this.I0f(this.Ov.currentVersion)),window.removeEventListener&&(window.removeEventListener("FGWebSurfaceEvent",this.gjb,!0),window.removeEventListener("FRELaunchedEvent",this.gjb,!0))}}gHj(Eb){if("RemindMeLater"in Eb&&"FREDisplayedDate"in Eb){if("true"===Eb.RemindMeLater.toString()&&(+new Date-+new Date(Eb.FREDisplayedDate.toString()))/36E5>this.Ov.Wvf)return!0}else if(f.AFrameworkApplication.fa.pa("WacShowVersionBasedFREToAllUsers")&&
"VersionDisplayed"in Eb&&Eb.VersionDisplayed<this.Ov.currentVersion)return e.ULS.sendTraceTag(528262853,306,50,"Current version is higher so FRE V2 UI should be displayed again."),!0;return!1}F8c(Eb){f.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DispatchFREDecisionEvent")&&O.a.dispatch("FREDecisionEvent",{["show"]:Eb})}}Object(b.a)(wa,"FirstRunExperienceLauncher",null,[703]);class ia{constructor(){this.$a=null}get name(){return"Common.App.FirstRunExperienceLauncher"}Ah(Eb){this.$a=
Eb;this.$a.register(703,"Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher").qc().yc(()=>new wa)}init(){}dispose(){}static main(){P.a.instance.gi(new ia)}}Object(b.a)(ia,"FirstRunExperienceLauncherPackage",null,[4,5]);var Ha=a(1134),Sa=a(1135),Da=a(1162),ea=a(1277),sa=a(9),Ea=a(226);class ba{constructor(Eb){this.$=Eb}get EYc(){return"Excel"}get campaignId(){return"aed9de6b-d4e7-4878-988a-9dfec66fed9e"}get version(){return 1}get currentVersion(){return 0}get wni(){return this.isEnabled()&&
this.$.sa(295)}get X7a(){return this.isEnabled()&&this.$.sa(297)}get U7a(){return this.$.sa(296)}get kIh(){return null}get Wvf(){return 24}get v_f(){return 4E3}get OKb(){return this.$.ya.WebServiceBase||""}isEnabled(){if(f.AFrameworkApplication.fa?f.AFrameworkApplication.fa.pa("IsAnonymousUser"):1)return!1;const Eb=f.AFrameworkApplication.Rb?Object(I.a)(String,f.AFrameworkApplication.Rb.AudienceGroup):"";return"Unknown"!==Eb&&"Automation"!==Eb}}Object(b.a)(ba,"FirstRunExperienceLauncherSettings",
null,[731]);class ka{constructor(Eb,Ac){this.tYe=Eb;this.YHh=Ac}GUd(){this.tYe&&this.tYe.GUd(this.YHh)}}Object(b.a)(ka,"FirstRunExperienceManager",null,[721]);var Ca=a(712);class db extends Ea.a{constructor(Eb){super();this.$=Eb;this.Db()}create(){const Eb=Object(Ca.a)(this.$.da,311,()=>this.Zch());this.nb(Eb)}Zch(){var Eb=new ba(this.$);Eb=new ka(ca.a.instance.resolve("Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher"),Eb);Eb.GUd();return Eb}static ka(Eb){Eb.da.Ha(312,new db(Eb))}}
Object(b.a)(db,"FirstRunExperienceManagerFactory",Ea.a,[]);var yb=a(56);class kb extends Ea.a{constructor(Eb){super();this.hnd=null;this.$=Eb;this.Db()}create(){const Eb=Object(Ca.a)(this.$.da,361,()=>this.Mdh());this.nb(Eb)}Mdh(){this.hnd=ca.a.instance.mg("Common.IInProductMessagingUIManager");yb.a.pg.gs?U.a.get_instance().Lj(16,()=>{this.Wef()}):this.Wef();return this.hnd}Wef(){ca.a.instance.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(Eb=>{Eb.isFeatureEnabled("MsoPremiumBadge",
!0).then(Ac=>{!Ac&&Eb.isFreemiumUpsellEnabled()&&this.hnd.Bqf();return null})})}static ka(Eb){Eb.da.Ha(362,new kb(Eb))}}Object(b.a)(kb,"InProductMessagingManagerFactory",Ea.a,[]);var mb=a(1214),W=a(1137),Q=a(48),va=a(420),na=a(81),Ba=a(1),Oa=a(528),oa=a(21),Ja=a(577);class Wb extends Oa.a{constructor(Eb){super(1);this.vfa=!1;this.rAf=()=>{this.refresh()};this.sAf=()=>{this.refresh()};this.gridView=oa.h(Eb);this.gridView.Vb.xl(this.sAf);this.gridView.Vb.Jm(this.rAf);this.refresh()}get KH(){return this.Xmc(this.vfa)}CSd(Eb){this.vfa!==
Eb&&(this.vfa=Eb,this.AIb())}get name(){return Ja.a.cellEdit}dispose(){this.gridView.Vb.nl(this.sAf);this.gridView.Vb.$l(this.rAf);this.gridView=null;super.dispose()}AIb(){this.cJd(this.vfa)}refresh(){this.CSd(!this.gridView.fb)}}Object(b.a)(Wb,"CellEditSafeStatePublisher",Oa.a,[]);var nc=a(38),Yb=a(114);class pb{constructor(Eb,Ac){this.handler=null;this.publisher=Eb;this.KH=Ac}}Object(b.a)(pb,"SafeStatePublisherState",null,[]);var Fa=a(615);const ab=Eb=>Eb?`${Eb.Current} / ${Eb.Pending} @${Eb.SuspensionStartTimestamp}`:
null,Gb=Eb=>(null===Eb||void 0===Eb?void 0:Eb.SuspensionStartTimestamp)&&Eb.Pending>Eb.Current;class Ga extends nc.a{constructor(Eb,Ac){super();this.ppf=null;this.z8a=!1;this.jGb=(ld,Vd)=>{3===Vd.Ivf&&this.z8a&&e.ULS.sendTraceTag(520480204,0,15,"ClientStateMonitor.onMergeDidntOccur: Aborted merge occurred after another aborted merge.");this.z8a=!0;this.pbb()};this.nRa=new Z.a;this.bya=Eb;this.vma=Ac;this.tAb=Ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);
this.B7a=Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:7464389_RetryDoPendingMergeAfterBailout");this.tAb&&(this.vma.VYa(this.Gya.bind(this)),this.B7a?this.bya.Yqe(this.jGb):this.bya.xNg(this.kFf.bind(this)))}get vYj(){return Yb.f(Yb.c(this.nRa.toArray(),Eb=>0!=Eb.KH),Eb=>Eb.publisher.name)}O_b(Eb){this.addHandler(Ga.mRa,Eb)}Quc(Eb){this.removeHandler(Ga.mRa,Eb)}Pza(Eb,Ac){const ld=new pb(Eb,Ac);this.nRa.add(ld);Ac=(Vd,Od)=>{ld.KH=Od.KH;this.pbb()};Eb.O_b(Ac);ld.handler=Ac;this.pbb()}G_d(Eb){let Ac=
null;for(let ld of this.nRa)if(ld.publisher===Eb){this.uig(ld);Ac=ld;break}Ac&&(this.nRa.remove(Ac),this.pbb())}dispose(){for(let Eb of this.nRa)this.uig(Eb);this.nRa.clear();this.tAb&&(this.vma.lcb(this.Gya.bind(this)),this.B7a?this.bya.yWf(this.jGb):this.bya.dkj(this.kFf.bind(this)));super.dispose()}kbc(){let Eb=ec.kbc(this.nRa.toArray().map(Ac=>Ac.KH));return this.z8a&&1===Eb?2:Eb}uig(Eb){Eb.publisher.Quc(Eb.handler)}pbb(){const Eb=this.kbc();Eb!==this.ppf&&(this.raiseEvent(Ga.mRa,new Fa.a(Eb)),
this.ppf=Eb)}kFf(){this.z8a&&e.ULS.sendTraceTag(523317957,0,15,"ClientStateMonitor.onMergeWasAborted: Aborted merge occurred after another aborted merge.");this.z8a=!0;this.pbb()}Gya(Eb,Ac){Eb=Ac.hca;(Ac=!Gb(Eb))||(Ac=this.Xxi,Ac=(null===Eb||void 0===Eb?void 0:Eb.SuspensionStartTimestamp)!==(null===Ac||void 0===Ac?void 0:Ac.SuspensionStartTimestamp));Ac&&(this.z8a=!1);this.Xxi=Eb;this.pbb()}}Ga.mRa="SSC";Object(b.a)(Ga,"ClientStateMonitor",nc.a,[]);var Ma=a(6),Qa=a(73);class wb extends Oa.a{constructor(Eb,
Ac=null){super(1);this.vfa=!1;this.qN=()=>{this.refresh()};this.xBf=()=>{this.refresh()};this.$=Eb;this.V$d=Ac||Qa.a(Eb).dQ(Ma.a.idle);Qa.a(Eb).bXc(this.xBf);this.L5a.nq(this.qN);this.refresh()}get KH(){return this.Xmc(this.vfa)}CSd(Eb){Eb!==this.vfa&&(this.vfa=Eb,this.AIb())}get name(){return Ja.a.L5a}get L5a(){return this.V$d}dispose(){Qa.a(this.$).vuc(this.xBf);this.L5a.Iq(this.qN);this.V$d=null;super.dispose()}AIb(){this.cJd(this.vfa)}refresh(){this.CSd(1===this.L5a.nu||Qa.a(this.$).Rh===this.L5a)}}
Object(b.a)(wb,"IdleActivitySafeStatePublisher",Oa.a,[]);var Na=a(318),ya=a(3),nb=a(22);class vb extends na.a{constructor(){super()}Hc(){return!1}executeCommand(){return A.Task.Ra(!0)}wc(Eb,Ac){return 1905775613===Ac.command}Mc(){return!1}}Object(b.a)(vb,"ToggleMergeSuspensionSafeState",na.a,[221]);class gb extends nc.a{constructor(Eb,Ac){super();this.statusBarManager=null;this.IAd=!1;this.Gya=(ld,Vd)=>{ld=`${Vd.hca.Current===Vd.hca.Pending?"\u26ad":"\u26ae"}${Vd.hca.Current}`;nb.a.equals(this.Enc,
ld,!1)||(this.Enc=ld,this.pz())};this.ePa=(ld,Vd)=>{ld=0==Vd.KH;this.IAd!==ld&&(this.IAd=ld,this.pz())};this.mergeSuspensionManager=Ac;this.mergeSuspensionManager.vma.VYa(this.Gya);this.Enc="";Na.a.n9(1905775613,ya.a.oc,0,1);this.Ia=Eb.Ia;this.XOb=new vb;Eb.da.gb(29,ld=>{this.mergeSuspensionManager&&(this.statusBarManager=ld,ld.XI(this),this.mergeSuspensionManager.yha.O_b(this.ePa))});this.Ia.a2(this.XOb)}nq(Eb){this.addHandler(gb.izd,Eb)}Iq(Eb){this.removeHandler(gb.izd,Eb)}pz(){this.raiseEvent(gb.izd)}tn(Eb){return Eb===
gb.s$i&&!!this.mergeSuspensionManager}Tr(Eb,Ac){if(!this.tn(Eb))return!1;this.mergeSuspensionManager&&(Ac.LabelText=this.Enc,Ac.On=this.IAd);return!0}dispose(){this.XOb&&(this.Ia.Zbb(this.XOb),this.XOb.dispose(),this.XOb=null);this.mergeSuspensionManager&&(this.mergeSuspensionManager.vma.lcb(this.Gya),this.mergeSuspensionManager.yha.Quc(this.ePa),this.mergeSuspensionManager=null);this.statusBarManager&&(this.statusBarManager.wF(this),this.statusBarManager=null);this.Enc=null;super.dispose()}}gb.izd=
"MSMSC";gb.s$i="QueryMergeSuspensionStatus";Object(b.a)(gb,"MergeSuspensionIndicatorManager",nc.a,[282,203,2]);var cb=a(7),La=a(895);class ja extends Sys.EventArgs{constructor(Eb){super();this.Ywa=Eb}}Object(b.a)(ja,"TogglePendingMergeBlockedByClientEventArgs",Sys.EventArgs,[]);class Ua{}Object(b.a)(Ua,"SuspensionState",null,[]);class lb extends Ua{constructor(Eb){super();this.Qse=!1;this.Qse=Eb}}Object(b.a)(lb,"ReadyForPendingMergeState",Ua,[]);const sb=new Ua,V=new Ua,za=new lb(!1),Ra=new lb(!0);
var Xa=a(896);class $a extends Xa.a{constructor(Eb,Ac,ld){super(Eb);this.LQg=Ac;this.NKj=ld}}Object(b.a)($a,"ReadyForPendingMergesUpdatedEventArgs",Xa.a,[]);class ma extends nc.a{constructor(Eb,Ac,ld){super();this.Gya=(Vd,Od)=>{Vd=this.getState();const he=this.i_;this.i_=Od.hca;Od=this.getState();this.aDi(Vd,Od,he);this.raiseEvent(ma.dzd);this.dYe(Vd,Od)};this.ePa=(Vd,Od)=>{Vd=this.getState();this.KH=Od.KH;Od=this.getState();this.dYe(Vd,Od)};this.jGb=(Vd,Od)=>{this.B7a&&4===Od.Ivf&&(e.ULS.sendTraceTag(520480203,
0,50,"MergeSuspensionStateHandler.onMergeDidntOccur: Retry DoPendingMerge after bailout. Current merge counter: {0}, Response merge counter: {1}",ab(this.i_),ab(Od.i_)),this.OQf(this.getState(),!0))};this.tAb=Ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);this.B7a=Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:7464389_RetryDoPendingMergeAfterBailout");this.yha=Eb;this.yha.O_b(this.ePa);this.vma=Ac;this.vma.VYa(this.Gya);this.B7a&&(this.bya=ld,this.bya.Yqe(this.jGb));
this.i_=Object(cb.a)(new La.a,{Pending:0,Current:0,SuspensionStartTimestamp:null});this.KH=this.sfi()}sfi(){return Object(va.a)(Ga,this.yha)?Object(I.a)(Ga,this.yha).kbc():1}S_b(Eb){this.addHandler(ma.UYd,Eb)}Uuc(Eb){this.removeHandler(ma.UYd,Eb)}jOg(Eb){this.addHandler(ma.MJd,Eb)}Gkj(Eb){this.removeHandler(ma.MJd,Eb)}wNg(Eb){this.addHandler(ma.dzd,Eb)}ckj(Eb){this.removeHandler(ma.dzd,Eb)}qbj(){this.$Id(this.getState()===V)}dispose(){this.yha.Quc(this.ePa);this.yha=null;this.vma.lcb(this.Gya);this.vma=
null;this.B7a&&(this.bya.yWf(this.jGb),this.bya=null);super.dispose()}shd(){return Object(cb.a)(new La.a,{Current:this.i_.Current,Pending:this.i_.Pending,SuspensionStartTimestamp:this.i_.SuspensionStartTimestamp})}getState(){return Gb(this.i_)?0==this.KH?Ra:this.tAb&&1==this.KH?za:V:sb}dYe(Eb,Ac){Eb!==Ac&&(Ac===V?this.$Id(!0):Eb===V&&this.$Id(!1));this.OQf(Ac)}OQf(Eb,Ac=!1){Eb instanceof lb&&this.raiseEvent(ma.MJd,new $a(this.i_,Eb.Qse||!this.tAb,Ac))}aDi(Eb,Ac,ld){Eb===sb&&Ac!==sb?(Eb=Ac===V,Ac=
Ac===za,e.ULS.sendTraceTag(252760283,0,50,`MergeSuspensionStateHandler.LogPendingMergesStatusChanged: Pending changes exist. IsBlocking: ${Ac} publisher: ${Ac||Eb?this.yha.vYj.join(","):""} counter: ${ab(this.i_)} isBlockingAllMerges: ${Eb}`)):Eb!==sb&&Ac===sb&&e.ULS.sendTraceTag(252760284,0,50,`MergeSuspensionStateHandler.LogPendingMergesStatusChanged: No pending changes. counter: ${ab(ld)}`)}$Id(Eb){this.raiseEvent(ma.UYd,new ja(Eb))}}ma.UYd="TPMBBC";ma.MJd="RFPMU";ma.dzd="MCC";Object(b.a)(ma,"MergeSuspensionStateHandler",
nc.a,[]);class fa extends nc.a{constructor(Eb){super();this.w1=null;this.Kkc=0;this.pEb=(Ac,ld)=>{(null===ld||void 0===ld?0:ld.hca)&&this.YOa(ld.hca,fa.v2d)};this.Dxc=()=>{this.kZf();this.EQf(this.w1,fa.eoj)};this.o$a=(Ac,ld)=>{ld.Hrb&&this.w1.SuspensionStartTimestamp&&e.ULS.sendTraceTag(17318084,0,50,`PendingMergeMonitor.OnEditCellEnded: committed with counter ${ab(this.w1)}`)};this.kZf();this.$=Eb;this.$.ea.Jj(this.Dxc);this.$.ea.ML(this.Dxc);oa.h(this.$).Vb.Jm(this.o$a);this.$.da.gb(292,Ac=>{Ac.VYa(this.pEb);
e.ULS.sendTraceTag(588276809,0,50,"PendingMergeMonitor initialized")})}VYa(Eb){this.addHandler("MCU",Eb)}lcb(Eb){this.removeHandler("MCU",Eb)}get i_(){return this.w1}YOa(Eb,Ac=""){const ld=this.w1.Current<Eb.Current||this.w1.Pending<Eb.Pending;if(Eb.SuspensionStartTimestamp&&this.Kkc!==Eb.SuspensionStartTimestamp){if(this.Kkc>Eb.SuspensionStartTimestamp){ld&&e.ULS.sendTraceTag(553736149,0,50,`PendingMergeMonitor.OnMergeCounterReceivedFromServer: skipping a higher stale counter received via ${Ac}. S: ${fa.oEb(Eb)}, C: ${fa.oEb(this.w1)}`);
return}ld||e.ULS.sendTraceTag(553736148,0,50,`PendingMergeMonitor.OnMergeCounterReceivedFromServer: recovering from a potentially stale counter. S: ${fa.oEb(Eb)}, C: ${fa.oEb(this.w1)}`)}else if(!ld)return;this.w1=Eb;this.EQf(Eb,Ac)}dispose(){this.$.ea.ik(this.Dxc);this.$.ea.rR(this.Dxc);oa.h(this.$).Vb.$l(this.o$a);const Eb=this.$.da.Aa(292);Eb&&Eb.lcb(this.pEb);super.dispose()}EQf(Eb,Ac=""){Gb(Eb)&&Eb.SuspensionStartTimestamp>this.Kkc&&(e.ULS.sendTraceTag(537155416,0,50,`PendingMergeMonitor.RaiseMergeCounterUpdated: Merge suspension requested. MergeCounter: ${ab(Eb)}, Origin: ${Ac}`),
this.Kkc=Eb.SuspensionStartTimestamp);this.raiseEvent("MCU",new Xa.a(Eb))}kZf(){e.ULS.sendTraceTag(588276808,0,50,`PendingMergeMonitor.ResetMergeCounter : Last counter was ${fa.oEb(this.w1)}`);this.w1=Object(cb.a)(new La.a,{Pending:0,Current:0,SuspensionStartTimestamp:null})}static oEb(Eb){return Eb?`(${Eb.Current}/${Eb.Pending} @${Eb.SuspensionStartTimestamp})`:"null"}}fa.v2d="PMM.RTC";fa.A8b="PMM.EwaResult";fa.eoj="PMM.resetMergeCounter";Object(b.a)(fa,"PendingMergeMonitor",nc.a,[]);class eb{}Object(b.a)(eb,
"ClientRevisions",null,[]);var ua=a(44),xa=a(60);const tb=(Eb,Ac,ld,Vd,Od,he,Ye,se=null)=>{se=Eb.Na(1,se);se.viewportState=Ac;se.allowViewAdjustment=ld;return xa.g(Eb,"DoPendingMerge",se,Vd,Od,he,Ye,0)},Qb=(Eb,Ac,ld,Vd,Od,he,Ye=null)=>{Ye=Eb.Na(1,Ye);Ye.suspensionStartTimestamp=Ac;return xa.g(Eb,"KeepBlockingPendingMerges",Ye,ld,Vd,Od,he,0)};class pc extends nc.a{constructor(Eb,Ac,ld,Vd){super();this.PIa=null;this.tCb=0;this.uCb=this.m8a=null;this.VGf=(Od,he)=>{this.PIa.nUg(he.hca,he.LQg,he.NKj)};
this.MGb=(Od,he)=>{he.Ywa?this.aNj():this.NAc()};this.jFf=()=>{this.tCb=0};this.H2f=()=>{const Od=this.G5.shd();Qb(this.xa,null!=Od.SuspensionStartTimestamp?Od.SuspensionStartTimestamp:0,null,()=>{this.rVi(Od)},null,null,this.xa.Wb())};this.mCa=(Od,he)=>{if(he){he.Gob.MergeCount=this.G5.shd();let Ye;({min:Od,max:Ye}=oa.h(this.$).hIi());Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:5524817_LogOnMergeRaceCondition2")?he.Gob.ClientRevisions=Object(cb.a)(new eb,{Min:Od,Max:Ye,MaxFromBlockCache:oa.h(this.$).Ca.gvf}):
he.Gob.ClientRevisions=Object(cb.a)(new eb,{Min:Od,Max:Ye})}};this.$=Eb;this.QZa=ld;this.G5=Ac;this.G5.jOg(this.VGf);this.G5.S_b(this.MGb);this.G5.wNg(this.jFf);this.$.oa.Lga(this.mCa);this.xa=this.$.oa.xa;this.yNd=this.$.ya.MergeSuspensionRequestThrottlingTimeInMs;this.qxi=this.$.ya.KeepBlockingPendingMergesRequestIntervalMs;this.PIa=Vd;e.ULS.sendTraceTag(588276807,0,50,"RequestController initialized")}dispose(){this.$.oa.Xma(this.mCa);this.NAc();this.G5.Gkj(this.VGf);this.G5.Uuc(this.MGb);this.G5.ckj(this.jFf);
this.G5=null;super.dispose()}aNj(){this.NAc();if(this.YLe()){const Eb=this.G5.shd();e.ULS.sendTraceTag(537155414,0,50,`RequestController.StartKeepBlockingPendingMergesTimer: Prevented starting StartKeepBlockingPendingMergesTimer because of repeated failure in counter ${ab(Eb)} fail count: ${this.tCb}`)}else this.uCb=this.QZa.create(this.H2f,this.yNd,ua.a.uCb),this.m8a=this.QZa.wC(this.H2f,this.qxi,ua.a.m8a)}NAc(){this.m8a&&(this.uCb.cancel(),this.m8a.cancel(),this.m8a=this.uCb=null)}rVi(Eb){let Ac;
Ac=" fail count: "+this.tCb;this.tCb++;this.YLe()&&this.NAc();e.ULS.sendTraceTag(542229773,0,10,`RequestController.OnKeepBlockingPendingMergesRequestFailed: request failed ${ab(Eb)}${Ac}`)}YLe(){return this.tCb>pc.QGi}}pc.QGi=5;Object(b.a)(pc,"RequestController",nc.a,[]);var hb=a(160),ib=a(202),Vb=a(28),wc=a(282);class Lc extends Sys.EventArgs{constructor(Eb,Ac){super();this.Ivf=Eb;this.i_=Ac}}Object(b.a)(Lc,"MergeDidntOccurEventArgs",Sys.EventArgs,[]);class Fc extends nc.a{get $La(){return 0<this.OEd}constructor(Eb,
Ac,ld=null,Vd=null,Od=null){super();this.Jkc=null;this.OEd=0;this.documentVisibilityObserver=null;this.Gof=!1;this.Vmc=null;this.xa=Eb;this.yNd=Ac.ya.MergeSuspensionRequestThrottlingTimeInMs;const he=Ac.ya.GetRangeContentPrefetchDelayForMergeInMs;this.my=()=>{Ac.p1f(he)};this.uh=ld||Vb.a.Ya;this.zlg=0;this.cL=Vd;this.sAa=Od;Ac.da.gb(291,Ye=>{this.documentVisibilityObserver=Ye})}xNg(Eb){this.addHandler(Fc.jzd,Eb)}dkj(Eb){this.removeHandler(Fc.jzd,Eb)}Yqe(Eb){this.addHandler(Fc.ezd,Eb)}yWf(Eb){this.removeHandler(Fc.ezd,
Eb)}get isDocumentHidden(){return!!this.documentVisibilityObserver&&this.documentVisibilityObserver.Vh}nUg(Eb,Ac,ld=!1){this.aNb(Eb,Ac,ld)?(new hb.a).setResult(!0):(Ac=this.A4i(Eb,Ac),this.Jkc=Eb,this.OEd++,Ac.continueWith(()=>{this.MQi()},0,ib.a.none,this.cL))}A4i(Eb,Ac){this.zlg=this.uh.Gea;this.Gof=Ac;e.ULS.sendTraceTag(554767493,0,50,`DoPendingMergeSender.performDoPendingMergeInternal: Sending DoPendingMerge ${Eb.Current} / ${Eb.Pending} @${Eb.SuspensionStartTimestamp}. allowSelectionAdjustment: ${Ac}`);
this.isDocumentHidden||this.my();return this.Luj(Ac,Eb)}aNb(Eb,Ac,ld=!1){if(this.sAa&&!Ac&&!this.sAa.xui())return e.ULS.sendTraceTag(523317956,0,50,"DoPendingMergeSender.shouldThrottle: We can't retrieve selection and selection adjustments are disallowed."),!0;if(!this.Jkc||Eb.SuspensionStartTimestamp>this.Jkc.SuspensionStartTimestamp)return this.$La&&e.ULS.sendTraceTag(523551556,0,50,`DoPendingMergeSender.shouldThrottle: Allowing request for new suspension while previous is ongoing, new counter: ${Eb.Current} / ${Eb.Pending} @${Eb.SuspensionStartTimestamp}`),
!1;if(this.$La)return!0;if(ld)return!1;ld=this.Jkc;const Vd=this.uh.Gea-this.zlg<this.yNd;Ac=this.Gof===Ac;return(Eb||ld?Eb&&ld?Eb.Current===ld.Current&&Eb.Pending===ld.Pending&&Eb.SuspensionStartTimestamp===ld.SuspensionStartTimestamp:!1:!0)&&Vd&&Ac}Luj(Eb,Ac){const ld=this.xa.Wb(),Vd=()=>{e.ULS.sendTraceTag(588276806,0,10,`DoPendingMergeSender.sendDoPendingMergeRequest: request failed ${Ac.Current} / ${Ac.Pending} @${Ac.SuspensionStartTimestamp}`)};return this.sAa?this.sAa.orj(this.ATh(Eb,Vd,ld)):
this.Eze(null,!0,void 0,Vd,ld)}ATh(Eb,Ac,ld){return(Vd,Od,he)=>{let Ye=void 0;e.ULS.shipAssertTag(523317955,0,null!=Vd||Eb,"!allowSelectionAdjustment requires a non-null initialViewportState.");Ye=this.NQi.bind(this);Od&&(Ye=wc.b.call(null,se=>{const bf=se.Result;let tf=null===bf||void 0===bf?void 0:bf.AdjustedViewportState;3===(null===bf||void 0===bf?void 0:bf.MergeResultState)&&(tf=void 0);Od(tf,se.StateId)},Ye));he&&(Ac=wc.a.call(null,he,Ac));return this.Eze(Vd,Eb,Ye,Ac,ld)}}Eze(Eb,Ac,ld,Vd,Od){return tb(this.xa,
Eb,Ac,ld,Vd,null,null,Od)}NQi(Eb){var Ac=Eb.Result;void 0!=Ac&&(Ac=Ac.MergeResultState,Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:7464389_RetryDoPendingMergeAfterBailout")&&2!==Ac?this.Vmc=[Ac,Eb.MergeCount]:3===Ac&&(e.ULS.sendTraceTag(523317954,0,50,"DoPendingMergeSender.onDoPendingMergeSucceeded: Aborted merge."),this.Paj()))}Paj(){this.raiseEvent(Fc.jzd,new Sys.EventArgs)}Oaj(Eb,Ac){this.raiseEvent(Fc.ezd,new Lc(Eb,Ac))}MQi(){this.OEd--;if(this.Vmc){const Eb=this.Vmc;this.Vmc=null;this.Oaj(...Eb)}}}
Fc.jzd="MWA";Fc.ezd="MDO";Object(b.a)(Fc,"DoPendingMergeSender",nc.a,[741,742]);class fd{constructor(Eb=!1){this.divergenceOnResponse=this.adjustedDidntChangeWithDivergence=this.editBoxDivergence=this.differentSheetAdjust=this.parallel=this.errors=this.nonContinuous=this.divergenceOnViewportReady=this.adjusted=this.adjustedDidntChange=0;this.kei=Eb}get reportName(){return this.kei?"SelectionAdjustInHiddenDocument":"SelectionAdjust"}}Object(b.a)(fd,"SelectionAdjustSessionEndsReport",null,[685]);var Ta=
a(41);class Fb{constructor(Eb,Ac,ld,Vd,Od,he){this.jb=Eb;this.bG=Ac;this.a9=ld;this.EXb=Vd;this.n4d=Od;this.yL=he}get activeCell(){return this.bG}get selectedRanges(){return this.a9}get es(){let Eb=!1;if(null===this.yL||void 0===this.yL)Eb=!0;else if(this.yL>=this.selectedRanges.length||!this.selectedRanges[this.yL].contains(this.activeCell))e.ULS.sendTraceTag(521200010,0,50,`SelectionState.indexOfActiveRange: the index of the adjusted active range has changed. indexOfActiveRange: ${this.yL}, selectedRangesLength: ${this.selectedRanges.length}`),
Eb=!0;Eb&&(this.yL=this.f0g());return this.yL}get activeRange(){return 0>this.es?this.activeCell:this.selectedRanges[this.es]}get sheetName(){return this.EXb}get activeItemName(){return this.n4d}get Tpg(){return 1===this.selectedRanges.length}Img(Eb){let Ac=this.selectedRanges.map(ld=>this.PVj(ld,this.n4d));for(let ld of Ac)if(ld)for(let Vd of ld)if(Vd.uk&&Vd.ae.Revision<Eb)return!1;return!0}MSj(){var Eb;return{SheetName:this.sheetName,ActiveCell:null===(Eb=this.activeCell)||void 0===Eb?void 0:Eb.toString(),
TopLeft:void 0,SelectedRanges:Ta.r(this.selectedRanges,this.jb)}}toString(){var Eb,Ac;return`active cell: ${null!==(Ac=null===(Eb=this.activeCell)||void 0===Eb?void 0:Eb.toString())&&void 0!==Ac?Ac:"null"} selection: ${Yb.f(this.selectedRanges,ld=>{var Vd;return null!==(Vd=null===ld||void 0===ld?void 0:ld.toString())&&void 0!==Vd?Vd:"null"}).join(",")}`}equals(Eb){return Eb?this.activeCell.equals(Eb.activeCell)&&Ta.Q(this.selectedRanges,Eb.selectedRanges)&&this.sheetName===Eb.sheetName:!1}f0g(){for(let [Eb,
Ac]of this.selectedRanges.entries())if(null===Ac||void 0===Ac?0:Ac.contains(this.activeCell))return Eb;return-1}PVj(Eb,Ac){var ld;const Vd=oa.h(this.jb).Ca.X3a(Eb,Ac);Vd||e.ULS.sendTraceTag(522803340,0,50,`SelectionState.tryGetBlockCacheItemsFromRange: no items found. range: ${null!==(ld=null===Eb||void 0===Eb?void 0:Eb.toString())&&void 0!==ld?ld:"null"} ; activeItemNameIsDefined: ${!!Ac}`);return Vd}}Object(b.a)(Fb,"SelectionState",null,[]);var ic=a(218),zb=a(752);class Bb{constructor(Eb){this.IAc=
0;this.yG=this.YE=null;this.C4d=new fd;this.D4d=new fd(!0);this.AH=0;this.XQj=!1;this.lIi=1E4;this.dd=()=>{this.RIe()};this.vj=()=>{this.FZc(!0,!1)};this.f$a=()=>{this.FZc(!1,!1)};this.$=Eb;this.gridView=oa.h(this.$);this.gridView.Ca.Rv(this.vj);this.gridView.Ca.Ns(this.f$a);this.gridView.Ca.eqe(this.f$a);this.gridView.Ca.r9(this.f$a);this.$.Lk(this.dd);this.RIe()}orj(Eb){let Ac=null,ld=null,Vd=()=>{this.nNi()};this.rgf()?(this.fP.parallel++,e.ULS.sendTraceTag(526390086,0,15,`SelectionAdjustManager.runRequestWithSelectionAdjust: Skipping parallel request. Current adjustedSelection is defined : ${!!this.yG}`)):
(Ac=(Od,he)=>{this.oNi(Od,he)},ld=this.oAj());return null===Eb||void 0===Eb?void 0:Eb(ld,Ac,Vd)}xui(){return!this.rgf()&&this.Kaa().Tpg}oAj(){var Eb;e.ULS.shipAssertTag(525135961,0,0===this.AH,"SelectionAdjustManager.setPreRequestState: unexpected state");this.yG&&(this.fP.errors++,e.ULS.sendTraceTag(526960090,0,10,`SelectionAdjustManager.setPreRequestState: About to ignore a defined Adjusted selection: ${this.yG.toString()}`));this.yG=null;this.YE=this.Kaa();let Ac=null;const ld=null===(Eb=this.YE)||
void 0===Eb?void 0:Eb.MSj();ld&&(Ac={ActiveSheetName:this.YE.sheetName,SheetViewportStateChanges:[ld]});this.AH=1;return Ac}nNi(){e.ULS.shipAssertTag(525135960,0,1===this.AH,"SelectionAdjustManager.onAdjustedRequestFailed: unexpected state");this.fP.errors++;this.AH=2;this.cr()}oNi(Eb,Ac){try{e.ULS.shipAssertTag(525135959,0,1===this.AH,"SelectionAdjustManager.onAdjustedSelectionReady: unexpected state"),this.IAc=Ac,Ac=2,this.YE?Eb?(this.yG=this.MDj(Eb))?(Ac=7,this.YE.equals(this.yG)?this.YE.equals(this.Kaa())?
(this.fP.adjustedDidntChange++,Ac=4):(this.fP.adjustedDidntChangeWithDivergence++,Ac=5):this.YE.sheetName!=this.yG.sheetName?(this.fP.differentSheetAdjust++,Ac=10):this.YE.equals(this.Kaa())||(this.fP.divergenceOnResponse++,Ac=6,this.QXf())):this.fP.errors++:(this.fP.errors++,e.ULS.sendTraceTag(537155412,0,15,`SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted returned null, initialSelection: ${this.YE.toString()}`)):(this.fP.errors++,e.ULS.sendTraceTag(537155413,0,10,`SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted selection results returned when not waiting for them, adjusted:  ActiveCell: ${null===
Eb||void 0===Eb?void 0:Eb.ActiveCell}`)),this.AH=Ac}catch(ld){this.AH=12,e.ULS.sendTraceTag(525135958,0,10,`SelectionAdjustManager.OnAdjustedSelectionReady: caught Exception ${ld}`)}finally{7!=this.AH?this.cr():this.FZc(!1,!0)}}dispose(){this.gridView.Ca.Mw(this.vj);this.gridView.Ca.Hq(this.f$a);this.gridView.Ca.LVf(this.f$a);this.gridView.Ca.CQa(this.f$a);this.$.pl(this.dd)}rgf(){return 1===this.AH||7===this.AH}MDj(Eb){let Ac;if(!({range:Ac}=Ta.Y(Eb.ActiveCell,this.$.va)).returnValue)return e.ULS.sendTraceTag(537155411,
0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: Unable to extract active cell ${Eb.ActiveCell}`),null;let ld=[];const Vd=this.$.na,Od=!!Vd&&2===Vd.GF;if(Eb.SelectedRanges)ld=Ta.g(Eb.SelectedRanges.Ranges);else if(!Od)return e.ULS.sendTraceTag(522826913,0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: SelectedRanges is null, active sheet exists: ${!!Vd}`),null;return new Fb(this.$,Ac,ld,Eb.SheetName,this.YE.activeItemName,this.YE.es)}Kaa(){const Eb=this.$.na;if((null===
Eb||void 0===Eb?0:Eb.activeCell)&&Eb.selectedRanges&&Eb.sheetName)return new Fb(this.$,Eb.activeCell,Eb.selectedRanges,Eb.sheetName,this.$.activeItemName,Eb.es);e.ULS.sendTraceTag(525135957,0,15,`SelectionAdjustManager.getCurrentSelection: invalid activeItem. activeItem null: ${!Eb}, activeCell null: ${!(null===Eb||void 0===Eb?0:Eb.activeCell)}, selectedRanges null: ${!(null===Eb||void 0===Eb?0:Eb.selectedRanges)}, sheetName null: ${!(null===Eb||void 0===Eb?0:Eb.sheetName)}`);return null}RIe(){this.$.da.gb(276,
()=>{const Eb=ic.a(this.$);Eb.bY(this.C4d);Eb.bY(this.D4d)})}FZc(Eb,Ac){var ld;if(this.Fsi(Eb))if(8===this.AH)e.ULS.sendTraceTag(523106438,0,15,"SelectionAdjustManager.attemptAdjustSelection: skipping as was already adjusted");else{Ac&&e.ULS.sendTraceTag(524039250,0,50,"SelectionAdjustManager.attemptAdjustSelection: viewport ready on response");try{e.ULS.shipAssertTag(525135956,0,7===this.AH,"SelectionAdjustManager.attemptAdjustSelection: unexpected state"),this.YE.equals(this.Kaa())?(null===(ld=
this.gridView)||void 0===ld?0:ld.fb)?(this.fP.editBoxDivergence++,this.AH=11):(Eb=0,Eb=this.yG.es,-1==Eb?(this.fP.errors++,e.ULS.sendTraceTag(522826912,0,10,"SelectionAdjustManager.attemptAdjustSelection: invalid indexOfActiveRange")):(this.fP.adjusted++,this.AH=8,this.gridView.ha.sy(this.yG.selectedRanges,Eb,this.yG.activeCell,0,void 0,"SelectionAdjust"))):(this.fP.divergenceOnViewportReady++,this.QXf(),this.AH=9)}catch(Vd){this.AH=12,e.ULS.sendTraceTag(525135955,0,10,`SelectionAdjustManager.attemptAdjustSelection: caught Exception ${Vd}`)}finally{this.cr()}}}Fsi(Eb){if(!this.yG)return!1;
if(!this.YE)return e.ULS.sendTraceTag(537155409,0,10,`SelectionAdjustManager.attemptAdjustSelection: initialSelection is null while adjustedSelection isn't null, adjustedSelection: ${this.yG.toString()}`),!1;if(oa.h(this.$).Ca.gvf<this.IAc)return!1;if(Eb||this.XQj)e.ULS.sendTraceTag(528590295,0,15,"SelectionAdjustManager.attemptAdjustSelection: got to blockCacheConsistent while pending for selection adjust");else if(!this.YE.Img(this.IAc)||!this.yG.Img(this.IAc))return!1;return!0}cr(){this.YE=this.yG=
null;this.AH=0}QXf(){const Eb=this.Kaa();e.ULS.sendTraceTag(537155408,0,50,`SelectionAdjustManager.ReportDivergence: initial: ${this.YE.toString()} current: ${Eb?Eb.toString():""} adjusted: ${this.yG.toString()} sheetSameBetweenInitialAndAdjusted: ${this.YE.sheetName===this.yG.sheetName} sheetSameBetweenInitialAndCurrent: ${this.YE.sheetName===(Eb?Eb.sheetName:null)}`)}get fP(){return zb.a.oH(this.lIi)?this.D4d:this.C4d}}Object(b.a)(Bb,"SelectionAdjustManager",null,[740,2]);class ec extends na.a{constructor(Eb,
Ac,ld=null){super();this.ZCa=this.Mfc=this.M5a=this.Z_a=null;e.ULS.sendTraceTag(537155417,0,50,"MergeSuspensionManager.ctor started");this.$=Eb;this.gXa=new fa(Eb);this.sAa=new Bb(this.$);this.PIa=new Fc(this.$.oa.xa,this.$,void 0,void 0,this.sAa);this.Nfi(Eb,ld);this.Efa=new ma(this.ZCa,this.gXa,this.PIa);this.rNd=new pc(Eb,this.Efa,Ac,this.PIa);Ba.EwaSettings.sa(230)&&(this.Mfc=new gb(Eb,this));e.ULS.sendTraceTag(588276810,0,50,"MergeSuspensionManager created")}S_b(Eb){this.Efa.S_b(Eb)}Uuc(Eb){this.Efa&&
this.Efa.Uuc(Eb)}get yha(){return this.ZCa}get vma(){return this.gXa}get G5(){return this.Efa}Pza(Eb,Ac){this.ZCa.Pza(Eb,Ac)}G_d(Eb){this.ZCa.G_d(Eb)}YOa(Eb,Ac=""){this.gXa.YOa(Eb,Ac)}dispose(){this.Mfc&&(this.Mfc.dispose(),this.Mfc=null);this.sAa&&this.sAa.dispose();this.PIa.dispose();this.rNd&&(this.rNd.dispose(),this.rNd=null);this.Efa&&(this.Efa.dispose(),this.Efa=null);this.gXa.dispose();this.gXa=null;this.ZCa.dispose();this.ZCa=null;this.Z_a&&(this.Z_a.dispose(),this.Z_a=null);this.M5a&&(this.M5a.dispose(),
this.M5a=null);this.$=null;super.dispose()}AIb(){this.Efa.qbj()}static kbc(Eb){let Ac=0;for(let ld of Eb){if(2==ld)return 2;1==ld&&(Ac=1)}return Ac}Nfi(Eb,Ac){this.ZCa=new Ga(this.PIa,this.gXa);Ac?Object(va.a)(wb,Ac)?this.Pza(Ac,Object(I.a)(wb,Ac).KH):Object(va.a)(Wb,Ac)?this.Pza(Ac,Object(I.a)(Wb,Ac).KH):this.Pza(Ac,0):(this.Z_a=new Wb(Eb),this.M5a=new wb(Eb),this.Pza(this.Z_a,this.Z_a.KH),this.Pza(this.M5a,this.M5a.KH))}}Object(b.a)(ec,"MergeSuspensionManager",na.a,[717,2]);class Qd extends Ea.a{constructor(Eb){super();
this.Oc=Eb;this.Db()}create(){e.ULS.sendTraceTag(537155419,0,50,"MergeSuspensionFactory.Create");this.nb(this.Oc.da.Aa(343)||this.Oc.da.Ha(343,new ec(this.Oc,Q.a.instance)))}static ka(Eb){e.ULS.sendTraceTag(537155418,0,50,"MergeSuspensionFactory.Attach");Eb.da.Ha(344,new Qd(Eb))}}Object(b.a)(Qd,"MergeSuspensionFactory",Ea.a,[]);var fc=a(50),cd=a(37),jd=a(89),nd=a(99),vd=a(59),wd=a(13);class Td{}Td.Tzi=3;Td.connected=0;Object(b.a)(Td,"ConnectionStateConstants",null,[]);var jc=a(112),bd=a(120),Hd=a(45);
class ge{constructor(Eb,Ac,ld){var Vd;this.type=0;this.startTime=null;this.blockedOperationsCount=this.durationMs=0;this.blockedActions=null;this.blockedUserOperationsWhileToastShown=this.durationUntilToastShownMs=0;this.toastRaiser=null;this.wasUserActiveOnPIEnd=this.wasUserActiveOnPIStart=this.hasTabbedOut=this.isToastShown=!1;this.durationUntilUserInactive=-1;this.isTaskPaneCollapsed=this.isTaskPaneShown=this.isDialogShown=!1;this.bAf=(Od,he)=>{this.blockedOperationsCount++;Od=`${he.componentName}_${he.actionName}_${he.details})`;
this.blockedActions[Od]=this.blockedActions[Od]?this.blockedActions[Od]+1:1;this.isToastShown&&this.blockedUserOperationsWhileToastShown++};this.KEd=Od=>{this.durationUntilUserInactive=jc.getElapsedSeconds(this.startTime,Vb.a.Ya.Ub);Od.xMd(this.KEd)};this.zV=()=>{this.hasTabbedOut=!0};this.Fca=(Od,he)=>{he.QLf!==this.type||this.isToastShown||(this.durationUntilToastShownMs=bd.a(Vb.a.Ya,this.startTime),this.toastRaiser=he.toastRaiser,this.isToastShown=!0)};this.startTime=Eb;this.durationUntilToastShownMs=
0;this.blockedActions={};this.isToastShown=ld;if(null===(Vd=Ac.ea)||void 0===Vd?0:Vd.Ae)this.wasUserActiveOnPIStart=Ac.ea.Ae.nr;this.Aj(Ac);this.isDialogShown=0<Ac.qb.gR;Eb=Ac.da.Aa(183);this.isTaskPaneShown=!!Eb&&Eb.isVisible&&!Eb.isCollapsed;this.isTaskPaneCollapsed=!!Eb&&Eb.isVisible&&Eb.isCollapsed}v4f(){this.durationMs=bd.a(Vb.a.Ya,this.startTime)}TDd(Eb){var Ac;this.v4f();Hd.a(Eb).Ouc(this.bAf);Hd.a(Eb).Sf.Puc(this.Fca);Eb.da.gb(291,ld=>{ld.fcb(this.zV)});if(null===(Ac=Eb.ea)||void 0===Ac?0:
Ac.Ae)Eb.ea.Ae.xMd(this.KEd),this.wasUserActiveOnPIEnd=Eb.ea.Ae.nr}Aj(Eb){Hd.a(Eb).K_b(this.bAf);this.isToastShown?this.toastRaiser="Immediate":Hd.a(Eb).Sf.tXc(this.Fca);Eb.da.gb(291,Ac=>{this.hasTabbedOut=Ac.Vh;Ac.XFa(this.zV)});this.wasUserActiveOnPIStart&&Eb.ea.Ae.Nre(this.KEd)}}Object(b.a)(ge,"PartialInteractivityData",null,[]);var Mb=a(1140);class Kc extends ge{constructor(Eb,Ac,ld,Vd,Od,he){super(Eb,Ac,Vd);this.swappedOffline=this.swappedByOffline=!1;this.lastFailedRequestToOnlineTimeGapSec=
this.longestDurationBetweenFailedRequestsSec=this.averageDurationBetweenFailedRequestsSec=0;this.errorDataDuringConnectivityIssuesMode=this.disconnectionSource=null;this.failedRequests=[];this.triggeringRequest=null;this.type=4;this.swappedOffline=ld;this.disconnectionSource=Enum.toString(Mb.a,Od);this.triggeringRequest=he}JPi(Eb,Ac){this.swappedByOffline=Ac;this.TDd(Eb)}byj(Eb){this.errorDataDuringConnectivityIssuesMode=Eb}Fdj(Eb){10>this.failedRequests.length&&(Eb=Eb+"_"+jc.getElapsedSeconds(this.startTime,
Vb.a.Ya.Ub).toString(),this.failedRequests.push(Eb))}}Object(b.a)(Kc,"ConnectivityIssuesData",ge,[]);var Ob=a(164),Mc=a(129),Dc=a(115);class $c{}$c.Lph="DuringWork";$c.connectivityIssues="ConnectivityIssues";$c.offline="Offline";Object(b.a)($c,"UnavailabilityTypes",null,[]);var td=a(52);class Yd{constructor(Eb){this.Dkc=this.data=null;this.Lbd=0;this.DFe=null;this.lBf=(Ac,ld)=>{ld.HL?(this.data=new Kc(Vb.a.Ya.Ub,this.$,5===ld.ioa,0!==ld.ioa,this.$.Re.disconnectionSource,this.DFe),this.Dkc=this.$.Re.zpf,
this.Lbd=1,this.$.oa.Re.jPg(this.wm),Ob.a(this.$).cXc(this.G0f)):(this.data.JPi(this.$,5===ld.ioa),this.$.oa.Re.VWf(this.wm),this.data.lastFailedRequestToOnlineTimeGapSec=jc.getElapsedSeconds(this.Dkc,Vb.a.Ya.Ub),Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_7pzab_ConnectivityIssues")?td.b().JLb(557682689,0,50,$c.connectivityIssues,this.data.durationMs,"ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: {0}",vd.a.Dc(this.data)):
e.ULS.sendTraceTag(557682689,0,50,`ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: ${vd.a.Dc(this.data)}`),this.data&&this.data.isToastShown&&nd.Health.instance.recordQosError(Mc.a.k5g,[Dc.a.olc],!0,!1,!1,!1,null),Ob.a(this.$).RLd(this.G0f),this.data=null)};this.G0f=(Ac,ld)=>{this.data.byj(ld.sU)};this.wm=(Ac,ld)=>{this.data.Fdj(ld.context.methodName);Ac=Vb.a.Ya.Ub;ld=jc.getElapsedSeconds(this.Dkc,Ac);this.Dkc=Ac;ld>this.data.longestDurationBetweenFailedRequestsSec&&
(this.data.longestDurationBetweenFailedRequestsSec=ld);this.Lbd++;this.data.averageDurationBetweenFailedRequestsSec=this.T_g(ld)};this.iBf=(Ac,ld)=>{this.DFe=ld.mVj};this.$=Eb;Hd.a(this.$).Sf.nqe(this.lBf);this.$.Re.mqe(this.iBf)}dispose(){this.$&&(Hd.a(this.$).Sf.VVf(this.lBf),this.$.Re&&this.$.Re.UVf(this.iBf));this.data&&this.$.oa.Re.VWf(this.wm);this.$=null}T_g(Eb){const Ac=this.Lbd-1;return(this.data.averageDurationBetweenFailedRequestsSec*(Ac-1)+Eb)/Ac}}Object(b.a)(Yd,"ConnectivityIssuesTelemetryManager",
null,[2]);var ae=a(871),je=a(8),Ke=a(1139),Fd=a(1138);class fe{constructor(Eb){this.H_f=null;this.Rud=this.szd=this.mFb=this.nFb=0;this.STd=!1;this.T3c=this.PSa=this.kAc=this.J9a=null;this.g4c=0;this.Guj=()=>{if(12E4>this.$.ea.Ae.qfb)for(let Ac of this.kAc)Ac.runTest();else this.NWd("UserInactive")};this.hnj=Ac=>{Ac=Sys.Serialization.JavaScriptSerializer.serialize(Ac);e.ULS.sendTraceTag(388821830,0,50,Ac)};this.ymj=Ac=>{if(Ac){var ld=this.T3c[Ac.testIteration.toString()];ld?ld.push(Ac):(ld=[Ac],this.T3c[Ac.testIteration.toString()]=
ld);if(ld.length===this.H_f.length){ld=Sys.Serialization.JavaScriptSerializer.serialize(ld);if(this.$&&this.$.Re){if(Ac.EstimatedLatency=this.$.Re.Iwe,this.$.Re.Iwe>this.$.Wu.ExcelRountripThresholdMs){e.ULS.sendTraceTag(570712144,0,50,`Periodic ping tests results when network is slow: ${ld}, consequtive slow ping iteration #: ${this.g4c++}`);return}}else e.ULS.sendTraceTag(537155209,0,50,"EwaControl/ConnectivityObserver is null when conducting slow connection speed tests");e.ULS.sendTraceTag(570712142,
0,50,`Periodic ping tests results: ${ld}`);this.g4c=1}}};this.eh=(Ac,ld)=>{Ac=ld.context.methodName;if(Ac===je.a.Axb||Ac===je.a.xva)this.mFb++,Ac=Date.now(),this.sFj(Ac)&&(this.mFb=0,this.Rud=Ac,this.tNj())};this.Eca=()=>{this.nWd("OnThrottledUserActivity")};this.zV=()=>{this.NWd("OnDocumentHidden")};this.PH=()=>{this.nWd("OnDocumentUnhidden")};this.$=Eb;if(this.TTd=this.B3g())this.H_f=[Fd.a.PFc],this.g4c=1,this.T3c={},this.$.ea.Ae.w9(this.Eca),this.$.da.gb(291,Ac=>{Ac.XFa(this.zV);Ac.Qra(this.PH)})}dispose(){this.$&&
(this.STd&&this.$.oa&&0<this.J9a.count&&this.$.oa.ps(this.eh),this.TTd&&(this.NWd("Dispose"),this.$.ea.Ae.Wza(this.Eca)))}rfi(){Ba.EwaSettings.sa(199)&&this.w7i();this.TTd&&this.x7i()}Ofi(){this.mFb=this.nFb;this.Rud=0;var Eb={};if(!this.J9a){this.J9a=new Z.a;const Ac=Ke.a.ved(this.hnj,"InitSampleMeasurement",this.$);for(const ld of Ac)Eb[ld.mmd]=ld.baseUrl,this.J9a.add(ld)}Eb=Sys.Serialization.JavaScriptSerializer.serialize(Eb);e.ULS.sendTraceTag(537155210,0,50,`Init Network measurement: numberOfRequestToWaitPerNetworkMeasurement: ${this.nFb}, numberOfRequestFromTheLastNetworkMeasurement: ${this.mFb}, testParams: ${Eb} `);
0<this.J9a.count&&this.$.oa.Xq(this.eh)}tNj(){for(let Eb of this.J9a)Eb.runTest()}nWd(Eb){this.PSa&&this.PSa.ep||(e.ULS.sendTraceTag(537155208,0,50,`NetworkMeasurement.StartConnectionSpeedTest: starting ping tests. caller: ${Eb}`),this.PSa=Q.a.instance.wC(this.Guj,5E3,ua.a.oLj),this.PSa.$U())}NWd(Eb){this.PSa&&this.PSa.ep&&(e.ULS.sendTraceTag(537155207,0,50,`NetworkMeasurement.StopConnectionSpeedTest: stopping ping tests. caller: ${Eb}`),this.PSa.cancel())}sFj(Eb){return this.mFb>=this.nFb&&Eb-this.Rud>
this.szd}B3g(){return fe.x_f(this.$.ya.SlowNetworkMeasurementsSamplePercentage)}w7i(){this.nFb=this.$.ya.NumberOfRequestToWaitPerNetworkMeasurement;this.szd=1E3*this.$.ya.MinTimeBetweenNetworkMeasurementInSec;const Eb=this.$.ya.NetworkMeasurementsSamplePercentage;0<this.nFb&&0<this.szd&&(this.STd=fe.x_f(Eb))&&this.Ofi()}x7i(){if(!this.kAc){this.kAc=new Z.a;const Eb=Ke.a.ved(this.ymj,"PrepareAndInitSlowNetworkTests.ConnectionSpeedTest",this.$,[Fd.a.PFc]);for(const Ac of Eb)this.kAc.add(Ac);this.$.ea.Ae.nr&&
this.nWd("PrepareAndInitSlowNetworkTests")}}static x_f(Eb){return 100*Math.random()<Eb}}Object(b.a)(fe,"NetworkMeasurement",null,[2]);var ne=a(132),ce=a(799);class te{constructor(Eb){this._count=0;this.sessionID=this.allOfflinePartialInteractivitiesDataInSession=null;this.allOfflinePartialInteractivitiesDataInSession=[];this.sessionID=Eb}get count(){return this._count}get YT(){return this.allOfflinePartialInteractivitiesDataInSession[this.allOfflinePartialInteractivitiesDataInSession.length-1]}SZj(){this.YT&&
this.YT.v4f()}LJg(Eb){this.allOfflinePartialInteractivitiesDataInSession.push(Eb);this._count++}}Object(b.a)(te,"OfflinePartialInteractivitiesDataForLog",null,[]);class we extends ge{constructor(Eb,Ac,ld){super(Eb,Ac,ld);this.timeFromLastOffline=0;this._errorDataDuringOfflineMode=null;this.timeFromLastOffline=-1;this.type=5}HBj(Eb){this.timeFromLastOffline=Eb}cyj(Eb){this._errorDataDuringOfflineMode=Eb}}Object(b.a)(we,"OfflinePartialInteractivityData",ge,[]);class Pe{constructor(Eb,Ac){this.EOa=this.YT=
null;this.JHd=-1;this.xvb=null;this.tpf=A.Task.delay(0);this.E$a=(ld,Vd)=>{Vd.HL?this.UWi(Vd.ioa):this.VWi()};this.Fca=(ld,Vd)=>{5===Vd.QLf&&this.o3a()};this.H0f=(ld,Vd)=>{this.YT.cyj(Vd.sU)};this.o3a=()=>{this.EOa.SZj();this.fsj(Pe.KFd,Sys.Serialization.JavaScriptSerializer.serialize(this.EOa))};this.Ymj=ld=>{if(ld=ld.result)this.$mg=!0,e.ULS.sendTraceTag(576811915,0,50,`OfflineModeTelemetryManager.ReportOfflinePartialInteractivityDataFromIDB: Previous session's offline partial interactivy data: ${ld}`)};
this.rhj=()=>{this.$mg&&(this.$?cd.TaskExtensions.za(this.indexedDB.e8c(Pe.KFd),()=>{e.ULS.sendTraceTag(537155204,0,50,"OfflineModeTelemetryManager.RemoveDataFromIDB: Previous session's offline partial interactivy data successfuly removed from IDB.")},this.$.la):e.ULS.sendTraceTag(537155203,0,10,"OfflineModeTelemetryManager.RemoveDataFromIDB: EwaControl is null when attempting to remove offline mode data stored in IDB."))};this.JOa=()=>{if(this.EOa&&0<this.EOa.count){const ld=Sys.Serialization.JavaScriptSerializer.serialize(this.EOa);
e.ULS.sendTraceTag(560791644,0,50,`OfflineModeTelemetryManager.OnBeforeUnload: This session's offline partial interactivy data: ${ld}`)}};this.$=Eb;this.indexedDB=Ac;this.$mg=!1;this.indexedDB.Fe()&&(this.indexedDB.initialize(Pe.wzb,Pe.xzb),this.tmj(),this.EOa=new te(this.$.ya.UserSessionId),Hd.a(this.$).Sf.nXc(this.E$a));this.Cm=ne.a.instance.KG();this.Cm.ka("beforeunload",this.JOa)}dispose(){this.$&&Hd.a(this.$)&&Hd.a(this.$).Sf.dMd(this.E$a);jd.a.Ja(this.xvb);this.$=this.xvb=null}UWi(Eb){this.YT=
new we(Vb.a.Ya.Ub,this.$,0!==Eb);this.YT.HBj(-1!==this.JHd?window.performance.now()-this.JHd:-1);this.EOa.LJg(this.YT);Hd.a(this.$).Sf.tXc(this.Fca);this.o3a();this.xvb=Q.a.instance.wC(this.o3a,Pe.FIh,ua.a.o3a);Ob.a(this.$).cXc(this.H0f)}VWi(){this.YT.TDd(this.$);this.o3a();jd.a.Ja(this.xvb);this.xvb=null;this.JHd=window.performance.now();Hd.a(this.$).Sf.Puc(this.Fca);Ob.a(this.$).RLd(this.H0f);this.zmj()}fsj(Eb,Ac){this.$?this.tpf=cd.TaskExtensions.za(this.tpf,()=>{this.indexedDB.adb(new ce.a(Eb,
Ac))},this.$.la):e.ULS.sendTraceTag(537155205,0,15,"OfflineModeTelemetryManager.SaveToIndexedDBSequential: EwaControl is null when attempting to write to IDB")}tmj(){const Eb=this.$.la;cd.TaskExtensions.za(cd.TaskExtensions.za(this.indexedDB.yKa(Pe.KFd),this.Ymj,Eb),this.rhj,Eb)}zmj(){if(this.YT){const Eb=Sys.Serialization.JavaScriptSerializer.serialize(this.YT);Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_71qb3_Offline")?td.b().JLb(560791645,0,50,$c.offline,this.YT.durationMs,
"OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: {0}",Eb):e.ULS.sendTraceTag(560791645,0,50,`OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: ${Eb}`)}this.YT&&this.YT.isToastShown&&nd.Health.instance.recordQosError(Mc.a.Q2j,[Dc.a.olc],!0,!1,!1,!1,null)}}Pe.wzb="NetworkAvailability";Pe.xzb="NetworkAvailabilityData";Pe.KFd="partialInteractivityData";Pe.FIh=3E3;Object(b.a)(Pe,
"OfflineModeTelemetryManager",null,[2]);var qf=a(1319);const Ve=Eb=>{Eb.isSuccess||(Eb=Sys.Serialization.JavaScriptSerializer.serialize(Eb),e.ULS.sendTraceTag(509669840,0,10,Eb))};class Qe{constructor(Eb,Ac){this.Gla=this.uAd=this.Vyf=null;this.$=Eb;Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&aa.a.Cf||(this.Vyf=new Pe(Eb,Ac));Ba.EwaSettings.sa(199)&&(this.uAd=new fe(this.$),this.uAd.rfi());!Ba.EwaSettings.sa(483)||Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&
aa.a.Cf||(this.Gla=new ae.NetworkConnectionHealthChecker(this.$));this.W8g=new Yd(this.$);Ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.1CdnDarkTestEnabled",!1)&&(Eb=this.$,Ac=Ba.EwaSettings.getStringFeatureGate("Microsoft.Office.Excel.1CdnDarkTestTargetUrl",""),""!==Ac&&(new qf.a(Eb,"1CDN",Ac,Ve,"runOneCdnNetworkTest")).runTest())}dispose(){jd.a.Ja(this.Vyf);jd.a.Ja(this.uAd);jd.a.Ja(this.Gla);jd.a.Ja(this.W8g);this.$=null}}Object(b.a)(Qe,"NetworkConnectionTelemetryManager",null,[2]);
class Ze extends ge{constructor(Eb,Ac,ld,Vd){super(Eb,Ac,ld);this.wasInteruptedByOfflineMode=!1;this.type=Vd;this.wasInteruptedByOfflineMode=!1}E$a(){this.wasInteruptedByOfflineMode=!0}}Object(b.a)(Ze,"SilentReopenData",ge,[]);class Re{constructor(Eb){this.l7=null;this.OIf=(Ac,ld)=>{this.LIf(ld,3)};this.dFf=(Ac,ld)=>{this.LIf(ld,2)};this.$=Eb;this.Sf=Hd.a(this.$).Sf;this.Sf.Vqe(this.dFf);this.Sf.OOg(this.OIf)}dispose(){this.Sf.vWf(this.dFf);this.Sf.glj(this.OIf);this.l7=this.Sf=this.$=null}LIf(Eb,
Ac){Eb.HL?this.l7=new Ze(Vb.a.Ya.Ub,this.$,0!==Eb.ioa,Ac):(5===Eb.ioa&&(this.l7.wasInteruptedByOfflineMode=!0),3!==Eb.ioa&&2!==Eb.ioa||e.ULS.sendTraceTag(537155202,0,10,"SilentReopenPartialInteractivityTelemetryManager.OnSilentReopen: BackToWork/DuringWork partial interactivity has been swapped to DuringWork/BackToWork."),this.l7.TDd(this.$),2===Ac?Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_8dtae_B2W")?td.b().KLb(571289604,0,50,$c.offline,this.l7.durationMs,this.l7):
e.ULS.sendTraceTag(571289604,0,50,vd.a.Dc(this.l7)):Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_6w9lg_DuringWork")?td.b().KLb(542782150,0,50,$c.Lph,this.l7.durationMs,this.l7):e.ULS.sendTraceTag(542782150,0,50,vd.a.Dc(this.l7)),this.l7=null)}}Object(b.a)(Re,"SilentReopenPartialInteractivityTelemetryManager",null,[2]);class Za extends nc.a{constructor(Eb,Ac,ld=!0){super();this.s0=this.H4b=this.FOa=this.Una=this.KSa=null;this.dxf=0;this.Ttc=this.Tbb=this.Ubb=!1;this.exf=
this.documentVisibilityObserver=null;this.mqa=!1;this.jnd=this.u7=0;this.BBb=!1;this.Y$f=0;this.KTd=!1;this.D0=null;this.PFf=()=>{e.ULS.sendTraceTag(537155219,0,50,"NetworkConnectionStateManager.OnNetworkDownEvent: Network down.");this.gnc(1,!1)};this.PH=()=>{this.Cka||this.KDb?window.setTimeout(()=>{this.TYd()},this.dxf):this.TYd();this.documentVisibilityObserver.Uza(this.PH);this.BBb=!1};this.$f=()=>{e.ULS.sendTraceTag(537155218,0,50,`NetworkConnectionStateManager.OnEditEnded: Edit ended. IsInOfflineMode:${this.KDb}, IsInDuringWorkSilentReopenMode:${this.$lc&&
!this.mqa}`);this.KDb&&this.mne();this.$lc&&!this.mqa&&this.jne();oa.h(this.$).mc.$l(this.$f);this.Ubb=this.Tbb=!1};this.QFf=()=>{e.ULS.sendTraceTag(537155213,0,50,"NetworkConnectionStateManager.OnNetworkResumedEvent: network was resumed.");this.gnc(1,!0);this.Tbb&&!this.Ubb&&oa.h(this.$).mc.$l(this.$f);this.Tbb=!1};this.Eca=(Vd,Od)=>{this.jnd=this.u7;this.u7=Od.fCc};this.NIf=()=>{this.$&&(this.Ttc||(Qa.a(this.$).dQ(Ma.a.qPa).vMg(this.ZFf),this.$.Lk(this.dd),this.Ttc=!0),this.mqa=this.Jli(),this.gnc(2,
!1))};this.ZFf=()=>{var Vd=Qa.a(this.$).Rh;const Od=Vd.GSg();Vd=Yb.f(Vd.Ds.gd.errors,he=>he.MessageIdName);e.ULS.sendTraceTag(545842889,0,50,`NetworkConnectionStateManager.OnOpenWebMethodErrorUserAlertExecuting: IsStateUnrecoverable:${Od}, IsB2W:${this.mqa}, Errors: ${vd.a.Dc(Vd)}`);Od&&(this.KSa?(this.mqa=!1,this.mKe(),this.iDc()):this.Una&&(this.nKe(),this.iDc()))};this.dd=()=>{this.$?(e.ULS.sendTraceTag(541193955,0,50,"NetworkConnectionStateManager.OnWorkbookOpened: Workbook opened."),this.mqa=
!1,this.s0&&this.s0.ep&&(jd.a.Ja(this.s0),this.s0=null),this.D0&&this.D0.ep&&(jd.a.Ja(this.D0),this.D0=null),this.gnc(2,!0),this.iDc()):e.ULS.sendTraceTag(537155212,0,10,"NetworkConnectionStateManager.OnWorkbookOpened: bug monitoring: EwaControl is null.")};this.jBf=()=>{this.dwf(!0)};this.kBf=()=>{this.dwf(!1)};this.wXb=Td.Tzi;this.c4c=Td.connected;this.$=Eb;this.Re=Eb.oa.Re;ld&&(this.exf=new Qe(Eb,Ac));this.$.da.gb(291,Vd=>{this.documentVisibilityObserver=Vd});this.dxf=this.$.ya.ExcelNetworkCheckAfterTabActivationDelayMs;
this.Re.are(this.PFf);this.Re.iob(this.QFf);this.Re.mqe(this.jBf);this.Re.bMg(this.kBf);new Re(this.$,this);this.Msf=this.$.ya.LongInactivityTimePeriodSeconds;this.$.ea.JXc(this.NIf);this.$.ea.Ae.w9(this.Eca);this.Y$f=this.$.ya.SilentReopenDuringWorkDelayMs}get Pni(){return this.mqa}get KDb(){return!(this.wXb&1)}get $lc(){return!(this.wXb&2)}get Cka(){return!!(this.c4c&2)}dispose(){this.Re&&(this.Re.BWf(this.PFf),this.Re.NJb(this.QFf),this.Re.UVf(this.jBf),this.Re.Wij(this.kBf));this.BBb&&this.documentVisibilityObserver&&
(this.documentVisibilityObserver.Uza(this.PH),this.BBb=!1);this.$&&(this.Ttc&&this.iDc(),this.$.ea&&(this.$.ea.MWf(this.NIf),this.$.ea.Ae&&this.$.ea.Ae.Wza(this.Eca)));this.D0&&(this.D0.dispose(),this.D0=null);jd.a.Ja(this.exf);this.$=null;super.dispose()}jGi(){this.KTd=!0}jne(){this.Una||(this.Una=Hd.a(this.$).Sf.uYa(3,"NetworkConnectionStateManager.ActivateDuringWorkSilentReopenPartialInteractivity"))}Jli(){if(this.KTd)return this.KTd=!1,!0;const Eb=this.u7>this.Msf||this.jnd>this.Msf&&10>this.u7;
e.ULS.sendTraceTag(537155223,0,50,`NetworkConnectionStateManager.IsBackToWorkSilentReopen: Inactivity duration: Time from last activity:${this.u7}, Time gap between last two activities: ${this.jnd}. return value:${Eb}`);return Eb}knj(){this.D0=Q.a.instance.create(()=>{nd.Health.instance.recordQosError(Mc.a.tLj,[Dc.a.olc],!0,!0,!1,!1,null)},6E3,"ReportLongSilentReopenBackToWorkVeto",void 0,!0)}pHg(){this.Una||this.s0?e.ULS.sendTraceTag(542782155,0,10,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Trying to activate during-work partial interactivity when we are already in this partial interactivity or there is a running timer that's going to do it soon."):
this.s0=Q.a.instance.create(()=>{this.$?this.Una?e.ULS.sendTraceTag(537155221,0,15,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Tried to activate SilentReopenDuringWork PI when there is already an DuringWorkSilentReopen partial interactivity object"):oa.h(this.$).fb?(this.Tbb||(oa.h(this.$).mc.Jm(this.$f),e.ULS.sendTraceTag(541893722,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Registered OnEditEnded while during-work silent reopen")),this.Ubb=
!0,e.ULS.sendTraceTag(537155220,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Need to init during-work silent reopen partial interactivity but the user is during a cell edit. Registered to OnEditEnded event.")):this.jne():e.ULS.sendTraceTag(537155222,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: EwaControl is null")},this.Y$f,ua.a.rKj,void 0,!0)}dwf(Eb){this.c4c=this.kze(2,Eb,!0);this.kse()}gnc(Eb,Ac){this.wXb=this.kze(Eb,Ac,!1);this.kse()}kze(Eb,
Ac,ld){ld=ld?this.c4c:this.wXb;return Ac?ld|Eb:ld&~Eb}TYd(){const Eb=!!this.FOa,Ac=!!this.KSa,ld=!!this.Una,Vd=!!this.H4b;this.KDb&&!Eb?this.oHg():!this.KDb&&Eb&&this.rjh();!this.$lc||Ac||ld?this.$lc||(Ac?this.mKe():(ld||this.s0&&this.s0.ep)&&this.nKe()):this.mqa?this.mHg():this.s0||this.pHg();this.Cka&&!Vd?this.dfg(!0):!this.Cka&&Vd&&this.dfg(!1)}oHg(){this.$?this.FOa?e.ULS.sendTraceTag(537155215,0,15,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Tried to activate offline PI when there is already an offline partial interactivity object"):
oa.h(this.$).fb?(this.Ubb||(oa.h(this.$).mc.Jm(this.$f),e.ULS.sendTraceTag(537155217,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Registered OnEditEnded during offline mode")),this.Tbb=!0,e.ULS.sendTraceTag(537155216,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Turned offline while user is editing a cell, registered to OnEditEnded event.")):this.mne():e.ULS.sendTraceTag(537155214,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: EwaControl is null")}mne(){this.FOa||
(this.FOa=Hd.a(this.$).Sf.uYa(5,"NetworkConnecStateManager.ActivateOfflinePartialInteractivity"))}rjh(){this.FOa&&(jd.a.Ja(this.FOa),this.FOa=null)}mKe(){this.KSa&&(jd.a.Ja(this.KSa),this.KSa=null);this.D0&&this.D0.ep&&this.D0.cancel();this.D0=null}nKe(){this.Una&&(jd.a.Ja(this.Una),this.Una=null);this.s0&&(jd.a.Ja(this.s0),this.s0=null);this.Ubb&&!this.Tbb&&oa.h(this.$).mc.$l(this.$f);this.Ubb=!1}mHg(){this.KSa||(this.KSa=Hd.a(this.$).Sf.uYa(2,"NetworkConnectionStateManager.ActivateLongInactivitySilentReopenPartialInteractivity",
void 0,wd.a.instance.ga(2187)));this.knj()}dfg(Eb){Eb?(this.H4b=Hd.a(this.$).Sf.uYa(4,"NetworkConnectionStateManager.ConnectivityIssues"),this.t$i()):(jd.a.Ja(this.H4b),this.H4b=null)}t$i(){if(this.$&&this.$.oa){const Eb=this.$.oa.xa.Wb();xa.I(this.$.oa.xa,null,null,null,Eb)}}iDc(){Qa.a(this.$).dQ(Ma.a.qPa).Iq(this.ZFf);this.$.pl(this.dd);this.Ttc=!1}kse(){this.documentVisibilityObserver||e.ULS.sendTraceTag(537155211,0,15,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: Document visibility observer is null while it shouldn't be.");
this.documentVisibilityObserver&&this.documentVisibilityObserver.Vh?this.BBb||(this.documentVisibilityObserver.Qra(this.PH),this.BBb=!0,e.ULS.sendTraceTag(541193954,0,50,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: tabbed out user, will update the partial interactivity state when the user will be back.")):this.TYd()}}Object(b.a)(Za,"NetworkConnectionStateManager",nc.a,[718,2]);var Xb=a(105),jb=a(186);class Sb extends Ea.a{constructor(Eb){super();this.$=Eb;this.Db()}create(){Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:7476522_IDBNewService2")?
void jb.a.resolve(Xb.i,{Tl:this.Xa}).then(Eb=>{let Ac=Object(Ca.a)(this.$.da,400,()=>new Za(this.$,Eb));this.nb(Ac)}):cd.TaskExtensions.za(fc.GetServiceTaskFactory.Oa(this.$.da,395,396,this.Xa),Eb=>{let Ac=Object(Ca.a)(this.$.da,400,()=>new Za(this.$,Eb.result));this.nb(Ac)},this.$.la,3)}static ka(Eb){Eb.da.Ha(401,new Sb(Eb))}}Object(b.a)(Sb,"NetworkConnectionStateManagerFactory",Ea.a,[]);var lc=a(1278),oc=a(1181),Qc=a(1240),Kb=a(122),hc=a(109),Cc=a(151),Ka=a(324);class Ib{constructor(Eb){this.cOa=
this.Zxd=this.fOa=this.lmc=0;this.Sxd=this.Xtf=null;Eb?(this.tmc=Eb,this.gtb=Date.now,this.jfh(),this.Wfj()):e.ULS.sendTraceTag(520955213,209,10,"Can not initialize PenMinutesManager because TaskManager is null")}bAj(){this.Xtf="Office.Excel.Online.Data.Activity.PenMinutes"}Wfj(){window.document.body.addEventListener("pointerenter",Object(w.a)(this,this.Vpc,"onPointerEnter"));window.document.body.addEventListener("pointerleave",Object(w.a)(this,this.Cca,"onPointerLeave"));ca.a.instance.Tb("Common.App.VisibilityManagement.IVisibilityManager").execute(Eb=>
{Eb.nre(Object(w.a)(this,this.lyb,"handleVisibilityChange"))})}Vpc(Eb){"pen"!==Eb.pointerType||this.fOa||(this.fOa=Math.floor(this.gtb()/1E3),this.fOa<=this.lmc&&(this.fOa=this.lmc),this.Zxd=0)}Cca(){this.S$e()}S$e(){const Eb=Math.ceil(this.gtb()/1E3);this.fOa&&Eb>this.lmc&&(this.Zxd=Eb,this.cOa+=this.Zxd-this.fOa);this.lmc=Eb;this.fOa=0}lyb(Eb,Ac){0!==Ac.newState&&this.S$e()}jfh(){this.Sxd=new hc.a(4,2,6E4,Object(w.a)(this,this.$Ci,"logPenUsage"));this.tmc.fg(this.Sxd)}$Ci(){0<this.cOa&&this.N2f(this.cOa);
this.cOa=0}N2f(Eb){const Ac=new Ka.a;Ac.name=this.Xtf;const ld=[];(Eb=Kb.a.jh("PenInputSec",Eb.toString(),3))&&Array.add(ld,Eb);Ac.dataFields=ld;Cc.a.sendActivityEvent(Ac)}dispose(){0<this.cOa&&this.N2f(this.cOa);this.tmc.So(this.Sxd)}}Object(b.a)(Ib,"PenMinutesManager",null,[554]);class dc{constructor(){this.KQc=this.$a=null}get name(){return"Common.App.PenMinutesManager"}Ah(Eb){this.$a=Eb;const Ac=f.AFrameworkApplication.hi;this.$a.register(554,"Common.App.PenMinutesManager.IPenMinutesManager").qc().yc(()=>
new Ib(Ac))}init(){this.KQc=this.$a.resolve("Common.App.PenMinutesManager.IPenMinutesManager")}dispose(){this.KQc&&this.KQc.dispose()}static main(){P.a.instance.gi(new dc)}}Object(b.a)(dc,"PenMinutesManagerPackage",null,[4,5]);class yc extends Ea.a{constructor(Eb){super();this.$=Eb;this.Db()}static ka(Eb){Eb.da.Ha(514,new yc(Eb))}create(){this.nb(Object(Ca.a)(this.$.da,513,()=>{Type.registerNamespace("Common.App.PenMinutesManager");dc.main();const Eb=ca.a.instance.resolve("Common.App.PenMinutesManager.IPenMinutesManager");
Eb.bAj();return Eb}))}}Object(b.a)(yc,"PenMinutesFactory",Ea.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.InsertPicture");Type.registerNamespace("_Ewa");Object(c.a)();Object(Ha.a)();Object(Sa.a)();Object(Da.a)();Object(ea.a)();Object(mb.a)();Object(W.a)();Object(Qc.a)();Type.registerNamespace("Common.App.InProductMessaging");X.main();Type.registerNamespace("Common.App.FirstRunExperienceLauncher");ia.main();(()=>{sa.a.Fa(()=>{sa.a.Fa(db.ka)})})();(()=>{sa.a.Fa(()=>{sa.a.Fa(kb.ka)})})();
sa.a.Fa(Qd.ka);sa.a.Fa(Sb.ka);(()=>{sa.a.Fa(Eb=>{yc.ka(Eb)})})();Object(lc.a)();Object(oc.a)()},871:function(t,F,a){a.r(F);t=a(0);var c=a(7),b=a(15),e=a(322),f=a(29),d=a(11),h=a(240);class m{constructor(){this.scenario=null;this.timeElapsed=0;this.isNewSession=!1;this.rawData=null}}Object(t.a)(m,"ConnectionErrorLogInfo",null,[]);var l=a(1138),v=a(1139);class r{constructor(x){this.vmd=[l.a.xog,l.a.PFc];this.cn=(n,u)=>{this.PN[u]=n;this.jbi()&&this.cnj("OnNetworkDownImmediatePing"===n.caller)};this.Gla=
x;this.$=x.$;this.PN={}}pyi(){const x=v.a.ved(this.cn,"OnNetworkDownImmediatePing",this.$,this.vmd);for(const n of x)n.runTest()}jbi(){for(const x of this.vmd)if(void 0===this.PN[x]||null===this.PN[x])return!1;return!0}cnj(x){const n=this.$.Re.S4;x&&this.tOj(n);for(var u of this.vmd)this.PN[u]=Sys.Serialization.JavaScriptSerializer.serialize(this.PN[u]);x=Date.now();u=this.Gla.ojd(a(871).NetworkConnectionHealthChecker.SEb).returnValue;const z=this.Gla.ojd(a(871).NetworkConnectionHealthChecker.MLb).returnValue;
this.PN.isOfflineMode=n;this.PN.networkDownBBAge=-1===u?u:x-u;this.PN.transientServerCommunicationFailuresBBAge=-1===z?z:x-z;this.Gla.businessBar?(this.PN.isNetworkDownBBShown=this.Gla.businessBar.GG(56).toString(),this.PN.isServerErrorBBShown=this.Gla.businessBar.GG(21).toString()):(this.PN.isNetworkDownBBShown="unknown",this.PN.isServerErrorBBShown="unknown");b.ULS.sendTraceTag(537155224,0,50,`ConnectionHealthTestsRunner.ReportPingResults: ${Sys.Serialization.JavaScriptSerializer.serialize(this.PN)}`)}tOj(x){const {NetworkConnectionHealthChecker:n}=
a(871),u={};for(const z of Object.keys(this.PN)){const w=this.PN[z];u[w.testName]=w.isSuccess}u.isOfflineMode=x;this.Gla.WWd(n.b4c,Sys.Serialization.JavaScriptSerializer.serialize(u))}}Object(t.a)(r,"ConnectionHealthTestsRunner",null,[]);a.d(F,"NetworkConnectionHealthChecker",function(){return A});class A{constructor(x){this.businessBar=this.w8a=null;this.fOi=(n,u)=>{u.K8c?this.hOi(u):this.gOi(u)};this.eh=(n,u)=>{n=u.context.methodName;this.w8a&&n===this.w8a&&(b.ULS.sendTraceTag(537155230,0,50,`NetworkConnectionHealthChecker.OnWebMethodSuccess: Failed web method "${this.w8a}" has now succeeded. Querying local storage for BB showings.`),
this.V8a(A.MLb,!0),this.w8a=null);this.bsf(!1);this.G4b=!1};this.wm=(n,u)=>{f.a.dh(u.errors,[-1387426400])&&!this.G4b&&(this.G4b=!0,this.k8f()&&window.performance.mark(A.Uyf),(new r(this)).pyi())};this.Jf=()=>{this.bsf(!0);this.V8a(A.SEb,!1);this.V8a(A.MLb,!1)};this.Hya=()=>{b.ULS.sendTraceTag(537155225,0,50,"NetworkConnectionHealthChecker.OnNetworkResumed: Network resumed for session. Querying local storage for BB showings.");this.V8a(A.SEb,!0)};this.$=x;this.oa=this.$.oa;this.localStorage=new h.a;
this.G4b=!1;this.$.ea.Dk(this.Jf);this.oa.Re.iob(this.Hya);this.oa.Xq(this.eh);this.$.da.gb(5,n=>{this.businessBar=n;n.HLg(this.fOi)});this.oa.ox(this.wm)}dispose(){this.$&&(this.$.ea&&this.$.ea.Bn(this.Jf),this.oa&&(this.oa.Re.NJb(this.Hya),this.oa.ky(this.wm),this.oa.ps(this.eh)))}hOi(x){const n={};n.Timestamp=Date.now().toString();switch(x.B_a){case 21:this.w8a=x.data.FailedMethod;n.FailedMethod=this.w8a;this.WWd(A.MLb,JSON.stringify(n));break;case 56:this.WWd(A.SEb,JSON.stringify(n))}}gOi(x){switch(x.B_a){case 21:this.V8a(A.MLb,
!0);break;case 56:this.V8a(A.SEb,!0)}}WWd(x,n){try{this.localStorage.Fe()&&this.localStorage.setItem(x,n)}catch(u){b.ULS.sendTraceTag(537155231,0,15,`NetworkConnectionHealthChecker.StoreDataInLocalStorage: Failed to set item to local storage. reason: ${u.message||"Unknown"}`)}}ojd(x){if(this.localStorage.Fe()&&(x=this.localStorage.x4a(x))&&"null"!==x){var n=JSON.parse(x);x=parseInt(n.Timestamp,10);n=Sys.Serialization.JavaScriptSerializer.serialize(n);return{returnValue:x,rawData:n}}return{returnValue:-1,
rawData:null}}bsf(x){if(this.localStorage.Fe()){const n=this.localStorage.x4a(A.b4c);if(n&&"null"!==n){let u=-1;this.G4b&&(u=this.NTh(A.Uyf,A.QMi));b.ULS.sendTraceTag(537155229,0,50,`NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: Ping Results: ${Sys.Serialization.JavaScriptSerializer.serialize(n)}, Period offline: ${u}, New session: ${x}`);this.localStorage.removeItem(A.b4c)}}}NTh(x,n){if(!this.k8f())return-1;window.performance.measure(n,x);x=window.performance.getEntriesByName(n);
return x.length&&x[x.length-1]?x[x.length-1].duration:(b.ULS.sendTraceTag(537155228,0,10,`NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: measure name ${n} returned no measures.`),-1)}V8a(x,n){try{let u;const z=({rawData:u}=this.ojd(x)).returnValue;if(-1!==z){const w=Object(c.a)(new m,{timeElapsed:Date.now()-z,scenario:x,isNewSession:!n,rawData:u});b.ULS.sendTraceTag(537155227,0,50,`NetworkConnectionHealthChecker.LogNetworkIssueBBShown: ${JSON.stringify(w)}`)}this.localStorage.removeItem(x)}catch(u){b.ULS.sendTraceTag(537155226,
0,15,`NetworkConnectionHealthChecker.LogNetworkIssueBBShown: Failed to get item from local storage. reason: ${u.message||"Unknown"}`)}}k8f(){return d.HelperMethods.L_c&&e.a.bqb}}A.SEb="NetworkDownBBShown";A.MLb="ServerCommunicationFailureBBShown";A.b4c="ConnectionHealthPingRsults";A.Uyf="offMoStMa";A.QMi="offMoDuMea";Object(t.a)(A,"NetworkConnectionHealthChecker",null,[2])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.pi.js.map/b77915e8f228fff20b3f577c04be2c2a/EwaDSEsNext.pi.js.map